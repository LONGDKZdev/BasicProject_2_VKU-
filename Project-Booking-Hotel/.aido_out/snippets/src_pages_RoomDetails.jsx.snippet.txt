// snippet: src\pages\RoomDetails.jsx

import { ScrollToTop, Toast } from '../components';
import QRPayment from '../components/QRPayment';
import Invoice from '../components/Invoice';
import { useRoomContext } from '../context/RoomContext';
import { useAuth } from '../context/AuthContext';
import { hotelRules } from '../constants/data';
import { useParams } from 'react-router-dom';
import { FaCheck, FaStar } from 'react-icons/fa';
import { useMemo, useState } from 'react';

// Placeholder image - will be replaced by Supabase Storage URL
const PLACEHOLDER_IMG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Crect fill='%23ddd' width='800' height='600'/%3E%3Ctext x='50%' y='50%' font-size='24' fill='%23999' text-anchor='middle' dy='.3em'%3ELoading image...%3C/text%3E%3C/svg%3E";

const createLocalId = () => {
  if (typeof crypto !== 'undefined' && crypto.randomUUID) {
    return crypto.randomUUID();
  }
  return Date.now().toString();
};

const RoomDetails = () => {
  const { id } = useParams();
  const {
    allRooms,
    bookRoom,
    confirmBookingPayment,
    hasUserBookedRoom,
    addReview,
    calculatePricingForRoom,
  } = useRoomContext();
  const { user, isAuthenticated } = useAuth();

  // Support both numeric IDs (legacy) and UUID strings (new)
  const room = allRooms.find(roomItem => 
    roomItem.id === id || roomItem.id === Number(id)
  );

  const [reservation, setReservation] = useState({
    checkIn: '',
    checkOut: '',