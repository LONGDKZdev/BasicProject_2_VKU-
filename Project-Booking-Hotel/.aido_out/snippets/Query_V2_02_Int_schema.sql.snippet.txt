// snippet: Query_V2\02_Int_schema.sql

-- =====================================
-- 02_INIT_SCHEMA.SQL (UPDATED)
-- =====================================

create extension if not exists "pgcrypto";

-- ====== ENUMS ======
create type room_status as enum ('available', 'occupied', 'maintenance', 'cleaning');
create type booking_status as enum ('pending', 'pending_payment', 'approved', 'rejected', 'confirmed', 'checked_in', 'checked_out', 'modified', 'completed', 'cancelled');
create type price_rule_type as enum ('weekend', 'holiday', 'seasonal', 'season');
create type discount_type as enum ('percent', 'fixed');
create type account_status as enum ('active', 'inactive', 'suspended');

-- ====== FUNCTION UPDATE TIMESTAMP ======
create or replace function public.trigger_set_timestamp()
returns trigger language plpgsql as $$
begin
  new.updated_at = now();
  return new;
end$$;

-- ====== 1. PROFILES (UPDATED: Added status field) ======
create table if not exists public.profiles (
  id uuid primary key default gen_random_uuid(),
  email text unique not null,
  full_name text,
  phone text,
  avatar_url text,
  country text,
  city text,
  bio text,
  preferences jsonb not null default '[]'::jsonb,
  language text not null default 'en',
  newsletter boolean not null default true,
  role text not null default 'user', -- 'user', 'admin', 'staff'
  status account_status not null default 'active', -- NEW: account status
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create trigger set_profiles_updated_at before update on public.profiles for each row execute procedure public.trigger_set_timestamp();