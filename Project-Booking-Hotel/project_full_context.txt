PROJECT SNAPSHOT
Generated at: 2025-12-12T12:23:15.234Z

Total files found: 113
==================================================

--- START FILE: Backend\HotelBooking.API\appsettings.json ---
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "Supabase": {
    "Url": "https://sxteddkozzqniebfstag.supabase.co",
    "Key": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4dGVkZGtvenpxbmllYmZzdGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NjQwMDgsImV4cCI6MjA3NzQ0MDAwOH0.FYblHTFrNTthvpcdGy6DFefjnApCe4qwcKZaHdkTiac"
  },
  "ApiBaseUrl": "http://localhost:5000",
  "OAuth": {
    "Google": {
      "ClientId": "58279057551-8c4ref9g41f9ed1hkm6kvgfhln7jdub4.apps.googleusercontent.com",
      "ClientSecret": "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"
    },
    "Facebook": {
      "AppId": "1582823942902981",
      "AppSecret": "6642359113e8dfe9e5373f6ec875403a"
    },
    "RedirectUri": "http://localhost:5173"
  },
  "Email": {
    "SmtpHost": "smtp.gmail.com",
    "SmtpPort": "587",
    "SmtpUser": "vohuylong12393@gmail.com",
    "SmtpPassword": "byfmhiyqbyqbzqne",
    "FromEmail": "vohuylong12393@gmail.com",
    "FromName": "Test_API_Basci_Project_2"
  }
  
}


--- END FILE: Backend\HotelBooking.API\appsettings.json ---

--- START FILE: Backend\HotelBooking.API\bin\Debug\net8.0\appsettings.json ---
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "Supabase": {
    "Url": "https://sxteddkozzqniebfstag.supabase.co",
    "Key": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4dGVkZGtvenpxbmllYmZzdGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NjQwMDgsImV4cCI6MjA3NzQ0MDAwOH0.FYblHTFrNTthvpcdGy6DFefjnApCe4qwcKZaHdkTiac"
  },
  "ApiBaseUrl": "http://localhost:5000",
  "OAuth": {
    "Google": {
      "ClientId": "58279057551-8c4ref9g41f9ed1hkm6kvgfhln7jdub4.apps.googleusercontent.com",
      "ClientSecret": "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"
    },
    "Facebook": {
      "AppId": "1582823942902981",
      "AppSecret": "6642359113e8dfe9e5373f6ec875403a"
    },
    "RedirectUri": "http://localhost:5173"
  },
  "Email": {
    "SmtpHost": "smtp.gmail.com",
    "SmtpPort": "587",
    "SmtpUser": "vohuylong12393@gmail.com",
    "SmtpPassword": "byfmhiyqbyqbzqne",
    "FromEmail": "vohuylong12393@gmail.com",
    "FromName": "Test_API_Basci_Project_2"
  }
  
}


--- END FILE: Backend\HotelBooking.API\bin\Debug\net8.0\appsettings.json ---

--- START FILE: Backend\HotelBooking.API\bin\Debug\net8.0\HotelBooking.API.deps.json ---
{
  "runtimeTarget": {
    "name": ".NETCoreApp,Version=v8.0",
    "signature": ""
  },
  "compilationOptions": {},
  "targets": {
    ".NETCoreApp,Version=v8.0": {
      "HotelBooking.API/1.0.0": {
        "dependencies": {
          "Microsoft.AspNetCore.OpenApi": "8.0.0",
          "Swashbuckle.AspNetCore": "6.5.0"
        },
        "runtime": {
          "HotelBooking.API.dll": {}
        }
      },
      "Microsoft.AspNetCore.OpenApi/8.0.0": {
        "dependencies": {
          "Microsoft.OpenApi": "1.4.3"
        },
        "runtime": {
          "lib/net8.0/Microsoft.AspNetCore.OpenApi.dll": {
            "assemblyVersion": "8.0.0.0",
            "fileVersion": "8.0.23.53112"
          }
        }
      },
      "Microsoft.Extensions.ApiDescription.Server/6.0.5": {},
      "Microsoft.OpenApi/1.4.3": {
        "runtime": {
          "lib/netstandard2.0/Microsoft.OpenApi.dll": {
            "assemblyVersion": "1.4.3.0",
            "fileVersion": "1.4.3.0"
          }
        }
      },
      "Swashbuckle.AspNetCore/6.5.0": {
        "dependencies": {
          "Microsoft.Extensions.ApiDescription.Server": "6.0.5",
          "Swashbuckle.AspNetCore.Swagger": "6.5.0",
          "Swashbuckle.AspNetCore.SwaggerGen": "6.5.0",
          "Swashbuckle.AspNetCore.SwaggerUI": "6.5.0"
        }
      },
      "Swashbuckle.AspNetCore.Swagger/6.5.0": {
        "dependencies": {
          "Microsoft.OpenApi": "1.4.3"
        },
        "runtime": {
          "lib/net7.0/Swashbuckle.AspNetCore.Swagger.dll": {
            "assemblyVersion": "6.5.0.0",
            "fileVersion": "6.5.0.0"
          }
        }
      },
      "Swashbuckle.AspNetCore.SwaggerGen/6.5.0": {
        "dependencies": {
          "Swashbuckle.AspNetCore.Swagger": "6.5.0"
        },
        "runtime": {
          "lib/net7.0/Swashbuckle.AspNetCore.SwaggerGen.dll": {
            "assemblyVersion": "6.5.0.0",
            "fileVersion": "6.5.0.0"
          }
        }
      },
      "Swashbuckle.AspNetCore.SwaggerUI/6.5.0": {
        "runtime": {
          "lib/net7.0/Swashbuckle.AspNetCore.SwaggerUI.dll": {
            "assemblyVersion": "6.5.0.0",
            "fileVersion": "6.5.0.0"
          }
        }
      }
    }
  },
  "libraries": {
    "HotelBooking.API/1.0.0": {
      "type": "project",
      "serviceable": false,
      "sha512": ""
    },
    "Microsoft.AspNetCore.OpenApi/8.0.0": {
      "type": "package",
      "serviceable": true,
      "sha512": "sha512-T4mwMvPSOYAp+KeQ4xO8H2rxpiOMJ9W/7yBBkUTMp96AHtGlPN4s7hbax2tM61LxTY775JKL4fiv5grn41EHXw==",
      "path": "microsoft.aspnetcore.openapi/8.0.0",
      "hashPath": "microsoft.aspnetcore.openapi.8.0.0.nupkg.sha512"
    },
    "Microsoft.Extensions.ApiDescription.Server/6.0.5": {
      "type": "package",
      "serviceable": true,
      "sha512": "sha512-Ckb5EDBUNJdFWyajfXzUIMRkhf52fHZOQuuZg/oiu8y7zDCVwD0iHhew6MnThjHmevanpxL3f5ci2TtHQEN6bw==",
      "path": "microsoft.extensions.apidescription.server/6.0.5",
      "hashPath": "microsoft.extensions.apidescription.server.6.0.5.nupkg.sha512"
    },
    "Microsoft.OpenApi/1.4.3": {
      "type": "package",
      "serviceable": true,
      "sha512": "sha512-rURwggB+QZYcSVbDr7HSdhw/FELvMlriW10OeOzjPT7pstefMo7IThhtNtDudxbXhW+lj0NfX72Ka5EDsG8x6w==",
      "path": "microsoft.openapi/1.4.3",
      "hashPath": "microsoft.openapi.1.4.3.nupkg.sha512"
    },
    "Swashbuckle.AspNetCore/6.5.0": {
      "type": "package",
      "serviceable": true,
      "sha512": "sha512-FK05XokgjgwlCI6wCT+D4/abtQkL1X1/B9Oas6uIwHFmYrIO9WUD5aLC9IzMs9GnHfUXOtXZ2S43gN1mhs5+aA==",
      "path": "swashbuckle.aspnetcore/6.5.0",
      "hashPath": "swashbuckle.aspnetcore.6.5.0.nupkg.sha512"
    },
    "Swashbuckle.AspNetCore.Swagger/6.5.0": {
      "type": "package",
      "serviceable": true,
      "sha512": "sha512-XWmCmqyFmoItXKFsQSwQbEAsjDKcxlNf1l+/Ki42hcb6LjKL8m5Db69OTvz5vLonMSRntYO1XLqz0OP+n3vKnA==",
      "path": "swashbuckle.aspnetcore.swagger/6.5.0",
      "hashPath": "swashbuckle.aspnetcore.swagger.6.5.0.nupkg.sha512"
    },
    "Swashbuckle.AspNetCore.SwaggerGen/6.5.0": {
      "type": "package",
      "serviceable": true,
      "sha512": "sha512-Y/qW8Qdg9OEs7V013tt+94OdPxbRdbhcEbw4NiwGvf4YBcfhL/y7qp/Mjv/cENsQ2L3NqJ2AOu94weBy/h4KvA==",
      "path": "swashbuckle.aspnetcore.swaggergen/6.5.0",
      "hashPath": "swashbuckle.aspnetcore.swaggergen.6.5.0.nupkg.sha512"
    },
    "Swashbuckle.AspNetCore.SwaggerUI/6.5.0": {
      "type": "package",
      "serviceable": true,
      "sha512": "sha512-OvbvxX+wL8skxTBttcBsVxdh73Fag4xwqEU2edh4JMn7Ws/xJHnY/JB1e9RoCb6XpDxUF3hD9A0Z1lEUx40Pfw==",
      "path": "swashbuckle.aspnetcore.swaggerui/6.5.0",
      "hashPath": "swashbuckle.aspnetcore.swaggerui.6.5.0.nupkg.sha512"
    }
  }
}
--- END FILE: Backend\HotelBooking.API\bin\Debug\net8.0\HotelBooking.API.deps.json ---

--- START FILE: Backend\HotelBooking.API\bin\Debug\net8.0\HotelBooking.API.runtimeconfig.json ---
{
  "runtimeOptions": {
    "tfm": "net8.0",
    "frameworks": [
      {
        "name": "Microsoft.NETCore.App",
        "version": "8.0.0"
      },
      {
        "name": "Microsoft.AspNetCore.App",
        "version": "8.0.0"
      }
    ],
    "configProperties": {
      "System.GC.Server": true,
      "System.Runtime.Serialization.EnableUnsafeBinaryFormatterSerialization": false
    }
  }
}
--- END FILE: Backend\HotelBooking.API\bin\Debug\net8.0\HotelBooking.API.runtimeconfig.json ---

--- START FILE: Backend\HotelBooking.API\bin\Debug\net8.0\HotelBooking.API.staticwebassets.endpoints.json ---
{"Version":1,"ManifestType":"Build","Endpoints":[]}
--- END FILE: Backend\HotelBooking.API\bin\Debug\net8.0\HotelBooking.API.staticwebassets.endpoints.json ---

--- START FILE: Backend\HotelBooking.API\obj\Debug\net8.0\HotelBooking.API.sourcelink.json ---
{"documents":{"E:\\Storage\\StorageCode\\Year2\\Project\\*":"https://raw.githubusercontent.com/LONGDKZdev/BasicProject_2_VKU-/2e1a514dcb28b30545c3bae265143f47e1b46bae/*"}}
--- END FILE: Backend\HotelBooking.API\obj\Debug\net8.0\HotelBooking.API.sourcelink.json ---

--- START FILE: Backend\HotelBooking.API\obj\Debug\net8.0\rjsmcshtml.dswa.cache.json ---
{"GlobalPropertiesHash":"yS2n4UVXR83ky7tg2OHHfqfDW9MZAzPtPZEGQpaxA5E=","FingerprintPatternsHash":"8ZRc1sGeVrPBx4lD717BgRaQekyh78QKV9SKsdt638U=","PropertyOverridesHash":"8ZRc1sGeVrPBx4lD717BgRaQekyh78QKV9SKsdt638U=","InputHashes":["0jYB8W6lxvEoM4ux8MBwmg71OGoxM6yestTeZjEk7sY=","q5953jiudyzkEkDB5uciH3XsIBNNwzLrxXCw3oFycuY=","3B3qsh8nm0vsBTcBdlH5JPjZ0HLsovnSre7gIqF40yU=","Prn9iE2ZtJJFxbUtI2JrqVdLRBoxna2TLkZgUqg7X3w=","b0ABfInwra4Utws1vbeEMJjOvJTidZpFLdC\u002BWblwnz8="],"CachedAssets":{},"CachedCopyCandidates":{}}
--- END FILE: Backend\HotelBooking.API\obj\Debug\net8.0\rjsmcshtml.dswa.cache.json ---

--- START FILE: Backend\HotelBooking.API\obj\Debug\net8.0\rjsmrazor.dswa.cache.json ---
{"GlobalPropertiesHash":"mEmXf6lplqOeGkydc5toz9dU+SVMCyKsM+hrFIhczYs=","FingerprintPatternsHash":"8ZRc1sGeVrPBx4lD717BgRaQekyh78QKV9SKsdt638U=","PropertyOverridesHash":"8ZRc1sGeVrPBx4lD717BgRaQekyh78QKV9SKsdt638U=","InputHashes":["0jYB8W6lxvEoM4ux8MBwmg71OGoxM6yestTeZjEk7sY=","q5953jiudyzkEkDB5uciH3XsIBNNwzLrxXCw3oFycuY=","3B3qsh8nm0vsBTcBdlH5JPjZ0HLsovnSre7gIqF40yU=","Prn9iE2ZtJJFxbUtI2JrqVdLRBoxna2TLkZgUqg7X3w=","b0ABfInwra4Utws1vbeEMJjOvJTidZpFLdC\u002BWblwnz8="],"CachedAssets":{},"CachedCopyCandidates":{}}
--- END FILE: Backend\HotelBooking.API\obj\Debug\net8.0\rjsmrazor.dswa.cache.json ---

--- START FILE: Backend\HotelBooking.API\obj\Debug\net8.0\rpswa.dswa.cache.json ---
{"GlobalPropertiesHash":"TAdS6ghXQ0sPK4V/0AnoGmLBTSs/JLCEw0DAwiAffF0=","FingerprintPatternsHash":"gq3WsqcKBUGTSNle7RKKyXRIwh7M8ccEqOqYvIzoM04=","PropertyOverridesHash":"8ZRc1sGeVrPBx4lD717BgRaQekyh78QKV9SKsdt638U=","InputHashes":["0jYB8W6lxvEoM4ux8MBwmg71OGoxM6yestTeZjEk7sY="],"CachedAssets":{},"CachedCopyCandidates":{}}
--- END FILE: Backend\HotelBooking.API\obj\Debug\net8.0\rpswa.dswa.cache.json ---

--- START FILE: Backend\HotelBooking.API\obj\Debug\net8.0\staticwebassets.build.endpoints.json ---
{"Version":1,"ManifestType":"Build","Endpoints":[]}
--- END FILE: Backend\HotelBooking.API\obj\Debug\net8.0\staticwebassets.build.endpoints.json ---

--- START FILE: Backend\HotelBooking.API\obj\Debug\net8.0\staticwebassets.build.json ---
{"Version":1,"Hash":"8AI3vx1Pb/0qzG3iU5Qv5xJJ/9UQ3cvE4x6Qy3wPluU=","Source":"HotelBooking.API","BasePath":"_content/HotelBooking.API","Mode":"Default","ManifestType":"Build","ReferencedProjectsConfiguration":[],"DiscoveryPatterns":[],"Assets":[],"Endpoints":[]}
--- END FILE: Backend\HotelBooking.API\obj\Debug\net8.0\staticwebassets.build.json ---

--- START FILE: Backend\HotelBooking.API\obj\HotelBooking.API.csproj.nuget.dgspec.json ---
{
  "format": 1,
  "restore": {
    "E:\\Storage\\StorageCode\\Year2\\Project\\Project-Booking-Hotel\\Backend\\HotelBooking.API\\HotelBooking.API.csproj": {}
  },
  "projects": {
    "E:\\Storage\\StorageCode\\Year2\\Project\\Project-Booking-Hotel\\Backend\\HotelBooking.API\\HotelBooking.API.csproj": {
      "version": "1.0.0",
      "restore": {
        "projectUniqueName": "E:\\Storage\\StorageCode\\Year2\\Project\\Project-Booking-Hotel\\Backend\\HotelBooking.API\\HotelBooking.API.csproj",
        "projectName": "HotelBooking.API",
        "projectPath": "E:\\Storage\\StorageCode\\Year2\\Project\\Project-Booking-Hotel\\Backend\\HotelBooking.API\\HotelBooking.API.csproj",
        "packagesPath": "C:\\Users\\vohuy\\.nuget\\packages\\",
        "outputPath": "E:\\Storage\\StorageCode\\Year2\\Project\\Project-Booking-Hotel\\Backend\\HotelBooking.API\\obj\\",
        "projectStyle": "PackageReference",
        "fallbackFolders": [
          "D:\\VS Programing\\Microsoft Visual Studio\\Shared\\NuGetPackages"
        ],
        "configFilePaths": [
          "C:\\Users\\vohuy\\AppData\\Roaming\\NuGet\\NuGet.Config",
          "C:\\Program Files (x86)\\NuGet\\Config\\Microsoft.VisualStudio.FallbackLocation.config",
          "C:\\Program Files (x86)\\NuGet\\Config\\Microsoft.VisualStudio.Offline.config"
        ],
        "originalTargetFrameworks": [
          "net8.0"
        ],
        "sources": {
          "C:\\Program Files (x86)\\Microsoft SDKs\\NuGetPackages\\": {},
          "https://api.nuget.org/v3/index.json": {}
        },
        "frameworks": {
          "net8.0": {
            "targetAlias": "net8.0",
            "projectReferences": {}
          }
        },
        "warningProperties": {
          "warnAsError": [
            "NU1605"
          ]
        },
        "restoreAuditProperties": {
          "enableAudit": "true",
          "auditLevel": "low",
          "auditMode": "direct"
        },
        "SdkAnalysisLevel": "9.0.300"
      },
      "frameworks": {
        "net8.0": {
          "targetAlias": "net8.0",
          "dependencies": {
            "Microsoft.AspNetCore.OpenApi": {
              "target": "Package",
              "version": "[8.0.0, )"
            },
            "Swashbuckle.AspNetCore": {
              "target": "Package",
              "version": "[6.5.0, )"
            }
          },
          "imports": [
            "net461",
            "net462",
            "net47",
            "net471",
            "net472",
            "net48",
            "net481"
          ],
          "assetTargetFallback": true,
          "warn": true,
          "downloadDependencies": [
            {
              "name": "Microsoft.AspNetCore.App.Ref",
              "version": "[8.0.22, 8.0.22]"
            },
            {
              "name": "Microsoft.NETCore.App.Host.win-x64",
              "version": "[8.0.22, 8.0.22]"
            },
            {
              "name": "Microsoft.NETCore.App.Ref",
              "version": "[8.0.22, 8.0.22]"
            },
            {
              "name": "Microsoft.WindowsDesktop.App.Ref",
              "version": "[8.0.22, 8.0.22]"
            }
          ],
          "frameworkReferences": {
            "Microsoft.AspNetCore.App": {
              "privateAssets": "none"
            },
            "Microsoft.NETCore.App": {
              "privateAssets": "all"
            }
          },
          "runtimeIdentifierGraphPath": "C:\\Program Files\\dotnet\\sdk\\9.0.307/PortableRuntimeIdentifierGraph.json"
        }
      }
    }
  }
}
--- END FILE: Backend\HotelBooking.API\obj\HotelBooking.API.csproj.nuget.dgspec.json ---

--- START FILE: Backend\HotelBooking.API\obj\project.assets.json ---
{
  "version": 3,
  "targets": {
    "net8.0": {
      "Microsoft.AspNetCore.OpenApi/8.0.0": {
        "type": "package",
        "dependencies": {
          "Microsoft.OpenApi": "1.4.3"
        },
        "compile": {
          "lib/net8.0/Microsoft.AspNetCore.OpenApi.dll": {
            "related": ".xml"
          }
        },
        "runtime": {
          "lib/net8.0/Microsoft.AspNetCore.OpenApi.dll": {
            "related": ".xml"
          }
        },
        "frameworkReferences": [
          "Microsoft.AspNetCore.App"
        ]
      },
      "Microsoft.Extensions.ApiDescription.Server/6.0.5": {
        "type": "package",
        "build": {
          "build/Microsoft.Extensions.ApiDescription.Server.props": {},
          "build/Microsoft.Extensions.ApiDescription.Server.targets": {}
        },
        "buildMultiTargeting": {
          "buildMultiTargeting/Microsoft.Extensions.ApiDescription.Server.props": {},
          "buildMultiTargeting/Microsoft.Extensions.ApiDescription.Server.targets": {}
        }
      },
      "Microsoft.OpenApi/1.4.3": {
        "type": "package",
        "compile": {
          "lib/netstandard2.0/Microsoft.OpenApi.dll": {
            "related": ".pdb;.xml"
          }
        },
        "runtime": {
          "lib/netstandard2.0/Microsoft.OpenApi.dll": {
            "related": ".pdb;.xml"
          }
        }
      },
      "Swashbuckle.AspNetCore/6.5.0": {
        "type": "package",
        "dependencies": {
          "Microsoft.Extensions.ApiDescription.Server": "6.0.5",
          "Swashbuckle.AspNetCore.Swagger": "6.5.0",
          "Swashbuckle.AspNetCore.SwaggerGen": "6.5.0",
          "Swashbuckle.AspNetCore.SwaggerUI": "6.5.0"
        },
        "build": {
          "build/Swashbuckle.AspNetCore.props": {}
        }
      },
      "Swashbuckle.AspNetCore.Swagger/6.5.0": {
        "type": "package",
        "dependencies": {
          "Microsoft.OpenApi": "1.2.3"
        },
        "compile": {
          "lib/net7.0/Swashbuckle.AspNetCore.Swagger.dll": {
            "related": ".pdb;.xml"
          }
        },
        "runtime": {
          "lib/net7.0/Swashbuckle.AspNetCore.Swagger.dll": {
            "related": ".pdb;.xml"
          }
        },
        "frameworkReferences": [
          "Microsoft.AspNetCore.App"
        ]
      },
      "Swashbuckle.AspNetCore.SwaggerGen/6.5.0": {
        "type": "package",
        "dependencies": {
          "Swashbuckle.AspNetCore.Swagger": "6.5.0"
        },
        "compile": {
          "lib/net7.0/Swashbuckle.AspNetCore.SwaggerGen.dll": {
            "related": ".pdb;.xml"
          }
        },
        "runtime": {
          "lib/net7.0/Swashbuckle.AspNetCore.SwaggerGen.dll": {
            "related": ".pdb;.xml"
          }
        }
      },
      "Swashbuckle.AspNetCore.SwaggerUI/6.5.0": {
        "type": "package",
        "compile": {
          "lib/net7.0/Swashbuckle.AspNetCore.SwaggerUI.dll": {
            "related": ".pdb;.xml"
          }
        },
        "runtime": {
          "lib/net7.0/Swashbuckle.AspNetCore.SwaggerUI.dll": {
            "related": ".pdb;.xml"
          }
        },
        "frameworkReferences": [
          "Microsoft.AspNetCore.App"
        ]
      }
    }
  },
  "libraries": {
    "Microsoft.AspNetCore.OpenApi/8.0.0": {
      "sha512": "T4mwMvPSOYAp+KeQ4xO8H2rxpiOMJ9W/7yBBkUTMp96AHtGlPN4s7hbax2tM61LxTY775JKL4fiv5grn41EHXw==",
      "type": "package",
      "path": "microsoft.aspnetcore.openapi/8.0.0",
      "files": [
        ".nupkg.metadata",
        ".signature.p7s",
        "Icon.png",
        "THIRD-PARTY-NOTICES.TXT",
        "lib/net8.0/Microsoft.AspNetCore.OpenApi.dll",
        "lib/net8.0/Microsoft.AspNetCore.OpenApi.xml",
        "microsoft.aspnetcore.openapi.8.0.0.nupkg.sha512",
        "microsoft.aspnetcore.openapi.nuspec"
      ]
    },
    "Microsoft.Extensions.ApiDescription.Server/6.0.5": {
      "sha512": "Ckb5EDBUNJdFWyajfXzUIMRkhf52fHZOQuuZg/oiu8y7zDCVwD0iHhew6MnThjHmevanpxL3f5ci2TtHQEN6bw==",
      "type": "package",
      "path": "microsoft.extensions.apidescription.server/6.0.5",
      "hasTools": true,
      "files": [
        ".nupkg.metadata",
        ".signature.p7s",
        "Icon.png",
        "build/Microsoft.Extensions.ApiDescription.Server.props",
        "build/Microsoft.Extensions.ApiDescription.Server.targets",
        "buildMultiTargeting/Microsoft.Extensions.ApiDescription.Server.props",
        "buildMultiTargeting/Microsoft.Extensions.ApiDescription.Server.targets",
        "microsoft.extensions.apidescription.server.6.0.5.nupkg.sha512",
        "microsoft.extensions.apidescription.server.nuspec",
        "tools/Newtonsoft.Json.dll",
        "tools/dotnet-getdocument.deps.json",
        "tools/dotnet-getdocument.dll",
        "tools/dotnet-getdocument.runtimeconfig.json",
        "tools/net461-x86/GetDocument.Insider.exe",
        "tools/net461-x86/GetDocument.Insider.exe.config",
        "tools/net461-x86/Microsoft.Win32.Primitives.dll",
        "tools/net461-x86/System.AppContext.dll",
        "tools/net461-x86/System.Buffers.dll",
        "tools/net461-x86/System.Collections.Concurrent.dll",
        "tools/net461-x86/System.Collections.NonGeneric.dll",
        "tools/net461-x86/System.Collections.Specialized.dll",
        "tools/net461-x86/System.Collections.dll",
        "tools/net461-x86/System.ComponentModel.EventBasedAsync.dll",
        "tools/net461-x86/System.ComponentModel.Primitives.dll",
        "tools/net461-x86/System.ComponentModel.TypeConverter.dll",
        "tools/net461-x86/System.ComponentModel.dll",
        "tools/net461-x86/System.Console.dll",
        "tools/net461-x86/System.Data.Common.dll",
        "tools/net461-x86/System.Diagnostics.Contracts.dll",
        "tools/net461-x86/System.Diagnostics.Debug.dll",
        "tools/net461-x86/System.Diagnostics.DiagnosticSource.dll",
        "tools/net461-x86/System.Diagnostics.FileVersionInfo.dll",
        "tools/net461-x86/System.Diagnostics.Process.dll",
        "tools/net461-x86/System.Diagnostics.StackTrace.dll",
        "tools/net461-x86/System.Diagnostics.TextWriterTraceListener.dll",
        "tools/net461-x86/System.Diagnostics.Tools.dll",
        "tools/net461-x86/System.Diagnostics.TraceSource.dll",
        "tools/net461-x86/System.Diagnostics.Tracing.dll",
        "tools/net461-x86/System.Drawing.Primitives.dll",
        "tools/net461-x86/System.Dynamic.Runtime.dll",
        "tools/net461-x86/System.Globalization.Calendars.dll",
        "tools/net461-x86/System.Globalization.Extensions.dll",
        "tools/net461-x86/System.Globalization.dll",
        "tools/net461-x86/System.IO.Compression.ZipFile.dll",
        "tools/net461-x86/System.IO.Compression.dll",
        "tools/net461-x86/System.IO.FileSystem.DriveInfo.dll",
        "tools/net461-x86/System.IO.FileSystem.Primitives.dll",
        "tools/net461-x86/System.IO.FileSystem.Watcher.dll",
        "tools/net461-x86/System.IO.FileSystem.dll",
        "tools/net461-x86/System.IO.IsolatedStorage.dll",
        "tools/net461-x86/System.IO.MemoryMappedFiles.dll",
        "tools/net461-x86/System.IO.Pipes.dll",
        "tools/net461-x86/System.IO.UnmanagedMemoryStream.dll",
        "tools/net461-x86/System.IO.dll",
        "tools/net461-x86/System.Linq.Expressions.dll",
        "tools/net461-x86/System.Linq.Parallel.dll",
        "tools/net461-x86/System.Linq.Queryable.dll",
        "tools/net461-x86/System.Linq.dll",
        "tools/net461-x86/System.Memory.dll",
        "tools/net461-x86/System.Net.Http.dll",
        "tools/net461-x86/System.Net.NameResolution.dll",
        "tools/net461-x86/System.Net.NetworkInformation.dll",
        "tools/net461-x86/System.Net.Ping.dll",
        "tools/net461-x86/System.Net.Primitives.dll",
        "tools/net461-x86/System.Net.Requests.dll",
        "tools/net461-x86/System.Net.Security.dll",
        "tools/net461-x86/System.Net.Sockets.dll",
        "tools/net461-x86/System.Net.WebHeaderCollection.dll",
        "tools/net461-x86/System.Net.WebSockets.Client.dll",
        "tools/net461-x86/System.Net.WebSockets.dll",
        "tools/net461-x86/System.Numerics.Vectors.dll",
        "tools/net461-x86/System.ObjectModel.dll",
        "tools/net461-x86/System.Reflection.Extensions.dll",
        "tools/net461-x86/System.Reflection.Primitives.dll",
        "tools/net461-x86/System.Reflection.dll",
        "tools/net461-x86/System.Resources.Reader.dll",
        "tools/net461-x86/System.Resources.ResourceManager.dll",
        "tools/net461-x86/System.Resources.Writer.dll",
        "tools/net461-x86/System.Runtime.CompilerServices.Unsafe.dll",
        "tools/net461-x86/System.Runtime.CompilerServices.VisualC.dll",
        "tools/net461-x86/System.Runtime.Extensions.dll",
        "tools/net461-x86/System.Runtime.Handles.dll",
        "tools/net461-x86/System.Runtime.InteropServices.RuntimeInformation.dll",
        "tools/net461-x86/System.Runtime.InteropServices.dll",
        "tools/net461-x86/System.Runtime.Numerics.dll",
        "tools/net461-x86/System.Runtime.Serialization.Formatters.dll",
        "tools/net461-x86/System.Runtime.Serialization.Json.dll",
        "tools/net461-x86/System.Runtime.Serialization.Primitives.dll",
        "tools/net461-x86/System.Runtime.Serialization.Xml.dll",
        "tools/net461-x86/System.Runtime.dll",
        "tools/net461-x86/System.Security.Claims.dll",
        "tools/net461-x86/System.Security.Cryptography.Algorithms.dll",
        "tools/net461-x86/System.Security.Cryptography.Csp.dll",
        "tools/net461-x86/System.Security.Cryptography.Encoding.dll",
        "tools/net461-x86/System.Security.Cryptography.Primitives.dll",
        "tools/net461-x86/System.Security.Cryptography.X509Certificates.dll",
        "tools/net461-x86/System.Security.Principal.dll",
        "tools/net461-x86/System.Security.SecureString.dll",
        "tools/net461-x86/System.Text.Encoding.Extensions.dll",
        "tools/net461-x86/System.Text.Encoding.dll",
        "tools/net461-x86/System.Text.RegularExpressions.dll",
        "tools/net461-x86/System.Threading.Overlapped.dll",
        "tools/net461-x86/System.Threading.Tasks.Parallel.dll",
        "tools/net461-x86/System.Threading.Tasks.dll",
        "tools/net461-x86/System.Threading.Thread.dll",
        "tools/net461-x86/System.Threading.ThreadPool.dll",
        "tools/net461-x86/System.Threading.Timer.dll",
        "tools/net461-x86/System.Threading.dll",
        "tools/net461-x86/System.ValueTuple.dll",
        "tools/net461-x86/System.Xml.ReaderWriter.dll",
        "tools/net461-x86/System.Xml.XDocument.dll",
        "tools/net461-x86/System.Xml.XPath.XDocument.dll",
        "tools/net461-x86/System.Xml.XPath.dll",
        "tools/net461-x86/System.Xml.XmlDocument.dll",
        "tools/net461-x86/System.Xml.XmlSerializer.dll",
        "tools/net461-x86/netstandard.dll",
        "tools/net461/GetDocument.Insider.exe",
        "tools/net461/GetDocument.Insider.exe.config",
        "tools/net461/Microsoft.Win32.Primitives.dll",
        "tools/net461/System.AppContext.dll",
        "tools/net461/System.Buffers.dll",
        "tools/net461/System.Collections.Concurrent.dll",
        "tools/net461/System.Collections.NonGeneric.dll",
        "tools/net461/System.Collections.Specialized.dll",
        "tools/net461/System.Collections.dll",
        "tools/net461/System.ComponentModel.EventBasedAsync.dll",
        "tools/net461/System.ComponentModel.Primitives.dll",
        "tools/net461/System.ComponentModel.TypeConverter.dll",
        "tools/net461/System.ComponentModel.dll",
        "tools/net461/System.Console.dll",
        "tools/net461/System.Data.Common.dll",
        "tools/net461/System.Diagnostics.Contracts.dll",
        "tools/net461/System.Diagnostics.Debug.dll",
        "tools/net461/System.Diagnostics.DiagnosticSource.dll",
        "tools/net461/System.Diagnostics.FileVersionInfo.dll",
        "tools/net461/System.Diagnostics.Process.dll",
        "tools/net461/System.Diagnostics.StackTrace.dll",
        "tools/net461/System.Diagnostics.TextWriterTraceListener.dll",
        "tools/net461/System.Diagnostics.Tools.dll",
        "tools/net461/System.Diagnostics.TraceSource.dll",
        "tools/net461/System.Diagnostics.Tracing.dll",
        "tools/net461/System.Drawing.Primitives.dll",
        "tools/net461/System.Dynamic.Runtime.dll",
        "tools/net461/System.Globalization.Calendars.dll",
        "tools/net461/System.Globalization.Extensions.dll",
        "tools/net461/System.Globalization.dll",
        "tools/net461/System.IO.Compression.ZipFile.dll",
        "tools/net461/System.IO.Compression.dll",
        "tools/net461/System.IO.FileSystem.DriveInfo.dll",
        "tools/net461/System.IO.FileSystem.Primitives.dll",
        "tools/net461/System.IO.FileSystem.Watcher.dll",
        "tools/net461/System.IO.FileSystem.dll",
        "tools/net461/System.IO.IsolatedStorage.dll",
        "tools/net461/System.IO.MemoryMappedFiles.dll",
        "tools/net461/System.IO.Pipes.dll",
        "tools/net461/System.IO.UnmanagedMemoryStream.dll",
        "tools/net461/System.IO.dll",
        "tools/net461/System.Linq.Expressions.dll",
        "tools/net461/System.Linq.Parallel.dll",
        "tools/net461/System.Linq.Queryable.dll",
        "tools/net461/System.Linq.dll",
        "tools/net461/System.Memory.dll",
        "tools/net461/System.Net.Http.dll",
        "tools/net461/System.Net.NameResolution.dll",
        "tools/net461/System.Net.NetworkInformation.dll",
        "tools/net461/System.Net.Ping.dll",
        "tools/net461/System.Net.Primitives.dll",
        "tools/net461/System.Net.Requests.dll",
        "tools/net461/System.Net.Security.dll",
        "tools/net461/System.Net.Sockets.dll",
        "tools/net461/System.Net.WebHeaderCollection.dll",
        "tools/net461/System.Net.WebSockets.Client.dll",
        "tools/net461/System.Net.WebSockets.dll",
        "tools/net461/System.Numerics.Vectors.dll",
        "tools/net461/System.ObjectModel.dll",
        "tools/net461/System.Reflection.Extensions.dll",
        "tools/net461/System.Reflection.Primitives.dll",
        "tools/net461/System.Reflection.dll",
        "tools/net461/System.Resources.Reader.dll",
        "tools/net461/System.Resources.ResourceManager.dll",
        "tools/net461/System.Resources.Writer.dll",
        "tools/net461/System.Runtime.CompilerServices.Unsafe.dll",
        "tools/net461/System.Runtime.CompilerServices.VisualC.dll",
        "tools/net461/System.Runtime.Extensions.dll",
        "tools/net461/System.Runtime.Handles.dll",
        "tools/net461/System.Runtime.InteropServices.RuntimeInformation.dll",
        "tools/net461/System.Runtime.InteropServices.dll",
        "tools/net461/System.Runtime.Numerics.dll",
        "tools/net461/System.Runtime.Serialization.Formatters.dll",
        "tools/net461/System.Runtime.Serialization.Json.dll",
        "tools/net461/System.Runtime.Serialization.Primitives.dll",
        "tools/net461/System.Runtime.Serialization.Xml.dll",
        "tools/net461/System.Runtime.dll",
        "tools/net461/System.Security.Claims.dll",
        "tools/net461/System.Security.Cryptography.Algorithms.dll",
        "tools/net461/System.Security.Cryptography.Csp.dll",
        "tools/net461/System.Security.Cryptography.Encoding.dll",
        "tools/net461/System.Security.Cryptography.Primitives.dll",
        "tools/net461/System.Security.Cryptography.X509Certificates.dll",
        "tools/net461/System.Security.Principal.dll",
        "tools/net461/System.Security.SecureString.dll",
        "tools/net461/System.Text.Encoding.Extensions.dll",
        "tools/net461/System.Text.Encoding.dll",
        "tools/net461/System.Text.RegularExpressions.dll",
        "tools/net461/System.Threading.Overlapped.dll",
        "tools/net461/System.Threading.Tasks.Parallel.dll",
        "tools/net461/System.Threading.Tasks.dll",
        "tools/net461/System.Threading.Thread.dll",
        "tools/net461/System.Threading.ThreadPool.dll",
        "tools/net461/System.Threading.Timer.dll",
        "tools/net461/System.Threading.dll",
        "tools/net461/System.ValueTuple.dll",
        "tools/net461/System.Xml.ReaderWriter.dll",
        "tools/net461/System.Xml.XDocument.dll",
        "tools/net461/System.Xml.XPath.XDocument.dll",
        "tools/net461/System.Xml.XPath.dll",
        "tools/net461/System.Xml.XmlDocument.dll",
        "tools/net461/System.Xml.XmlSerializer.dll",
        "tools/net461/netstandard.dll",
        "tools/netcoreapp2.1/GetDocument.Insider.deps.json",
        "tools/netcoreapp2.1/GetDocument.Insider.dll",
        "tools/netcoreapp2.1/GetDocument.Insider.runtimeconfig.json",
        "tools/netcoreapp2.1/System.Diagnostics.DiagnosticSource.dll"
      ]
    },
    "Microsoft.OpenApi/1.4.3": {
      "sha512": "rURwggB+QZYcSVbDr7HSdhw/FELvMlriW10OeOzjPT7pstefMo7IThhtNtDudxbXhW+lj0NfX72Ka5EDsG8x6w==",
      "type": "package",
      "path": "microsoft.openapi/1.4.3",
      "files": [
        ".nupkg.metadata",
        ".signature.p7s",
        "lib/netstandard2.0/Microsoft.OpenApi.dll",
        "lib/netstandard2.0/Microsoft.OpenApi.pdb",
        "lib/netstandard2.0/Microsoft.OpenApi.xml",
        "microsoft.openapi.1.4.3.nupkg.sha512",
        "microsoft.openapi.nuspec"
      ]
    },
    "Swashbuckle.AspNetCore/6.5.0": {
      "sha512": "FK05XokgjgwlCI6wCT+D4/abtQkL1X1/B9Oas6uIwHFmYrIO9WUD5aLC9IzMs9GnHfUXOtXZ2S43gN1mhs5+aA==",
      "type": "package",
      "path": "swashbuckle.aspnetcore/6.5.0",
      "files": [
        ".nupkg.metadata",
        ".signature.p7s",
        "build/Swashbuckle.AspNetCore.props",
        "swashbuckle.aspnetcore.6.5.0.nupkg.sha512",
        "swashbuckle.aspnetcore.nuspec"
      ]
    },
    "Swashbuckle.AspNetCore.Swagger/6.5.0": {
      "sha512": "XWmCmqyFmoItXKFsQSwQbEAsjDKcxlNf1l+/Ki42hcb6LjKL8m5Db69OTvz5vLonMSRntYO1XLqz0OP+n3vKnA==",
      "type": "package",
      "path": "swashbuckle.aspnetcore.swagger/6.5.0",
      "files": [
        ".nupkg.metadata",
        ".signature.p7s",
        "lib/net5.0/Swashbuckle.AspNetCore.Swagger.dll",
        "lib/net5.0/Swashbuckle.AspNetCore.Swagger.pdb",
        "lib/net5.0/Swashbuckle.AspNetCore.Swagger.xml",
        "lib/net6.0/Swashbuckle.AspNetCore.Swagger.dll",
        "lib/net6.0/Swashbuckle.AspNetCore.Swagger.pdb",
        "lib/net6.0/Swashbuckle.AspNetCore.Swagger.xml",
        "lib/net7.0/Swashbuckle.AspNetCore.Swagger.dll",
        "lib/net7.0/Swashbuckle.AspNetCore.Swagger.pdb",
        "lib/net7.0/Swashbuckle.AspNetCore.Swagger.xml",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.Swagger.dll",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.Swagger.pdb",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.Swagger.xml",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.Swagger.dll",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.Swagger.pdb",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.Swagger.xml",
        "swashbuckle.aspnetcore.swagger.6.5.0.nupkg.sha512",
        "swashbuckle.aspnetcore.swagger.nuspec"
      ]
    },
    "Swashbuckle.AspNetCore.SwaggerGen/6.5.0": {
      "sha512": "Y/qW8Qdg9OEs7V013tt+94OdPxbRdbhcEbw4NiwGvf4YBcfhL/y7qp/Mjv/cENsQ2L3NqJ2AOu94weBy/h4KvA==",
      "type": "package",
      "path": "swashbuckle.aspnetcore.swaggergen/6.5.0",
      "files": [
        ".nupkg.metadata",
        ".signature.p7s",
        "lib/net5.0/Swashbuckle.AspNetCore.SwaggerGen.dll",
        "lib/net5.0/Swashbuckle.AspNetCore.SwaggerGen.pdb",
        "lib/net5.0/Swashbuckle.AspNetCore.SwaggerGen.xml",
        "lib/net6.0/Swashbuckle.AspNetCore.SwaggerGen.dll",
        "lib/net6.0/Swashbuckle.AspNetCore.SwaggerGen.pdb",
        "lib/net6.0/Swashbuckle.AspNetCore.SwaggerGen.xml",
        "lib/net7.0/Swashbuckle.AspNetCore.SwaggerGen.dll",
        "lib/net7.0/Swashbuckle.AspNetCore.SwaggerGen.pdb",
        "lib/net7.0/Swashbuckle.AspNetCore.SwaggerGen.xml",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.SwaggerGen.dll",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.SwaggerGen.pdb",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.SwaggerGen.xml",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.SwaggerGen.dll",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.SwaggerGen.pdb",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.SwaggerGen.xml",
        "swashbuckle.aspnetcore.swaggergen.6.5.0.nupkg.sha512",
        "swashbuckle.aspnetcore.swaggergen.nuspec"
      ]
    },
    "Swashbuckle.AspNetCore.SwaggerUI/6.5.0": {
      "sha512": "OvbvxX+wL8skxTBttcBsVxdh73Fag4xwqEU2edh4JMn7Ws/xJHnY/JB1e9RoCb6XpDxUF3hD9A0Z1lEUx40Pfw==",
      "type": "package",
      "path": "swashbuckle.aspnetcore.swaggerui/6.5.0",
      "files": [
        ".nupkg.metadata",
        ".signature.p7s",
        "lib/net5.0/Swashbuckle.AspNetCore.SwaggerUI.dll",
        "lib/net5.0/Swashbuckle.AspNetCore.SwaggerUI.pdb",
        "lib/net5.0/Swashbuckle.AspNetCore.SwaggerUI.xml",
        "lib/net6.0/Swashbuckle.AspNetCore.SwaggerUI.dll",
        "lib/net6.0/Swashbuckle.AspNetCore.SwaggerUI.pdb",
        "lib/net6.0/Swashbuckle.AspNetCore.SwaggerUI.xml",
        "lib/net7.0/Swashbuckle.AspNetCore.SwaggerUI.dll",
        "lib/net7.0/Swashbuckle.AspNetCore.SwaggerUI.pdb",
        "lib/net7.0/Swashbuckle.AspNetCore.SwaggerUI.xml",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.SwaggerUI.dll",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.SwaggerUI.pdb",
        "lib/netcoreapp3.0/Swashbuckle.AspNetCore.SwaggerUI.xml",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.SwaggerUI.dll",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.SwaggerUI.pdb",
        "lib/netstandard2.0/Swashbuckle.AspNetCore.SwaggerUI.xml",
        "swashbuckle.aspnetcore.swaggerui.6.5.0.nupkg.sha512",
        "swashbuckle.aspnetcore.swaggerui.nuspec"
      ]
    }
  },
  "projectFileDependencyGroups": {
    "net8.0": [
      "Microsoft.AspNetCore.OpenApi >= 8.0.0",
      "Swashbuckle.AspNetCore >= 6.5.0"
    ]
  },
  "packageFolders": {
    "C:\\Users\\vohuy\\.nuget\\packages\\": {},
    "D:\\VS Programing\\Microsoft Visual Studio\\Shared\\NuGetPackages": {}
  },
  "project": {
    "version": "1.0.0",
    "restore": {
      "projectUniqueName": "E:\\Storage\\StorageCode\\Year2\\Project\\Project-Booking-Hotel\\Backend\\HotelBooking.API\\HotelBooking.API.csproj",
      "projectName": "HotelBooking.API",
      "projectPath": "E:\\Storage\\StorageCode\\Year2\\Project\\Project-Booking-Hotel\\Backend\\HotelBooking.API\\HotelBooking.API.csproj",
      "packagesPath": "C:\\Users\\vohuy\\.nuget\\packages\\",
      "outputPath": "E:\\Storage\\StorageCode\\Year2\\Project\\Project-Booking-Hotel\\Backend\\HotelBooking.API\\obj\\",
      "projectStyle": "PackageReference",
      "fallbackFolders": [
        "D:\\VS Programing\\Microsoft Visual Studio\\Shared\\NuGetPackages"
      ],
      "configFilePaths": [
        "C:\\Users\\vohuy\\AppData\\Roaming\\NuGet\\NuGet.Config",
        "C:\\Program Files (x86)\\NuGet\\Config\\Microsoft.VisualStudio.FallbackLocation.config",
        "C:\\Program Files (x86)\\NuGet\\Config\\Microsoft.VisualStudio.Offline.config"
      ],
      "originalTargetFrameworks": [
        "net8.0"
      ],
      "sources": {
        "C:\\Program Files (x86)\\Microsoft SDKs\\NuGetPackages\\": {},
        "https://api.nuget.org/v3/index.json": {}
      },
      "frameworks": {
        "net8.0": {
          "targetAlias": "net8.0",
          "projectReferences": {}
        }
      },
      "warningProperties": {
        "warnAsError": [
          "NU1605"
        ]
      },
      "restoreAuditProperties": {
        "enableAudit": "true",
        "auditLevel": "low",
        "auditMode": "direct"
      },
      "SdkAnalysisLevel": "9.0.300"
    },
    "frameworks": {
      "net8.0": {
        "targetAlias": "net8.0",
        "dependencies": {
          "Microsoft.AspNetCore.OpenApi": {
            "target": "Package",
            "version": "[8.0.0, )"
          },
          "Swashbuckle.AspNetCore": {
            "target": "Package",
            "version": "[6.5.0, )"
          }
        },
        "imports": [
          "net461",
          "net462",
          "net47",
          "net471",
          "net472",
          "net48",
          "net481"
        ],
        "assetTargetFallback": true,
        "warn": true,
        "downloadDependencies": [
          {
            "name": "Microsoft.AspNetCore.App.Ref",
            "version": "[8.0.22, 8.0.22]"
          },
          {
            "name": "Microsoft.NETCore.App.Host.win-x64",
            "version": "[8.0.22, 8.0.22]"
          },
          {
            "name": "Microsoft.NETCore.App.Ref",
            "version": "[8.0.22, 8.0.22]"
          },
          {
            "name": "Microsoft.WindowsDesktop.App.Ref",
            "version": "[8.0.22, 8.0.22]"
          }
        ],
        "frameworkReferences": {
          "Microsoft.AspNetCore.App": {
            "privateAssets": "none"
          },
          "Microsoft.NETCore.App": {
            "privateAssets": "all"
          }
        },
        "runtimeIdentifierGraphPath": "C:\\Program Files\\dotnet\\sdk\\9.0.307/PortableRuntimeIdentifierGraph.json"
      }
    }
  }
}
--- END FILE: Backend\HotelBooking.API\obj\project.assets.json ---

--- START FILE: Backend\HotelBooking.API\Properties\launchSettings.json ---
{
  "$schema": "http://json.schemastore.org/launchsettings.json",
  "profiles": {
    "http": {
      "commandName": "bookinghotelproject_OAuthClientID",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "launchUrl": "swagger",
      "applicationUrl": "http://localhost:5000",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "https": {
      "commandName": "bookinghotelproject_OAuthClientID",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "launchUrl": "swagger",
      "applicationUrl": "http://localhost:5000",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}


--- END FILE: Backend\HotelBooking.API\Properties\launchSettings.json ---

--- START FILE: Backend\package.json ---
{
  "name": "hotel-booking-backend",
  "version": "1.0.0",
  "description": "Scripts to run C# backend",
  "scripts": {
    "start": "dotnet run --project HotelBooking.API/HotelBooking.API.csproj",
    "watch": "dotnet watch run --project HotelBooking.API/HotelBooking.API.csproj",
    "restore": "dotnet restore HotelBooking.API/HotelBooking.API.csproj",
    "build": "dotnet build HotelBooking.API/HotelBooking.API.csproj"
  }
}


--- END FILE: Backend\package.json ---

--- START FILE: index.html ---
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" type="image/png" href="/logo.png" />

  <title>Hotel Booking</title>
</head>

<body>

  <div id="root"></div>

  <script type="module" src="/src/main.jsx"></script>

</body>

</html>
--- END FILE: index.html ---

--- START FILE: netlify.toml ---
[[redirects]]
from = "/*"
to = "/index.html"
status = 200
--- END FILE: netlify.toml ---

--- START FILE: package.json ---
{
  "name": "hotelbooking",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "seed:users": "node seed-users.js"
  },
  "dependencies": {
    "@emailjs/browser": "^4.4.1",
    "@supabase/supabase-js": "^2.84.0",
    "chart.js": "^4.5.1",
    "dotenv": "^17.2.3",
    "html2canvas": "^1.4.1",
    "jspdf": "^3.0.3",
    "qrcode.react": "^4.2.0",
    "react": "^18.2.0",
    "react-chartjs-2": "^5.3.1",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@headlessui/react": "^1.7.10",
    "@types/react": "^18.0.27",
    "@types/react-dom": "^18.0.10",
    "@vitejs/plugin-react": "^3.1.0",
    "autoprefixer": "^10.4.13",
    "postcss": "^8.4.21",
    "react-datepicker": "^4.10.0",
    "react-icons": "^4.7.1",
    "react-router-dom": "^6.8.1",
    "spinners-react": "^1.0.7",
    "swiper": "^9.0.4",
    "tailwindcss": "^3.2.6",
    "vite": "^4.1.0",
    "vite-plugin-svgr": "^2.4.0"
  }
}

--- END FILE: package.json ---

--- START FILE: Query_V2\01_Clean_Data.sql ---
-- =====================================================
-- 01_CLEAN_DB.SQL
-- =====================================================
-- Xóa bảng theo đúng thứ tự phụ thuộc để không lỗi khóa ngoại

-- 1. Xoá trigger trên auth.users (KHÔNG DÙNG NỮA - dùng bảng users riêng)
-- drop trigger if exists on_auth_user_created on auth.users;

-- 2. XÓA TẤT CẢ TRIGGERS TRƯỚC (xóa trước khi drop tables để tránh lỗi)
-- Dùng DO block để check bảng tồn tại trước khi drop trigger
DO $$ 
BEGIN
  -- Xóa triggers trên price_rules (nếu bảng tồn tại)
  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'price_rules') THEN
    DROP TRIGGER IF EXISTS set_price_rules_updated_at ON public.price_rules CASCADE;
    DROP TRIGGER IF EXISTS audit_price_rules_trigger ON public.price_rules CASCADE;
    DROP TRIGGER IF EXISTS log_price_rules_changes ON public.price_rules CASCADE;
    DROP TRIGGER IF EXISTS price_rules_audit_trigger ON public.price_rules CASCADE;
  END IF;

  -- Xóa triggers trên promotions (nếu bảng tồn tại)
  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'promotions') THEN
    DROP TRIGGER IF EXISTS set_promotions_updated_at ON public.promotions CASCADE;
    DROP TRIGGER IF EXISTS audit_promotions_trigger ON public.promotions CASCADE;
    DROP TRIGGER IF EXISTS log_promotions_changes ON public.promotions CASCADE;
    DROP TRIGGER IF EXISTS promotions_audit_trigger ON public.promotions CASCADE;
  END IF;

  -- Xóa triggers trên audit_logs (nếu bảng tồn tại)
  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'audit_logs') THEN
    DROP TRIGGER IF EXISTS audit_logs_trigger ON public.audit_logs CASCADE;
    DROP TRIGGER IF EXISTS log_audit_logs_changes ON public.audit_logs CASCADE;
    DROP TRIGGER IF EXISTS set_audit_logs_updated_at ON public.audit_logs CASCADE;
  END IF;
END $$;

-- 3. Xoá bảng (Drop con trước, cha sau)
drop table if exists public.audit_logs cascade;
drop table if exists public.password_reset_requests cascade;
drop table if exists public.spa_bookings cascade;
drop table if exists public.restaurant_bookings cascade;
drop table if exists public.booking_events cascade;
drop table if exists public.booking_pricing_breakdown cascade;
drop table if exists public.room_reviews cascade;
drop table if exists public.booking_items cascade;
drop table if exists public.bookings cascade;
drop table if exists public.promotions cascade;
drop table if exists public.price_rules cascade;
drop table if exists public.room_images cascade;
drop table if exists public.rooms cascade;
drop table if exists public.room_type_amenities cascade;
drop table if exists public.room_types cascade;
drop table if exists public.amenities cascade;
drop table if exists public.users cascade;  -- Bảng users riêng (không dùng auth.users)
drop table if exists public.profiles cascade;
drop table if exists public.holiday_calendar cascade;
-- Bảng bổ sung mới
drop table if exists public.room_status_history cascade;
drop table if exists public.housekeeping_tasks cascade;
drop table if exists public.restaurant_slots cascade;
drop table if exists public.restaurant_tables cascade;
drop table if exists public.restaurant_menu_items cascade;
drop table if exists public.spa_slots cascade;
drop table if exists public.spa_services cascade;
-- View bổ sung
drop view if exists public.room_status_board cascade;

-- 4. Xóa các functions có thể gây vòng lặp
drop function if exists public.audit_price_rules() cascade;
drop function if exists public.audit_promotions() cascade;
drop function if exists public.log_changes() cascade;
drop function if exists public.auto_audit_log() cascade;
drop function if exists public.is_restaurant_slot_available(uuid, timestamptz, int) cascade;
drop function if exists public.is_spa_slot_available(uuid, text, timestamptz) cascade;

-- 5. Xoá hàm và types (types phải xóa sau khi drop tables vì có thể đang được sử dụng)
drop function if exists public.get_available_rooms(date, date, int);
drop function if exists public.get_available_rooms(date, date);
drop function if exists public.is_room_available(uuid, date, date);
drop function if exists public.is_admin(uuid);
drop function if exists public.hash_password_sql(text, text);  -- Function tạm để hash password
-- drop function if exists public.handle_new_user();  -- Không dùng nữa
-- Drop trigger_set_timestamp() với CASCADE để xóa tất cả trigger phụ thuộc
-- (Các trigger sẽ được tạo lại trong 02_Int_schema.sql)
drop function if exists public.trigger_set_timestamp() cascade;

-- Xóa types (sau khi drop tables, types có thể vẫn còn nếu không dùng CASCADE)
-- Dùng CASCADE để xóa tất cả dependencies
drop type if exists public.booking_status cascade;
drop type if exists public.room_status cascade;
drop type if exists public.discount_type cascade;
drop type if exists public.price_rule_type cascade;
--- END FILE: Query_V2\01_Clean_Data.sql ---

--- START FILE: Query_V2\02_Int_schema.sql ---
-- =====================================
-- 02_INIT_SCHEMA.SQL
-- =====================================

create extension if not exists "pgcrypto";

-- ====== XÓA TYPES CŨ (nếu còn) ======
-- Đảm bảo xóa types trước khi tạo lại để tránh lỗi "type already exists"
drop type if exists public.room_status cascade;
drop type if exists public.booking_status cascade;
drop type if exists public.price_rule_type cascade;
drop type if exists public.discount_type cascade;

-- ====== ENUMS ======
create type room_status as enum ('available', 'occupied', 'maintenance', 'cleaning');
create type booking_status as enum ('pending', 'pending_payment', 'approved', 'rejected', 'confirmed', 'checked_in', 'checked_out', 'modified', 'completed', 'cancelled');
create type price_rule_type as enum ('weekend', 'holiday', 'seasonal', 'season');
create type discount_type as enum ('percent', 'fixed');

-- ====== FUNCTION UPDATE TIMESTAMP ======
-- Function này chỉ update updated_at nếu có thay đổi thực sự để tránh vòng lặp
-- CẢI THIỆN: Kiểm tra updated_at không thay đổi để tránh recursive trigger
create or replace function public.trigger_set_timestamp()
returns trigger 
language plpgsql 
security definer
set search_path = public
as $$
begin
  -- Chỉ xử lý UPDATE operations
  if (TG_OP != 'UPDATE') then
    return new;
  end if;

  -- QUAN TRỌNG: Nếu updated_at đã thay đổi, không update lại (tránh vòng lặp)
  if (OLD.updated_at IS DISTINCT FROM NEW.updated_at) then
    return new;
  end if;

  -- Chỉ update updated_at nếu có cột khác thay đổi
  if (OLD IS DISTINCT FROM NEW) then
    new.updated_at = now();
  end if;

  return new;
end$$;

-- ====== 1. USERS (BẢNG RIÊNG - KHÔNG DÙNG auth.users) ======
create table if not exists public.users (
  id uuid primary key default gen_random_uuid(),
  email text unique not null,
  password_hash text not null,  -- Mật khẩu đã hash (dùng bcrypt hoặc crypto)
  full_name text,
  phone text,
  avatar_url text,
  country text,
  city text,
  preferences jsonb not null default '[]'::jsonb,
  language text not null default 'en',
  newsletter boolean not null default true,
  bio text,
  is_admin boolean not null default false,
  is_email_verified boolean not null default false,
  email_verification_token text,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now(),
  last_login timestamptz
);
create index if not exists idx_users_email on public.users(email);
create index if not exists idx_users_is_admin on public.users(is_admin);
create index if not exists idx_users_email_verification_token on public.users(email_verification_token);
create trigger set_users_updated_at before update on public.users for each row execute procedure public.trigger_set_timestamp();

-- Function Check Admin (đơn giản hóa - check từ users)
create or replace function public.is_admin(uid uuid)
returns boolean language sql stable as $$
  select coalesce((select is_admin from public.users where id = uid), false);
$$;

-- ====== 3. AMENITIES ======
create table if not exists public.amenities (
  id uuid primary key default gen_random_uuid(),
  name text unique not null,
  icon_name text,
  created_at timestamptz not null default now()
);

-- ====== 4. ROOM TYPES ======
create table if not exists public.room_types (
  id uuid primary key default gen_random_uuid(),
  code text unique not null,
  name text not null,
  description text,
  base_capacity int not null default 2,
  max_person int not null default 2,
  base_price numeric(12,2) not null,
  is_active boolean not null default true,
  facilities text[] default '{}',
  hotel_rules text[] default '{}',
  cancellation_policy text,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now(),
  constraint chk_room_types_capacity check (max_person >= base_capacity)
);
create trigger set_room_types_updated_at before update on public.room_types for each row execute procedure public.trigger_set_timestamp();

-- ====== 4. ROOM TYPE AMENITIES ======
create table if not exists public.room_type_amenities (
  room_type_id uuid not null references public.room_types(id) on delete cascade,
  amenity_id uuid not null references public.amenities(id) on delete cascade,
  primary key (room_type_id, amenity_id)
);

-- ====== 5. ROOM IMAGES ======
create table if not exists public.room_images (
  id uuid primary key default gen_random_uuid(),
  room_type_id uuid not null references public.room_types(id) on delete cascade,
  image_url text not null,
  image_lg_url text,
  display_order int default 0,
  created_at timestamptz not null default now()
);
create index if not exists idx_room_images_room_type_id on public.room_images(room_type_id);

-- ====== 6. ROOMS ======
create table if not exists public.rooms (
  id uuid primary key default gen_random_uuid(),
  room_no text unique not null,
  name text not null,
  room_type_id uuid not null references public.room_types(id),
  floor int,
  size int,
  status room_status not null default 'available',
  -- Các cột cached cho frontend
  type text, category text, price numeric(12,2), description text,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create index if not exists idx_rooms_room_type_id on public.rooms(room_type_id);
create trigger set_rooms_updated_at before update on public.rooms for each row execute procedure public.trigger_set_timestamp();

-- ====== 7. PRICE RULES ======
create table if not exists public.price_rules (
  id uuid primary key default gen_random_uuid(),
  rule_type price_rule_type not null,
  room_type_id uuid references public.room_types(id) on delete cascade,
  start_date date, end_date date, description text,
  apply_fri boolean not null default false,
  apply_sat boolean not null default false,
  apply_sun boolean not null default false,
  price numeric(12,2) not null,
  priority int not null default 10,
  is_active boolean not null default true,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now(),
  constraint chk_price_rule_dates check (end_date is null or start_date is null or end_date >= start_date)
);
-- Trigger cho price_rules - CHỈ update updated_at khi có thay đổi thực sự
create trigger set_price_rules_updated_at 
  before update on public.price_rules 
  for each row 
  when (
    OLD.rule_type IS DISTINCT FROM NEW.rule_type OR
    OLD.room_type_id IS DISTINCT FROM NEW.room_type_id OR
    OLD.start_date IS DISTINCT FROM NEW.start_date OR
    OLD.end_date IS DISTINCT FROM NEW.end_date OR
    OLD.apply_fri IS DISTINCT FROM NEW.apply_fri OR
    OLD.apply_sat IS DISTINCT FROM NEW.apply_sat OR
    OLD.apply_sun IS DISTINCT FROM NEW.apply_sun OR
    OLD.price IS DISTINCT FROM NEW.price OR
    OLD.priority IS DISTINCT FROM NEW.priority OR
    OLD.description IS DISTINCT FROM NEW.description OR
    OLD.is_active IS DISTINCT FROM NEW.is_active
  )
  execute procedure public.trigger_set_timestamp();

-- ====== 8. PROMOTIONS ======
create table if not exists public.promotions (
  id uuid primary key default gen_random_uuid(),
  code text unique not null,
  name text not null,
  description text,
  discount_kind discount_type not null,
  discount_value numeric(12,2) not null,
  start_date date not null,
  end_date date not null,
  is_active boolean not null default true,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now(),
  constraint chk_promo_dates check (end_date >= start_date)
);
-- Trigger cho promotions - CHỈ update updated_at khi có thay đổi thực sự
create trigger set_promotions_updated_at 
  before update on public.promotions 
  for each row 
  when (
    OLD.code IS DISTINCT FROM NEW.code OR
    OLD.name IS DISTINCT FROM NEW.name OR
    OLD.description IS DISTINCT FROM NEW.description OR
    OLD.discount_kind IS DISTINCT FROM NEW.discount_kind OR
    OLD.discount_value IS DISTINCT FROM NEW.discount_value OR
    OLD.start_date IS DISTINCT FROM NEW.start_date OR
    OLD.end_date IS DISTINCT FROM NEW.end_date OR
    OLD.is_active IS DISTINCT FROM NEW.is_active
  )
  execute procedure public.trigger_set_timestamp();

-- ====== 9. BOOKINGS ======
create table if not exists public.bookings (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references public.users(id) on delete set null,
  confirmation_code text not null unique,
  booking_type text not null default 'room',
  status booking_status not null default 'pending_payment',
  check_in date not null,
  check_out date not null,
  room_id uuid references public.rooms(id),
  room_name text,
  user_name text, user_email text, guest_name text, guest_phone text, note text,
  promo_code text references public.promotions(code),
  num_adults int not null default 1,
  num_children int not null default 0,
  total_nights int not null default 1,
  subtotal numeric(12,2) not null default 0,
  discount numeric(12,2) not null default 0,
  total_amount numeric(12,2) not null default 0,
  pricing_breakdown jsonb not null default '[]'::jsonb,
  history jsonb not null default '[]'::jsonb,
  payment_code text, payment_method text, paid_at timestamptz,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now(),
  constraint chk_dates_valid check (check_out > check_in)
);
create index if not exists idx_bookings_user_id on public.bookings(user_id);
create unique index if not exists idx_bookings_confirmation_code on public.bookings(confirmation_code);
create trigger set_bookings_updated_at before update on public.bookings for each row execute procedure public.trigger_set_timestamp();

-- ====== 10. BOOKING ITEMS ======
create table if not exists public.booking_items (
  id uuid primary key default gen_random_uuid(),
  booking_id uuid not null references public.bookings(id) on delete cascade,
  room_id uuid not null references public.rooms(id),
  room_type_id uuid not null references public.room_types(id),
  price_per_night numeric(12,2) not null,
  nights int not null,
  amount numeric(12,2) not null,
  created_at timestamptz not null default now()
);

-- ====== 11. ROOM REVIEWS ======
create table if not exists public.room_reviews (
  id uuid primary key default gen_random_uuid(),
  room_id uuid references public.rooms(id) on delete cascade,
  room_type_id uuid references public.room_types(id) on delete cascade,
  booking_id uuid references public.bookings(id) on delete set null,
  user_id uuid references public.users(id) on delete set null,
  user_name text, user_email text, rating int not null check (rating between 1 and 5),
  comment text, stay_date date,
  created_at timestamptz not null default now(),
  constraint chk_room_reviews_room check (room_id is not null or room_type_id is not null)
);

-- ====== 12. OTHERS (Audit, Restaurant, Spa, Holidays) ======
create table if not exists public.booking_pricing_breakdown (
  id bigint generated by default as identity primary key,
  booking_id uuid not null references public.bookings(id) on delete cascade,
  stay_date date not null, rate_type text not null, rate numeric(12,2) not null,
  created_at timestamptz not null default now(),
  constraint uniq_booking_pricing unique (booking_id, stay_date, rate_type)
);

create table if not exists public.booking_events (
  id bigint generated by default as identity primary key,
  booking_id uuid not null references public.bookings(id) on delete cascade,
  event_type text not null, note text, actor uuid references public.users(id) on delete set null, meta jsonb,
  created_at timestamptz not null default now()
);

create table if not exists public.restaurant_bookings (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references public.users(id) on delete set null,
  confirmation_code text not null unique,
  name text not null, email text not null, phone text,
  reservation_at timestamptz not null, guests int default 1, special_requests text,
  price numeric(12,2) default 0, total_price numeric(12,2) default 0,
  status booking_status default 'pending_payment',
  created_at timestamptz not null default now(), updated_at timestamptz not null default now()
);
create trigger set_restaurant_bookings_updated_at before update on public.restaurant_bookings for each row execute procedure public.trigger_set_timestamp();

create table if not exists public.spa_bookings (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references public.users(id) on delete set null,
  confirmation_code text not null unique,
  name text not null, email text not null, phone text,
  appointment_at timestamptz not null, service_name text not null, service_duration text,
  therapist text, special_requests text,
  price numeric(12,2) default 0, total_price numeric(12,2) default 0,
  status booking_status default 'pending_payment',
  created_at timestamptz not null default now(), updated_at timestamptz not null default now()
);
create trigger set_spa_bookings_updated_at before update on public.spa_bookings for each row execute procedure public.trigger_set_timestamp();

create table if not exists public.password_reset_requests (
  id uuid primary key default gen_random_uuid(),
  email text not null, code text not null, expires_at timestamptz not null, used_at timestamptz,
  created_at timestamptz not null default now()
);

create table if not exists public.audit_logs (
  id bigint generated by default as identity primary key,
  actor uuid references public.users(id) on delete set null,
  action text not null, target_table text, target_id text, meta jsonb,
  created_at timestamptz not null default now()
);

create table if not exists public.holiday_calendar (
  id uuid primary key default gen_random_uuid(),
  holiday_date date not null unique,
  name text, multiplier numeric(5,2) default 1.35, is_active boolean default true,
  created_at timestamptz not null default now()
);

-- ====== LOGIC FUNCTIONS ======
create or replace function public.is_room_available(p_room_id uuid, p_start date, p_end date)
returns boolean language sql stable as $$
  select 
    (select r.status = 'available'::room_status from public.rooms r where r.id = p_room_id)
    and not exists (
      select 1 from public.bookings b
      join public.booking_items bi on bi.booking_id = b.id
      where b.status in ('confirmed', 'checked_in')
        and bi.room_id = p_room_id
        and daterange(b.check_in, b.check_out) && daterange(p_start, p_end)
    );
$$;

create or replace function public.get_available_rooms(p_start date, p_end date, p_guests int)
returns setof public.rooms language sql stable as $$
  select r.*
  from public.rooms r
  join public.room_types rt on r.room_type_id = rt.id
  where r.status in ('available', 'cleaning')
    and rt.base_capacity >= p_guests
    and public.is_room_available(r.id, p_start, p_end);
$$;

-- ====== 13. ROOM STATUS HISTORY (Track operational status shifts) ======
create table if not exists public.room_status_history (
  id uuid primary key default gen_random_uuid(),
  room_id uuid not null references public.rooms(id) on delete cascade,
  status room_status not null,
  started_at timestamptz not null default now(),
  ended_at timestamptz,
  note text,
  actor uuid references public.users(id) on delete set null,
  created_at timestamptz not null default now()
);
create index if not exists idx_room_status_history_room_start on public.room_status_history(room_id, started_at desc);

-- Current room status snapshot by date
create or replace view public.room_status_board as
select
  r.id as room_id,
  r.room_no,
  r.room_type_id,
  r.status as current_status,
  coalesce((
    select rs.status
    from public.room_status_history rs
    where rs.room_id = r.id
    order by rs.started_at desc
    limit 1
  ), r.status) as last_recorded_status,
  (
    select jsonb_build_object(
      'booking_id', b.id,
      'status', b.status,
      'check_in', b.check_in,
      'check_out', b.check_out,
      'guest_name', coalesce(b.user_name, b.guest_name),
      'confirmation_code', b.confirmation_code
    )
    from public.bookings b
    join public.booking_items bi on bi.booking_id = b.id
    where bi.room_id = r.id
      and b.status in ('confirmed','checked_in','pending_payment','approved')
      and daterange(b.check_in, b.check_out, '[)') && daterange(current_date, current_date + 30, '[)')
    order by b.check_in asc
    limit 1
  ) as next_booking
from public.rooms r;

-- ====== 14. HOUSEKEEPING TASKS ======
create table if not exists public.housekeeping_tasks (
  id uuid primary key default gen_random_uuid(),
  room_id uuid not null references public.rooms(id) on delete cascade,
  task_type text not null, -- cleaning, maintenance, minibar, inspection
  status text not null default 'pending' check (status in ('pending','in_progress','done','cancelled')),
  priority smallint not null default 3 check (priority between 1 and 5),
  assignee uuid references public.users(id) on delete set null,
  due_at timestamptz,
  completed_at timestamptz,
  note text,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create trigger set_housekeeping_tasks_updated_at before update on public.housekeeping_tasks for each row execute procedure public.trigger_set_timestamp();
create index if not exists idx_housekeeping_tasks_room on public.housekeeping_tasks(room_id, status);

-- ====== 15. RESTAURANT DATA (menu + tables + slots) ======
create table if not exists public.restaurant_menu_items (
  id uuid primary key default gen_random_uuid(),
  code text unique not null,
  name text not null,
  description text,
  category text not null,
  price numeric(12,2) not null,
  image_url text,
  is_active boolean not null default true,
  display_order int not null default 0,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create trigger set_restaurant_menu_items_updated_at before update on public.restaurant_menu_items for each row execute procedure public.trigger_set_timestamp();

create table if not exists public.restaurant_tables (
  id uuid primary key default gen_random_uuid(),
  name text not null unique,
  capacity int not null check (capacity > 0),
  location text,
  status text not null default 'available' check (status in ('available','maintenance','inactive')),
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create trigger set_restaurant_tables_updated_at before update on public.restaurant_tables for each row execute procedure public.trigger_set_timestamp();

create table if not exists public.restaurant_slots (
  id uuid primary key default gen_random_uuid(),
  table_id uuid not null references public.restaurant_tables(id) on delete cascade,
  reservation_at timestamptz not null,
  capacity_limit int not null,
  capacity_used int not null default 0,
  status text not null default 'available' check (status in ('available','held','booked')),
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now(),
  constraint uniq_restaurant_slot unique (table_id, reservation_at)
);
create trigger set_restaurant_slots_updated_at before update on public.restaurant_slots for each row execute procedure public.trigger_set_timestamp();
create index if not exists idx_restaurant_slots_table_time on public.restaurant_slots(table_id, reservation_at);

-- Availability helper
create or replace function public.is_restaurant_slot_available(p_table_id uuid, p_time timestamptz, p_guests int)
returns boolean language sql stable as $$
  select exists (
    select 1 from public.restaurant_slots rs
    where rs.table_id = p_table_id
      and rs.reservation_at = p_time
      and rs.status <> 'booked'
      and (rs.capacity_limit - rs.capacity_used) >= p_guests
  );
$$;

-- ====== 16. SPA DATA (services + slots) ======
create table if not exists public.spa_services (
  id uuid primary key default gen_random_uuid(),
  code text unique not null,
  name text not null,
  category text not null,
  duration_minutes int not null,
  price numeric(12,2) not null,
  description text,
  image_url text,
  is_active boolean not null default true,
  display_order int not null default 0,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create trigger set_spa_services_updated_at before update on public.spa_services for each row execute procedure public.trigger_set_timestamp();

create table if not exists public.spa_slots (
  id uuid primary key default gen_random_uuid(),
  service_id uuid not null references public.spa_services(id) on delete cascade,
  therapist text,
  appointment_at timestamptz not null,
  capacity int not null default 1 check (capacity > 0),
  status text not null default 'available' check (status in ('available','held','booked','blocked')),
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now(),
  constraint uniq_spa_slot unique (service_id, therapist, appointment_at)
);
create trigger set_spa_slots_updated_at before update on public.spa_slots for each row execute procedure public.trigger_set_timestamp();
create index if not exists idx_spa_slots_service_time on public.spa_slots(service_id, appointment_at);

create or replace function public.is_spa_slot_available(p_service_id uuid, p_therapist text, p_time timestamptz)
returns boolean language sql stable as $$
  select exists (
    select 1 from public.spa_slots ss
    where ss.service_id = p_service_id
      and ss.appointment_at = p_time
      and (p_therapist is null or ss.therapist = p_therapist)
      and ss.status = 'available'
  );
$$;
--- END FILE: Query_V2\02_Int_schema.sql ---

--- START FILE: Query_V2\03_Setup_RLS.sql ---
-- =========================================
-- 03_SETUP_RLS.SQL (SIMPLIFIED)
-- Disable RLS - Permission check on Frontend/Services
-- =========================================

-- DISABLE RLS - Tất cả các bảng không dùng RLS
-- Permissions được quản lý ở Frontend (AuthContext) & Services layer
-- Admin check: if (user.role === 'admin') { allow all operations }
-- User check: if (booking.user_id === current_user.id) { allow update/delete }

alter table public.users disable row level security;
--alter table public.profiles disable row level security;
-- BỎ admin_accounts (đã gộp vào profiles)
alter table public.room_types disable row level security;
alter table public.amenities disable row level security;
alter table public.room_type_amenities disable row level security;
alter table public.rooms disable row level security;
alter table public.room_images disable row level security;
alter table public.room_reviews disable row level security;
alter table public.price_rules disable row level security;
alter table public.promotions disable row level security;
alter table public.bookings disable row level security;
alter table public.booking_items disable row level security;
alter table public.audit_logs disable row level security;
alter table public.restaurant_bookings disable row level security;
alter table public.spa_bookings disable row level security;
alter table public.password_reset_requests disable row level security;
-- Bảng bổ sung
alter table public.room_status_history disable row level security;
alter table public.housekeeping_tasks disable row level security;
alter table public.restaurant_menu_items disable row level security;
alter table public.restaurant_tables disable row level security;
alter table public.restaurant_slots disable row level security;
alter table public.spa_services disable row level security;
alter table public.spa_slots disable row level security;
--- END FILE: Query_V2\03_Setup_RLS.sql ---

--- START FILE: Query_V2\04_Full_seed_data.sql ---
-- =====================================================
-- 04_FULL_SEED_DATA.SQL
-- =====================================================

-- NOTE: File này seed tất cả dữ liệu bao gồm:
-- - Amenities, Room Types, Rooms, Images
-- - Reviews, Price Rules, Promotions
-- - Users (admin@hotel.com / admin123 và longvh@gmail.com / user123)
-- - Bookings test data
-- - Holiday calendar

-- 1. AMENITIES
insert into public.amenities (name, icon_name) values
  ('Wifi', 'FaWifi'), ('Coffee', 'FaCoffee'), ('Bath', 'FaBath'), ('Parking Space', 'FaParking'),
  ('Swimming Pool', 'FaSwimmingPool'), ('Breakfast', 'FaHotdog'), ('GYM', 'FaStopwatch'), ('Drinks', 'FaCocktail')
on conflict (name) do nothing;

-- 2. ROOM TYPES
insert into public.room_types (code, name, description, base_capacity, max_person, base_price, facilities, is_active) values
  ('STD', 'Standard', 'Comfortable rooms with essential amenities', 1, 3, 115, array['Wifi', 'Coffee', 'Bath', 'Parking Space', 'Swimming Pool', 'Breakfast', 'GYM', 'Drinks'], true),
  ('DLX', 'Deluxe', 'Premium experience with elegant design', 2, 4, 265, array['Wifi', 'Coffee', 'Bath', 'Parking Space', 'Swimming Pool', 'Breakfast', 'GYM', 'Drinks'], true),
  ('SUI', 'Suite', 'Spacious suites for ultimate comfort', 3, 6, 320, array['Wifi', 'Coffee', 'Bath', 'Parking Space', 'Swimming Pool', 'Breakfast', 'GYM', 'Drinks'], true),
  ('PEN', 'Penthouse', 'Exclusive top-floor residences', 4, 6, 344, array['Wifi', 'Coffee', 'Bath', 'Parking Space', 'Swimming Pool', 'Breakfast', 'GYM', 'Drinks'], true),
  ('CMB', 'Combo', 'Value-packed packages with extras', 2, 6, 290, array['Wifi', 'Coffee', 'Bath', 'Parking Space', 'Swimming Pool', 'Breakfast', 'GYM', 'Drinks'], true)
on conflict (code) do update set is_active = true;

-- 3. ROOMS (40 PHÒNG ĐẦY ĐỦ)
insert into public.rooms (id, room_no, name, room_type_id, floor, size, type, category, price, description, status) values
  -- Standard
  (gen_random_uuid(), 'STD-01', 'Standard Room', (select id from public.room_types where code='STD'), 1, 30, 'Standard', 'standard', 115, 'Comfortable room with essential amenities.', 'available'),
  (gen_random_uuid(), 'STD-02', 'Cozy Studio Standard', (select id from public.room_types where code='STD'), 1, 28, 'Standard', 'standard', 145, 'Intimate studio with integrated work space.', 'available'),
  (gen_random_uuid(), 'STD-03', 'Garden View Standard', (select id from public.room_types where code='STD'), 1, 35, 'Standard', 'standard', 195, 'Charming room with garden views.', 'available'),
  (gen_random_uuid(), 'STD-04', 'Courtyard Classic Standard', (select id from public.room_types where code='STD'), 1, 32, 'Standard', 'standard', 185, 'Peaceful room overlooking the courtyard.', 'available'),
  (gen_random_uuid(), 'STD-05', 'Urban Escape Standard', (select id from public.room_types where code='STD'), 2, 38, 'Standard', 'standard', 205, 'Modern room in city center.', 'available'),
  (gen_random_uuid(), 'STD-06', 'Zen Retreat Standard', (select id from public.room_types where code='STD'), 2, 42, 'Standard', 'standard', 225, 'Tranquil room designed for relaxation.', 'available'),
  (gen_random_uuid(), 'STD-07', 'Heritage Standard', (select id from public.room_types where code='STD'), 2, 55, 'Standard', 'standard', 275, 'Elegant room with cultural charm.', 'available'),
  (gen_random_uuid(), 'STD-08', 'Skyline View Standard', (select id from public.room_types where code='STD'), 2, 45, 'Standard', 'standard', 255, 'Room with panoramic city views.', 'available'),
  -- Deluxe
  (gen_random_uuid(), 'DLX-01', 'Deluxe Room', (select id from public.room_types where code='DLX'), 3, 50, 'Deluxe', 'deluxe', 265, 'Premium experience with elegant design.', 'available'),
  (gen_random_uuid(), 'DLX-02', 'Deluxe Comfort', (select id from public.room_types where code='DLX'), 3, 38, 'Deluxe', 'deluxe', 245, 'Comfortable deluxe room.', 'available'),
  (gen_random_uuid(), 'DLX-03', 'Deluxe Modern', (select id from public.room_types where code='DLX'), 3, 42, 'Deluxe', 'deluxe', 265, 'Modern deluxe room.', 'available'),
  (gen_random_uuid(), 'DLX-04', 'Deluxe Sophisticated', (select id from public.room_types where code='DLX'), 3, 46, 'Deluxe', 'deluxe', 295, 'Sophisticated deluxe suite.', 'available'),
  (gen_random_uuid(), 'DLX-05', 'Deluxe Exquisite', (select id from public.room_types where code='DLX'), 4, 50, 'Deluxe', 'deluxe', 315, 'Exquisite deluxe room.', 'available'),
  (gen_random_uuid(), 'DLX-06', 'Deluxe Paramount', (select id from public.room_types where code='DLX'), 4, 54, 'Deluxe', 'deluxe', 335, 'Paramount deluxe suite.', 'available'),
  (gen_random_uuid(), 'DLX-07', 'Deluxe Prestigious', (select id from public.room_types where code='DLX'), 4, 58, 'Deluxe', 'deluxe', 365, 'Prestigious deluxe suite.', 'available'),
  (gen_random_uuid(), 'DLX-08', 'Deluxe Elite', (select id from public.room_types where code='DLX'), 4, 52, 'Deluxe', 'deluxe', 285, 'Elite deluxe experience.', 'available'),
  -- Suite
  (gen_random_uuid(), 'SUI-01', 'Luxury Suite Room', (select id from public.room_types where code='SUI'), 5, 90, 'Suite', 'suite', 320, 'Spacious suite for ultimate comfort.', 'available'),
  (gen_random_uuid(), 'SUI-02', 'Suite Comfort', (select id from public.room_types where code='SUI'), 5, 50, 'Suite', 'suite', 315, 'Comfortable suite.', 'available'),
  (gen_random_uuid(), 'SUI-03', 'Suite Spacious', (select id from public.room_types where code='SUI'), 5, 55, 'Suite', 'suite', 335, 'Spacious suite.', 'available'),
  (gen_random_uuid(), 'SUI-04', 'Suite Elegance', (select id from public.room_types where code='SUI'), 5, 60, 'Suite', 'suite', 365, 'Elegant suite.', 'available'),
  (gen_random_uuid(), 'SUI-05', 'Suite Grand', (select id from public.room_types where code='SUI'), 6, 65, 'Suite', 'suite', 385, 'Grand suite.', 'available'),
  (gen_random_uuid(), 'SUI-06', 'Suite Magnificent', (select id from public.room_types where code='SUI'), 6, 70, 'Suite', 'suite', 415, 'Magnificent suite.', 'available'),
  (gen_random_uuid(), 'SUI-07', 'Suite Premium', (select id from public.room_types where code='SUI'), 6, 75, 'Suite', 'suite', 445, 'Premium suite.', 'available'),
  (gen_random_uuid(), 'SUI-08', 'Suite Royal', (select id from public.room_types where code='SUI'), 6, 80, 'Suite', 'suite', 475, 'Royal suite.', 'available'),
  -- Penthouse
  (gen_random_uuid(), 'PEN-01', 'Penthouse', (select id from public.room_types where code='PEN'), 7, 45, 'Penthouse', 'penthouse', 344, 'Exclusive top-floor residence.', 'available'),
  (gen_random_uuid(), 'PEN-02', 'Penthouse View', (select id from public.room_types where code='PEN'), 7, 50, 'Penthouse', 'penthouse', 375, 'Penthouse with stunning views.', 'available'),
  (gen_random_uuid(), 'PEN-03', 'Penthouse Skyline', (select id from public.room_types where code='PEN'), 7, 55, 'Penthouse', 'penthouse', 395, 'Penthouse overlooking the skyline.', 'available'),
  (gen_random_uuid(), 'PEN-04', 'Penthouse Crown', (select id from public.room_types where code='PEN'), 7, 60, 'Penthouse', 'penthouse', 425, 'Crown jewel penthouse.', 'available'),
  (gen_random_uuid(), 'PEN-05', 'Penthouse Royal', (select id from public.room_types where code='PEN'), 8, 65, 'Penthouse', 'penthouse', 455, 'Royal penthouse.', 'available'),
  (gen_random_uuid(), 'PEN-06', 'Penthouse Ultra', (select id from public.room_types where code='PEN'), 8, 70, 'Penthouse', 'penthouse', 485, 'Ultra-luxury penthouse.', 'available'),
  (gen_random_uuid(), 'PEN-07', 'Penthouse Imperial', (select id from public.room_types where code='PEN'), 8, 75, 'Penthouse', 'penthouse', 515, 'Imperial penthouse.', 'available'),
  (gen_random_uuid(), 'PEN-08', 'Penthouse Supreme', (select id from public.room_types where code='PEN'), 8, 80, 'Penthouse', 'penthouse', 545, 'Supreme penthouse.', 'available'),
  -- Combo
  (gen_random_uuid(), 'CMB-01', 'Combo Premium', (select id from public.room_types where code='CMB'), 1, 40, 'Combo', 'combo', 245, 'Value package with breakfast & spa.', 'available'),
  (gen_random_uuid(), 'CMB-02', 'Combo Family', (select id from public.room_types where code='CMB'), 2, 50, 'Combo', 'combo', 315, 'Family package with activities.', 'available'),
  (gen_random_uuid(), 'CMB-03', 'Combo Romance', (select id from public.room_types where code='CMB'), 2, 42, 'Combo', 'combo', 265, 'Romance package with dinner.', 'available'),
  (gen_random_uuid(), 'CMB-04', 'Combo Business', (select id from public.room_types where code='CMB'), 3, 36, 'Combo', 'combo', 255, 'Business package.', 'available'),
  (gen_random_uuid(), 'CMB-05', 'Combo Adventure', (select id from public.room_types where code='CMB'), 3, 44, 'Combo', 'combo', 275, 'Adventure package.', 'available'),
  (gen_random_uuid(), 'CMB-06', 'Combo Wellness', (select id from public.room_types where code='CMB'), 4, 48, 'Combo', 'combo', 285, 'Wellness package.', 'available'),
  (gen_random_uuid(), 'CMB-07', 'Combo Culinary', (select id from public.room_types where code='CMB'), 4, 45, 'Combo', 'combo', 295, 'Culinary package.', 'available'),
  (gen_random_uuid(), 'CMB-08', 'Combo Ultimate', (select id from public.room_types where code='CMB'), 5, 70, 'Combo', 'combo', 565, 'Ultimate combo package.', 'available')
on conflict (room_no) do nothing;

-- 4. ROOM IMAGES (ẢNH THẬT TỪ FILE BẠN ĐƯA)
insert into public.room_images (room_type_id, image_url, image_lg_url, display_order)
select id, 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/1.png', 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/1-lg.png', 1 from public.room_types where code = 'STD'
union all
select id, 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/2.png', 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/2-lg.png', 1 from public.room_types where code = 'DLX'
union all
select id, 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/3.png', 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/3-lg.png', 1 from public.room_types where code = 'SUI'
union all
select id, 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/4.png', 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/4-lg.png', 1 from public.room_types where code = 'PEN'
union all
select id, 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/5.png', 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/5-lg.png', 1 from public.room_types where code = 'CMB'
on conflict do nothing;

-- 5. REVIEWS MẪU
insert into public.room_reviews (room_type_id, user_name, user_email, rating, comment, stay_date, created_at) values
  ((select id from public.room_types where code='STD'), 'Sophia Nguyen', 'sophia@email.com', 5, 'Room was spotless, pool view stunning.', '2024-10-15', now()),
  ((select id from public.room_types where code='STD'), 'Daniel Park', 'daniel@email.com', 4, 'Bed was plush and breakfast tasty.', '2024-11-10', now()),
  ((select id from public.room_types where code='DLX'), 'Marco Rossi', 'marco@email.com', 5, 'Serene courtyard setting.', '2024-07-22', now());

-- 6. KHUYẾN MÃI & QUY TẮC GIÁ
insert into public.price_rules (rule_type, room_type_id, apply_fri, apply_sat, apply_sun, price, priority, description, is_active)
select 'weekend'::price_rule_type, rt.id, false, true, true, rt.base_price * 1.15, 5, 'Weekend rate', true from public.room_types rt on conflict do nothing;

insert into public.promotions (code, name, description, discount_kind, discount_value, start_date, end_date, is_active) values
  ('WELCOME25', 'Welcome 25% Off', 'Giảm 25% cho đặt phòng lần đầu', 'percent', 25, '2025-01-01', '2025-12-31', true),
  ('SUMMER50', 'Summer Special 50k', 'Giảm 50k cho đặt phòng mùa hè', 'fixed', 50, '2025-06-01', '2025-08-31', true),
  ('WEEKEND15', 'Weekend Bonus', 'Giảm 15% cuối tuần', 'percent', 15, '2025-01-01', '2025-12-31', true)
on conflict (code) do nothing;

-- 7. USERS TEST DATA (Admin và User mẫu)
-- Password hash format: "salt:hash" (SHA-256 với salt)
-- Hash được tạo bằng function SQL để đảm bảo format đúng

-- Function để hash password (tương tự JavaScript hashPassword)
-- Format: "salt:hash" với salt 32 ký tự hex (16 bytes) và hash 64 ký tự hex (32 bytes SHA-256)
CREATE OR REPLACE FUNCTION public.hash_password_sql(password text, salt_hex text)
RETURNS text
LANGUAGE plpgsql
AS $$
DECLARE
  hash_hex text;
BEGIN
  -- Hash password + salt bằng SHA-256 (giống JavaScript: password + saltHex)
  -- pgcrypto extension đã được tạo trong 02_Int_schema.sql
  SELECT encode(digest(password || salt_hex, 'sha256'), 'hex') INTO hash_hex;
  RETURN salt_hex || ':' || hash_hex;
END;
$$;

-- Insert users với password hash
-- admin@hotel.com / admin123 (is_admin = true)
-- longvh@gmail.com / user123 (is_admin = false)
-- Salt: 32 ký tự hex (16 bytes) - giống format trong JavaScript
INSERT INTO public.users (email, password_hash, full_name, is_admin, is_email_verified, newsletter, language) VALUES
  (
    'admin@hotel.com',
    public.hash_password_sql('admin123', 'a1b2c3d4e5f6789012345678901234ab'), -- Salt 32 hex chars
    'Admin User',
    true,
    true,
    true,
    'en'
  ),
  (
    'longvh@gmail.com',
    public.hash_password_sql('user123', 'b2c3d4e5f6789012345678901234abcd'), -- Salt 32 hex chars
    'Long Võ',
    false,
    true,
    true,
    'vi'
  )
ON CONFLICT (email) DO UPDATE SET
  password_hash = EXCLUDED.password_hash,
  is_admin = EXCLUDED.is_admin,
  is_email_verified = EXCLUDED.is_email_verified,
  full_name = EXCLUDED.full_name,
  language = EXCLUDED.language;

-- Giữ lại function để có thể dùng sau này nếu cần
-- Nếu muốn xóa: DROP FUNCTION IF EXISTS public.hash_password_sql(text, text);

-- 8. BOOKINGS TEST DATA
-- Lưu ý: User IDs sẽ được lấy từ public.users
-- Tạo Booking Quá khứ cho user 1 (khach1@example.com)
INSERT INTO public.bookings (id, user_id, confirmation_code, status, check_in, check_out, room_id, room_name, total_amount)
SELECT gen_random_uuid(), u.id, 'BK-PAST-01', 'checked_out', CURRENT_DATE - 10, CURRENT_DATE - 8, (SELECT id FROM public.rooms WHERE room_no = 'STD-01'), 'Standard Room', 230
FROM public.users u WHERE u.email = 'khach1@example.com'
ON CONFLICT (confirmation_code) DO NOTHING;

-- Tạo Booking Tương lai cho user 2 (khachvip@example.com)
INSERT INTO public.bookings (id, user_id, confirmation_code, status, check_in, check_out, room_id, room_name, total_amount)
SELECT gen_random_uuid(), u.id, 'BK-FUTR-02', 'confirmed', CURRENT_DATE + 5, CURRENT_DATE + 7, (SELECT id FROM public.rooms WHERE room_no = 'DLX-01'), 'Deluxe Room', 530
FROM public.users u WHERE u.email = 'khachvip@example.com'
ON CONFLICT (confirmation_code) DO NOTHING;

-- Tạo Booking Items
INSERT INTO public.booking_items (booking_id, room_id, room_type_id, price_per_night, nights, amount)
SELECT b.id, b.room_id, r.room_type_id, r.price, (b.check_out - b.check_in), (r.price * (b.check_out - b.check_in))
FROM public.bookings b JOIN public.rooms r ON b.room_id = r.id;

-- 9. LIÊN KẾT TIỆN NGHI (AUTO LINK)
INSERT INTO public.room_type_amenities (room_type_id, amenity_id)
SELECT DISTINCT rt.id, a.id FROM public.room_types rt CROSS JOIN LATERAL unnest(rt.facilities) AS facility_name JOIN public.amenities a ON a.name = facility_name ON CONFLICT DO NOTHING;

-- 10. LỊCH LỄ
INSERT INTO public.holiday_calendar (holiday_date, name, multiplier) VALUES
    ('2025-01-01', 'New Year 2025', 1.5), ('2025-04-30', 'Reunification Day', 1.3), ('2025-12-25', 'Christmas Day', 1.5)
ON CONFLICT (holiday_date) DO NOTHING;

-- 11. ROOM STATUS HISTORY (seed optional)
insert into public.room_status_history (room_id, status, started_at, note)
select id, status, now(), 'Initial status seed'
from public.rooms
on conflict do nothing;

-- 12. RESTAURANT SEED (menu, tables, slots)
insert into public.restaurant_menu_items (code, name, description, category, price, image_url, display_order) values
  ('APP-TRUFFLE', 'Truffle Arancini', 'Crispy risotto with truffle', 'appetizers', 28, 'https://via.placeholder.com/400x300?text=Arancini', 1),
  ('MAIN-RIBEYE', 'Wagyu Ribeye Steak', '300g ribeye with veggies', 'mains', 95, 'https://via.placeholder.com/400x300?text=Ribeye', 2),
  ('DESS-SOUFFLE', 'Chocolate Soufflé', 'Warm soufflé with ice cream', 'desserts', 24, 'https://via.placeholder.com/400x300?text=Souffle', 3),
  ('BEV-CHAMP', 'Champagne', 'Premium champagne', 'beverages', 120, 'https://via.placeholder.com/400x300?text=Champagne', 4)
on conflict (code) do nothing;

insert into public.restaurant_tables (name, capacity, location, status) values
  ('T1', 2, 'Indoor', 'available'),
  ('T2', 4, 'Indoor', 'available'),
  ('T3', 4, 'Terrace', 'available'),
  ('T4', 6, 'Terrace', 'available')
on conflict (name) do nothing;

-- Seed a few slots today/tomorrow for each table
insert into public.restaurant_slots (table_id, reservation_at, capacity_limit, capacity_used, status)
select t.id, (current_date + i)::date + time '18:00', t.capacity, 0, 'available'
from public.restaurant_tables t
cross join generate_series(0,1) as i
on conflict do nothing;

insert into public.restaurant_slots (table_id, reservation_at, capacity_limit, capacity_used, status)
select t.id, (current_date + i)::date + time '20:00', t.capacity, 0, 'available'
from public.restaurant_tables t
cross join generate_series(0,1) as i
on conflict do nothing;

-- 13. SPA SEED (services, slots)
insert into public.spa_services (code, name, category, duration_minutes, price, description, image_url, display_order) values
  ('SPA-SWE', 'Swedish Massage', 'massage', 60, 95, 'Relaxation massage', 'https://via.placeholder.com/400x300?text=Swedish', 1),
  ('SPA-HOT', 'Hot Stone Massage', 'massage', 90, 145, 'Deep relaxation with stones', 'https://via.placeholder.com/400x300?text=Hot+Stone', 2),
  ('SPA-FAC', 'Signature Facial', 'facial', 60, 120, 'Deep cleansing facial', 'https://via.placeholder.com/400x300?text=Facial', 3)
on conflict (code) do nothing;

-- Seed slots for today/tomorrow for each service
insert into public.spa_slots (service_id, therapist, appointment_at, capacity, status)
select s.id, 'Therapist A', (current_date + i)::date + time '10:00', 1, 'available'
from public.spa_services s
cross join generate_series(0,1) as i
on conflict do nothing;

insert into public.spa_slots (service_id, therapist, appointment_at, capacity, status)
select s.id, 'Therapist B', (current_date + i)::date + time '14:00', 1, 'available'
from public.spa_services s
cross join generate_series(0,1) as i
on conflict do nothing;
--- END FILE: Query_V2\04_Full_seed_data.sql ---

--- START FILE: src\App.jsx ---
import { BrowserRouter, Route, Routes, useLocation } from "react-router-dom";
import { Footer, Header, ProtectedRoute } from "./components";
import ChatBox from "./components/chatBox";
import {
  Home,
  RoomDetails,
  Admin,
  Login,
  Register,
  ForgotPassword,
  ResetPassword,
  RoomsPage,
  Contact,
  UserDashboard,
  RestaurantPage,
  SpaPage,
  NotFound404,
  AuthCallback,
  SetPassword,
} from "./pages";
import "./style/chatbox.css";

const AppContent = () => {
  const location = useLocation();
  const isAdminPage = location.pathname.startsWith("/admin");
  const isLoginPage =
    location.pathname === "/login" || location.pathname === "/admin/login";
  const isRegisterPage = location.pathname === "/register";
  const isForgotPasswordPage = location.pathname === "/forgot-password";
  const isResetPasswordPage = location.pathname === "/reset-password";
  const isSetPasswordPage = location.pathname === "/set-password";
  const isUserDashboardPage = location.pathname === "/account";
  const shouldHideHeaderFooter =
    isAdminPage ||
    isLoginPage ||
    isRegisterPage ||
    isForgotPasswordPage ||
    isResetPasswordPage ||
    isSetPasswordPage ||
    isUserDashboardPage;

  return (
    <>
      {!shouldHideHeaderFooter && <Header />}

      <Routes>
        <Route path={"/"} element={<Home />} />
        <Route path={"/room/:id"} element={<RoomDetails />} />
        <Route path={"/rooms"} element={<RoomsPage />} />
        <Route path={"/restaurant"} element={<RestaurantPage />} />
        <Route path={"/spa"} element={<SpaPage />} />
        <Route path={"/contact"} element={<Contact />} />
        <Route
          path={"/account"}
          element={
            <ProtectedRoute redirectTo="/login" disallowAdmin={true}>
              <UserDashboard />
            </ProtectedRoute>
          }
        />
        <Route path={"/login"} element={<Login />} />
        <Route path={"/register"} element={<Register />} />
        <Route path={"/forgot-password"} element={<ForgotPassword />} />
        <Route path={"/reset-password"} element={<ResetPassword />} />
        <Route path={"/set-password"} element={<SetPassword />} />
        <Route path={"/auth/callback"} element={<AuthCallback />} />
        <Route path={"/admin/login"} element={<Login />} />
        <Route
          path={"/admin"}
          element={
            <ProtectedRoute requireAdmin={true} redirectTo="/admin/login">
              <Admin />
            </ProtectedRoute>
          }
        />
        <Route path={"*"} element={<NotFound404 />} />
      </Routes>

      {!shouldHideHeaderFooter && <Footer />}
      {!shouldHideHeaderFooter && <ChatBox />}
    </>
  );
};

const App = () => {
  return (
    <main className="">
      <BrowserRouter>
        <AppContent />
      </BrowserRouter>
    </main>
  );
};

export default App;

--- END FILE: src\App.jsx ---

--- START FILE: src\components\admin\AuditLogsManagement.jsx ---
import { useEffect } from 'react';
import { useCRUD } from '../../hooks';
import { AdminHeader, AdminTable } from '../../features/admin';
const AuditLogsManagement = () => {
  const { data: logs, isLoading, error, fetchData } = useCRUD(
    'audit_logs',
    '*'
  );

  useEffect(() => {
    fetchData({}, { column: 'created_at', ascending: false });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []); // Empty dependency array - only fetch once on mount

  // Table columns configuration - using correct schema field names
  const columns = [
    {
      key: 'actor',
      label: 'Actor',
      render: (value) => <span className="font-semibold">{value ? `User ${value.substring(0, 8)}` : 'System'}</span>
    },
    {
      key: 'action',
      label: 'Action',
      render: (value) => (
        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
          value === 'create' ? 'bg-green-100 text-green-800' :
          value === 'update' ? 'bg-blue-100 text-blue-800' :
          value === 'delete' ? 'bg-red-100 text-red-800' :
          'bg-gray-100 text-gray-800'
        }`}>
          {value?.toUpperCase() || 'N/A'}
        </span>
      )
    },
    {
      key: 'target_table',
      label: 'Table',
      render: (value) => <span className="font-mono text-sm">{value || '-'}</span>
    },
    {
      key: 'target_id',
      label: 'Record ID',
      render: (value) => <span className="text-sm">{value ? value.substring(0, 8) + '...' : '-'}</span>
    },
    {
      key: 'meta',
      label: 'Details',
      render: (value) => <span className="text-sm text-gray-600">{value ? 'Yes' : 'No'}</span>
    },
    {
      key: 'created_at',
      label: 'Timestamp',
      render: (value) => <span className="text-sm">{value ? new Date(value).toLocaleString() : '-'}</span>
    }
  ];

  return (
    <div>
      <AdminHeader
        title="Audit Logs"
        description="Admin action history - Record CRUD operations"
      />

      <AdminTable
        columns={columns}
        data={logs}
        isLoading={isLoading}
        error={error}
        onRetry={() => fetchData({}, { column: 'created_at', ascending: false })}
        emptyMessage="No data found"
      />
    </div>
  );
};

export default AuditLogsManagement;

--- END FILE: src\components\admin\AuditLogsManagement.jsx ---

--- START FILE: src\components\admin\BookingsManagement.jsx ---
import { useState, useEffect } from "react";
import {
  FaCheck,
  FaTimes,
  FaEdit,
  FaTrash
} from "react-icons/fa";
import {
  fetchAllRoomBookingsForAdmin,
  fetchAllRestaurantBookingsForAdmin,
  fetchAllSpaBookingsForAdmin,
  updateRoomBookingStatus,
  updateRestaurantBookingStatus,
  updateSpaBookingStatus,
  deleteRoomBooking,
  deleteRestaurantBooking,
  deleteSpaBooking
} from "../../services/adminService";

const BookingsManagement = () => {
  const [bookings, setBookings] = useState([]);
  const [selectedBooking, setSelectedBooking] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(null);
  const [filterStatus, setFilterStatus] = useState('');
  const [filterType, setFilterType] = useState('');
  const [sortBy, setSortBy] = useState('date-desc');
  const [dateRange, setDateRange] = useState({ start: '', end: '' });

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setLoading(true);
    setError(null);
    try {
      const [roomBookings, restBookings, spaBookings] = await Promise.all([
        fetchAllRoomBookingsForAdmin(),
        fetchAllRestaurantBookingsForAdmin(),
        fetchAllSpaBookingsForAdmin(),
      ]);

      const combined = [
        ...roomBookings.map((b) => ({
          ...b,
          type: "room",
          item_name: b.rooms?.room_no || "Room N/A",
          guestName: b.users?.full_name || b.user_name || "N/A",
          guestEmail: b.users?.email || b.user_email || "N/A",
          totalPrice: parseFloat(b.total_amount || 0),
        })),
        ...restBookings.map((b) => ({
          ...b,
          type: "restaurant",
          item_name: "Restaurant Table",
          guestName: b.users?.full_name || b.name || "N/A",
          guestEmail: b.users?.email || b.email || "N/A",
          totalPrice: parseFloat(b.total_price || 0),
          checkIn: b.reservation_at,
          checkOut: b.reservation_at,
        })),
        ...spaBookings.map((b) => ({
          ...b,
          type: "spa",
          item_name: b.service_name || "Spa Service",
          guestName: b.users?.full_name || b.name || "N/A",
          guestEmail: b.users?.email || b.email || "N/A",
          totalPrice: parseFloat(b.total_price || 0),
          checkIn: b.appointment_at,
          checkOut: b.appointment_at,
        })),
      ].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

      setBookings(combined);
    } catch (err) {
      console.error("❌ Error loading admin bookings:", err);
      setError("Failed to load bookings");
      setBookings([]);
    } finally {
      setLoading(false);
    }
  };

  const handleStatusChange = async (booking, newStatus) => {
    if (!newStatus || newStatus === booking.status) return;
    
    setLoading(true);
    setError(null);
    try {
      const updateFn =
        booking.type === "room"
          ? updateRoomBookingStatus
          : booking.type === "restaurant"
          ? updateRestaurantBookingStatus
          : updateSpaBookingStatus;

      await updateFn(booking.id, newStatus);
      setSuccess(`Booking status updated to ${statusOptions.find(s => s.value === newStatus)?.label || newStatus}`);
      await loadData();
      setTimeout(() => setSuccess(null), 3000);
      console.log(
        `✅ Booking ${booking.confirmation_code || booking.id.substring(0, 8)} status updated to ${newStatus}`
      );
    } catch (err) {
      console.error("❌ Error updating status:", err);
      setError(err.message || "Failed to update booking status");
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (booking) => {
    if (!window.confirm(`Are you sure you want to delete booking #${booking.confirmation_code || booking.id.substring(0, 8)}? This action cannot be undone.`)) return;

    setLoading(true);
    setError(null);
    try {
      const deleteFn =
        booking.type === "room"
          ? deleteRoomBooking
          : booking.type === "restaurant"
          ? deleteRestaurantBooking
          : deleteSpaBooking;

      await deleteFn(booking.id);
      setSuccess(`Booking deleted successfully`);
      await loadData();
      setTimeout(() => setSuccess(null), 3000);
    } catch (err) {
      console.error("❌ Error deleting booking:", err);
      setError(err.message || "Failed to delete booking");
    } finally {
      setLoading(false);
    }
  };

  const statusOptions = [
    {
      value: "pending",
      label: "Pending Approval",
      color: "bg-yellow-100 text-yellow-800",
    },
    {
      value: "pending_payment",
      label: "Pending Payment",
      color: "bg-yellow-200 text-yellow-800",
    },
    {
      value: "approved",
      label: "Approved",
      color: "bg-green-100 text-green-800",
    },
    {
      value: "confirmed",
      label: "Confirmed",
      color: "bg-blue-100 text-blue-800",
    },
    {
      value: "checked_in",
      label: "Checked In",
      color: "bg-cyan-100 text-cyan-800",
    },
    {
      value: "checked_out",
      label: "Checked Out",
      color: "bg-gray-300 text-gray-800",
    },
    { value: "completed", label: "Completed", color: "bg-gray-500 text-white" },
    {
      value: "modified",
      label: "Modified",
      color: "bg-purple-100 text-purple-800",
    },
    { value: "rejected", label: "Rejected", color: "bg-red-100 text-red-800" },
    {
      value: "cancelled",
      label: "Cancelled",
      color: "bg-red-200 text-red-800",
    },
  ];

  const getStatusBadge = (status) => {
    const option = statusOptions.find((opt) => opt.value === status);
    return (
      <span
        className={`px-3 py-1 rounded-full text-xs font-semibold ${
          option?.color || "bg-gray-100 text-gray-800"
        }`}
      >
        {option?.label || status}
      </span>
    );
  };

  const handleViewDetails = (booking) => {
    setSelectedBooking(booking);
    setIsModalOpen(true);
  };

  const getFilteredAndSortedBookings = () => {
    let filtered = bookings;

    // Apply status filter
    if (filterStatus) {
      filtered = filtered.filter(b => b.status === filterStatus);
    }

    // Apply type filter
    if (filterType) {
      filtered = filtered.filter(b => b.type === filterType);
    }

    // Apply date range filter
    if (dateRange.start || dateRange.end) {
      filtered = filtered.filter(b => {
        const bookingDate = new Date(b.created_at);
        if (dateRange.start && bookingDate < new Date(dateRange.start)) return false;
        if (dateRange.end && bookingDate > new Date(dateRange.end)) return false;
        return true;
      });
    }

    // Apply sorting
    switch (sortBy) {
      case 'date-asc':
        filtered.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
        break;
      case 'price-desc':
        filtered.sort((a, b) => (b.totalPrice || 0) - (a.totalPrice || 0));
        break;
      case 'price-asc':
        filtered.sort((a, b) => (a.totalPrice || 0) - (b.totalPrice || 0));
        break;
      case 'date-desc':
      default:
        filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    }

    return filtered;
  };

  const displayBookings = getFilteredAndSortedBookings();

  const DetailItem = ({ label, value, isTotal = false, isHtml = false }) => (
    <div
      className={`py-1 ${isTotal ? "border-t-2 border-accent mt-4 pt-4" : ""}`}
    >
      <label className="block text-xs font-semibold mb-1 text-primary/70 uppercase">
        {label}
      </label>
      {isHtml ? (
        <div>{value}</div>
      ) : (
        <span
          className={`font-semibold ${
            isTotal ? "text-lg text-accent" : "text-primary"
          }`}
        >
          {value || "N/A"}
        </span>
      )}
    </div>
  );

  return (
    <div>
      <div className="mb-8">
        <h1 className="h2 text-primary mb-2">Bookings Management</h1>
        <p className="text-gray-600">
          Approve, reject, cancel orders and manage guest information
        </p>
      </div>

      {error && (
        <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700">
          ❌ {error}
        </div>
      )}

      {success && (
        <div className="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700">
          ✅ {success}
        </div>
      )}

      {loading && !error ? <div className="text-center py-8 text-gray-500">Loading...</div> : null}

      {/* Filter & Sort Controls */}
      <div className="mb-6 bg-white p-4 rounded-lg shadow-sm flex flex-wrap gap-4">
        <div className="flex-1 min-w-[200px]">
          <label className="block text-sm font-semibold mb-1 text-primary">Status Filter</label>
          <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
            <option value="">All Status</option>
            <option value="pending">Pending</option>
            <option value="pending_payment">Pending Payment</option>
            <option value="confirmed">Confirmed</option>
            <option value="completed">Completed</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        <div className="flex-1 min-w-[200px]">
          <label className="block text-sm font-semibold mb-1 text-primary">Booking Type</label>
          <select value={filterType} onChange={(e) => setFilterType(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
            <option value="">All Types</option>
            <option value="room">Room</option>
            <option value="restaurant">Restaurant</option>
            <option value="spa">Spa</option>
          </select>
        </div>
        <div className="flex-1 min-w-[200px]">
          <label className="block text-sm font-semibold mb-1 text-primary">Sort By</label>
          <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm">
            <option value="date-desc">Newest First</option>
            <option value="date-asc">Oldest First</option>
            <option value="price-desc">Highest Price</option>
            <option value="price-asc">Lowest Price</option>
          </select>
        </div>
      </div>

      <div className="bg-white rounded-lg shadow-md overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-accent text-white">
              <tr>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                  ID / Type
                </th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                  Item/Service
                </th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                  Guest
                </th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                  Total
                </th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                  Date/Time
                </th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                  Created At
                </th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                  Status
                </th>
                <th className="px-6 py-4 text-center font-tertiary tracking-wider">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {displayBookings.length === 0 ? (
                <tr>
                  <td
                    colSpan="8"
                    className="px-6 py-12 text-center text-gray-500"
                  >
                    No bookings found.
                  </td>
                </tr>
              ) : (
                displayBookings.map((booking) => (
                  <tr key={booking.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <span className="font-semibold">
                        {booking.confirmation_code ||
                          booking.id.substring(0, 8)}
                      </span>
                      <span
                        className={`ml-2 px-2 py-0.5 rounded text-xs font-medium uppercase tracking-wider ${
                          booking.type === "room"
                            ? "bg-blue-100 text-blue-800"
                            : booking.type === "restaurant"
                            ? "bg-orange-100 text-orange-800"
                            : "bg-pink-100 text-pink-800"
                        }`}
                      >
                        {booking.type}
                      </span>
                    </td>
                    <td className="px-6 py-4">{booking.item_name || "-"}</td>
                    <td className="px-6 py-4">{booking.guestName || "-"}</td>
                    <td className="px-6 py-4 font-semibold">
                      ${booking.totalPrice?.toFixed(2) || "0.00"}
                    </td>
                    <td className="px-6 py-4 text-sm">
                      {booking.checkIn
                        ? new Date(booking.checkIn).toLocaleDateString()
                        : "-"}
                    </td>
                    <td className="px-6 py-4 text-sm">
                      {new Date(booking.created_at).toLocaleDateString()}
                    </td>
                    <td className="px-6 py-4">
                      {getStatusBadge(booking.status)}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center justify-center gap-2">
                        <button
                          onClick={() => handleViewDetails(booking)}
                          className="p-2 text-accent hover:bg-accent/10 rounded transition-colors disabled:opacity-50"
                          title="View Details"
                          disabled={loading}
                        >
                          <FaEdit />
                        </button>
                        <select
                          value={booking.status}
                          onChange={(e) => handleStatusChange(booking, e.target.value)}
                          className="px-3 py-1 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-accent focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"
                          disabled={loading}
                          title="Change Status"
                        >
                          {statusOptions.map(opt => (
                            <option key={opt.value} value={opt.value}>{opt.label}</option>
                          ))}
                        </select>
                        <button
                          onClick={() => handleDelete(booking)}
                          className="p-2 text-red-500 hover:bg-red-50 rounded transition-colors disabled:opacity-50"
                          title="Delete"
                          disabled={loading}
                        >
                          <FaTrash />
                        </button>
                      </div>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

      {isModalOpen && selectedBooking && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-gray-200 flex justify-between items-center">
              <h2 className="h3 text-primary">
                Booking Details #
                {selectedBooking.confirmation_code ||
                  selectedBooking.id.substring(0, 8)}
              </h2>
              <button
                onClick={() => setIsModalOpen(false)}
                className="text-gray-500 hover:text-red-500"
              >
                <FaTimes />
              </button>
            </div>

            <div className="p-6 space-y-6">
              <div className="grid grid-cols-2 gap-4">
                <DetailItem
                  label="Type"
                  value={selectedBooking.type?.toUpperCase()}
                />
                <DetailItem
                  label="Status"
                  value={getStatusBadge(selectedBooking.status)}
                  isHtml={true}
                />

                {selectedBooking.type === "room" && (
                  <>
                    <DetailItem
                      label="Room"
                      value={selectedBooking.item_name}
                    />
                    <DetailItem
                      label="Check-in"
                      value={selectedBooking.check_in}
                    />
                    <DetailItem
                      label="Check-out"
                      value={selectedBooking.check_out}
                    />
                    <DetailItem
                      label="Guests"
                      value={`${selectedBooking.num_adults || 0} Adult(s), ${selectedBooking.num_children || 0} Kid(s)`}
                    />
                    <DetailItem
                      label="Total Nights"
                      value={selectedBooking.total_nights}
                    />
                  </>
                )}
                {selectedBooking.type === "restaurant" && (
                  <>
                    <DetailItem
                      label="Reservation Time"
                      value={new Date(
                        selectedBooking.reservation_at
                      ).toLocaleString("vi-VN")}
                    />
                    <DetailItem
                      label="Guests"
                      value={`${selectedBooking.guests || 0} people`}
                    />
                  </>
                )}
                {selectedBooking.type === "spa" && (
                  <>
                    <DetailItem
                      label="Service"
                      value={selectedBooking.service_name}
                    />
                    <DetailItem
                      label="Appointment"
                      value={new Date(
                        selectedBooking.appointment_at
                      ).toLocaleString("vi-VN")}
                    />
                    <DetailItem
                      label="Therapist"
                      value={selectedBooking.therapist || "No preference"}
                    />
                  </>
                )}

                <DetailItem
                  label="Guest Name"
                  value={selectedBooking.guestName}
                />
                <DetailItem
                  label="Email"
                  value={selectedBooking.guestEmail}
                />
                <DetailItem
                  label="Phone"
                  value={selectedBooking.phone || "N/A"}
                />
                <DetailItem
                  label="Subtotal"
                  value={`$${(selectedBooking.subtotal || 0).toFixed(2)}`}
                />
                <DetailItem
                  label="Discount"
                  value={`$${(selectedBooking.discount || 0).toFixed(2)}`}
                />
                <DetailItem
                  label="TOTAL AMOUNT"
                  value={`$${selectedBooking.totalPrice?.toFixed(2) || "0.00"}`}
                  isTotal={true}
                />
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  Notes / Special Requests
                </label>
                <textarea
                  rows="4"
                  readOnly
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 resize-none"
                  defaultValue={selectedBooking.note || "N/A"}
                />
              </div>

              <div className="flex gap-4 pt-4 border-t border-gray-200">
                <button
                  onClick={() => setIsModalOpen(false)}
                  className="btn btn-primary btn-sm flex-1"
                >
                  Close
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default BookingsManagement;
--- END FILE: src\components\admin\BookingsManagement.jsx ---

--- START FILE: src\components\admin\BookingsManagement_REFACTORED.js ---
import { useState, useEffect, useCallback } from "react";
import {
  FaCheck,
  FaTimes,
  FaBan,
  FaEdit,
  FaPhone,
  FaUser,
  FaSpinner,
  FaExclamationCircle,
} from "react-icons/fa";
import {
  fetchAllBookingsForAdmin,
  updateBookingStatus,
  deleteBooking,
  fetchRoomStatusBoardForAdmin,
} from "../../services/adminService_REFACTORED";

/**
 * ============================================================================
 * BOOKINGS MANAGEMENT - REFACTORED
 * ============================================================================
 * 
 * This component displays ALL bookings (Room + Restaurant + Spa) in a unified
 * table using the admin service layer.
 * 
 * Key Changes:
 * - ✅ Uses adminService instead of direct supabase calls
 * - ✅ Cleaner, simpler component logic
 * - ✅ Better error handling and loading states
 * - ✅ Data normalization happens in service layer
 * - ✅ All booking types combined at service level
 * ============================================================================
 */

const BookingsManagement = () => {
  const [bookings, setBookings] = useState([]);
  const [selectedBooking, setSelectedBooking] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [updating, setUpdating] = useState(false);
  const [roomBoard, setRoomBoard] = useState([]);
  const statusChip = {
    available: "bg-green-100 text-green-800",
    occupied: "bg-blue-100 text-blue-800",
    cleaning: "bg-yellow-100 text-yellow-800",
    maintenance: "bg-red-100 text-red-800",
  };

  // Status options for dropdown
  const statusOptions = [
    {
      value: "pending",
      label: "Pending Approval",
      color: "bg-yellow-100 text-yellow-800",
    },
    {
      value: "pending_payment",
      label: "Pending Payment",
      color: "bg-yellow-200 text-yellow-800",
    },
    {
      value: "approved",
      label: "Approved",
      color: "bg-green-100 text-green-800",
    },
    {
      value: "confirmed",
      label: "Confirmed",
      color: "bg-blue-100 text-blue-800",
    },
    {
      value: "checked_in",
      label: "Checked In",
      color: "bg-cyan-100 text-cyan-800",
    },
    {
      value: "checked_out",
      label: "Checked Out",
      color: "bg-gray-300 text-gray-800",
    },
    { value: "completed", label: "Completed", color: "bg-gray-500 text-white" },
    {
      value: "modified",
      label: "Modified",
      color: "bg-purple-100 text-purple-800",
    },
    { value: "rejected", label: "Rejected", color: "bg-red-100 text-red-800" },
    {
      value: "cancelled",
      label: "Cancelled",
      color: "bg-red-200 text-red-800",
    },
  ];

  /**
   * Load all bookings from service layer
   */
  const loadBookings = useCallback(async () => {
    setLoading(true);
    setError(null);
    try {
      const data = await fetchAllBookingsForAdmin();
      setBookings(data);
      console.log(`✅ Loaded ${data.length} bookings`);
    } catch (err) {
      console.error("❌ Error loading bookings:", err);
      setError("Failed to load bookings. Please try again.");
    } finally {
      setLoading(false);
    }
  }, []);

  /**
   * Initial load on component mount
   */
  useEffect(() => {
    loadBookings();
    fetchRoomStatusBoardForAdmin().then(setRoomBoard).catch(() => {});
  }, [loadBookings]);

  /**
   * Handle status change via dialog
   */
  const handleStatusChange = async (booking) => {
    const availableStatuses = statusOptions.map((opt) => opt.value);
    const statusListPrompt = availableStatuses.join(", ");

    const newStatus = prompt(
      `Change status for ${booking.confirmation_code} (current: ${booking.status})\n\nAvailable statuses:\n${statusListPrompt}`
    );

    if (!newStatus) return; // User cancelled

    if (!availableStatuses.includes(newStatus)) {
      alert(`Invalid status. Use one of: ${statusListPrompt}`);
      return;
    }

    setUpdating(true);
    try {
      const success = await updateBookingStatus(
        booking.id,
        booking.type,
        newStatus
      );

      if (success) {
        console.log(`✅ Booking status updated to ${newStatus}`);
        // Update local state
        setBookings((prev) =>
          prev.map((b) =>
            b.id === booking.id ? { ...b, status: newStatus } : b
          )
        );
        if (selectedBooking?.id === booking.id) {
          setSelectedBooking({ ...selectedBooking, status: newStatus });
        }
      } else {
        setError("Failed to update booking status");
      }
    } catch (err) {
      console.error("❌ Error updating status:", err);
      setError("Error updating status. Please try again.");
    } finally {
      setUpdating(false);
    }
  };

  const handleQuickAction = async (booking, targetStatus) => {
    setUpdating(true);
    try {
      const updated = await updateBookingStatus(
        booking.id,
        booking.type,
        targetStatus
      );
      if (updated) {
        setBookings((prev) =>
          prev.map((b) =>
            b.id === booking.id ? { ...b, status: targetStatus } : b
          )
        );
        if (selectedBooking?.id === booking.id) {
          setSelectedBooking({ ...selectedBooking, status: targetStatus });
        }
        const board = await fetchRoomStatusBoardForAdmin();
        setRoomBoard(board || []);
      } else {
        setError("Failed to update booking status");
      }
    } catch (err) {
      console.error("❌ Error updating status:", err);
      setError("Error updating status. Please try again.");
    } finally {
      setUpdating(false);
    }
  };

  /**
   * Handle booking deletion
   */
  const handleDeleteBooking = async (booking) => {
    if (
      !window.confirm(
        `Are you sure you want to delete booking ${booking.confirmation_code}? This cannot be undone.`
      )
    ) {
      return;
    }

    setUpdating(true);
    try {
      const success = await deleteBooking(booking.id, booking.type);
      if (success) {
        console.log(`✅ Booking deleted`);
        setBookings((prev) => prev.filter((b) => b.id !== booking.id));
        if (selectedBooking?.id === booking.id) {
          setIsModalOpen(false);
          setSelectedBooking(null);
        }
      } else {
        setError("Failed to delete booking");
      }
    } catch (err) {
      console.error("❌ Error deleting booking:", err);
      setError("Error deleting booking. Please try again.");
    } finally {
      setUpdating(false);
    }
  };

  /**
   * Get status badge with color
   */
  const getStatusBadge = (status) => {
    const option = statusOptions.find((opt) => opt.value === status);
    return (
      <span
        className={`px-3 py-1 rounded-full text-xs font-semibold ${
          option?.color || "bg-gray-100 text-gray-800"
        }`}
      >
        {option?.label || status}
      </span>
    );
  };

  /**
   * Get booking type badge with color
   */
  const getTypeBadge = (type) => {
    const typeConfig = {
      room: { label: "🛏️ Room", color: "bg-blue-100 text-blue-800" },
      restaurant: { label: "🍽️ Restaurant", color: "bg-orange-100 text-orange-800" },
      spa: { label: "💆 Spa", color: "bg-pink-100 text-pink-800" },
    };

    const config = typeConfig[type] || { label: type, color: "bg-gray-100 text-gray-800" };

    return (
      <span className={`px-2 py-0.5 rounded text-xs font-medium uppercase tracking-wider ${config.color}`}>
        {config.label}
      </span>
    );
  };

  /**
   * View booking details in modal
   */
  const handleViewDetails = (booking) => {
    setSelectedBooking(booking);
    setIsModalOpen(true);
  };

  /**
   * Detail item component for modal
   */
  const DetailItem = ({ label, value, isTotal = false, isHtml = false }) => (
    <div
      className={`py-2 ${isTotal ? "border-t-2 border-accent mt-4 pt-4" : ""}`}
    >
      <label className="block text-xs font-semibold mb-1 text-primary/70 uppercase">
        {label}
      </label>
      {isHtml ? (
        <div>{value}</div>
      ) : (
        <span
          className={`font-semibold ${
            isTotal ? "text-lg text-accent" : "text-primary"
          }`}
        >
          {value || "N/A"}
        </span>
      )}
    </div>
  );

  // ========== RENDER ==========

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="mb-8">
        <h1 className="h2 text-primary mb-2">Bookings Management</h1>
        <p className="text-gray-600">
          Manage all bookings (Room, Restaurant, Spa) - approve, reject, update status, or delete
        </p>
      </div>

      {/* Error Alert */}
      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-3 text-red-700">
          <FaExclamationCircle size={20} />
          <p>{error}</p>
          <button
            onClick={() => setError(null)}
            className="ml-auto text-red-500 hover:text-red-700"
          >
            <FaTimes />
          </button>
        </div>
      )}

      {/* Loading State */}
      {loading ? (
        <div className="flex items-center justify-center py-12">
          <FaSpinner className="animate-spin text-accent text-3xl" />
          <span className="ml-3 text-gray-600">Loading bookings...</span>
        </div>
      ) : (
        <>
          {/* Room Status Board (compact) */}
          {roomBoard.length > 0 && (
            <div className="bg-white rounded-lg shadow-md overflow-hidden border border-gray-200">
              <div className="flex items-center justify-between px-6 py-4 border-b border-gray-100">
                <h3 className="text-lg font-semibold">Room Status Board</h3>
                <button
                  className="text-sm text-blue-600"
                  onClick={() => fetchRoomStatusBoardForAdmin().then(setRoomBoard)}
                  disabled={updating}
                >
                  Refresh
                </button>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-0 divide-y md:divide-y-0 md:divide-x divide-gray-100">
                {roomBoard.map((room) => (
                  <div key={room.room_id} className="p-4">
                    <div className="flex items-center justify-between mb-1">
                      <div className="font-semibold">{room.room_no}</div>
                      <span
                        className={`px-2 py-1 rounded-full text-xxs font-semibold ${
                          statusChip[room.last_recorded_status || room.current_status] ||
                          "bg-gray-100 text-gray-700"
                        }`}
                      >
                        {room.last_recorded_status || room.current_status}
                      </span>
                    </div>
                    <div className="text-xs text-gray-600">
                      Type: {room.room_type_id ? room.room_type_id.slice(0, 6) : "N/A"}
                    </div>
                    {room.next_booking && (
                      <div className="text-xs text-gray-600 mt-1">
                        Next: {room.next_booking.status} ({room.next_booking.check_in} →{" "}
                        {room.next_booking.check_out})
                      </div>
                    )}
                    {!room.next_booking && (
                      <div className="text-xs text-gray-500 mt-1">No upcoming booking</div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Bookings Table */}
          <div className="bg-white rounded-lg shadow-md overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-accent text-white">
                  <tr>
                    <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                      ID / Type
                    </th>
                    <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                      Item/Service
                    </th>
                    <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                      Guest
                    </th>
                    <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                      Total
                    </th>
                    <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                      Date
                    </th>
                    <th className="px-6 py-4 text-left font-tertiary tracking-wider">
                      Status
                    </th>
                    <th className="px-6 py-4 text-center font-tertiary tracking-wider">
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {bookings.length === 0 ? (
                    <tr>
                      <td colSpan="7" className="px-6 py-12 text-center text-gray-500">
                        No bookings found.
                      </td>
                    </tr>
                  ) : (
                    bookings.map((booking) => (
                      <tr key={booking.id} className="hover:bg-gray-50 transition-colors">
                        <td className="px-6 py-4">
                          <div className="flex items-center gap-2">
                            <span className="font-semibold text-sm">
                              {booking.confirmation_code || booking.id.substring(0, 8)}
                            </span>
                            {getTypeBadge(booking.type)}
                          </div>
                        </td>
                        <td className="px-6 py-4 text-sm">
                          {booking.item_name || "-"}
                        </td>
                        <td className="px-6 py-4">
                          <div className="flex items-center gap-2">
                            <FaUser className="text-gray-400" size={14} />
                            <span className="text-sm font-medium">
                              {booking.guestName || "-"}
                            </span>
                          </div>
                        </td>
                        <td className="px-6 py-4 font-semibold text-accent">
                          ${booking.totalPrice?.toFixed(2) || "0.00"}
                        </td>
                        <td className="px-6 py-4 text-sm">
                          {booking.checkIn
                            ? new Date(booking.checkIn).toLocaleDateString()
                            : "-"}
                        </td>
                        <td className="px-6 py-4">
                          {getStatusBadge(booking.status)}
                        </td>
                        <td className="px-6 py-4">
                          <div className="flex items-center justify-center gap-2">
                            <button
                              onClick={() => handleViewDetails(booking)}
                              disabled={updating}
                              className="p-2 text-accent hover:bg-accent/10 rounded transition-colors disabled:opacity-50"
                              title="View Details"
                            >
                              <FaEdit />
                            </button>
                            <button
                              onClick={() => handleStatusChange(booking)}
                              disabled={updating}
                              className="p-2 text-orange-500 hover:bg-orange-50 rounded transition-colors disabled:opacity-50"
                              title="Change Status"
                            >
                              <FaCheck />
                            </button>
                            {booking.type === "room" && booking.status === "confirmed" && (
                              <button
                                onClick={() => handleQuickAction(booking, "checked_in")}
                                disabled={updating}
                                className="p-2 text-blue-600 hover:bg-blue-50 rounded transition-colors disabled:opacity-50"
                                title="Check-in"
                              >
                                Check-in
                              </button>
                            )}
                            {booking.type === "room" && booking.status === "checked_in" && (
                              <button
                                onClick={() => handleQuickAction(booking, "checked_out")}
                                disabled={updating}
                                className="p-2 text-green-600 hover:bg-green-50 rounded transition-colors disabled:opacity-50"
                                title="Check-out"
                              >
                                Check-out
                              </button>
                            )}
                            <button
                              onClick={() => handleDeleteBooking(booking)}
                              disabled={updating}
                              className="p-2 text-red-500 hover:bg-red-50 rounded transition-colors disabled:opacity-50"
                              title="Delete Booking"
                            >
                              <FaBan />
                            </button>
                          </div>
                        </td>
                      </tr>
                    ))
                  )}
                </tbody>
              </table>
            </div>
          </div>
        </>
      )}

      {/* Details Modal */}
      {isModalOpen && selectedBooking && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            {/* Modal Header */}
            <div className="p-6 border-b border-gray-200 sticky top-0 bg-white">
              <div className="flex items-center justify-between">
                <h2 className="h3 text-primary">
                  Booking Details
                  <span className="ml-2 font-mono text-sm text-gray-500">
                    #{selectedBooking.confirmation_code || selectedBooking.id.substring(0, 8)}
                  </span>
                </h2>
                <button
                  onClick={() => setIsModalOpen(false)}
                  className="text-gray-500 hover:text-red-500 transition-colors"
                >
                  <FaTimes size={24} />
                </button>
              </div>
            </div>

            {/* Modal Body */}
            <div className="p-6 space-y-6">
              {/* Basic Info Grid */}
              <div className="grid grid-cols-2 gap-4">
                <DetailItem label="Type" value={getTypeBadge(selectedBooking.type)} isHtml={true} />
                <DetailItem label="Status" value={getStatusBadge(selectedBooking.status)} isHtml={true} />

                {/* Room-Specific Details */}
                {selectedBooking.type === "room" && (
                  <>
                    <DetailItem label="Room" value={selectedBooking.item_name} />
                    <DetailItem
                      label="Check-in"
                      value={selectedBooking.check_in
                        ? new Date(selectedBooking.check_in).toLocaleDateString()
                        : "N/A"}
                    />
                    <DetailItem
                      label="Check-out"
                      value={selectedBooking.check_out
                        ? new Date(selectedBooking.check_out).toLocaleDateString()
                        : "N/A"}
                    />
                    <DetailItem label="Guests" value={`${selectedBooking.num_adults || 0} Adult(s), ${selectedBooking.num_children || 0} Child(ren)`} />
                    <DetailItem label="Total Nights" value={selectedBooking.total_nights || "N/A"} />
                  </>
                )}

                {/* Restaurant-Specific Details */}
                {selectedBooking.type === "restaurant" && (
                  <>
                    <DetailItem label="Party Size" value={`${selectedBooking.guests || 1} guest(s)`} />
                    <DetailItem
                      label="Reservation Time"
                      value={selectedBooking.reservation_at
                        ? new Date(selectedBooking.reservation_at).toLocaleString()
                        : "N/A"}
                    />
                    {selectedBooking.special_requests && (
                      <DetailItem label="Special Requests" value={selectedBooking.special_requests} />
                    )}
                  </>
                )}

                {/* Spa-Specific Details */}
                {selectedBooking.type === "spa" && (
                  <>
                    <DetailItem label="Service" value={selectedBooking.item_name} />
                    <DetailItem
                      label="Appointment"
                      value={selectedBooking.appointment_at
                        ? new Date(selectedBooking.appointment_at).toLocaleString()
                        : "N/A"}
                    />
                    <DetailItem label="Therapist" value={selectedBooking.therapist || "No preference"} />
                    {selectedBooking.special_requests && (
                      <DetailItem label="Special Requests" value={selectedBooking.special_requests} />
                    )}
                  </>
                )}

                {/* Guest Info */}
                <DetailItem label="Guest Name" value={selectedBooking.guestName || "-"} />
                <DetailItem label="Email" value={selectedBooking.guestEmail || selectedBooking.email || "-"} />
                <DetailItem label="Phone" value={selectedBooking.guestPhone || selectedBooking.phone || "-"} />

                {/* Pricing */}
                <DetailItem
                  label="Subtotal"
                  value={`$${(selectedBooking.subtotal || selectedBooking.price || 0).toFixed(2)}`}
                />
                <DetailItem
                  label="Discount"
                  value={`$${(selectedBooking.discount || 0).toFixed(2)}`}
                />
                <DetailItem
                  label="TOTAL AMOUNT"
                  value={`$${selectedBooking.totalPrice?.toFixed(2) || "0.00"}`}
                  isTotal={true}
                />
              </div>

              {/* Notes / Special Requests */}
              {(selectedBooking.note || selectedBooking.special_requests) && (
                <div>
                  <label className="block text-sm font-semibold mb-2 text-primary">
                    Notes / Special Requests
                  </label>
                  <textarea
                    rows="4"
                    readOnly
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 resize-none text-sm"
                    defaultValue={selectedBooking.note || selectedBooking.special_requests || "N/A"}
                  />
                </div>
              )}

              {/* Modal Actions */}
              <div className="flex gap-4 pt-4 border-t border-gray-200">
                <button
                  onClick={() => setIsModalOpen(false)}
                  className="btn btn-primary btn-sm flex-1"
                  disabled={updating}
                >
                  Close
                </button>
                <button
                  onClick={() => handleStatusChange(selectedBooking)}
                  disabled={updating}
                  className="btn btn-accent btn-sm flex-1 flex items-center justify-center gap-2"
                >
                  {updating && <FaSpinner className="animate-spin" />}
                  Change Status
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default BookingsManagement;

--- END FILE: src\components\admin\BookingsManagement_REFACTORED.js ---

--- START FILE: src\components\admin\index.js ---
export { default as RoomTypesManagement } from './RoomTypesManagement';
export { default as RoomsManagement } from './RoomsManagement';
export { default as PriceRulesManagement } from './PriceRulesManagement';
export { default as PromotionsManagement } from './PromotionsManagement';
export { default as BookingsManagement } from './BookingsManagement';
export { default as UsersManagement } from './UsersManagement';
export { default as AuditLogsManagement } from './AuditLogsManagement';
export { default as ReportsManagement } from './ReportsManagement';


--- END FILE: src\components\admin\index.js ---

--- START FILE: src\components\admin\PriceRulesManagement.jsx ---
import { useEffect, useState } from 'react';
import { useCRUD, useModalForm } from '../../hooks';
import { AdminHeader, AdminTable, AdminModal } from '../../features/admin';
import { supabase } from '../../utils/supabaseClient';

const PriceRulesManagement = () => {
  const { data: priceRules, isLoading, error, fetchData, create, update, remove } = useCRUD(
    'price_rules',
    `
      *,
      room_types:room_type_id (code, name)
    `
  );

  const {
    isModalOpen,
    editingItem,
    formData,
    updateFormData,
    openCreateModal,
    openEditModal,
    closeModal,
    resetFormData
  } = useModalForm({
    rule_type: 'weekend',
    room_type_id: '',
    price: '',
    apply_fri: false,
    apply_sat: true,
    apply_sun: true,
    start_date: '',
    end_date: '',
    description: '',
    priority: '10',
    is_active: true
  });

  // Fetch room types for dropdown
  const [roomTypes, setRoomTypes] = useState([]);
  
  useEffect(() => {
    fetchRoomTypes();
  }, []);

  const fetchRoomTypes = async () => {
    try {
      const { supabase } = await import('../../utils/supabaseClient');
      const { data, error } = await supabase
        .from('room_types')
        .select('*')
        .order('code');
      if (error) throw error;
      setRoomTypes(data || []);
    } catch (err) {
      console.error('❌ Error fetching room types:', err);
    }
  };

  // Fetch price rules on mount (only once)
  useEffect(() => {
    fetchData({}, { column: 'priority', ascending: true });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []); // Empty dependency array - only fetch once on mount

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const values = {
        rule_type: formData.rule_type,
        room_type_id: formData.room_type_id || null,
        price: parseFloat(formData.price),
        apply_fri: formData.apply_fri,
        apply_sat: formData.apply_sat,
        apply_sun: formData.apply_sun,
        start_date: formData.start_date || null,
        end_date: formData.end_date || null,
        description: formData.description,
        priority: parseInt(formData.priority),
        is_active: formData.is_active
      };

      if (editingItem) {
        await update(editingItem.id, values, 'Price rule updated successfully');
      } else {
        await create(values, 'Price rule created successfully');
      }

      closeModal();
      resetFormData();
    } catch (err) {
      console.error('❌ Error saving price rule:', err);
    }
  };

  const handleEdit = (rule) => {
    openEditModal(rule);
  };

  const handleDelete = async (id) => {
    try {
      await remove(id, 'Price rule deleted successfully');
    } catch (err) {
      console.error('❌ Error deleting price rule:', err);
    }
  };

  const ruleTypes = [
    { value: 'weekend', label: 'Weekend' },
    { value: 'holiday', label: 'Holiday' },
    { value: 'seasonal', label: 'Seasonal' },
    { value: 'season', label: 'Season' },
  ];

  const columns = [
    {
      key: 'rule_type',
      label: 'Rule Type',
      render: (value) => {
        const type = ruleTypes.find(t => t.value === value);
        return (
          <span className="px-3 py-1 bg-accent/20 text-accent rounded-full text-sm font-semibold">
            {type?.label || value}
          </span>
        );
      }
    },
    {
      key: 'description',
      label: 'Description',
      render: (value) => <span>{value || '-'}</span>
    },
    {
      key: 'price',
      label: 'Price',
      render: (value) => <span className="font-semibold text-accent">${value}</span>
    },
    {
      key: 'start_date',
      label: 'Start Date',
      render: (value) => <span>{value || '-'}</span>
    },
    {
      key: 'end_date',
      label: 'End Date',
      render: (value) => <span>{value || '-'}</span>
    },
    {
      key: 'is_active',
      label: 'Status',
      render: (value) => (
        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
          value 
            ? 'bg-green-100 text-green-800' 
            : 'bg-gray-100 text-gray-800'
        }`}>
          {value ? '✓ Active' : 'Inactive'}
        </span>
      )
    }
  ];

  return (
    <div>
      <AdminHeader
        title="Price Rules Management"
        description="Set weekend, season and holiday prices - automatically apply by schedule"
        onAddNew={openCreateModal}
        addButtonLabel="Add New Price Rule"
      />

      <AdminTable
        columns={columns}
        data={priceRules}
        isLoading={isLoading}
        error={error}
        onEdit={handleEdit}
        onDelete={handleDelete}
        onRetry={() => fetchData({}, { column: 'priority', ascending: true })}
        emptyMessage="No price rules yet. Add your first rule!"
      />

      <AdminModal
        isOpen={isModalOpen}
        title={editingItem ? 'Edit Price Rule' : 'Add New Price Rule'}
        onClose={closeModal}
        onSubmit={handleSubmit}
        isLoading={isLoading}
        submitLabel={editingItem ? 'Update' : 'Add Rule'}
      >
        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Rule Type *</label>
          <select
            required
            value={formData.rule_type}
            onChange={(e) => updateFormData({ rule_type: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
          >
            {ruleTypes.map(type => (
              <option key={type.value} value={type.value}>{type.label}</option>
            ))}
          </select>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Room Type</label>
          <select
            value={formData.room_type_id}
            onChange={(e) => updateFormData({ room_type_id: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
          >
            <option value="">All Room Types</option>
            {roomTypes.map(rt => (
              <option key={rt.id} value={rt.id}>{rt.code} - {rt.name}</option>
            ))}
          </select>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Price (USD) *</label>
          <input
            type="number"
            required
            min="0"
            step="0.01"
            value={formData.price}
            onChange={(e) => updateFormData({ price: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            placeholder="0.00"
          />
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">Start Date</label>
            <input
              type="date"
              value={formData.start_date}
              onChange={(e) => updateFormData({ start_date: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            />
          </div>

          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">End Date</label>
            <input
              type="date"
              value={formData.end_date}
              onChange={(e) => updateFormData({ end_date: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Priority</label>
          <input
            type="number"
            min="1"
            max="100"
            value={formData.priority}
            onChange={(e) => updateFormData({ priority: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            placeholder="10"
          />
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Description</label>
          <textarea
            value={formData.description}
            onChange={(e) => updateFormData({ description: e.target.value })}
            rows="3"
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            placeholder="Description of this price rule..."
          />
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">
            <input
              type="checkbox"
              checked={formData.is_active}
              onChange={(e) => updateFormData({ is_active: e.target.checked })}
              className="mr-2"
            />
            Active
          </label>
        </div>
      </AdminModal>
    </div>
  );
};

export default PriceRulesManagement;

--- END FILE: src\components\admin\PriceRulesManagement.jsx ---

--- START FILE: src\components\admin\PromotionsManagement.jsx ---
import { useEffect } from 'react';
import { FaTag } from 'react-icons/fa';
import { useCRUD, useModalForm } from '../../hooks';
import { AdminHeader, AdminTable, AdminModal } from '../../features/admin';
import { supabase } from '../../utils/supabaseClient';

const PromotionsManagement = () => {
  const { data: promotions, isLoading, error, fetchData, create, update, remove } = useCRUD(
    'promotions',
    '*'
  );

  const {
    isModalOpen,
    editingItem,
    formData,
    updateFormData,
    openCreateModal,
    openEditModal,
    closeModal,
    resetFormData
  } = useModalForm({
    code: '',
    discount_type: 'percentage', // UI field, will map to discount_kind
    discount_value: '',
    start_date: '',
    end_date: '',
    description: '',
    is_active: true
  });

  // Fetch promotions on mount (only once)
  useEffect(() => {
    fetchData({}, { column: 'code', ascending: true });
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []); // Empty dependency array - only fetch once on mount

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const values = {
        code: formData.code,
        name: formData.code, // Add name field required by schema
        discount_kind: formData.discount_type === 'percentage' ? 'percent' : 'fixed', // Map to schema field
        discount_value: parseFloat(formData.discount_value),
        start_date: formData.start_date || null,
        end_date: formData.end_date || null,
        description: formData.description,
        is_active: formData.is_active
      };

      if (editingItem) {
        await update(editingItem.id, values, 'Promotion updated successfully');
      } else {
        await create(values, 'Promotion created successfully');
      }

      closeModal();
      resetFormData();
    } catch (err) {
      console.error('❌ Error saving promotion:', err);
    }
  };

  const handleEdit = (promotion) => {
    // Map discount_kind back to discount_type for UI
    const mappedPromo = {
      ...promotion,
      discount_type: promotion.discount_kind === 'percent' ? 'percentage' : 'fixed'
    };
    openEditModal(mappedPromo);
  };

  const handleDelete = async (id) => {
    try {
      await remove(id, 'Promotion deleted successfully');
    } catch (err) {
      console.error('❌ Error deleting promotion:', err);
    }
  };

  const formatDiscount = (promo) => {
    const discountType = promo.discount_kind || promo.discount_type;
    if (discountType === 'percent' || discountType === 'percentage') {
      return `${promo.discount_value}%`;
    }
    return `$${promo.discount_value}`;
  };

  const discountTypes = [
    { value: 'percentage', label: 'Percentage (%)' },
    { value: 'fixed', label: 'Fixed Amount ($)' }
  ];

  // Table columns configuration
  const columns = [
    {
      key: 'code',
      label: 'Code',
      render: (value) => (
        <span className="inline-flex items-center gap-2 px-3 py-1 bg-accent/20 text-accent rounded-full text-sm font-semibold">
          <FaTag /> {value}
        </span>
      )
    },
    {
      key: 'discount_kind',
      label: 'Discount Type',
      render: (value) => {
        const type = discountTypes.find(t => t.value === (value === 'percent' ? 'percentage' : 'fixed'));
        return <span className="text-sm">{type?.label || value}</span>;
      }
    },
    {
      key: 'discount_value',
      label: 'Value',
      render: (value, row) => <span className="font-semibold text-accent">{formatDiscount({ ...row, discount_type: row.discount_kind === 'percent' ? 'percentage' : 'fixed' })}</span>
    },
    {
      key: 'start_date',
      label: 'Start Date',
      render: (value) => <span>{value || '-'}</span>
    },
    {
      key: 'end_date',
      label: 'End Date',
      render: (value) => <span>{value || '-'}</span>
    },
    {
      key: 'is_active',
      label: 'Status',
      render: (value) => (
        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
          value 
            ? 'bg-green-100 text-green-800' 
            : 'bg-gray-100 text-gray-800'
        }`}>
          {value ? '✓ Active' : 'Inactive'}
        </span>
      )
    }
  ];

  return (
    <div>
      <AdminHeader
        title="Promotions Management"
        description="Create and manage discount codes (code, %, or fixed)"
        onAddNew={openCreateModal}
        addButtonLabel="Add New Promotion"
      />

      <AdminTable
        columns={columns}
        data={promotions}
        isLoading={isLoading}
        error={error}
        onEdit={handleEdit}
        onDelete={handleDelete}
        onRetry={() => fetchData({}, { column: 'code', ascending: true })}
        emptyMessage="No promotions yet. Add your first promotion!"
      />

      <AdminModal
        isOpen={isModalOpen}
        title={editingItem ? 'Edit Promotion' : 'Add New Promotion'}
        onClose={closeModal}
        onSubmit={handleSubmit}
        isLoading={isLoading}
        submitLabel={editingItem ? 'Update' : 'Add Promotion'}
      >
        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Code *</label>
          <input
            type="text"
            required
            value={formData.code}
            onChange={(e) => updateFormData({ code: e.target.value.toUpperCase() })}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent uppercase"
            placeholder="e.g., SUMMER2025"
          />
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Discount Type *</label>
          <select
            required
            value={formData.discount_type}
            onChange={(e) => updateFormData({ discount_type: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
          >
            {discountTypes.map(type => (
              <option key={type.value} value={type.value}>{type.label}</option>
            ))}
          </select>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">
            Discount Value * {formData.discount_type === 'percentage' ? '(%)' : '($)'}
          </label>
          <input
            type="number"
            required
            min="0"
            step={formData.discount_type === 'percentage' ? '1' : '0.01'}
            max={formData.discount_type === 'percentage' ? '100' : undefined}
            value={formData.discount_value}
            onChange={(e) => updateFormData({ discount_value: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            placeholder={formData.discount_type === 'percentage' ? '0-100' : '0.00'}
          />
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">Start Date</label>
            <input
              type="date"
              value={formData.start_date}
              onChange={(e) => updateFormData({ start_date: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            />
          </div>

          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">End Date</label>
            <input
              type="date"
              value={formData.end_date}
              onChange={(e) => updateFormData({ end_date: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Description</label>
          <textarea
            value={formData.description}
            onChange={(e) => updateFormData({ description: e.target.value })}
            rows="3"
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            placeholder="Description of this promotion..."
          />
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">
            <input
              type="checkbox"
              checked={formData.is_active}
              onChange={(e) => updateFormData({ is_active: e.target.checked })}
              className="mr-2"
            />
            Active
          </label>
        </div>
      </AdminModal>
    </div>
  );
};

export default PromotionsManagement;

--- END FILE: src\components\admin\PromotionsManagement.jsx ---

--- START FILE: src\components\admin\ReportsManagement.jsx ---
import { useState, useEffect } from 'react';
import { FaChartLine, FaChartBar, FaDollarSign, FaBed } from 'react-icons/fa';
import { supabase } from '../../utils/supabaseClient';
import { RevenueChart, OccupancyChart } from '../charts';

const ReportsManagement = () => {
  const [dateRange, setDateRange] = useState({
    startDate: new Date(new Date().setMonth(new Date().getMonth() - 1)).toISOString().split('T')[0],
    endDate: new Date().toISOString().split('T')[0]
  });
  const [reportType, setReportType] = useState('revenue');
  const [isLoading, setIsLoading] = useState(false);
  const [revenueData, setRevenueData] = useState({
    daily: [],
    monthly: [],
    total: 0
  });
  const [occupancyData, setOccupancyData] = useState({
    rate: 0,
    occupied: 0,
    total: 0
  });
  const [totalBookings, setTotalBookings] = useState(0);
  const [occupancyHistory, setOccupancyHistory] = useState([]);

  useEffect(() => {
    loadReportData();
  }, [dateRange, reportType]);

  const loadReportData = async () => {
    if (!dateRange.startDate || !dateRange.endDate) return;
    
    setIsLoading(true);
    try {
      // Fetch bookings in date range
      const { data: bookings, error: bookingsError } = await supabase
        .from('bookings')
        .select('total_amount, check_in, check_out, status, created_at')
        .gte('created_at', dateRange.startDate)
        .lte('created_at', dateRange.endDate + 'T23:59:59');

      const { data: restaurantBookings, error: restError } = await supabase
        .from('restaurant_bookings')
        .select('total_price, created_at, status')
        .gte('created_at', dateRange.startDate)
        .lte('created_at', dateRange.endDate + 'T23:59:59');

      const { data: spaBookings, error: spaError } = await supabase
        .from('spa_bookings')
        .select('total_price, created_at, status')
        .gte('created_at', dateRange.startDate)
        .lte('created_at', dateRange.endDate + 'T23:59:59');

      if (bookingsError || restError || spaError) {
        console.error('Error fetching bookings:', bookingsError || restError || spaError);
        return;
      }

      // Calculate total revenue
      const roomRevenue = (bookings || []).reduce((sum, b) => sum + parseFloat(b.total_amount || 0), 0);
      const restRevenue = (restaurantBookings || []).reduce((sum, b) => sum + parseFloat(b.total_price || 0), 0);
      const spaRevenue = (spaBookings || []).reduce((sum, b) => sum + parseFloat(b.total_price || 0), 0);
      const totalRevenue = roomRevenue + restRevenue + spaRevenue;

      // Calculate total bookings
      const total = (bookings?.length || 0) + (restaurantBookings?.length || 0) + (spaBookings?.length || 0);

      // Calculate occupancy (for room bookings only)
      const { data: rooms, error: roomsError } = await supabase
        .from('rooms')
        .select('id, status');
      
      if (!roomsError && rooms) {
        const totalRooms = rooms.length;
        const occupiedRooms = rooms.filter(r => r.status === 'occupied').length;
        const occupancyRate = totalRooms > 0 ? (occupiedRooms / totalRooms) * 100 : 0;
        
        setOccupancyData({
          rate: occupancyRate,
          occupied: occupiedRooms,
          total: totalRooms
        });

        // Calculate occupancy history by date
        const occupancyMap = new Map();
        const startDate = new Date(dateRange.startDate);
        const endDate = new Date(dateRange.endDate);
        
        // Initialize all dates in range
        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
          const dateStr = d.toISOString().split('T')[0];
          occupancyMap.set(dateStr, { date: dateStr, occupied: 0, total: totalRooms, rate: 0 });
        }

        // Calculate occupancy for each date based on bookings
        (bookings || []).forEach(booking => {
          if (booking.status === 'confirmed' || booking.status === 'checked_in') {
            const checkIn = new Date(booking.check_in);
            const checkOut = new Date(booking.check_out);
            
            for (let d = new Date(checkIn); d < checkOut; d.setDate(d.getDate() + 1)) {
              const dateStr = d.toISOString().split('T')[0];
              if (occupancyMap.has(dateStr)) {
                const dayData = occupancyMap.get(dateStr);
                dayData.occupied += 1;
                dayData.rate = totalRooms > 0 ? (dayData.occupied / totalRooms) * 100 : 0;
              }
            }
          }
        });

        const history = Array.from(occupancyMap.values())
          .map(item => ({
            date: item.date,
            rate: item.rate
          }))
          .sort((a, b) => new Date(a.date) - new Date(b.date));

        setOccupancyHistory(history);
      }

      // Group revenue by date
      const dailyMap = new Map();
      [...(bookings || []), ...(restaurantBookings || []), ...(spaBookings || [])].forEach(booking => {
        const date = new Date(booking.created_at).toISOString().split('T')[0];
        const amount = parseFloat(booking.total_amount || booking.total_price || 0);
        dailyMap.set(date, (dailyMap.get(date) || 0) + amount);
      });

      const daily = Array.from(dailyMap.entries())
        .map(([date, revenue]) => ({ date, revenue }))
        .sort((a, b) => new Date(a.date) - new Date(b.date));

      setRevenueData({
        daily,
        monthly: [], // Can be calculated from daily if needed
        total: totalRevenue
      });

      setTotalBookings(total);
    } catch (err) {
      console.error('Error loading report data:', err);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <h1 className="h2 text-primary mb-2">Reports & Statistics</h1>
        <p className="text-gray-600">Revenue, occupancy rate and statistics charts</p>
      </div>

      {/* Filters */}
      <div className="bg-white rounded-lg shadow-md p-6 mb-6">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">Report Type</label>
            <select
              value={reportType}
              onChange={(e) => setReportType(e.target.value)}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            >
              <option value="revenue">Revenue</option>
              <option value="occupancy">Occupancy Rate</option>
            </select>
          </div>

          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">From Date</label>
            <input
              type="date"
              value={dateRange.startDate}
              onChange={(e) => setDateRange({ ...dateRange, startDate: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            />
          </div>

          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">To Date</label>
            <input
              type="date"
              value={dateRange.endDate}
              onChange={(e) => setDateRange({ ...dateRange, endDate: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            />
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-semibold text-primary">Total Revenue</h3>
            <FaDollarSign className="text-3xl text-accent" />
          </div>
          <p className="text-3xl font-bold text-accent">
            {isLoading ? '...' : `$${revenueData.total.toLocaleString()}`}
          </p>
          <p className="text-sm text-gray-500 mt-2">In selected time period</p>
        </div>

        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-semibold text-primary">Occupancy Rate</h3>
            <FaBed className="text-3xl text-accent" />
          </div>
          <p className="text-3xl font-bold text-accent">
            {isLoading ? '...' : `${occupancyData.rate.toFixed(1)}%`}
          </p>
          <p className="text-sm text-gray-500 mt-2">
            {occupancyData.occupied} / {occupancyData.total} rooms
          </p>
        </div>

        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-semibold text-primary">Total Bookings</h3>
            <FaChartBar className="text-3xl text-accent" />
          </div>
          <p className="text-3xl font-bold text-accent">
            {isLoading ? '...' : totalBookings}
          </p>
          <p className="text-sm text-gray-500 mt-2">Number of bookings</p>
        </div>
      </div>

      {/* Charts */}
      <div className="bg-white rounded-lg shadow-md p-6">
        <div className="mb-6">
          <h2 className="h3 text-primary">
            {reportType === 'revenue' ? 'Revenue Chart' : 'Occupancy Rate Chart'}
          </h2>
        </div>

        <div className="border border-gray-200 rounded-lg p-4">
          {reportType === 'revenue' ? (
            <RevenueChart data={revenueData.daily} type="line" />
          ) : (
            <OccupancyChart data={occupancyHistory} type="line" />
          )}
        </div>
      </div>

      {/* Revenue Table */}
      {reportType === 'revenue' && (
        <div className="bg-white rounded-lg shadow-md overflow-hidden mt-6">
          <div className="p-6 border-b border-gray-200">
            <h3 className="h3 text-primary">Revenue Details</h3>
          </div>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-accent text-white">
                <tr>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Date</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Revenue</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Bookings</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {isLoading ? (
                  <tr>
                    <td colSpan="3" className="px-6 py-12 text-center text-gray-500">
                      Loading...
                    </td>
                  </tr>
                ) : revenueData.daily.length === 0 ? (
                  <tr>
                    <td colSpan="3" className="px-6 py-12 text-center text-gray-500">
                      No data available for selected time period.
                    </td>
                  </tr>
                ) : (
                  revenueData.daily.map((day, idx) => (
                    <tr key={idx} className="hover:bg-gray-50">
                      <td className="px-6 py-4">{new Date(day.date).toLocaleDateString()}</td>
                      <td className="px-6 py-4 font-semibold">${day.revenue.toFixed(2)}</td>
                      <td className="px-6 py-4">-</td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
        </div>
      )}
    </div>
  );
};

export default ReportsManagement;

--- END FILE: src\components\admin\ReportsManagement.jsx ---

--- START FILE: src\components\admin\RoomsManagement.jsx ---
import { useState, useEffect } from 'react';
import { FaEdit, FaTrash, FaPlus, FaCheck, FaTimes } from 'react-icons/fa';
import { fetchRoomTypes } from '../../services/roomService';
import { fetchRoomsForAdmin, createRoomAdmin, updateRoomAdmin, deleteRoomAdmin } from '../../services/adminService';

const RoomsManagement = () => {
  const [rooms, setRooms] = useState([]);
  const [roomTypes, setRoomTypes] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingRoom, setEditingRoom] = useState(null);
  const [validationErrors, setValidationErrors] = useState({});
  const [formData, setFormData] = useState({
    room_no: '',
    name: '',
    room_type_id: '',
    floor: '',
    size: '',
    price: '',
    description: '',
    status: 'available'
  });

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const [roomsData, roomTypesData] = await Promise.all([
        fetchRoomsForAdmin(),
        fetchRoomTypes()
      ]);
      setRooms(roomsData);
      setRoomTypes(roomTypesData);
    } catch (err) {
      console.error('Error loading data:', err);
      setError('Failed to load rooms and room types');
    } finally {
      setIsLoading(false);
    }
  };

  const validateForm = () => {
    const errors = {};
    if (!formData.room_no.trim()) errors.room_no = 'Room number is required';
    if (!formData.name.trim()) errors.name = 'Room name is required';
    if (!formData.room_type_id) errors.room_type_id = 'Room type is required';
    if (!formData.price || parseFloat(formData.price) < 0) errors.price = 'Valid price is required';
    if (formData.floor && isNaN(parseInt(formData.floor))) errors.floor = 'Floor must be a number';
    if (formData.size && isNaN(parseInt(formData.size))) errors.size = 'Size must be a number';
    setValidationErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleEdit = (room) => {
    setEditingRoom(room);
    setFormData({
      room_no: room.room_no || '',
      name: room.name || '',
      room_type_id: room.room_type_id || '',
      floor: room.floor || '',
      size: room.size || '',
      price: room.price || '',
      description: room.description || '',
      status: room.status || 'available'
    });
    setIsModalOpen(true);
    setValidationErrors({});
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validateForm()) return;

    setIsSaving(true);
    setError(null);
    try {
      const roomPayload = {
        room_no: formData.room_no.trim(),
        name: formData.name.trim(),
        room_type_id: formData.room_type_id,
        floor: formData.floor ? parseInt(formData.floor) : null,
        size: formData.size ? parseInt(formData.size) : null,
        price: parseFloat(formData.price),
        description: formData.description.trim(),
        status: formData.status,
      };

      if (editingRoom) {
        await updateRoomAdmin(editingRoom.id, roomPayload);
        setSuccess(`Room ${formData.room_no} updated successfully`);
      } else {
        await createRoomAdmin(roomPayload);
        setSuccess(`Room ${formData.room_no} created successfully`);
      }

      await loadData();
      closeModal();
      setTimeout(() => setSuccess(null), 3000);
    } catch (err) {
      console.error('Error saving room:', err);
      setError(err.message || 'Failed to save room');
    } finally {
      setIsSaving(false);
    }
  };

  const handleDelete = async (roomId, roomNo) => {
    if (!window.confirm(`Are you sure you want to delete room ${roomNo}?`)) return;
    
    setIsLoading(true);
    setError(null);
    try {
      await deleteRoomAdmin(roomId);
      setSuccess(`Room ${roomNo} deleted successfully`);
      await loadData();
      setTimeout(() => setSuccess(null), 3000);
    } catch (err) {
      console.error('Error deleting room:', err);
      setError(err.message || 'Failed to delete room');
    } finally {
      setIsLoading(false);
    }
  };

  const closeModal = () => {
    setIsModalOpen(false);
    setEditingRoom(null);
    setFormData({
      room_no: '',
      name: '',
      room_type_id: '',
      floor: '',
      size: '',
      price: '',
      description: '',
      status: 'available'
    });
    setValidationErrors({});
  };

  const statusOptions = [
    { value: 'available', label: 'Available', color: 'bg-green-100 text-green-800' },
    { value: 'occupied', label: 'Occupied', color: 'bg-red-100 text-red-800' },
    { value: 'maintenance', label: 'Maintenance', color: 'bg-yellow-100 text-yellow-800' },
    { value: 'cleaning', label: 'Cleaning', color: 'bg-blue-100 text-blue-800' }
  ];

  const getStatusBadge = (status) => {
    const option = statusOptions.find(opt => opt.value === status);
    return (
      <span className={`px-3 py-1 rounded-full text-xs font-semibold ${option?.color || 'bg-gray-100 text-gray-800'}`}>
        {option?.label || status}
      </span>
    );
  };

  return (
    <div>
      <div className="mb-8">
        <h1 className="h2 text-primary mb-2">Rooms Management</h1>
        <p className="text-gray-600">Manage hotel rooms, pricing and availability</p>
      </div>

      {error && (
        <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700">
          ❌ {error}
        </div>
      )}

      {success && (
        <div className="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700">
          ✅ {success}
        </div>
      )}

      <div className="flex justify-end mb-6">
        <button
          onClick={() => setIsModalOpen(true)}
          className="btn btn-primary flex items-center gap-2 disabled:opacity-50"
          disabled={isLoading}
        >
          <FaPlus /> Add New Room
        </button>
      </div>

      {isLoading && !error ? (
        <div className="text-center py-12 text-gray-500">Loading rooms...</div>
      ) : (
        <div className="bg-white rounded-lg shadow-md overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-accent text-white">
                <tr>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Room No</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Name</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Type</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Floor</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Size</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Price</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Status</th>
                  <th className="px-6 py-4 text-center font-tertiary tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {rooms.length === 0 ? (
                  <tr>
                    <td colSpan="8" className="px-6 py-12 text-center text-gray-500">
                      No rooms added yet.
                    </td>
                  </tr>
                ) : (
                  rooms.map((room) => (
                    <tr key={room.id} className="hover:bg-gray-50">
                      <td className="px-6 py-4 font-mono font-semibold">{room.room_no}</td>
                      <td className="px-6 py-4">{room.name}</td>
                      <td className="px-6 py-4">{room.room_types?.name || '-'}</td>
                      <td className="px-6 py-4">{room.floor || '-'}</td>
                      <td className="px-6 py-4">{room.size ? `${room.size}m²` : '-'}</td>
                      <td className="px-6 py-4 font-semibold">${parseFloat(room.price).toFixed(2) || '0.00'}</td>
                      <td className="px-6 py-4">{getStatusBadge(room.status)}</td>
                      <td className="px-6 py-4">
                        <div className="flex items-center justify-center gap-2">
                          <button
                            onClick={() => handleEdit(room)}
                            className="p-2 text-accent hover:bg-accent/10 rounded transition-colors disabled:opacity-50"
                            title="Edit"
                            disabled={isSaving}
                          >
                            <FaEdit />
                          </button>
                          <button
                            onClick={() => handleDelete(room.id, room.room_no)}
                            className="p-2 text-red-500 hover:bg-red-50 rounded transition-colors disabled:opacity-50"
                            title="Delete"
                            disabled={isSaving}
                          >
                            <FaTrash />
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {isModalOpen && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div className="p-6 border-b border-gray-200">
              <h2 className="h3 text-primary">
                {editingRoom ? 'Edit Room' : 'Add New Room'}
              </h2>
            </div>

            <form onSubmit={handleSubmit} className="p-6 space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-semibold mb-2 text-primary">
                    Room Number *
                  </label>
                  <input
                    type="text"
                    required
                    value={formData.room_no}
                    onChange={(e) => setFormData({ ...formData, room_no: e.target.value })}
                    className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent ${
                      validationErrors.room_no ? 'border-red-500' : 'border-gray-300'
                    }`}
                    placeholder="e.g., STD-01"
                    disabled={isSaving}
                  />
                  {validationErrors.room_no && (
                    <p className="text-red-500 text-xs mt-1">{validationErrors.room_no}</p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-semibold mb-2 text-primary">
                    Room Name *
                  </label>
                  <input
                    type="text"
                    required
                    value={formData.name}
                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                    className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent ${
                      validationErrors.name ? 'border-red-500' : 'border-gray-300'
                    }`}
                    placeholder="e.g., Standard Room"
                    disabled={isSaving}
                  />
                  {validationErrors.name && (
                    <p className="text-red-500 text-xs mt-1">{validationErrors.name}</p>
                  )}
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-semibold mb-2 text-primary">
                    Room Type *
                  </label>
                  <select
                    required
                    value={formData.room_type_id}
                    onChange={(e) => setFormData({ ...formData, room_type_id: e.target.value })}
                    className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent ${
                      validationErrors.room_type_id ? 'border-red-500' : 'border-gray-300'
                    }`}
                    disabled={isSaving}
                  >
                    <option value="">Select room type</option>
                    {roomTypes.map(rt => (
                      <option key={rt.id} value={rt.id}>{rt.code} - {rt.name}</option>
                    ))}
                  </select>
                  {validationErrors.room_type_id && (
                    <p className="text-red-500 text-xs mt-1">{validationErrors.room_type_id}</p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-semibold mb-2 text-primary">
                    Status *
                  </label>
                  <select
                    required
                    value={formData.status}
                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
                    disabled={isSaving}
                  >
                    {statusOptions.map(option => (
                      <option key={option.value} value={option.value}>{option.label}</option>
                    ))}
                  </select>
                </div>
              </div>

              <div className="grid grid-cols-3 gap-4">
                <div>
                  <label className="block text-sm font-semibold mb-2 text-primary">Floor</label>
                  <input
                    type="number"
                    min="1"
                    value={formData.floor}
                    onChange={(e) => setFormData({ ...formData, floor: e.target.value })}
                    className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent ${
                      validationErrors.floor ? 'border-red-500' : 'border-gray-300'
                    }`}
                    disabled={isSaving}
                  />
                  {validationErrors.floor && (
                    <p className="text-red-500 text-xs mt-1">{validationErrors.floor}</p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-semibold mb-2 text-primary">Size (m²)</label>
                  <input
                    type="number"
                    min="0"
                    value={formData.size}
                    onChange={(e) => setFormData({ ...formData, size: e.target.value })}
                    className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent ${
                      validationErrors.size ? 'border-red-500' : 'border-gray-300'
                    }`}
                    disabled={isSaving}
                  />
                  {validationErrors.size && (
                    <p className="text-red-500 text-xs mt-1">{validationErrors.size}</p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-semibold mb-2 text-primary">
                    Price (USD) *
                  </label>
                  <input
                    type="number"
                    min="0"
                    step="0.01"
                    value={formData.price}
                    onChange={(e) => setFormData({ ...formData, price: e.target.value })}
                    className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent ${
                      validationErrors.price ? 'border-red-500' : 'border-gray-300'
                    }`}
                    disabled={isSaving}
                  />
                  {validationErrors.price && (
                    <p className="text-red-500 text-xs mt-1">{validationErrors.price}</p>
                  )}
                </div>
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">Description</label>
                <textarea
                  value={formData.description}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  rows="3"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
                  placeholder="Room description..."
                  disabled={isSaving}
                />
              </div>

              <div className="flex gap-4 pt-4 border-t border-gray-200">
                <button
                  type="submit"
                  disabled={isSaving}
                  className="btn btn-primary btn-sm flex-1 flex items-center justify-center gap-2 disabled:opacity-50"
                >
                  <FaCheck /> {isSaving ? 'Saving...' : (editingRoom ? 'Update' : 'Add New')}
                </button>
                <button
                  type="button"
                  onClick={closeModal}
                  disabled={isSaving}
                  className="btn btn-secondary btn-sm flex-1 flex items-center justify-center gap-2 disabled:opacity-50"
                >
                  <FaTimes /> Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

export default RoomsManagement;
--- END FILE: src\components\admin\RoomsManagement.jsx ---

--- START FILE: src\components\admin\RoomTypesManagement.jsx ---
import { useState, useEffect } from 'react';
import { FaCheck } from 'react-icons/fa';
import { AdminHeader, AdminTable, AdminModal } from '../../features/admin';
import {
  fetchRoomTypesForAdmin,
  createRoomType,
  updateRoomTypeAdmin,
  deleteRoomTypeAdmin,
} from '../../services/adminService';
import { supabase } from '../../utils/supabaseClient';

const RoomTypesManagement = () => {
  const [roomTypes, setRoomTypes] = useState([]);
  const [amenities, setAmenities] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingItem, setEditingItem] = useState(null);
  const [formData, setFormData] = useState({
    code: '',
    name: '',
    description: '',
    base_capacity: '',
    max_person: '',
    base_price: '',
    facilities: [],
    is_active: true
  });

  // Fetch room types and amenities
  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const [roomTypesData, amenitiesData] = await Promise.all([
        fetchRoomTypesForAdmin(),
        supabase.from('amenities').select('name').order('name')
      ]);
      
      setRoomTypes(roomTypesData);
      setAmenities(amenitiesData.data?.map(item => item.name) || []);
    } catch (err) {
      console.error('Error loading data:', err);
      setError('Failed to load data');
    } finally {
      setIsLoading(false);
    }
  };

  const updateFormData = (updates) => {
    setFormData(prev => ({ ...prev, ...updates }));
  };

  const resetFormData = () => {
    setFormData({
      code: '',
      name: '',
      description: '',
      base_capacity: '',
      max_person: '',
      base_price: '',
      facilities: [],
      is_active: true
    });
  };

  const openCreateModal = () => {
    setEditingItem(null);
    resetFormData();
    setIsModalOpen(true);
  };

  const openEditModal = (roomType) => {
    setEditingItem(roomType);
    setFormData({
      code: roomType.code,
      name: roomType.name,
      description: roomType.description || '',
      base_capacity: roomType.base_capacity || '',
      max_person: roomType.max_person || '',
      base_price: roomType.base_price || '',
      facilities: roomType.facilities || [],
      is_active: roomType.is_active
    });
    setIsModalOpen(true);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    setEditingItem(null);
    resetFormData();
  };

  const toggleFacility = (facilityName) => {
    updateFormData({
      facilities: formData.facilities.includes(facilityName)
        ? formData.facilities.filter(name => name !== facilityName)
        : [...formData.facilities, facilityName],
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);
    setError(null);
    try {
      const values = {
        code: formData.code.trim(),
        name: formData.name.trim(),
        description: formData.description.trim(),
        base_capacity: parseInt(formData.base_capacity) || 1,
        max_person: parseInt(formData.max_person) || 2,
        base_price: parseFloat(formData.base_price) || 0,
        facilities: formData.facilities,
        is_active: formData.is_active
      };

      if (editingItem) {
        await updateRoomTypeAdmin(editingItem.id, values);
      } else {
        await createRoomType(values);
      }

      await loadData();
      closeModal();
    } catch (err) {
      console.error('❌ Error saving room type:', err);
      setError(err.message || 'Failed to save room type');
    } finally {
      setIsLoading(false);
    }
  };

  const handleEdit = (roomType) => {
    openEditModal(roomType);
  };

  const handleDelete = async (id) => {
    if (!window.confirm('Are you sure you want to delete this room type?')) return;
    
    setIsLoading(true);
    setError(null);
    try {
      await deleteRoomTypeAdmin(id);
      await loadData();
    } catch (err) {
      console.error('❌ Error deleting room type:', err);
      setError(err.message || 'Failed to delete room type');
    } finally {
      setIsLoading(false);
    }
  };

  const columns = [
    {
      key: 'code',
      label: 'Code',
      render: (value) => <span className="font-mono font-semibold text-accent">{value}</span>
    },
    {
      key: 'name',
      label: 'Name',
      render: (value) => <span className="font-semibold">{value}</span>
    },
    {
      key: 'description',
      label: 'Description',
      render: (value) => <span className="text-sm text-gray-600">{value || '-'}</span>
    },
    {
      key: 'max_person',
      label: 'Max Guests',
      render: (value) => <span>{value}</span>
    },
    {
      key: 'base_price',
      label: 'Price',
      render: (value) => <span className="font-semibold text-accent">${value}</span>
    },
    {
      key: 'facilities',
      label: 'Amenities',
      render: (value) => <span className="text-sm text-gray-600">{value?.length || 0} amenities</span>
    },
    {
      key: 'is_active',
      label: 'Status',
      render: (value) => (
        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
          value 
            ? 'bg-green-100 text-green-800' 
            : 'bg-gray-100 text-gray-800'
        }`}>
          {value ? '✓ Active' : 'Inactive'}
        </span>
      )
    }
  ];

  return (
    <div>
      <AdminHeader
        title="Room Types Management"
        description="Add, edit, delete and manage room types"
        onAddNew={openCreateModal}
        addButtonLabel="Add New Room Type"
      />

      <AdminTable
        columns={columns}
        data={roomTypes}
        isLoading={isLoading}
        error={error}
        onEdit={handleEdit}
        onDelete={handleDelete}
        onRetry={loadData}
        emptyMessage="No room types yet. Add your first room type!"
      />

      <AdminModal
        isOpen={isModalOpen}
        title={editingItem ? 'Edit Room Type' : 'Add New Room Type'}
        onClose={closeModal}
        onSubmit={handleSubmit}
        isLoading={isLoading}
        submitLabel={editingItem ? 'Update' : 'Add New'}
      >
        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">Code *</label>
            <input
              type="text"
              required
              value={formData.code}
              onChange={(e) => updateFormData({ code: e.target.value.toUpperCase() })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
              placeholder="e.g., STD, DLX, SUI"
              maxLength="10"
            />
          </div>

          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">Room Type Name *</label>
            <input
              type="text"
              required
              value={formData.name}
              onChange={(e) => updateFormData({ name: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
              placeholder="e.g., Deluxe Room"
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Description</label>
          <textarea
            value={formData.description}
            onChange={(e) => updateFormData({ description: e.target.value })}
            rows="3"
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            placeholder="Description about the room type..."
          />
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">Base Capacity *</label>
            <input
              type="number"
              required
              min="1"
              value={formData.base_capacity}
              onChange={(e) => updateFormData({ base_capacity: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            />
          </div>

          <div>
            <label className="block text-sm font-semibold mb-2 text-primary">Max Guests *</label>
            <input
              type="number"
              required
              min="1"
              value={formData.max_person}
              onChange={(e) => updateFormData({ max_person: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">Base Price (USD) *</label>
          <input
            type="number"
            required
            min="0"
            step="0.01"
            value={formData.base_price}
            onChange={(e) => updateFormData({ base_price: e.target.value })}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
          />
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">
            Facilities / Amenities ({formData.facilities.length} selected)
          </label>
          <div className="flex flex-wrap gap-2 max-h-48 overflow-y-auto border border-gray-300 rounded-lg p-4">
            {amenities.map((facility) => (
              <button
                key={facility}
                type="button"
                onClick={() => toggleFacility(facility)}
                className={`px-3 py-1 text-xs font-medium rounded-full transition-colors border ${
                  formData.facilities.includes(facility)
                    ? 'bg-accent text-white border-accent'
                    : 'bg-gray-100 text-primary border-gray-300 hover:bg-gray-200'
                }`}
              >
                {formData.facilities.includes(facility) ? <FaCheck className="inline mr-1" /> : ''}
                {facility}
              </button>
            ))}
            {amenities.length === 0 && <p className="text-sm text-gray-500">No amenities defined. Please add them in Amenities Management.</p>}
          </div>
        </div>

        <div>
          <label className="block text-sm font-semibold mb-2 text-primary">
            <input
              type="checkbox"
              checked={formData.is_active}
              onChange={(e) => updateFormData({ is_active: e.target.checked })}
              className="mr-2"
            />
            Active
          </label>
        </div>
      </AdminModal>
    </div>
  );
};

export default RoomTypesManagement;
--- END FILE: src\components\admin\RoomTypesManagement.jsx ---

--- START FILE: src\components\admin\UsersManagement.jsx ---
import { useState, useEffect } from 'react';
import { FaEdit, FaTrash, FaUser, FaEnvelope, FaLock, FaCheck, FaTimes, FaBriefcase } from 'react-icons/fa';
import { AdminTable } from '../../features/admin';
import { fetchUsersForAdmin, updateUserAdmin, deleteUserProfileAdmin } from '../../services/adminService';

const UsersManagement = () => {
  const [users, setUsers] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingUser, setEditingUser] = useState(null);
  const [isUpdating, setIsUpdating] = useState(false);
  
  const [formData, setFormData] = useState({
    full_name: '',
    role: ''
  });

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const usersData = await fetchUsersForAdmin();
      setUsers(usersData);
    } catch (err) {
      console.error('Error loading users:', err);
      setError('Failed to load users');
    } finally {
      setIsLoading(false);
    }
  };

  const handleEdit = (user) => {
    if (!user.id) {
      setError('Cannot edit user without a valid ID.');
      return;
    }
    setEditingUser(user);
    setFormData({
      full_name: user.full_name || '',
      role: user.role || 'user'
    });
    setIsModalOpen(true);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!editingUser) return;
    
    setIsUpdating(true);
    setError(null);
    
    try {
      const valuesToUpdate = {
        full_name: formData.full_name.trim(),
        role: formData.role
      };
      
      await updateUserAdmin(editingUser.id, valuesToUpdate);
      setSuccess(`User ${formData.full_name} updated successfully`);
      await loadData();
      closeModal();
      setTimeout(() => setSuccess(null), 3000);
    } catch (err) {
      console.error('Failed to save changes:', err);
      setError(err.message || 'Failed to update user');
    } finally {
      setIsUpdating(false);
    }
  };

  const handleDelete = async (userId) => {
    if (window.confirm('Are you sure you want to delete this user account? This action cannot be undone.')) {
      setIsLoading(true);
      setError(null);
      try {
        await deleteUserProfileAdmin(userId);
        setSuccess('User deleted successfully');
        await loadData();
        setTimeout(() => setSuccess(null), 3000);
      } catch (err) {
        console.error('Failed to delete user:', err);
        setError(err.message || 'Failed to delete user');
      } finally {
        setIsLoading(false);
      }
    }
  };
  
  const closeModal = () => {
    setIsModalOpen(false);
    setEditingUser(null);
    setFormData({ full_name: '', role: '' });
  };
  
  const getRoleBadge = (role) => {
    let colorClass = 'bg-gray-100 text-gray-800';
    if (role === 'admin') {
      colorClass = 'bg-red-100 text-red-800';
    } else if (role === 'user') {
      colorClass = 'bg-blue-100 text-blue-800';
    }

    return (
      <span className={`px-2 py-1 ${colorClass} rounded-full text-xs font-semibold`}>
        {role?.toUpperCase() || 'N/A'}
      </span>
    );
  };

  return (
    <div>
      <div className="mb-8">
        <h1 className="h2 text-primary mb-2">Users Management</h1>
        <p className="text-gray-600">Manage user accounts - View and edit user information</p>
      </div>

      {error && (
        <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700">
          ❌ {error}
        </div>
      )}

      {success && (
        <div className="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700">
          ✅ {success}
        </div>
      )}
      
      {/* Stats Cards - Simplified */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-semibold text-primary">Total Profiles</h3>
            <FaUser className="text-3xl text-accent" />
          </div>
          <p className="text-3xl font-bold text-accent">{users.length}</p>
          <p className="text-sm text-gray-500 mt-2">Total user profiles</p>
        </div>
        
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-semibold text-primary">Admins</h3>
            <FaBriefcase className="text-3xl text-red-500" />
          </div>
          <p className="text-3xl font-bold text-accent">
            {users.filter(u => u.role === 'admin').length}
          </p>
          <p className="text-sm text-gray-500 mt-2">Users with admin role</p>
        </div>
        
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-semibold text-primary">Standard Users</h3>
            <FaUser className="text-3xl text-blue-500" />
          </div>
          <p className="text-3xl font-bold text-accent">
            {users.filter(u => u.role === 'user').length}
          </p>
          <p className="text-sm text-gray-500 mt-2">Standard authenticated users</p>
        </div>
      </div>

      {/* Users Table */}
      <div className="bg-white rounded-lg shadow-md overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-accent text-white">
              <tr>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">Name</th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">Email</th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">Role</th>
                <th className="px-6 py-4 text-left font-tertiary tracking-wider">Created At</th>
                <th className="px-6 py-4 text-center font-tertiary tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {users.length === 0 && !isLoading ? (
                <tr>
                  <td colSpan="5" className="px-6 py-12 text-center text-gray-500">
                    No users found
                  </td>
                </tr>
              ) : (
                users.map((user) => (
                  <tr key={user.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4 font-semibold">{user.full_name || '-'}</td>
                    <td className="px-6 py-4">{user.email || '-'}</td>
                    <td className="px-6 py-4">
                      {getRoleBadge(user.role)}
                    </td>
                    <td className="px-6 py-4 text-sm text-gray-600">
                      {user.created_at
                        ? new Date(user.created_at).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric'
                          })
                        : '-'
                      }
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center justify-center gap-2">
                        <button
                          onClick={() => handleEdit(user)}
                          className="p-2 text-accent hover:bg-accent/10 rounded transition-colors disabled:opacity-50"
                          title="Edit"
                          disabled={isUpdating}
                        >
                          <FaEdit />
                        </button>
                        <button
                          onClick={() => handleDelete(user.id)}
                          className="p-2 text-red-500 hover:bg-red-50 rounded transition-colors disabled:opacity-50"
                          title="Delete"
                          disabled={isUpdating}
                        >
                          <FaTrash />
                        </button>
                      </div>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Edit Modal */}
      {isModalOpen && editingUser && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div className="p-6 border-b border-gray-200">
              <h2 className="h3 text-primary">Edit User Profile</h2>
            </div>
            
            <form onSubmit={handleSubmit} className="p-6 space-y-4">
              
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">Full Name *</label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <FaUser className="text-gray-400" />
                  </div>
                  <input
                    type="text"
                    required
                    value={formData.full_name}
                    onChange={(e) => setFormData({ ...formData, full_name: e.target.value })}
                    className="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent"
                    placeholder="User full name"
                    disabled={isUpdating}
                  />
                </div>
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">Role *</label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <FaBriefcase className="text-gray-400" />
                  </div>
                  <select
                    required
                    value={formData.role}
                    onChange={(e) => setFormData({ ...formData, role: e.target.value })}
                    className="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent appearance-none"
                    disabled={isUpdating}
                  >
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                  </select>
                </div>
              </div>
              
              <div className="flex gap-4 pt-4 border-t border-gray-200">
                <button
                  type="submit"
                  className="btn btn-primary btn-sm flex-1 flex items-center justify-center gap-2 disabled:opacity-50"
                  disabled={isUpdating}
                >
                  {isUpdating ? 'Saving...' : <><FaCheck /> Save Changes</>}
                </button>
                <button
                  type="button"
                  onClick={closeModal}
                  className="btn btn-secondary btn-sm flex-1 flex items-center justify-center gap-2 disabled:opacity-50"
                  disabled={isUpdating}
                >
                  <FaTimes /> Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

export default UsersManagement;


--- END FILE: src\components\admin\UsersManagement.jsx ---

--- START FILE: src\components\admin\UsersManagement_REFACTORED.js ---
import { useState, useEffect } from 'react';
import {
  FaEdit,
  FaTrash,
  FaUser,
  FaEnvelope,
  FaSpinner,
  FaCheck,
  FaTimes,
  FaBriefcase,
  FaExclamationCircle,
} from 'react-icons/fa';
import { fetchAllUsers, updateUser, deleteUser, fetchUserById } from '../../services/adminService';

/**
 * ============================================================================
 * USERS MANAGEMENT - REFACTORED
 * ============================================================================
 * 
 * Displays all user profiles from the database and allows admin to:
 * - View user details
 * - Edit user information (full_name, role)
 * - Delete user accounts
 * 
 * Uses adminService for all data operations
 * ============================================================================
 */

const UsersManagement = () => {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingUser, setEditingUser] = useState(null);
  const [isUpdating, setIsUpdating] = useState(false);

  const [formData, setFormData] = useState({
    full_name: '',
    role: '',
  });

  /**
   * Load all users from service
   */
  const loadUsers = async () => {
    setLoading(true);
    setError(null);
    try {
      const data = await fetchAllUsers();
      setUsers(data);
      console.log(`✅ Loaded ${data.length} users`);
    } catch (err) {
      console.error('❌ Error loading users:', err);
      setError('Failed to load users. Please try again.');
    } finally {
      setLoading(false);
    }
  };

  /**
   * Initial load on mount
   */
  useEffect(() => {
    loadUsers();
  }, []);

  /**
   * Open edit modal for user
   */
  const handleEdit = async (user) => {
    if (!user.id) {
      setError('Cannot edit user without a valid ID.');
      return;
    }
    
    // Fetch full user data
    const fullUser = await fetchUserById(user.id);
    if (!fullUser) {
      setError('Failed to load user details');
      return;
    }

    setEditingUser(fullUser);
    setFormData({
      full_name: fullUser.full_name || '',
      role: fullUser.role || 'user',
    });
    setIsModalOpen(true);
  };

  /**
   * Handle form input change
   */
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({
      ...prev,
      [name]: value,
    }));
  };

  /**
   * Submit user update
   */
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!editingUser?.id) return;

    setIsUpdating(true);
    try {
      const updated = await updateUser(editingUser.id, {
        full_name: formData.full_name,
        role: formData.role,
      });

      if (updated) {
        // Update local state
        setUsers((prev) =>
          prev.map((u) =>
            u.id === editingUser.id
              ? { ...u, full_name: formData.full_name, role: formData.role }
              : u
          )
        );
        closeModal();
        console.log('✅ User updated successfully');
      } else {
        setError('Failed to update user');
      }
    } catch (err) {
      console.error('❌ Error updating user:', err);
      setError('Error updating user. Please try again.');
    } finally {
      setIsUpdating(false);
    }
  };

  /**
   * Handle user deletion
   */
  const handleDelete = async (userId) => {
    if (
      !window.confirm(
        'Are you sure you want to delete this user account? This action cannot be undone.'
      )
    ) {
      return;
    }

    setIsUpdating(true);
    try {
      const success = await deleteUser(userId);
      if (success) {
        setUsers((prev) => prev.filter((u) => u.id !== userId));
        console.log('✅ User deleted successfully');
      } else {
        setError('Failed to delete user');
      }
    } catch (err) {
      console.error('❌ Error deleting user:', err);
      setError('Error deleting user. Please try again.');
    } finally {
      setIsUpdating(false);
    }
  };

  /**
   * Close modal and reset form
   */
  const closeModal = () => {
    setIsModalOpen(false);
    setEditingUser(null);
    setFormData({ full_name: '', role: '' });
  };

  /**
   * Get role badge with color
   */
  const getRoleBadge = (role) => {
    let colorClass = 'bg-gray-100 text-gray-800';
    if (role === 'admin') {
      colorClass = 'bg-red-100 text-red-800';
    } else if (role === 'user') {
      colorClass = 'bg-blue-100 text-blue-800';
    }

    return (
      <span className={`px-3 py-1 ${colorClass} rounded-full text-xs font-semibold uppercase tracking-wider`}>
        {role?.toUpperCase() || 'USER'}
      </span>
    );
  };

  // ========== RENDER ==========

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="mb-8">
        <h1 className="h2 text-primary mb-2">Users Management</h1>
        <p className="text-gray-600">
          View, edit, and manage all user accounts
        </p>
      </div>

      {/* Error Alert */}
      {error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-3 text-red-700">
          <FaExclamationCircle size={20} />
          <p>{error}</p>
          <button
            onClick={() => setError(null)}
            className="ml-auto text-red-500 hover:text-red-700"
          >
            <FaTimes />
          </button>
        </div>
      )}

      {/* Loading State */}
      {loading ? (
        <div className="flex items-center justify-center py-12">
          <FaSpinner className="animate-spin text-accent text-3xl" />
          <span className="ml-3 text-gray-600">Loading users...</span>
        </div>
      ) : (
        /* Users Table */
        <div className="bg-white rounded-lg shadow-md overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-accent text-white">
                <tr>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Name</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Email</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Phone</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Role</th>
                  <th className="px-6 py-4 text-left font-tertiary tracking-wider">Joined</th>
                  <th className="px-6 py-4 text-center font-tertiary tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {users.length === 0 ? (
                  <tr>
                    <td colSpan="6" className="px-6 py-12 text-center text-gray-500">
                      No users found.
                    </td>
                  </tr>
                ) : (
                  users.map((user) => (
                    <tr key={user.id} className="hover:bg-gray-50 transition-colors">
                      <td className="px-6 py-4">
                        <div className="flex items-center gap-2">
                          <div className="w-8 h-8 bg-accent/10 rounded-full flex items-center justify-center">
                            <FaUser className="text-accent" size={14} />
                          </div>
                          <span className="font-medium">{user.full_name || 'N/A'}</span>
                        </div>
                      </td>
                      <td className="px-6 py-4 text-sm">
                        <div className="flex items-center gap-2">
                          <FaEnvelope className="text-gray-400" size={14} />
                          {user.email}
                        </div>
                      </td>
                      <td className="px-6 py-4 text-sm">{user.phone || '-'}</td>
                      <td className="px-6 py-4">{getRoleBadge(user.role)}</td>
                      <td className="px-6 py-4 text-sm text-gray-600">
                        {user.created_at
                          ? new Date(user.created_at).toLocaleDateString()
                          : 'N/A'}
                      </td>
                      <td className="px-6 py-4">
                        <div className="flex items-center justify-center gap-2">
                          <button
                            onClick={() => handleEdit(user)}
                            disabled={isUpdating}
                            className="p-2 text-accent hover:bg-accent/10 rounded transition-colors disabled:opacity-50"
                            title="Edit User"
                          >
                            <FaEdit />
                          </button>
                          <button
                            onClick={() => handleDelete(user.id)}
                            disabled={isUpdating}
                            className="p-2 text-red-500 hover:bg-red-50 rounded transition-colors disabled:opacity-50"
                            title="Delete User"
                          >
                            <FaTrash />
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* Edit Modal */}
      {isModalOpen && editingUser && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-lg shadow-xl max-w-md w-full">
            {/* Modal Header */}
            <div className="p-6 border-b border-gray-200">
              <h2 className="h3 text-primary">Edit User</h2>
              <p className="text-sm text-gray-600 mt-1">
                Update user information
              </p>
            </div>

            {/* Modal Body */}
            <form onSubmit={handleSubmit} className="p-6 space-y-4">
              {/* Full Name */}
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  Full Name
                </label>
                <input
                  type="text"
                  name="full_name"
                  value={formData.full_name}
                  onChange={handleInputChange}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
                  placeholder="Enter full name"
                  disabled={isUpdating}
                />
              </div>

              {/* Role */}
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  Role
                </label>
                <select
                  name="role"
                  value={formData.role}
                  onChange={handleInputChange}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent"
                  disabled={isUpdating}
                >
                  <option value="user">User</option>
                  <option value="admin">Admin</option>
                </select>
              </div>

              {/* Read-Only Email */}
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  Email (Read-Only)
                </label>
                <input
                  type="email"
                  value={editingUser.email || ''}
                  disabled
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600"
                />
              </div>

              {/* Modal Actions */}
              <div className="flex gap-3 pt-4 border-t border-gray-200">
                <button
                  type="button"
                  onClick={closeModal}
                  disabled={isUpdating}
                  className="btn btn-secondary btn-sm flex-1"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  disabled={isUpdating}
                  className="btn btn-primary btn-sm flex-1 flex items-center justify-center gap-2"
                >
                  {isUpdating ? (
                    <>
                      <FaSpinner className="animate-spin" />
                      Saving...
                    </>
                  ) : (
                    <>
                      <FaCheck />
                      Save Changes
                    </>
                  )}
                </button>
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

export default UsersManagement;

--- END FILE: src\components\admin\UsersManagement_REFACTORED.js ---

--- START FILE: src\components\AdminSidebar.jsx ---
import { Link, useNavigate } from 'react-router-dom';
import {
  FaHome,
  FaBed,
  FaDoorOpen,
  FaDollarSign,
  FaTag,
  FaCalendarCheck,
  FaHistory,
  FaChartBar,
  FaSignOutAlt,
  FaUser,
  FaUsers
} from 'react-icons/fa';
import { getLogoUrl } from '../utils/supabaseStorageUrls';
import { useAuth } from '../context/SimpleAuthContext';
import { useMemo } from 'react';

const AdminSidebar = ({ activeSection, setActiveSection }) => {
  const { user, logout, updateUserProfile } = useAuth();
  const navigate = useNavigate();

  const avatarLetter = useMemo(() => {
    if (!user?.name && !user?.email) return '';
    return (user.name || user.email).charAt(0).toUpperCase();
  }, [user]);

  const handleLogout = () => {
    logout();
    navigate('/');
  };

  const handleAvatarChange = (event) => {
    const file = event.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onloadend = () => {
      updateUserProfile({ avatar: reader.result });
    };
    reader.readAsDataURL(file);
  };
  const menuItems = [
    { id: 'room-types', label: 'Room Types', icon: FaBed },
    { id: 'rooms', label: 'Rooms', icon: FaDoorOpen },
    { id: 'price-rules', label: 'Price Rules', icon: FaDollarSign },
    { id: 'promotions', label: 'Promotions', icon: FaTag },
    { id: 'bookings', label: 'Bookings', icon: FaCalendarCheck },
    { id: 'users', label: 'Users', icon: FaUsers },
    { id: 'audit-logs', label: 'Audit Logs', icon: FaHistory },
    { id: 'reports', label: 'Reports', icon: FaChartBar },
  ];

  return (
    <aside className="fixed left-0 top-0 h-full w-64 bg-primary text-white shadow-2xl z-40 hidden lg:block">
      {/* Logo */}
      <div className="p-6 border-b border-accent/20">
        <Link to="/" className="flex items-center">
          <img src={getLogoUrl('dark')} alt="logo" className="w-[140px] brightness-0 invert" />
        </Link>
        <p className="text-sm text-gray-400 mt-2 uppercase tracking-wider">Admin Panel</p>
      </div>

      {/* Navigation */}
      <nav className="p-4">
        <div className="mb-4">
          <Link
            to="/"
            className="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-accent/20 transition-colors text-gray-300 hover:text-white"
          >
            <FaHome className="text-lg" />
            <span className="font-tertiary tracking-wider">Home</span>
          </Link>
        </div>

        <div className="space-y-2">
          {menuItems.map((item) => {
            const Icon = item.icon;
            const isActive = activeSection === item.id;

            return (
              <button
                key={item.id}
                onClick={() => setActiveSection(item.id)}
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${
                  isActive
                    ? 'bg-accent text-white shadow-lg'
                    : 'text-gray-300 hover:bg-accent/10 hover:text-white'
                }`}
              >
                <Icon className="text-lg" />
                <span className="font-tertiary tracking-wider text-sm">{item.label}</span>
              </button>
            );
          })}
        </div>
      </nav>

      {/* User Info & Logout */}
      <div className="absolute bottom-0 left-0 right-0 border-t border-accent/20">
        {user && (
          <div className="p-4 border-b border-accent/20">
            <div className="flex items-center gap-3 mb-3">
              <div className="relative">
                <div className="w-12 h-12 rounded-full bg-accent/20 flex items-center justify-center uppercase text-accent font-semibold border border-accent/40 overflow-hidden">
                  {user?.avatar ? (
                    <img src={user.avatar} alt={user.name} className="w-full h-full object-cover" />
                  ) : (
                    avatarLetter || <FaUser className="text-accent" />
                  )}
                </div>
                <label className="absolute -bottom-1 -right-1 bg-accent text-white p-1 rounded-full text-[10px] cursor-pointer">
                  ✎
                  <input type="file" accept="image/*" className="hidden" onChange={handleAvatarChange} />
                </label>
              </div>
              <div className="flex-1 min-w-0">
                <p className="text-sm font-semibold text-white truncate">{user.name || user.email}</p>
                <p className="text-xs text-gray-400 truncate">{user.email}</p>
              </div>
            </div>
          </div>
        )}

        <div className="p-4">
          <button
            onClick={handleLogout}
            className="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-accent/20 hover:text-white transition-colors"
          >
            <FaSignOutAlt />
            <span className="font-tertiary tracking-wider text-sm">Sign Out</span>
          </button>

          <p className="text-xs text-gray-500 text-center mt-4">
            © {new Date().getFullYear()} Hotel Booking
          </p>
        </div>
      </div>
    </aside>
  );
};

export default AdminSidebar;


--- END FILE: src\components\AdminSidebar.jsx ---

--- START FILE: src\components\AdultsDropdown.jsx ---
import { useRoomContext } from '../context/RoomContext';
import { BsChevronDown } from 'react-icons/bs';
import { adultsList } from '../constants/data';
import { Menu } from '@headlessui/react';


const AdultsDropdown = () => {

  const { adults, setAdults, } = useRoomContext();


  return (
    <Menu as='div' className='w-full h-full bg-white relative'>


      <Menu.Button className='w-full h-full flex items-center justify-between px-8'>
        {adults}
        <BsChevronDown className='text-base text-accent-hover' />
      </Menu.Button>


      <Menu.Items as='ul' className='bg-white absolute w-full flex flex-col z-40'>
        {
          adultsList.map(({ name }, idx) =>
            <Menu.Item
              as='li'
              key={idx}
              onClick={() => setAdults(name)}
              className='border-b last-of-type:border-b-0 h-10 hover:bg-accent hover:text-white w-full flex items-center justify-center cursor-pointer'
            >
              {name}
            </Menu.Item>
          )
        }
      </Menu.Items>


    </Menu>
  );
};

export default AdultsDropdown;

--- END FILE: src\components\AdultsDropdown.jsx ---

--- START FILE: src\components\BookForm.jsx ---
import {
  AdultsDropdown,
  CheckIn,
  CheckOut,
  KidsDropdown,
  RoomTypeSelector,
} from ".";
import { useRoomContext } from "../context/RoomContext";

const BookForm = () => {
  const { handleCheck } = useRoomContext();

  const handleSubmit = (e) => {
    handleCheck(e);
    // Scroll to rooms section after a short delay to allow filtering
    setTimeout(() => {
      const roomsSection = document.getElementById("rooms-section");
      if (roomsSection) {
        roomsSection.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }, 900);
  };

  return (
    <form className="w-full" onSubmit={handleSubmit}>
      <div className="flex flex-col lg:flex-row lg:items-stretch w-full divide-y lg:divide-y-0 lg:divide-x divide-gray-200">
        <div className="flex-1 min-h-[60px] lg:min-h-auto">
          <CheckIn />
        </div>

        <div className="flex-1 min-h-[60px] lg:min-h-auto">
          <CheckOut />
        </div>

        <div className="flex-1 min-h-[60px] lg:min-h-auto">
          <RoomTypeSelector />
        </div>

        <div className="flex-1 min-h-[60px] lg:min-h-auto">
          <AdultsDropdown />
        </div>

        <div className="flex-1 min-h-[60px] lg:min-h-auto">
          <KidsDropdown />
        </div>

        <div className="flex items-center justify-center min-h-[60px] lg:min-h-auto lg:px-6 bg-white">
          <button type="submit" className="btn btn-primary w-full lg:w-auto">
            Check Now
          </button>
        </div>
      </div>
    </form>
  );
};

export default BookForm;

--- END FILE: src\components\BookForm.jsx ---

--- START FILE: src\components\CategoryFilter.jsx ---
import React, { useMemo } from "react";
import { useRoomContext } from "../context/RoomContext";

const CategoryFilter = () => {
  const { allRooms, selectedCategory, updateCategory } = useRoomContext();

  // Derive categories from actual room types in Supabase
  const roomTypes = useMemo(() => {
    const typeMap = new Map();
    allRooms.forEach((room) => {
      if (room.type && !typeMap.has(room.type)) {
        typeMap.set(room.type, {
          id: room.category,
          code: room.type,
          name: room.type === 'STD' ? 'Standard' : 
                room.type === 'DLX' ? 'Deluxe' :
                room.type === 'SUI' ? 'Suite' :
                room.type === 'PEN' ? 'Penthouse' :
                room.type === 'CMB' ? 'Combo Package' :
                room.type,
          description: `${room.type} rooms`
        });
      }
    });
    return Array.from(typeMap.values()).sort((a, b) => a.code.localeCompare(b.code));
  }, [allRooms]);

  return (
    <div className="mb-8 p-6 bg-white rounded-lg shadow-md">
      <h3 className="text-lg font-bold text-gray-800 mb-4">
        Filter by Room Type
      </h3>
      <div className="flex flex-wrap gap-3">
        {/* All Rooms Button */}
        <button
          onClick={() => updateCategory(null)}
          className={`px-6 py-2 rounded-full font-medium transition-all duration-300 ${
            selectedCategory === null
              ? "bg-teal-600 text-white shadow-lg"
              : "bg-gray-100 text-gray-700 hover:bg-gray-200"
          }`}
        >
          All Rooms
        </button>

        {/* Dynamic Room Type Buttons from Supabase */}
        {roomTypes.map((roomType) => (
          <button
            key={roomType.id}
            onClick={() => updateCategory(roomType.id)}
            className={`px-6 py-2 rounded-full font-medium transition-all duration-300 ${
              selectedCategory === roomType.id
                ? "bg-teal-600 text-white shadow-lg"
                : "bg-gray-100 text-gray-700 hover:bg-gray-200"
            }`}
            title={roomType.description}
          >
            {roomType.name}
          </button>
        ))}
      </div>
    </div>
  );
};

export default CategoryFilter;

--- END FILE: src\components\CategoryFilter.jsx ---

--- START FILE: src\components\charts\index.js ---
export { default as RevenueChart } from './RevenueChart';
export { default as OccupancyChart } from './OccupancyChart';


--- END FILE: src\components\charts\index.js ---

--- START FILE: src\components\charts\OccupancyChart.jsx ---
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js';
import { Line, Bar } from 'react-chartjs-2';

ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  Title,
  Tooltip,
  Legend
);

/**
 * Occupancy Chart Component
 * Displays occupancy rate over time
 */
const OccupancyChart = ({ data, type = 'line' }) => {
  if (!data || data.length === 0) {
    return (
      <div className="h-64 flex items-center justify-center text-gray-500">
        No data available
      </div>
    );
  }

  const chartData = {
    labels: data.map(item => {
      const date = new Date(item.date);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }),
    datasets: [
      {
        label: 'Occupancy Rate (%)',
        data: data.map(item => item.rate),
        borderColor: 'rgb(34, 197, 94)', // green
        backgroundColor: 'rgba(34, 197, 94, 0.1)',
        borderWidth: 2,
        fill: type === 'line',
        tension: 0.4,
      },
    ],
  };

  const options = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: true,
        position: 'top',
      },
      title: {
        display: false,
      },
      tooltip: {
        callbacks: {
          label: function(context) {
            return `Occupancy: ${context.parsed.y.toFixed(1)}%`;
          }
        }
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        max: 100,
        ticks: {
          callback: function(value) {
            return value + '%';
          }
        }
      }
    }
  };

  return (
    <div className="h-64">
      {type === 'line' ? (
        <Line data={chartData} options={options} />
      ) : (
        <Bar data={chartData} options={options} />
      )}
    </div>
  );
};

export default OccupancyChart;


--- END FILE: src\components\charts\OccupancyChart.jsx ---

--- START FILE: src\components\charts\RevenueChart.jsx ---
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  Title,
  Tooltip,
  Legend,
  ArcElement,
} from 'chart.js';
import { Line, Bar } from 'react-chartjs-2';

ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  Title,
  Tooltip,
  Legend,
  ArcElement
);

/**
 * Revenue Chart Component
 * Displays revenue data as a line or bar chart
 */
const RevenueChart = ({ data, type = 'line' }) => {
  if (!data || data.length === 0) {
    return (
      <div className="h-64 flex items-center justify-center text-gray-500">
        No data available
      </div>
    );
  }

  const chartData = {
    labels: data.map(item => {
      const date = new Date(item.date);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }),
    datasets: [
      {
        label: 'Revenue ($)',
        data: data.map(item => item.revenue),
        borderColor: 'rgb(139, 90, 43)', // accent color
        backgroundColor: 'rgba(139, 90, 43, 0.1)',
        borderWidth: 2,
        fill: type === 'line',
        tension: 0.4,
      },
    ],
  };

  const options = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: true,
        position: 'top',
      },
      title: {
        display: false,
      },
      tooltip: {
        callbacks: {
          label: function(context) {
            return `Revenue: $${context.parsed.y.toFixed(2)}`;
          }
        }
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          callback: function(value) {
            return '$' + value.toLocaleString();
          }
        }
      }
    }
  };

  return (
    <div className="h-64">
      {type === 'line' ? (
        <Line data={chartData} options={options} />
      ) : (
        <Bar data={chartData} options={options} />
      )}
    </div>
  );
};

export default RevenueChart;


--- END FILE: src\components\charts\RevenueChart.jsx ---

--- START FILE: src\components\chatBox\ChatBox.jsx ---
import { useState, useMemo, useEffect, useRef } from "react";
import { useNavigate } from "react-router-dom";
import { useRoomContext } from "../../context/RoomContext";
import { useAuth } from "../../context/SimpleAuthContext";
import { FiMessageCircle, FiX, FiSend } from "react-icons/fi";
import QRPaymentModal from "../QRPaymentModal";
import {
  recommendRooms,
  extractIntent,
  getTimeBasedGreeting,
  getSuggestedDates,
  getContextFromChat,
  generateSuggestions,
} from "../../utils/aiAssistant";

// AI Response templates for hotel consultation
const AI_RESPONSES = {
  greetings: [
    "Hello! 👋 I'm your booking assistant. I'll help you find the perfect room. What do you need?",
    "Welcome! 🏨 I'm here to provide you with an amazing booking experience.",
  ],
  room_suggestions: [
    "Based on your requirements, I recommend these rooms:",
    "I found rooms that match your needs:",
  ],
  price_inquiry: [
    "Room prices vary by season. Choose dates to see exact pricing!",
    "Best rates on weekdays. Weekend rates are different!",
  ],
  amenities: [
    "🏊 Swimming Pool, 🏋️ Gym, 🍽️ Restaurant, 🧖 Spa",
    "🎰 Casino, 🎪 Tennis Court, 🚴 Bike Rental",
  ],
  special_requests: [
    "I've noted your special request. Our team will contact you soon!",
    "A staff member will reach out to confirm this request.",
  ],
};

const QuickReply = ({ label, onClick, icon = "✓" }) => (
  <button
    onClick={onClick}
    className="px-4 py-2 text-sm rounded-full bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 transition transform hover:scale-105 active:scale-95 duration-200 font-medium flex items-center gap-2 whitespace-nowrap"
  >
    <span>{icon}</span>
    {label}
  </button>
);

const ChatMessage = ({ role = "ai", children, timestamp = null }) => {
  const isUser = role === "user";
  return (
    <div
      className={`w-full flex ${
        isUser ? "justify-end" : "justify-start"
      } my-3 animate-fade-in`}
    >
      <div
        className={`max-w-[85%] px-4 py-3 rounded-2xl text-sm leading-relaxed shadow-sm transition-all hover:shadow-md ${
          isUser
            ? "bg-blue-600 text-white rounded-br-sm"
            : "bg-gray-100 text-gray-900 border border-gray-200 rounded-bl-sm"
        }`}
      >
        {children}
        {timestamp && (
          <div
            className={`text-xs mt-1 ${
              isUser ? "text-blue-100" : "text-gray-500"
            }`}
          >
            {timestamp}
          </div>
        )}
      </div>
    </div>
  );
};

const TypingDots = () => (
  <div className="w-full flex justify-start my-3">
    <div className="px-4 py-3 rounded-2xl text-sm bg-gray-100 border border-gray-200 text-gray-500">
      <span className="inline-flex gap-1">
        <span
          className="w-2 h-2 rounded-full bg-gray-400 animate-bounce"
          style={{ animationDelay: "0ms" }}
        ></span>
        <span
          className="w-2 h-2 rounded-full bg-gray-400 animate-bounce"
          style={{ animationDelay: "150ms" }}
        ></span>
        <span
          className="w-2 h-2 rounded-full bg-gray-400 animate-bounce"
          style={{ animationDelay: "300ms" }}
        ></span>
      </span>
    </div>
  </div>
);

const RoomCard = ({ room, onSelect, showPrice = true }) => (
  <div
    onClick={() => onSelect(room)}
    className="flex gap-3 p-3 border border-gray-200 rounded-xl bg-white hover:bg-blue-50 transition transform hover:scale-[1.02] hover:shadow-lg duration-200 cursor-pointer"
  >
    <img
      src={room.image}
      alt={room.name}
      className="w-20 h-20 rounded-lg object-cover shadow-sm"
    />
    <div className="flex-1">
      <div className="font-semibold text-gray-900 text-sm">{room.name}</div>
      <div className="text-xs text-gray-600 mt-1">{room.description}</div>
      {showPrice && (
        <div className="text-blue-600 font-bold text-sm mt-2">
          ${room.price}/night
        </div>
      )}
    </div>
  </div>
);

const ChatBox = () => {
  const navigate = useNavigate();
  const { bookRoom, confirmBookingPayment, rooms: allRooms } = useRoomContext();
  const { isAuthenticated, user } = useAuth();

  const [open, setOpen] = useState(false);
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState("");
  const [isTyping, setIsTyping] = useState(false);
  const [stage, setStage] = useState("idle"); // idle | filter | book | payment | chat_after_booking
  const [bookingConfirmed, setBookingConfirmed] = useState(null);
  const [showQRPayment, setShowQRPayment] = useState(false);

  const messagesEndRef = useRef(null);

  const [filterForm, setFilterForm] = useState({
    checkIn: new Date().toISOString().split("T")[0],
    checkOut: new Date(Date.now() + 86400000).toISOString().split("T")[0],
    adults: 1,
    kids: 0,
  });

  const [bookingForm, setBookingForm] = useState({
    roomName: "",
    checkIn: new Date().toISOString().split("T")[0],
    checkOut: new Date(Date.now() + 86400000).toISOString().split("T")[0],
    adults: 1,
    kids: 0,
    name: "",
    email: "",
    phone: "",
    specialRequests: "",
  });

  const [adults, setAdults] = useState("1 Adult");
  const [kids, setKids] = useState("0 Kid");
  const [checkInDate, setCheckInDate] = useState(
    new Date().toISOString().split("T")[0]
  );
  const [checkOutDate, setCheckOutDate] = useState(
    new Date(Date.now() + 86400000).toISOString().split("T")[0]
  );
  const handleCheck = () => {};

  const candidateRooms = useMemo(() => {
    if (!bookingForm.roomName.trim()) return [];

    const keyword = bookingForm.roomName.toLowerCase();

    // Pre-filter by name to avoid suggestions that are too far off
    const roughMatches = allRooms.filter((room) =>
      room.name.toLowerCase().includes(keyword)
    );

    // Then use recommendRooms to select the most suitable rooms
    const prefs = {
      adults: bookingForm.adults || 1,
      kids: bookingForm.kids || 0,
      budget: null,
      amenities: [],
    };

    return recommendRooms(roughMatches.length ? roughMatches : allRooms, prefs);
  }, [bookingForm.roomName, bookingForm.adults, bookingForm.kids, allRooms]);

  const getRandomResponse = (type) => {
    const responses = AI_RESPONSES[type] || [];
    return responses[Math.floor(Math.random() * responses.length)] || "";
  };

  const getTimestamp = () => {
    const now = new Date();
    return now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  };

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages, isTyping]);

  useEffect(() => {
    if (open && messages.length === 0) {
      setTimeout(() => {
        const greeting = getTimeBasedGreeting();
        const suggestedDates = getSuggestedDates();
        pushAI(
          `${greeting}\n\n` +
            "I'm your virtual booking assistant. You can:\n" +
            "• Find rooms by date and number of guests\n" +
            "• Book directly here\n" +
            "• Ask about prices, promotions, amenities\n\n" +
            `Quick suggestion: tonight (${suggestedDates.tonight.checkIn}) or next weekend.`
        );
      }, 500);
    }
  }, [open, messages.length]);

  const pushAI = (text, delay = 800) => {
    setIsTyping(true);
    setTimeout(() => {
      setMessages((prev) => [
        ...prev,
        {
          role: "ai",
          text,
          timestamp: getTimestamp(),
        },
      ]);
      setIsTyping(false);
    }, delay);
  };

  const pushUser = (text) => {
    setMessages((prev) => [
      ...prev,
      {
        role: "user",
        text,
        timestamp: getTimestamp(),
      },
    ]);
  };

  const onQuick = (type) => {
    if (type === "filter") {
      pushUser("Find suitable rooms");
      setStage("filter");
      pushAI(
        "Great! 🎯 Please select check-in date, check-out date, and number of guests. I'll find the best rooms for you."
      );
    } else if (type === "book") {
      pushUser("Book now");
      setStage("book");
      pushAI(
        "Ready! 📋 Please enter a room type or keyword (e.g., Deluxe, Family, Sea View), then fill in your details."
      );
    } else if (type === "amenities") {
      pushUser("Ask about amenities");
      pushAI(
        `${getRandomResponse(
          "amenities"
        )} ✨\n\nOther features:\n🎵 Karaoke, 📺 Movie Room, 🌮 24h Food Court`
      );
    } else if (type === "contact") {
      pushUser("Contact support");
      pushAI(
        "📞 Hotline: 1-800-HOTEL\n📧 Email: support@hotel.com\n💬 24/7 Live chat support\n\nOr leave your phone number and we'll call back!"
      );
    } else if (type === "promo") {
      pushUser("Special offers");
      pushAI(
        "🎉 Today's Promotions:\n• 15% off for 3+ nights\n• Free room upgrade (available)\n• Breakfast voucher for families\n\nBook now to not miss out!"
      );
    }
  };

  const handleSend = () => {
    const text = input.trim();
    if (!text) return;
    pushUser(text);
    setInput("");

    const intent = extractIntent(text);

    if (intent === "book") {
      setStage("book");
      pushAI(
        "Great! 🛏️ What type of room would you like to book? Please enter a room name or keyword (e.g., Deluxe, Suite, Family), then fill in your contact information."
      );
    } else if (intent === "search") {
      setStage("filter");
      pushAI(
        "Sure! 👍 Please select check-in/check-out dates and number of guests, and I'll suggest the most suitable rooms for you."
      );
    } else if (intent === "amenities") {
      const ctx = getContextFromChat([...messages, { role: "user", text }]);
      const extra = generateSuggestions(ctx, "idle").join("\n") || "";
      pushAI(
        `${getRandomResponse(
          "amenities"
        )}\n\nAre you interested in any other amenities?\n${extra}`.trim()
      );
    } else if (intent === "price") {
      pushAI(getRandomResponse("price_inquiry"));
    } else if (intent === "contact") {
      pushAI(
        "📞 Hotline: 1-800-HOTEL\n📧 Email: support@hotel.com\n\nPlease describe your issue, and I'll guide you through the next steps."
      );
    } else {
      const ctx = getContextFromChat([...messages, { role: "user", text }]);
      const suggestions = generateSuggestions(ctx, stage).join("\n");
      pushAI(
        `Thank you! 😊 You can ask me about:\n` +
          "• Finding suitable rooms\n" +
          "• Booking rooms\n" +
          "• Prices & promotions\n" +
          "• Amenities & services\n" +
          (suggestions ? `\nAdditional suggestions:\n${suggestions}` : "")
      );
    }
  };

  const applyFilter = () => {
    if (filterForm.checkIn >= filterForm.checkOut) {
      pushAI(
        "⚠️ Check-out date must be after check-in date. Please try again!"
      );
      return;
    }
    setAdults(`${filterForm.adults} Adult`);
    setKids(`${filterForm.kids} Kid`);
    setCheckInDate(filterForm.checkIn);
    setCheckOutDate(filterForm.checkOut);
    try {
      handleCheck({ preventDefault: () => {} });
    } catch (_) {}
    pushAI("✅ Filter applied successfully. Redirecting to room list...");
    setTimeout(() => navigate("/"), 800);
    setTimeout(() => {
      const el = document.getElementById("rooms-section");
      if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 1000);
  };

  const selectRoomFromCard = (room) => {
    setBookingForm((f) => ({ ...f, roomName: room.name }));
    pushAI(
      `👍 You selected ${room.name}. Price: $${room.price}/night. Please confirm dates and enter your contact information.`
    );
    setStage("book");
  };

  const createBooking = () => {
    if (!bookingForm.roomName.trim()) {
      pushAI("❌ Please enter a room name or select a room from the list!");
      return;
    }
    if (bookingForm.checkIn >= bookingForm.checkOut) {
      pushAI("⚠️ Check-out date must be after check-in date!");
      return;
    }
    if (!bookingForm.name.trim()) {
      pushAI("❌ Please enter your name!");
      return;
    }
    if (!bookingForm.email.trim() || !bookingForm.email.includes("@")) {
      pushAI("❌ Please enter a valid email address!");
      return;
    }

    const room = candidateRooms[0];
    if (!room) {
      pushAI("❌ No matching room found. Please try a different keyword!");
      return;
    }

    const res = bookRoom({
      roomId: room.id,
      roomName: room.name,
      userId: user?.id || "guest",
      userName: bookingForm.name,
      userEmail: bookingForm.email,
      userPhone: bookingForm.phone,
      checkIn: bookingForm.checkIn,
      checkOut: bookingForm.checkOut,
      adults: bookingForm.adults,
      kids: bookingForm.kids,
      specialRequests: bookingForm.specialRequests,
      note: "Booked via AI ChatBox",
    });

    if (res?.success) {
      setBookingConfirmed(res.booking);
      pushAI(
        `🎉 Booking Details Confirmed!\n\n` +
          `🛏️ Room: ${room.name}\n` +
          `📅 Check-in: ${bookingForm.checkIn}\n` +
          `📅 Check-out: ${bookingForm.checkOut}\n` +
          `👥 Guests: ${bookingForm.adults} adults, ${bookingForm.kids} children\n` +
          `💰 Total: $${res.booking.totalPrice}\n` +
          `✅ Confirmation Code: ${res.booking.confirmationCode}\n\n` +
          `Now proceeding to QR payment...`
      );
      setStage("payment");
      setTimeout(() => {
        setShowQRPayment(true);
      }, 1500);
    } else {
      pushAI(
        `❌ Unable to create booking: ${
          res?.error || "Please check your information and try again."
        }`
      );
    }
  };

  const handleQRPaymentConfirm = (booking) => {
    // Confirm payment in the system
    confirmBookingPayment(booking.id, {
      paymentMethod: "QR Code",
      paymentCode: `QR-${Date.now()}`,
    });

    setShowQRPayment(false);
    pushAI(
      `✅ Payment successful!\n\n` +
        `Your booking has been confirmed and saved to your account.\n` +
        `Confirmation details have been sent to ${bookingForm.email}.\n\n` +
        `Would you like to book another room or need anything else?`
    );
    setStage("idle");
    setBookingForm({
      roomName: "",
      checkIn: new Date().toISOString().split("T")[0],
      checkOut: new Date(Date.now() + 86400000).toISOString().split("T")[0],
      adults: 1,
      kids: 0,
      name: "",
      email: "",
      phone: "",
      specialRequests: "",
    });
    setBookingConfirmed(null);
  };

  return (
    <div className="fixed bottom-6 right-6 z-50">
      {!open && (
        <button
          aria-label="Open AI Chat"
          onClick={() => setOpen(true)}
          className="flex items-center gap-3 px-5 py-4 rounded-full shadow-2xl bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 transition transform hover:scale-110 active:scale-95 duration-200 animate-bounce font-semibold"
        >
          <FiMessageCircle size={20} />
          <span>Chat AI</span>
        </button>
      )}

      {open && (
        <div className="w-[360px] sm:w-[400px] h-[600px] bg-white rounded-3xl shadow-2xl border border-gray-200 flex flex-col animate-slide-up animate-fade-in overflow-hidden">
          {/* Header */}
          <div className="px-6 py-4 flex items-center justify-between bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-t-3xl shadow-md">
            <div>
              <div className="font-bold text-lg">Booking Assistant</div>
              <div className="text-xs text-blue-100">
                24/7 Support • Fast & Friendly
              </div>
            </div>
            <button
              onClick={() => setOpen(false)}
              className="p-1 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition"
              aria-label="Close"
            >
              <FiX size={20} />
            </button>
          </div>

          {/* Body */}
          <div className="flex-1 overflow-y-auto px-4 py-4 bg-gradient-to-b from-blue-50 to-gray-50 space-y-1">
            {messages.map((m, idx) => (
              <ChatMessage key={idx} role={m.role} timestamp={m.timestamp}>
                {m.text}
              </ChatMessage>
            ))}
            {isTyping && <TypingDots />}
            <div ref={messagesEndRef} />

            {/* Suggestions when user types a room name */}
            {stage === "book" &&
              bookingForm.roomName &&
              candidateRooms.length > 0 && (
                <div className="mt-4 space-y-2 animate-fade-in">
                  <div className="text-xs font-semibold text-gray-600 px-2">
                    💡 Recommended Rooms:
                  </div>
                  {candidateRooms.slice(0, 3).map((room) => (
                    <RoomCard
                      key={room.id}
                      room={room}
                      onSelect={selectRoomFromCard}
                    />
                  ))}
                </div>
              )}

            {/* Quick actions */}
            {stage === "idle" && messages.length <= 2 && (
              <div className="flex flex-wrap gap-2 p-2">
                <QuickReply
                  label="🔍 Find Rooms"
                  onClick={() => onQuick("filter")}
                />
                <QuickReply
                  label="📋 Book Now"
                  onClick={() => onQuick("book")}
                />
                <QuickReply
                  label="✨ Amenities"
                  onClick={() => onQuick("amenities")}
                />
                <QuickReply
                  label="🎉 Specials"
                  onClick={() => onQuick("promo")}
                />
                <QuickReply
                  label="📞 Contact"
                  onClick={() => onQuick("contact")}
                />
              </div>
            )}

            {/* Filter form */}
            {stage === "filter" && (
              <div className="p-4 bg-white border border-gray-200 rounded-2xl animate-fade-in space-y-4">
                <h3 className="font-semibold text-gray-900">Find Rooms</h3>
                <div className="grid grid-cols-2 gap-3">
                  <label className="text-xs text-gray-600 font-medium">
                    Check-in
                    <input
                      type="date"
                      value={filterForm.checkIn}
                      onChange={(e) =>
                        setFilterForm((f) => ({
                          ...f,
                          checkIn: e.target.value,
                        }))
                      }
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium">
                    Check-out
                    <input
                      type="date"
                      value={filterForm.checkOut}
                      onChange={(e) =>
                        setFilterForm((f) => ({
                          ...f,
                          checkOut: e.target.value,
                        }))
                      }
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium">
                    👥 Adults
                    <input
                      type="number"
                      min={1}
                      max={10}
                      value={filterForm.adults}
                      onChange={(e) =>
                        setFilterForm((f) => ({
                          ...f,
                          adults: Number(e.target.value),
                        }))
                      }
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium">
                    👶 Children
                    <input
                      type="number"
                      min={0}
                      max={10}
                      value={filterForm.kids}
                      onChange={(e) =>
                        setFilterForm((f) => ({
                          ...f,
                          kids: Number(e.target.value),
                        }))
                      }
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                </div>
                <button
                  onClick={applyFilter}
                  className="w-full py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-blue-800 transition transform hover:scale-105 active:scale-95 duration-200"
                >
                  🔍 Find Rooms
                </button>

                {/* Featured rooms preview (top 3) */}
                <div className="space-y-2 border-t pt-4">
                  <div className="text-xs font-semibold text-gray-600">
                    🏨 Featured Rooms:
                  </div>
                  {allRooms.slice(0, 3).map((room) => (
                    <RoomCard
                      key={room.id}
                      room={room}
                      onSelect={selectRoomFromCard}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* Booking form */}
            {stage === "book" && (
              <div className="p-4 bg-white border border-gray-200 rounded-2xl animate-fade-in space-y-4">
                <h3 className="font-semibold text-gray-900">
                  📋 Booking Information
                </h3>
                <div className="grid grid-cols-2 gap-3">
                  <label className="text-xs text-gray-600 font-medium col-span-2">
                    Room Name / Search
                    <input
                      type="text"
                      value={bookingForm.roomName}
                      onChange={(e) =>
                        setBookingForm((f) => ({
                          ...f,
                          roomName: e.target.value,
                        }))
                      }
                      placeholder="e.g., Deluxe, Family, Sea View..."
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium">
                    Check-in
                    <input
                      type="date"
                      value={bookingForm.checkIn}
                      onChange={(e) =>
                        setBookingForm((f) => ({
                          ...f,
                          checkIn: e.target.value,
                        }))
                      }
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium">
                    Check-out
                    <input
                      type="date"
                      value={bookingForm.checkOut}
                      onChange={(e) =>
                        setBookingForm((f) => ({
                          ...f,
                          checkOut: e.target.value,
                        }))
                      }
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium">
                    👥 Adults
                    <input
                      type="number"
                      min={1}
                      max={10}
                      value={bookingForm.adults}
                      onChange={(e) =>
                        setBookingForm((f) => ({
                          ...f,
                          adults: Number(e.target.value),
                        }))
                      }
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium">
                    👶 Children
                    <input
                      type="number"
                      min={0}
                      max={10}
                      value={bookingForm.kids}
                      onChange={(e) =>
                        setBookingForm((f) => ({
                          ...f,
                          kids: Number(e.target.value),
                        }))
                      }
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium col-span-2">
                    Full Name
                    <input
                      type="text"
                      value={bookingForm.name}
                      onChange={(e) =>
                        setBookingForm((f) => ({ ...f, name: e.target.value }))
                      }
                      placeholder="John Doe"
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium col-span-2">
                    Email
                    <input
                      type="email"
                      value={bookingForm.email}
                      onChange={(e) =>
                        setBookingForm((f) => ({ ...f, email: e.target.value }))
                      }
                      placeholder="email@example.com"
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium col-span-2">
                    Phone (Optional)
                    <input
                      type="tel"
                      value={bookingForm.phone}
                      onChange={(e) =>
                        setBookingForm((f) => ({ ...f, phone: e.target.value }))
                      }
                      placeholder="+1 (555) 123-4567"
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                  </label>
                  <label className="text-xs text-gray-600 font-medium col-span-2">
                    Special Requests (Optional)
                    <textarea
                      value={bookingForm.specialRequests}
                      onChange={(e) =>
                        setBookingForm((f) => ({
                          ...f,
                          specialRequests: e.target.value,
                        }))
                      }
                      placeholder="e.g., High floor, near elevator, quiet room..."
                      rows="2"
                      className="mt-1 w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                    />
                  </label>
                </div>

                {bookingForm.roomName && candidateRooms.length > 0 && (
                  <div className="p-2 bg-blue-50 border border-blue-200 rounded-lg text-xs text-blue-900">
                    ✅ Suggestions:{" "}
                    {candidateRooms
                      .slice(0, 2)
                      .map((r) => r.name)
                      .join(", ")}
                  </div>
                )}

                <button
                  onClick={createBooking}
                  className="w-full py-3 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-lg hover:from-green-700 hover:to-green-800 transition transform hover:scale-105 active:scale-95 duration-200 flex items-center justify-center gap-2"
                >
                  <FiSend size={18} />
                  Confirm Booking
                </button>
              </div>
            )}

            {/* Payment stage placeholder */}
            {stage === "payment" && (
              <div className="p-4 bg-white border border-gray-200 rounded-2xl animate-fade-in space-y-4">
                <h3 className="font-semibold text-gray-900">💳 Payment</h3>
                <div className="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-900">
                  Payment gateway integration coming soon. Your booking details
                  have been saved.
                </div>
              </div>
            )}
          </div>

          {/* Input */}
          <div className="px-4 py-3 border-t bg-white rounded-b-3xl">
            <div className="flex gap-2">
              <input
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault();
                    handleSend();
                  }
                }}
                placeholder="Ask me anything..."
                className="flex-1 border border-gray-300 rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <button
                onClick={handleSend}
                className="px-4 py-2 rounded-full bg-blue-600 text-white hover:bg-blue-700 transition transform hover:scale-105 active:scale-95 duration-200 flex items-center justify-center"
              >
                <FiSend size={18} />
              </button>
            </div>
          </div>
        </div>
      )}

      {/* QR Payment Modal */}
      {showQRPayment && bookingConfirmed && (
        <QRPaymentModal
          booking={bookingConfirmed}
          onConfirmPayment={handleQRPaymentConfirm}
          onClose={() => setShowQRPayment(false)}
        />
      )}
    </div>
  );
};

export default ChatBox;

--- END FILE: src\components\chatBox\ChatBox.jsx ---

--- START FILE: src\components\chatBox\index.js ---
export { default } from './ChatBox';
--- END FILE: src\components\chatBox\index.js ---

--- START FILE: src\components\CheckIn.jsx ---
import { BsCalendar } from 'react-icons/bs';
import DatePicker from 'react-datepicker';
import 'react-datepicker/dist/react-datepicker.css';
import '../style/datepicker.css';
import { useRoomContext } from '../context/RoomContext';

const CheckIn = () => {
  const { checkInDate, setCheckInDate, checkOutDate, setCheckOutDate } = useRoomContext();

  const handleChange = (date) => {
    // Validate: can't check in on past dates
    if (date && date < new Date(new Date().setHours(0, 0, 0, 0))) {
      return;
    }
    setCheckInDate(date);
    if (checkOutDate && date && date >= checkOutDate) {
      setCheckOutDate(null);
    }
  };

  return (
    <div className='relative flex items-center justify-end h-full'>
      <div className='absolute z-10 pr-8'>
        <div><BsCalendar className='text-accent text-base' /></div>
      </div>

      <DatePicker
        className='w-full h-full'
        selected={checkInDate}
        placeholderText='Check in'
        minDate={new Date()}
        onChange={handleChange}
      />
    </div>
  );
};

export default CheckIn;

--- END FILE: src\components\CheckIn.jsx ---

--- START FILE: src\components\CheckOut.jsx ---
import { BsCalendar } from 'react-icons/bs';
import DatePicker from 'react-datepicker';
import 'react-datepicker/dist/react-datepicker.css';
import '../style/datepicker.css';
import { useRoomContext } from '../context/RoomContext';

const CheckOut = () => {
  const { checkInDate, checkOutDate, setCheckOutDate } = useRoomContext();

  const minDate = checkInDate ? new Date(checkInDate.getTime() + 24 * 60 * 60 * 1000) : new Date();

  return (
    <div className='relative flex items-center justify-end h-full'>
      <div className='absolute z-10 pr-8'>
        <div><BsCalendar className='text-accent text-base' /></div>
      </div>

      <DatePicker
        className='w-full h-full'
        selected={checkOutDate}
        placeholderText='Check out'
        minDate={minDate}
        onChange={(date) => setCheckOutDate(date)}
        disabled={!checkInDate}
      />

    </div>
  );
};

export default CheckOut;

--- END FILE: src\components\CheckOut.jsx ---

--- START FILE: src\components\Footer.jsx ---
import { getLogoUrl } from '../utils/supabaseStorageUrls';

const Footer = () => (
  <footer className='bg-primary py-12'>
    <div className='container mx-auto text-white flex items-center gap-5 sm:justify-between flex-col sm:flex-row'>
      <a href="/">
        <img src={getLogoUrl('white')} alt="logo" className="w-[120px]" />
      </a>
      <div className="flex flex-col items-center">
        <p>Copyright &copy; {new Date().getFullYear()}, All Right Reserved,</p>
      </div>
    </div>
  </footer>
);

export default Footer;
--- END FILE: src\components\Footer.jsx ---

--- START FILE: src\components\Header.jsx ---
import { useRoomContext } from "../context/RoomContext";
import { useAuth } from "../context/SimpleAuthContext";
import { useEffect, useMemo, useState } from "react";
import { Link, useNavigate, useLocation } from "react-router-dom";
import { FaUser, FaSignOutAlt, FaSignInAlt } from "react-icons/fa";
import { getLogoUrl } from "../utils/supabaseStorageUrls";

const Header = () => {
  const { resetRoomFilterData } = useRoomContext();
  const { user, logout, isAuthenticated } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();

  const [header, setHeader] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      if (location.pathname !== "/") {
        setHeader(true);
      } else {
        setHeader(window.scrollY > 50);
      }
    };

    handleScroll();
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, [location.pathname]);

  const navLinks = [
    { label: "Home", path: "/" },
    { label: "Rooms", path: "/rooms" },
    { label: "Restaurant", path: "/restaurant" },
    { label: "Spa", path: "/spa" },
    { label: "Contact", path: "/contact" },
  ];

  const handleLogout = () => {
    logout();
    navigate("/");
  };

  const avatarLetter = useMemo(() => {
    if (!user?.name && !user?.email) return "";
    const source = user.name || user.email;
    return source.charAt(0).toUpperCase();
  }, [user]);

  return (
    <header
      className={`fixed z-50 w-full transition-all duration-300 
      ${header ? "bg-white py-6 shadow-lg" : "bg-transparent py-8"}`}
    >
      <div className="container mx-auto flex flex-col lg:flex-row items-center lg:justify-between gap-y-6 lg:gap-y-0">
        <Link to="/" onClick={resetRoomFilterData}>
          {header ? (
            <img src={getLogoUrl('dark')} alt="logo" className="w-[160px]" />
          ) : (
            <img src={getLogoUrl('white')} alt="logo" className="w-[160px]" />
          )}
        </Link>

        <nav
          className={`${header ? "text-primary" : "text-white"}
        flex gap-x-4 lg:gap-x-8 font-tertiary tracking-[3px] text-[15px] items-center uppercase`}
        >
          {navLinks.map(({ label, path }) => (
            <Link
              to={path}
              className="transition hover:text-accent"
              key={label}
            >
              {label}
            </Link>
          ))}

          <div className="flex items-center gap-3 ml-4 pl-4 border-l border-current/20">
            {isAuthenticated() ? (
              <>
                <div
                  className={`flex items-center gap-3 text-sm ${
                    header ? "text-primary" : "text-white"
                  }`}
                >
                  <div className="w-9 h-9 rounded-full bg-accent/20 flex items-center justify-center uppercase font-semibold text-accent border border-accent/40">
                    {user?.avatar ? (
                      <img
                        src={user.avatar}
                        alt={user.name}
                        className="w-full h-full rounded-full object-cover"
                      />
                    ) : (
                      avatarLetter || <FaUser />
                    )}
                  </div>
                  <span className="hidden sm:inline font-semibold">
                    {user?.name || user?.email?.split("@")[0]}
                  </span>
                </div>
                {user?.role !== "admin" && (
                  <Link
                    to="/account"
                    className={`transition hover:text-accent flex items-center gap-2 text-sm ${
                      header ? "text-primary" : "text-white"
                    }`}
                  >
                    <span className="hidden sm:inline">Dashboard</span>
                  </Link>
                )}
                {user?.role === "admin" && (
                  <Link
                    to="/admin"
                    className={`transition hover:text-accent flex items-center gap-2 text-sm ${
                      header ? "text-primary" : "text-white"
                    }`}
                  >
                    <span className="hidden sm:inline">Admin</span>
                  </Link>
                )}
                <button
                  onClick={handleLogout}
                  className={`transition hover:text-accent flex items-center gap-2 text-sm ${
                    header ? "text-primary" : "text-white"
                  }`}
                  title="Sign Out"
                >
                  <FaSignOutAlt />
                  <span className="hidden sm:inline">Sign Out</span>
                </button>
              </>
            ) : (
              <>
                <Link
                  to="/register"
                  className={`transition hover:text-accent flex items-center gap-2 text-sm ${
                    header ? "text-primary" : "text-white"
                  }`}
                >
                  <span className="hidden sm:inline">Sign Up</span>
                </Link>
                <Link
                  to="/login"
                  className={`transition hover:text-accent flex items-center gap-2 text-sm ${
                    header ? "text-primary" : "text-white"
                  }`}
                >
                  <FaSignInAlt />
                  <span className="hidden sm:inline">Sign In</span>
                </Link>
              </>
            )}
          </div>
        </nav>
      </div>
    </header>
  );
};

export default Header;
--- END FILE: src\components\Header.jsx ---

--- START FILE: src\components\HeroSlider.jsx ---
import { Swiper, SwiperSlide } from 'swiper/react';
import { sliderData } from '../constants/data';
import { EffectFade, Autoplay } from 'swiper';
import 'swiper/css/effect-fade';
import 'swiper/css';

const STORAGE_URL = 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms';

const HeroSlider = () => {
  return (
    <Swiper
      modules={[EffectFade, Autoplay]}
      effect={'fade'}
      loop={true}
      autoplay={{
        delay: 3000,
        disableOnInteraction: false,
      }}
      className='heroSlider h-[600px] lg:h-[860px]'
    >
      {
        sliderData.map(({ id, title, btnNext }) =>
          <SwiperSlide className='h-full relative flex justify-center items-center' key={id}>

            <div className='z-20 text-white text-center'>
              <div className='uppercase font-tertiary tracking-[6px] mb-5'>Just Enjoy & Relax</div>
              <h1 className='font-primary text-[32px] uppercase tracking-[2px] max-w-[920px] lg:text-[68px] leading-tight mb-6'>
                {title}
              </h1>
              <button className='btn btn-lg btn-primary mx-auto'>{btnNext}</button>
            </div>

            <div className='absolute top-0 w-full h-full'>
              <img className='object-cover h-full w-full' src={`${STORAGE_URL}/img/heroSlider/${id}.jpg`} alt={title} />
            </div>

            <div className='absolute w-full h-full bg-black/70' />
          </SwiperSlide>
        )
      }
    </Swiper>
  )
};

export default HeroSlider;
--- END FILE: src\components\HeroSlider.jsx ---

--- START FILE: src\components\index.js ---
export { default as AdultsDropdown } from "./AdultsDropdown";
export { default as PageNotFound } from "./PageNotFound";
export { default as KidsDropdown } from "./KidsDropdown";
export { default as HeroSlider } from "./HeroSlider";
export { default as BookForm } from "./BookForm";
export { default as CheckOut } from "./CheckOut";
export { default as CheckIn } from "./CheckIn";
export { default as Footer } from "./Footer";
export { default as Header } from "./Header";
export { default as Rooms } from "./Rooms";
export { default as Room } from "./Room";
export { default as AdminSidebar } from "./AdminSidebar";
export { default as ProtectedRoute } from "./ProtectedRoute";
export { default as Toast } from "./Toast";
export { default as LanguageSwitcher } from "./LanguageSwitcher";
export { default as QRPaymentModal } from "./QRPaymentModal";
export { default as Invoice } from "./Invoice";
export { default as Pagination } from "./Pagination";
export { default as CategoryFilter } from "./CategoryFilter";
export { default as RoomTypeSelector } from "./RoomTypeSelector";

export { default as ScrollToTop } from "../utils/ScrollToTop";

--- END FILE: src\components\index.js ---

--- START FILE: src\components\Invoice.jsx ---
import { useRef } from "react";
import { FaFileInvoice, FaEnvelope, FaTimes } from "react-icons/fa";
import { getLogoUrl } from "../utils/supabaseStorageUrls";

const Invoice = ({ booking, onClose, onDownload, onEmail }) => {
  const invoiceRef = useRef(null);
  const formatDate = (dateString) => {
    if (!dateString) return "N/A";
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
    });
  };

  const formatDateTime = (dateString) => {
    if (!dateString) return "N/A";
    const date = new Date(dateString);
    return date.toLocaleString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
    });
  };

  const getBookingType = () => {
    if (booking.type === "restaurant") return "Restaurant Reservation";
    if (booking.type === "spa") return "Spa Appointment";
    return "Room Booking";
  };

  return (
    <div
      className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto"
      onClick={(e) => {
        if (e.target === e.currentTarget && onClose) {
          onClose();
        }
      }}
    >
      <div
        ref={invoiceRef}
        className="bg-white rounded-lg shadow-xl max-w-3xl w-full my-8 max-h-[90vh] flex flex-col invoice-pdf"
      >
        {/* Header - Fixed */}
        <div className="bg-gradient-to-r from-accent/20 to-accent/10 p-8 border-b-2 border-accent/30 flex-shrink-0">
          <div className="flex items-center justify-between mb-6">
            <div className="flex items-center gap-4">
              <div className="bg-white p-3 rounded-lg shadow-sm">
                <img src={getLogoUrl('dark')} alt="logo" className="w-32" />
              </div>
              <div>
                <h2 className="text-3xl font-primary text-primary mb-1">
                  Invoice
                </h2>
                <p className="text-sm text-primary/60">Adina Hotel & Spa</p>
              </div>
            </div>
            {onClose && (
              <button
                onClick={onClose}
                className="text-primary/60 hover:text-primary transition p-2 hover:bg-white/50 rounded-full close-btn"
                title="Close"
              >
                <FaTimes className="text-2xl" />
              </button>
            )}
          </div>
          <div className="flex items-center gap-4 text-sm flex-wrap action-buttons">
            <div className="flex items-center gap-2 px-5 py-2.5 bg-green-50 border-2 border-green-200 text-green-700 rounded-lg email-badge">
              <FaEnvelope />
              <span>Invoice sent to email</span>
            </div>
          </div>
        </div>

        {/* Invoice Content - Scrollable */}
        <div className="p-8 overflow-y-auto flex-1">
          {/* Invoice Details */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div className="bg-[#f7f4ef] p-6 rounded-lg border border-[#eadfcf]">
              <h3 className="font-semibold text-primary mb-4 text-lg flex items-center gap-2">
                <span className="w-1 h-6 bg-accent block"></span>
                Bill To:
              </h3>
              <div className="space-y-2">
                <p className="text-primary font-semibold text-lg">
                  {booking.userName || booking.name}
                </p>
                <p className="text-primary/70">
                  {booking.userEmail || booking.email}
                </p>
                {booking.phone && (
                  <p className="text-primary/70">{booking.phone}</p>
                )}
              </div>
            </div>
            <div className="bg-[#f7f4ef] p-6 rounded-lg border border-[#eadfcf] text-right md:text-left">
              <h3 className="font-semibold text-primary mb-4 text-lg flex items-center gap-2 md:justify-end">
                <span className="w-1 h-6 bg-accent block"></span>
                Invoice Details:
              </h3>
              <div className="space-y-2">
                <p className="text-primary/70">
                  <span className="font-semibold">Invoice #:</span>{" "}
                  <span className="font-mono">
                    {booking.invoiceNumber || booking.confirmationCode}
                  </span>
                </p>
                {booking.paymentCode && (
                  <p className="text-primary/70">
                    <span className="font-semibold">Payment Code:</span>{" "}
                    <span className="font-mono">{booking.paymentCode}</span>
                  </p>
                )}
                <p className="text-primary/70">
                  <span className="font-semibold">Date:</span>{" "}
                  {formatDate(booking.paidAt || booking.createdAt)}
                </p>
                <p className="text-primary/70">
                  <span className="font-semibold">Payment:</span>{" "}
                  {booking.paymentMethod || "QR Code"}
                </p>
                {booking.status && (
                  <p className="text-primary/70">
                    <span className="font-semibold">Status:</span>{" "}
                    <span className="capitalize">{booking.status}</span>
                  </p>
                )}
                {booking.roomId && (
                  <p className="text-primary/70">
                    <span className="font-semibold">Room ID:</span>{" "}
                    {booking.roomId}
                  </p>
                )}
              </div>
            </div>
          </div>

          {/* Booking Type */}
          <div className="mb-8">
            <h3 className="font-primary text-2xl mb-6 text-primary border-b-2 border-accent/30 pb-3">
              {getBookingType()}
            </h3>
            <div className="bg-gradient-to-r from-accent/10 to-accent/5 p-6 rounded-lg border-2 border-accent/20">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p className="text-sm text-primary/60 mb-1">
                    Confirmation Code
                  </p>
                  <p className="font-mono font-semibold text-lg text-primary">
                    {booking.confirmationCode}
                  </p>
                </div>
                {booking.paymentCode && (
                  <div>
                    <p className="text-sm text-primary/60 mb-1">Payment Code</p>
                    <p className="font-mono font-semibold text-lg text-primary">
                      {booking.paymentCode}
                    </p>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Booking Details */}
          <div className="mb-8">
            {booking.type === "room" && (
              <>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Room
                    </p>
                    <p className="font-semibold text-lg text-primary">
                      {booking.roomName}
                    </p>
                  </div>
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Check-in
                    </p>
                    <p className="font-semibold text-lg text-primary">
                      {formatDate(booking.checkIn)}
                    </p>
                  </div>
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Check-out
                    </p>
                    <p className="font-semibold text-lg text-primary">
                      {formatDate(booking.checkOut)}
                    </p>
                  </div>
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Nights
                    </p>
                    <p className="font-semibold text-lg text-accent">
                      {booking.totalNights || 1}
                    </p>
                  </div>
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf] col-span-2">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Guests
                    </p>
                    <p className="font-semibold text-lg text-primary">
                      {booking.adults || 1} Adult(s)
                      {booking.kids ? `, ${booking.kids} Kid(s)` : ""}
                    </p>
                  </div>
                </div>
                {booking.pricingBreakdown &&
                  booking.pricingBreakdown.length > 0 && (
                    <div className="mt-6">
                      <h4 className="font-semibold text-lg mb-4 text-primary border-b border-[#eadfcf] pb-2">
                        Pricing Breakdown:
                      </h4>
                      <div className="space-y-2 text-sm max-h-60 overflow-y-auto border-2 border-[#eadfcf] rounded-lg p-4 bg-white">
                        {booking.pricingBreakdown.map((day, idx) => (
                          <div
                            key={idx}
                            className="flex justify-between items-center text-primary/70 py-2 border-b border-[#eadfcf]/50 last:border-0"
                          >
                            <div className="flex-1">
                              <span className="font-medium">
                                {formatDate(day.date)}
                              </span>
                              {day.label && (
                                <span className="text-primary/50 text-xs ml-2">
                                  ({day.label})
                                </span>
                              )}
                            </div>
                            <span className="font-semibold text-accent text-base">
                              ${day.price || day.rate || 0}
                            </span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                {(booking.note || booking.specialRequests) && (
                  <div className="mt-6">
                    <h4 className="font-semibold text-lg mb-4 text-primary border-b border-[#eadfcf] pb-2">
                      Special Requests / Notes:
                    </h4>
                    <div className="bg-[#f7f4ef] p-4 rounded-lg border border-[#eadfcf]">
                      <p className="text-primary/80 whitespace-pre-wrap">
                        {booking.note || booking.specialRequests}
                      </p>
                    </div>
                  </div>
                )}
              </>
            )}

            {booking.type === "restaurant" && (
              <>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Date & Time
                    </p>
                    <p className="font-semibold text-lg text-primary">
                      {formatDateTime(booking.date)}
                    </p>
                  </div>
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Number of Guests
                    </p>
                    <p className="font-semibold text-lg text-primary">
                      {booking.guests || 1} Guest(s)
                    </p>
                  </div>
                  {booking.serviceName && (
                    <div className="bg-white p-4 rounded-lg border border-[#eadfcf] md:col-span-2">
                      <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                        Service
                      </p>
                      <p className="font-semibold text-lg text-primary">
                        {booking.serviceName}
                      </p>
                    </div>
                  )}
                </div>
                {booking.specialRequests && (
                  <div className="mt-4">
                    <h4 className="font-semibold text-lg mb-4 text-primary border-b border-[#eadfcf] pb-2">
                      Special Requests:
                    </h4>
                    <div className="bg-[#f7f4ef] p-4 rounded-lg border border-[#eadfcf]">
                      <p className="text-primary/80 whitespace-pre-wrap">
                        {booking.specialRequests}
                      </p>
                    </div>
                  </div>
                )}
              </>
            )}

            {booking.type === "spa" && (
              <>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Date & Time
                    </p>
                    <p className="font-semibold text-lg text-primary">
                      {formatDateTime(booking.date)}
                    </p>
                  </div>
                  <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                    <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                      Service
                    </p>
                    <p className="font-semibold text-lg text-primary">
                      {booking.serviceName || booking.service}
                    </p>
                  </div>
                  {booking.duration && (
                    <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                      <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                        Duration
                      </p>
                      <p className="font-semibold text-lg text-primary">
                        {booking.duration}
                      </p>
                    </div>
                  )}
                  {booking.therapist && (
                    <div className="bg-white p-4 rounded-lg border border-[#eadfcf]">
                      <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                        Therapist
                      </p>
                      <p className="font-semibold text-lg text-primary">
                        {booking.therapist}
                      </p>
                    </div>
                  )}
                </div>
                {booking.specialRequests && (
                  <div className="mt-4">
                    <h4 className="font-semibold text-lg mb-4 text-primary border-b border-[#eadfcf] pb-2">
                      Special Requests:
                    </h4>
                    <div className="bg-[#f7f4ef] p-4 rounded-lg border border-[#eadfcf]">
                      <p className="text-primary/80 whitespace-pre-wrap">
                        {booking.specialRequests}
                      </p>
                    </div>
                  </div>
                )}
              </>
            )}
          </div>

          {/* Total */}
          <div className="bg-gradient-to-r from-accent/10 to-accent/5 border-2 border-accent/20 rounded-lg p-6 mt-8">
            <div className="space-y-3">
              <div className="flex justify-between items-center">
                <span className="text-primary/70 text-base">Subtotal:</span>
                <span className="font-semibold text-lg text-primary">
                  ${booking.totalPrice || booking.price}
                </span>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-primary/70 text-base">Tax (10%):</span>
                <span className="font-semibold text-lg text-primary">
                  ${((booking.totalPrice || booking.price) * 0.1).toFixed(2)}
                </span>
              </div>
              <div className="border-t-2 border-accent/30 pt-3 mt-3">
                <div className="flex justify-between items-center">
                  <span className="text-2xl font-primary text-primary">
                    Total:
                  </span>
                  <span className="text-3xl font-primary text-accent font-bold">
                    ${((booking.totalPrice || booking.price) * 1.1).toFixed(2)}
                  </span>
                </div>
              </div>
            </div>
          </div>

          {/* Footer */}
          <div className="mt-8 pt-6 border-t-2 border-[#eadfcf] text-center">
            <p className="text-lg font-semibold text-primary mb-4">
              Thank you for your booking!
            </p>
            <div className="bg-[#f7f4ef] p-4 rounded-lg border border-[#eadfcf]">
              <p className="text-sm text-primary/70 font-medium mb-1">
                12 Tran Hung Dao, Hoan Kiem, Ha Noi
              </p>
              <p className="text-sm text-primary/60">
                Email: booking@adinahotel.com | Phone: +84 24 1234 5678
              </p>
            </div>
          </div>
        </div>

        {/* Close Button at Bottom */}
        {onClose && (
          <div className="p-4 border-t border-[#eadfcf] flex-shrink-0 bg-white">
            <button
              onClick={onClose}
              className="w-full btn btn-primary uppercase tracking-[2px]"
            >
              Close Invoice
            </button>
          </div>
        )}
      </div>
    </div>
  );
};

export default Invoice;

--- END FILE: src\components\Invoice.jsx ---

--- START FILE: src\components\KidsDropdown.jsx ---
import { useRoomContext } from '../context/RoomContext';
import { BsChevronDown } from 'react-icons/bs';
import { kidsList } from '../constants/data';
import { Menu } from '@headlessui/react';


const KidsDropdown = () => {

  const { kids, setKids } = useRoomContext();


  return (
    <Menu as='div' className='w-full h-full bg-white relative'>


      <Menu.Button className='w-full h-full flex items-center justify-between px-8 hover:bg-accent/5 transition'>
        {kids === '0 Kid' ? 'No Kid' : kids}
        <BsChevronDown className='text-base text-accent-hover' />
      </Menu.Button>


      <Menu.Items as='ul' className='bg-white absolute w-full flex flex-col z-50 mt-1 shadow-lg border border-[#eadfcf] max-h-60 overflow-y-auto'>
        {
          kidsList.map(({ name }, idx) =>
            <Menu.Item
              as='li'
              key={idx}
              onClick={() => setKids(name)}
              className='border-b last-of-type:border-b-0 h-12 hover:bg-accent hover:text-white w-full flex items-center justify-center cursor-pointer transition px-4'
            >
              {name === '0 Kid' ? 'No Kid' : name}
            </Menu.Item>
          )
        }
      </Menu.Items>


    </Menu>
  );
};

export default KidsDropdown;

--- END FILE: src\components\KidsDropdown.jsx ---

--- START FILE: src\components\LanguageSwitcher.jsx ---
import { useLanguage } from '../context/LanguageContext';

const LanguageSwitcher = () => {
  const { language, setLanguage, t } = useLanguage();
  const options = [
    { code: 'en', label: t('languageSwitcher.english') },
    { code: 'vi', label: t('languageSwitcher.vietnamese') },
  ];

  return (
    <div className='flex items-center border border-current/20 rounded-full overflow-hidden text-xs uppercase tracking-[2px]'>
      {options.map((option) => (
        <button
          key={option.code}
          onClick={() => setLanguage(option.code)}
          className={`px-2 py-1 transition ${
            language === option.code ? 'bg-accent text-white' : 'bg-transparent'
          }`}
        >
          {option.label}
        </button>
      ))}
    </div>
  );
};

export default LanguageSwitcher;


--- END FILE: src\components\LanguageSwitcher.jsx ---

--- START FILE: src\components\NotificationContainer.jsx ---
import { useState, useEffect } from 'react';
import { FaCheckCircle, FaExclamationCircle, FaInfoCircle, FaTimesCircle, FaTimes } from 'react-icons/fa';
import { subscribeToNotifications, removeNotification } from '../utils/notifications';

const NotificationContainer = () => {
  const [notifications, setNotifications] = useState([]);

  useEffect(() => {
    const unsubscribe = subscribeToNotifications(setNotifications);
    return unsubscribe;
  }, []);

  const getIcon = (type) => {
    switch (type) {
      case 'success':
        return <FaCheckCircle className="text-green-500" />;
      case 'error':
        return <FaTimesCircle className="text-red-500" />;
      case 'warning':
        return <FaExclamationCircle className="text-yellow-500" />;
      case 'info':
      default:
        return <FaInfoCircle className="text-blue-500" />;
    }
  };

  const getStyles = (type) => {
    switch (type) {
      case 'success':
        return 'bg-green-50 border-green-200 text-green-800';
      case 'error':
        return 'bg-red-50 border-red-200 text-red-800';
      case 'warning':
        return 'bg-yellow-50 border-yellow-200 text-yellow-800';
      case 'info':
      default:
        return 'bg-blue-50 border-blue-200 text-blue-800';
    }
  };

  return (
    <div className="fixed top-4 right-4 z-[9999] space-y-2 max-w-md">
      {notifications.map((notification) => (
        <div
          key={notification.id}
          className={`flex items-center gap-3 p-4 border rounded-lg shadow-lg animate-in fade-in slide-in-from-top-2 ${getStyles(notification.type)}`}
        >
          <div className="flex-shrink-0 text-xl">
            {getIcon(notification.type)}
          </div>
          <div className="flex-1">
            <p className="font-semibold text-sm">{notification.message}</p>
          </div>
          <button
            onClick={() => removeNotification(notification.id)}
            className="flex-shrink-0 text-lg hover:opacity-70 transition-opacity"
          >
            <FaTimes />
          </button>
        </div>
      ))}
    </div>
  );
};

export default NotificationContainer;

--- END FILE: src\components\NotificationContainer.jsx ---

--- START FILE: src\components\PageNotFound.jsx ---
import React from 'react'

const PageNotFound = () => {
  return (
    <div>404 Page Not Found</div>
  )
}

export default PageNotFound
--- END FILE: src\components\PageNotFound.jsx ---

--- START FILE: src\components\Pagination.jsx ---
import { FaChevronLeft, FaChevronRight } from "react-icons/fa";

const Pagination = ({
  currentPage,
  totalPages,
  onPageChange,
  itemsPerPage,
  totalItems,
}) => {
  if (totalPages <= 1) return null;

  // Generate page numbers to display
  const getPageNumbers = () => {
    const pages = [];
    const maxPagesToShow = 7;
    const halfRange = Math.floor(maxPagesToShow / 2);

    let startPage = Math.max(1, currentPage - halfRange);
    let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);

    if (endPage - startPage < maxPagesToShow - 1) {
      startPage = Math.max(1, endPage - maxPagesToShow + 1);
    }

    if (startPage > 1) {
      pages.push(1);
      if (startPage > 2) {
        pages.push("...");
      }
    }

    for (let i = startPage; i <= endPage; i++) {
      pages.push(i);
    }

    if (endPage < totalPages) {
      if (endPage < totalPages - 1) {
        pages.push("...");
      }
      pages.push(totalPages);
    }

    return pages;
  };

  const pageNumbers = getPageNumbers();
  const startItem = (currentPage - 1) * itemsPerPage + 1;
  const endItem = Math.min(currentPage * itemsPerPage, totalItems);

  return (
    <div className="py-12 px-6 lg:px-0">
      <div className="flex flex-col items-center gap-8">
        {/* Info */}
        <div className="text-center">
          <p className="text-sm text-primary/70">
            Showing{" "}
            <span className="font-semibold text-primary">{startItem}</span> to{" "}
            <span className="font-semibold text-primary">{endItem}</span> of{" "}
            <span className="font-semibold text-primary">{totalItems}</span>{" "}
            rooms
          </p>
        </div>

        {/* Pagination Controls */}
        <div className="flex items-center justify-center gap-2 flex-wrap">
          {/* Previous Button */}
          <button
            onClick={() => onPageChange(Math.max(1, currentPage - 1))}
            disabled={currentPage === 1}
            className="p-2.5 rounded-full border border-[#eadfcf] text-primary transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-accent hover:text-white hover:border-accent disabled:hover:bg-white disabled:hover:border-[#eadfcf] disabled:hover:text-primary"
            aria-label="Previous page"
          >
            <FaChevronLeft size={16} />
          </button>

          {/* Page Numbers */}
          <div className="flex items-center gap-1 flex-wrap justify-center">
            {pageNumbers.map((page, index) =>
              page === "..." ? (
                <span
                  key={`ellipsis-${index}`}
                  className="px-2 text-primary/50 font-tertiary"
                >
                  ...
                </span>
              ) : (
                <button
                  key={page}
                  onClick={() => onPageChange(page)}
                  className={`min-w-[40px] h-[40px] rounded-full font-tertiary font-semibold text-sm transition-all duration-300 ${
                    currentPage === page
                      ? "bg-accent text-white border border-accent shadow-lg scale-105"
                      : "border border-[#eadfcf] text-primary hover:bg-accent/10 hover:border-accent"
                  }`}
                  aria-label={`Go to page ${page}`}
                  aria-current={currentPage === page ? "page" : undefined}
                >
                  {page}
                </button>
              )
            )}
          </div>

          {/* Next Button */}
          <button
            onClick={() => onPageChange(Math.min(totalPages, currentPage + 1))}
            disabled={currentPage === totalPages}
            className="p-2.5 rounded-full border border-[#eadfcf] text-primary transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-accent hover:text-white hover:border-accent disabled:hover:bg-white disabled:hover:border-[#eadfcf] disabled:hover:text-primary"
            aria-label="Next page"
          >
            <FaChevronRight size={16} />
          </button>
        </div>

        {/* Page Info */}
        <div className="text-center text-xs text-primary/60 uppercase tracking-[2px]">
          Page <span className="font-semibold">{currentPage}</span> of{" "}
          <span className="font-semibold">{totalPages}</span>
        </div>
      </div>
    </div>
  );
};

export default Pagination;

--- END FILE: src\components\Pagination.jsx ---

--- START FILE: src\components\ProtectedRoute.jsx ---
import { Navigate, useLocation } from 'react-router-dom';
import { useAuth } from '../context/SimpleAuthContext';
import { FaSpinner } from 'react-icons/fa';

const ProtectedRoute = ({ children, requireAdmin = false, disallowAdmin = false, redirectTo }) => {
  const { isAuthenticated, isAdmin, loading } = useAuth();
  const location = useLocation();
  const fallbackLogin = redirectTo || (requireAdmin ? '/login' : '/login');

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center">
          <FaSpinner className="animate-spin text-4xl text-accent mx-auto mb-4" />
          <p className="text-gray-600">Checking authentication...</p>
        </div>
      </div>
    );
  }

  // Check if user is authenticated
  if (!isAuthenticated()) {
    return <Navigate to={fallbackLogin} state={{ from: location }} replace />;
  }

  // Admin-only route check
  if (requireAdmin && !isAdmin()) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center max-w-md p-8">
          <h1 className="h2 text-primary mb-4">Access Denied</h1>
          <p className="text-gray-600 mb-6">
            Admin access required.
          </p>
          <a href="/" className="btn btn-primary btn-sm">
            Go Home
          </a>
        </div>
      </div>
    );
  }

  // Prevent admin from accessing user pages if needed
  if (disallowAdmin && isAdmin()) {
    return <Navigate to="/admin" replace />;
  }

  return children;
};

export default ProtectedRoute;
--- END FILE: src\components\ProtectedRoute.jsx ---

--- START FILE: src\components\QRPayment.jsx ---
import { useState, useEffect } from 'react';
import { QRCodeSVG } from 'qrcode.react';
import { FaQrcode, FaClock, FaCheckCircle, FaTimes } from 'react-icons/fa';

const QRPayment = ({ 
  bookingData, 
  onPaymentSuccess, 
  onClose,
  type = 'room' // 'room', 'restaurant', 'spa'
}) => {
  const [timeLeft, setTimeLeft] = useState(15 * 60); // 15 minutes in seconds
  const [isPaid, setIsPaid] = useState(false);
  const [paymentCode] = useState(() => {
    // Generate a unique payment code
    return `PAY-${Date.now()}-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
  });

  useEffect(() => {
    if (isPaid || timeLeft <= 0) return;

    const timer = setInterval(() => {
      setTimeLeft((prev) => {
        if (prev <= 1) {
          clearInterval(timer);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(timer);
  }, [isPaid, timeLeft]);

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  const handleSimulatePayment = () => {
    setIsPaid(true);
    setTimeout(() => {
      onPaymentSuccess({
        ...bookingData,
        paymentCode,
        paidAt: new Date().toISOString(),
        paymentMethod: 'QR Code',
      });
    }, 1500);
  };

  const qrData = JSON.stringify({
    paymentCode,
    amount: bookingData.totalPrice || bookingData.price,
    type,
    bookingId: bookingData.id || bookingData.confirmationCode,
    timestamp: new Date().toISOString(),
  });

  if (isPaid) {
    return (
      <div className='fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4'>
        <div className='bg-white rounded-lg shadow-xl max-w-md w-full p-8 text-center'>
          <div className='mb-6'>
            <FaCheckCircle className='text-6xl text-green-500 mx-auto mb-4' />
            <h2 className='text-2xl font-primary mb-2'>Payment Successful!</h2>
            <p className='text-primary/70'>Your booking has been confirmed.</p>
          </div>
          <button
            onClick={onClose}
            className='btn btn-primary w-full'
          >
            Close
          </button>
        </div>
      </div>
    );
  }

  if (timeLeft <= 0) {
    return (
      <div className='fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4'>
        <div className='bg-white rounded-lg shadow-xl max-w-md w-full p-8 text-center'>
          <div className='mb-6'>
            <FaTimes className='text-6xl text-red-500 mx-auto mb-4' />
            <h2 className='text-2xl font-primary mb-2'>Payment Expired</h2>
            <p className='text-primary/70'>The payment code has expired. Please try again.</p>
          </div>
          <button
            onClick={onClose}
            className='btn btn-primary w-full'
          >
            Close
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className='fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4'>
      <div className='bg-white rounded-lg shadow-xl max-w-md w-full p-8'>
        <div className='flex items-center justify-between mb-6'>
          <h2 className='text-2xl font-primary'>Payment via QR Code</h2>
          <button
            onClick={onClose}
            className='text-primary/60 hover:text-primary transition'
          >
            <FaTimes className='text-xl' />
          </button>
        </div>

        <div className='text-center mb-6'>
          <div className='bg-white p-6 rounded-lg border-2 border-dashed border-accent/30 inline-block mb-4'>
            <QRCodeSVG
              value={qrData}
              size={200}
              level='H'
              includeMargin={true}
            />
          </div>
          <p className='text-sm text-primary/60 mb-2'>Scan this QR code to pay</p>
          <div className='flex items-center justify-center gap-2 text-accent font-semibold mb-4'>
            <FaClock />
            <span>Time remaining: {formatTime(timeLeft)}</span>
          </div>
        </div>

        <div className='bg-accent/10 p-4 rounded-lg mb-6'>
          <div className='flex justify-between items-center mb-2'>
            <span className='text-primary/70'>Payment Code:</span>
            <span className='font-mono font-semibold'>{paymentCode}</span>
          </div>
          <div className='flex justify-between items-center mb-2'>
            <span className='text-primary/70'>Amount:</span>
            <span className='font-primary text-xl text-accent'>
              ${bookingData.totalPrice || bookingData.price}
            </span>
          </div>
          {bookingData.confirmationCode && (
            <div className='flex justify-between items-center'>
              <span className='text-primary/70'>Booking Code:</span>
              <span className='font-mono font-semibold'>{bookingData.confirmationCode}</span>
            </div>
          )}
        </div>

        <div className='space-y-3'>
          <button
            onClick={handleSimulatePayment}
            className='btn btn-primary w-full'
          >
            Simulate Payment (Demo)
          </button>
          <button
            onClick={onClose}
            className='btn btn-outline w-full'
          >
            Cancel
          </button>
        </div>

        <p className='text-xs text-primary/50 text-center mt-4'>
          This is a demo payment. In production, users would scan the QR code with their payment app.
        </p>
      </div>
    </div>
  );
};

export default QRPayment;

--- END FILE: src\components\QRPayment.jsx ---

--- START FILE: src\components\QRPaymentModal.jsx ---
import { useState } from "react";
import { FaTimes, FaCheck, FaCopy } from "react-icons/fa";

const QRPaymentModal = ({ booking, onConfirmPayment, onClose }) => {
  const [paymentConfirmed, setPaymentConfirmed] = useState(false);
  const [copied, setCopied] = useState(false);

  const handleCopyCode = () => {
    navigator.clipboard.writeText(booking.confirmationCode);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  if (!booking) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 space-y-6">
        {!paymentConfirmed ? (
          <>
            {/* Header */}
            <div className="flex items-center justify-between">
              <h3 className="text-2xl font-primary text-primary">QR Payment</h3>
              <button
                onClick={onClose}
                className="text-primary/60 hover:text-primary p-1 hover:bg-gray-100 rounded-full transition"
              >
                <FaTimes size={20} />
              </button>
            </div>

            {/* Booking Summary */}
            <div className="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg space-y-2 text-sm">
              <p className="text-primary/70">
                <span className="font-semibold">Room:</span> {booking.roomName}
              </p>
              <p className="text-primary/70">
                <span className="font-semibold">Check-in:</span>{" "}
                {booking.checkIn}
              </p>
              <p className="text-primary/70">
                <span className="font-semibold">Check-out:</span>{" "}
                {booking.checkOut}
              </p>
              <p className="text-primary/70">
                <span className="font-semibold">Guests:</span> {booking.adults}{" "}
                adult(s){booking.kids ? `, ${booking.kids} kid(s)` : ""}
              </p>
              <div className="pt-2 border-t border-blue-200 mt-2 flex justify-between">
                <span className="font-semibold">Total Amount:</span>
                <span className="text-lg font-bold text-blue-600">
                  ${booking.totalPrice}
                </span>
              </div>
            </div>

            {/* QR Code Display */}
            <div className="space-y-4">
              <div className="bg-gray-100 p-6 rounded-lg text-center space-y-3">
                <div className="text-sm text-primary/70 mb-4">
                  Scan this QR code to complete payment:
                </div>
                {/* Placeholder for QR Code - in production, use a QR code library like qrcode.react */}
                <div className="w-48 h-48 mx-auto bg-white border-4 border-gray-300 rounded-lg flex items-center justify-center">
                  <div className="text-center">
                    <div className="text-5xl mb-2">📱</div>
                    <p className="text-xs text-gray-500">QR Code</p>
                    <p className="text-xs text-gray-400 mt-1">
                      Amount: ${booking.totalPrice}
                    </p>
                  </div>
                </div>
              </div>

              {/* Confirmation Code */}
              <div className="bg-gray-50 p-4 rounded-lg">
                <p className="text-xs text-primary/60 mb-2 uppercase tracking-wide">
                  Confirmation Code
                </p>
                <div className="flex items-center gap-2">
                  <input
                    type="text"
                    value={booking.confirmationCode}
                    readOnly
                    className="flex-1 px-3 py-2 bg-white border border-gray-200 rounded font-mono text-sm focus:outline-none"
                  />
                  <button
                    onClick={handleCopyCode}
                    className="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition flex items-center gap-1"
                    title="Copy code"
                  >
                    <FaCopy size={14} />
                  </button>
                </div>
                {copied && (
                  <p className="text-xs text-green-600 mt-1">Copied!</p>
                )}
              </div>
            </div>

            {/* Instructions */}
            <div className="bg-yellow-50 border border-yellow-200 p-4 rounded-lg text-sm text-primary/70 space-y-2">
              <p className="font-semibold text-yellow-800">
                Payment Instructions:
              </p>
              <ol className="list-decimal list-inside space-y-1 text-xs">
                <li>Scan the QR code with your phone</li>
                <li>Complete the payment (${booking.totalPrice})</li>
                <li>Payment will be verified automatically</li>
                <li>
                  Booking confirmation will be sent to {booking.userEmail}
                </li>
              </ol>
            </div>

            {/* Payment Confirmed Button */}
            <button
              onClick={() => setPaymentConfirmed(true)}
              className="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold"
            >
              I have paid via QR code
            </button>

            <button
              onClick={onClose}
              className="w-full py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition text-sm"
            >
              Cancel
            </button>
          </>
        ) : (
          <>
            {/* Payment Confirmation */}
            <div className="space-y-6">
              <div className="flex flex-col items-center gap-4">
                <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center">
                  <FaCheck className="text-2xl text-green-600" />
                </div>
                <h3 className="text-2xl font-primary text-green-600">
                  Payment Confirmed!
                </h3>
              </div>

              <div className="bg-green-50 p-4 rounded-lg space-y-2 text-sm">
                <p className="text-primary/70">
                  <span className="font-semibold">Confirmation Code:</span>{" "}
                  {booking.confirmationCode}
                </p>
                <p className="text-primary/70">
                  <span className="font-semibold">Amount Paid:</span> $
                  {booking.totalPrice}
                </p>
                <p className="text-primary/70">
                  <span className="font-semibold">Status:</span>{" "}
                  <span className="text-green-600 font-semibold">
                    Confirmed
                  </span>
                </p>
              </div>

              <div className="bg-blue-50 border border-blue-200 p-4 rounded-lg text-sm text-primary/70 space-y-2">
                <p className="font-semibold">What's next?</p>
                <ul className="list-disc list-inside space-y-1 text-xs">
                  <li>Confirmation email sent to {booking.userEmail}</li>
                  <li>Booking will appear in your account</li>
                  <li>Check-in details will be sent 24 hours before arrival</li>
                </ul>
              </div>

              <button
                onClick={() => onConfirmPayment(booking)}
                className="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold"
              >
                Complete Booking
              </button>
            </div>
          </>
        )}
      </div>
    </div>
  );
};

export default QRPaymentModal;

--- END FILE: src\components\QRPaymentModal.jsx ---

--- START FILE: src\components\Room.jsx ---
import { BsArrowsFullscreen, BsPeople } from "react-icons/bs";
import { FaStar } from "react-icons/fa";
import { Link } from "react-router-dom";
import { getImageUrlsByRoomType } from "../utils/supabaseStorageUrls";

const STORAGE_URL = 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms';
const PLACEHOLDER_IMG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3Crect fill='%23ddd' width='400' height='300'/%3E%3Ctext x='50%' y='50%' font-size='18' fill='%23999' text-anchor='middle' dy='.3em'%3ELoading image...%3C/text%3E%3C/svg%3E";

/**
 * Generate fallback image URL based on room type or number
 */
const getFallbackImageUrl = (roomNo, type) => {
  if (!type) {
    // Try to extract number from roomNo (e.g., "STD-01" -> 1, "DLX-05" -> 5)
    if (roomNo) {
      const match = roomNo.match(/\d+/);
      if (match) {
        const imgIndex = parseInt(match[0]) % 8 || 1;
        return `${STORAGE_URL}/${imgIndex === 0 ? 8 : imgIndex}-lg.png`;
      }
    }
    return PLACEHOLDER_IMG;
  }
  
  // Use room type to get image URL
  const imageUrls = getImageUrlsByRoomType(type);
  return imageUrls?.image_lg_url || imageUrls?.image_url || PLACEHOLDER_IMG;
};

const Room = ({ room }) => {
  if (!room) return null;

  const {
    id,
    roomNo,
    name,
    image,
    size,
    maxPerson,
    description,
    price,
    type,
    reviews,
  } = room;

  // Use Supabase image URL if available, otherwise use fallback
  const displayImage = image || getFallbackImageUrl(roomNo, type);

  // Calculate average rating from reviews
  const averageRating = reviews && reviews.length > 0
    ? Math.round(reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length)
    : 4;

  return (
    <div className="bg-white shadow-2xl min-h-[500px] group relative">
      <div className="overflow-hidden">
        <img
          src={displayImage}
          alt={name || "room"}
          className="group-hover:scale-110 transition-all duration-300 w-full object-cover h-64"
          loading="lazy"
          onError={(e) => {
            // If error occurs, try fallback URL first, then use placeholder
            if (e.target.src !== PLACEHOLDER_IMG && e.target.src !== getFallbackImageUrl(roomNo, type)) {
              console.warn('Image failed to load, trying fallback:', displayImage);
              e.target.src = getFallbackImageUrl(roomNo, type);
            } else {
              console.warn('All image sources failed, using placeholder');
              e.target.src = PLACEHOLDER_IMG;
            }
          }}
        />
        {type && (
          <div className="absolute top-4 right-4 bg-teal-600 text-white px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-[1px]">
            {type}
          </div>
        )}
      </div>

      <div className="bg-white shadow-lg max-w-[300px] mx-auto h-[60px] -translate-y-1/2 flex justify-center items-center uppercase font-tertiary tracking-[1px] font-semibold text-base">
        <div className="flex justify-between w-[80%]">
          <div className="flex items-center gap-x-2">
            <div className="text-accent">
              <BsArrowsFullscreen className="text-[15px]" />
            </div>
            <div className="flex gap-x-1">
              <div>Size</div>
              <div>{size || 0}m²</div>
            </div>
          </div>

          <div className="flex items-center gap-x-2">
            <div className="text-accent">
              <BsPeople className="text-[18px]" />
            </div>
            <div className="flex gap-x-1">
              <div>Max people</div>
              <div>{maxPerson || 2}</div>
            </div>
          </div>
        </div>
      </div>

      <div className="text-center px-6">
        <Link to={`/room/${roomNo || id}`}>
          <h3 className="h3">{name || 'Standard Room'}</h3>
        </Link>

        {type && (
          <p className="text-xs uppercase tracking-[3px] text-primary/60 mb-2">
            {type} Room
          </p>
        )}
        <p className="max-w-[300px] mx-auto mb-3 lg:mb-6">
          {description ? description.slice(0, 56) : 'Comfortable room with modern amenities'}..
        </p>
        <div className="flex justify-center items-center gap-2 mb-4 text-sm text-primary/80">
          <div className="flex items-center gap-1 text-accent">
            {[...Array(5)].map((_, index) => (
              <FaStar
                key={index}
                className={`${
                  index < averageRating ? "text-accent" : "text-accent/30"
                }`}
              />
            ))}
          </div>
          <span>{averageRating}.0 • {reviews?.length || 0} reviews</span>
        </div>
      </div>

      <Link
        to={`/room/${roomNo || id}`}
        className="btn btn-secondary btn-sm max-w-[240px] mx-auto duration-300"
      >
        Book now from ${(price || 0).toFixed(2)}
      </Link>
    </div>
  );
};

export default Room;
--- END FILE: src\components\Room.jsx ---

--- START FILE: src\components\Rooms.jsx ---
import { useRoomContext } from "../context/RoomContext";
import { SpinnerDotted } from "spinners-react";
import { Room, Pagination } from ".";
import { useState, useMemo } from "react";



const Rooms = () => {
  const { rooms, loading } = useRoomContext();
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 12;

  const { paginatedRooms, totalPages } = useMemo(() => {
    const validRooms = Array.isArray(rooms) ? rooms : [];
    const total = Math.ceil(validRooms.length / itemsPerPage);
    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    return {
      paginatedRooms: validRooms.slice(start, end),
      totalPages: total || 1,
    };
  }, [rooms, currentPage]);

  const handlePageChange = (page) => {
    setCurrentPage(page);
    const roomsSection = document.getElementById("rooms-section");
    if (roomsSection) {
      roomsSection.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  };

  if (loading) {
    return (
      <section id="rooms-section" className="py-24">
        <div className="h-screen w-full fixed bottom-0 top-0 bg-black/80 z-50 grid place-items-center">
          <SpinnerDotted />
        </div>
      </section>
    );
  }

  return (
    <section id="rooms-section" className="py-24">
      <div className="container mx-auto lg:px-0">
        <div className="text-center">
          <p className="font-tertiary uppercase text-[15px] tracking-[6px]">
            Hotel & Spa Adina
          </p>
          <h2 className="font-primary text-[45px] mb-6">Room & Suites</h2>
        </div>

        {!paginatedRooms || paginatedRooms.length === 0 ? (
          <div className="text-center py-16 text-primary/70">
            No rooms match these preferences yet. Try adjusting your filters and
            search again.
          </div>
        ) : (
          <>
            <div className="grid grid-cols-1 max-w-sm mx-auto gap-[30px] lg:grid-cols-3 lg:max-w-none lg:mx-0">
              {paginatedRooms.map((room) => (
                <Room key={room.id} room={room} />
              ))}
            </div>

            {totalPages > 1 && (
              <Pagination
                currentPage={currentPage}
                totalPages={totalPages}
                onPageChange={handlePageChange}
                itemsPerPage={itemsPerPage}
                totalItems={Array.isArray(rooms) ? rooms.length : 0}
              />
            )}
          </>
        )}
      </div>
    </section>
  );
};

export default Rooms;
--- END FILE: src\components\Rooms.jsx ---

--- START FILE: src\components\RoomTypeSelector.jsx ---
import { useRoomContext } from "../context/RoomContext";
import { useMemo } from "react";

const RoomTypeSelector = () => {
  const { allRooms, selectedCategory, updateCategory } = useRoomContext();

  // Derive room types from actual rooms in Supabase
  const roomTypes = useMemo(() => {
    const typeMap = new Map();
    allRooms.forEach((room) => {
      if (room.type && !typeMap.has(room.type)) {
        typeMap.set(room.type, {
          id: room.category,
          code: room.type,
          name: room.type === 'STD' ? 'Standard' : 
                room.type === 'DLX' ? 'Deluxe' :
                room.type === 'SUI' ? 'Suite' :
                room.type === 'PEN' ? 'Penthouse' :
                room.type === 'CMB' ? 'Combo Package' :
                room.type,
        });
      }
    });
    return Array.from(typeMap.values()).sort((a, b) => a.code.localeCompare(b.code));
  }, [allRooms]);

  return (
    <div className="flex flex-col justify-center h-full px-4 lg:px-3 bg-white">
      <label className="text-xs uppercase tracking-[1px] text-primary/60 mb-2 lg:mb-1">
        Room Type
      </label>
      <select
        value={selectedCategory || ""}
        onChange={(e) => updateCategory(e.target.value || null)}
        className="w-full border-0 outline-none bg-white text-sm text-primary font-medium cursor-pointer"
      >
        <option value="">All Rooms</option>
        {roomTypes.map((roomType) => (
          <option key={roomType.id} value={roomType.id}>
            {roomType.name}
          </option>
        ))}
      </select>
    </div>
  );
};

export default RoomTypeSelector;

--- END FILE: src\components\RoomTypeSelector.jsx ---

--- START FILE: src\components\Toast.jsx ---
import { useEffect } from 'react';
import { FaCheckCircle, FaTimesCircle, FaInfoCircle, FaTimes } from 'react-icons/fa';

const Toast = ({ message, type = 'success', onClose, duration = 3000 }) => {
  useEffect(() => {
    if (duration > 0) {
      const timer = setTimeout(() => {
        onClose();
      }, duration);
      return () => clearTimeout(timer);
    }
  }, [duration, onClose]);

  const icons = {
    success: FaCheckCircle,
    error: FaTimesCircle,
    info: FaInfoCircle,
  };

  const colors = {
    success: 'bg-green-500',
    error: 'bg-red-500',
    info: 'bg-blue-500',
  };

  const Icon = icons[type] || FaInfoCircle;

  return (
    <div className={`fixed top-20 right-4 z-50 animate-slide-in-right ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 min-w-[300px] max-w-md`}>
      <Icon className="text-xl flex-shrink-0" />
      <p className="flex-1 font-medium">{message}</p>
      <button
        onClick={onClose}
        className="flex-shrink-0 hover:bg-white/20 rounded p-1 transition-colors"
      >
        <FaTimes />
      </button>
    </div>
  );
};

export default Toast;


--- END FILE: src\components\Toast.jsx ---

--- START FILE: src\constants\data.js ---
import { FaCheck } from "react-icons/fa";

// Supabase storage base (assets moved to Supabase)
const STORAGE_BASE_URL = "https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms";


export const adultsList = [
    { name: '1 Adult' },
    { name: '2 Adults' },
    { name: '3 Adults' },
    { name: '4 Adults' },
]


export const kidsList = [
    { name: '0 Kid' },
    { name: '1 Kid' },
    { name: '2 Kids' },
    { name: '3 Kids' },
    { name: '4 Kids' },
]


export const sliderData = [
  {
    id: 1,
    title: 'Your Luxury Hotel For Vacation',
    bg: `${STORAGE_BASE_URL}/img/heroSlider/1.jpg`,
    btnNext: 'See our rooms',
  },
  {
    id: 2,
    title: 'Feel Relax & Enjoy Your Luxuriousness',
    bg: `${STORAGE_BASE_URL}/img/heroSlider/2.jpg`,
    btnNext: 'See our rooms',
  },
  {
    id: 3,
    title: 'Your Luxury Hotel For Vacation',
    bg: `${STORAGE_BASE_URL}/img/heroSlider/3.jpg`,
    btnNext: 'See our rooms',
  },
];


export const hotelRules = [
    {
        rules: 'Check-in : 3:00 PM - 9:00 PM',
    },
    {
        rules: 'Check-out : 10:30 AM',
    },
    {
        rules: 'No Smoking',
    },
    {
        rules: 'No Pet',
    },
]
--- END FILE: src\constants\data.js ---

--- START FILE: src\constants\translations.js ---
const translations = {
  en: {
    header: {
      home: 'Home',
      rooms: 'Rooms',
      restaurant: 'Restaurant',
      spa: 'Spa',
      contact: 'Contact',
      dashboard: 'Dashboard',
      admin: 'Admin',
      signIn: 'Sign In',
      signOut: 'Sign Out',
      signUp: 'Sign Up',
      languageLabel: 'Language',
    },
    common: {
      bookRoom: 'Book a room',
      backHome: 'Back to homepage',
      manageBooking: 'Manage booking',
      confirmed: 'confirmed',
      bookingType: {
        room: 'Room',
        restaurant: 'Restaurant',
        spa: 'Spa',
      }
    },
    languageSwitcher: {
      english: 'EN',
      vietnamese: 'VI',
    },
    userDashboard: {
      tabs: {
        overview: 'Overview',
        bookings: 'Bookings',
        profile: 'Profile & Preferences',
      },
      filters: {
        upcoming: 'Upcoming',
        past: 'Past',
        cancelled: 'Cancelled',
      },
      welcomeTitle: 'Your private Maison awaits,',
      welcomeSubtitle: 'Track upcoming retreats, earn loyalty nights, and curate personal details for a seamless arrival. Our concierge is on standby 24/7.',
      loyaltyTier: 'Loyalty tier',
      loyaltyDetail: (nights) => `Next upgrade in ${nights} nights`,
      stats: {
        upcoming: 'Upcoming stays',
        completed: 'Completed stays',
        loyalty: 'Loyalty nights',
      },
      nextReservation: 'Next reservation',
      bookAnotherStay: 'Book another stay',
      noUpcoming: 'No upcoming stay yet. Start planning your next visit!',
      conciergePerks: 'Concierge perks',
      perks: {
        lateCheckout: {
          title: 'Late checkout',
          desc: 'Complimentary 1-hour grace period on availability',
        },
        spaCredit: {
          title: 'Spa credit',
          desc: '$25 spa credit for every 5 nights stayed',
        },
        conciergeChat: {
          title: 'Concierge chat',
          desc: 'Direct WhatsApp line for bespoke planning',
        },
      },
      nextButton: 'Manage booking',
      overviewGreeting: 'Welcome back',
    },
    adminSidebar: {
      panel: 'Admin Panel',
      home: 'Home',
      signOut: 'Sign Out',
    },
  },
  vi: {
    header: {
      home: 'Trang chủ',
      rooms: 'Phòng',
      restaurant: 'Nhà hàng',
      spa: 'Spa',
      contact: 'Liên hệ',
      dashboard: 'Tài khoản',
      admin: 'Quản trị',
      signIn: 'Đăng nhập',
      signOut: 'Đăng xuất',
      signUp: 'Đăng ký',
      languageLabel: 'Ngôn ngữ',
    },
    common: {
      bookRoom: 'Đặt phòng',
      backHome: 'Về trang chủ',
      manageBooking: 'Quản lý đặt phòng',
      confirmed: 'đã xác nhận',
      bookingType: {
        room: 'Phòng',
        restaurant: 'Nhà hàng',
        spa: 'Spa',
      }
    },
    languageSwitcher: {
      english: 'EN',
      vietnamese: 'VI',
    },
    userDashboard: {
      tabs: {
        overview: 'Tổng quan',
        bookings: 'Đặt phòng',
        profile: 'Hồ sơ & Tuỳ chỉnh',
      },
      filters: {
        upcoming: 'Sắp tới',
        past: 'Hoàn thành',
        cancelled: 'Đã huỷ',
      },
      welcomeTitle: 'Biệt thự riêng của bạn đã sẵn sàng,',
      welcomeSubtitle: 'Theo dõi kỳ nghỉ, tích luỹ đêm lưu trú và cập nhật thông tin cá nhân để chuyến đi thật mượt mà. Concierge phục vụ 24/7.',
      loyaltyTier: 'Hạng hội viên',
      loyaltyDetail: (nights) => `Còn ${nights} đêm để lên hạng`,
      stats: {
        upcoming: 'Chuyến đi sắp tới',
        completed: 'Chuyến đi đã xong',
        loyalty: 'Đêm tích luỹ',
      },
      nextReservation: 'Đặt phòng tiếp theo',
      bookAnotherStay: 'Đặt thêm kỳ nghỉ',
      noUpcoming: 'Bạn chưa có chuyến đi nào, hãy lên kế hoạch ngay!',
      conciergePerks: 'Đặc quyền concierge',
      perks: {
        lateCheckout: {
          title: 'Trả phòng muộn',
          desc: 'Miễn phí 1 giờ nếu còn phòng trống',
        },
        spaCredit: {
          title: 'Voucher spa',
          desc: 'Tặng $25 cho mỗi 5 đêm lưu trú',
        },
        conciergeChat: {
          title: 'Trò chuyện concierge',
          desc: 'Nhắn WhatsApp để được thiết kế trải nghiệm riêng',
        },
      },
      nextButton: 'Quản lý đặt phòng',
      overviewGreeting: 'Chào mừng trở lại',
    },
    adminSidebar: {
      panel: 'Bảng điều khiển',
      home: 'Trang chủ',
      signOut: 'Đăng xuất',
    },
  },
};

export default translations;


--- END FILE: src\constants\translations.js ---

--- START FILE: src\context\BookingContext.jsx ---
import { createContext, useContext, useState, useEffect } from 'react';
import { isBookingEmailConfigured, sendBookingConfirmationEmail } from '../utils/emailService';
import {
  createBooking, // for room bookings
  updateBookingStatus, // for room bookings
  createRestaurantBooking,
  updateRestaurantBookingStatus,
  createSpaBooking,
  updateSpaBookingStatus,
  fetchUserBookings,
  fetchUserRestaurantBookings,
  fetchUserSpaBookings,
} from '../services/bookingService';
import { useAuth } from '../context/SimpleAuthContext';

const BookingContext = createContext();

const createId = () => {
  if (typeof crypto !== 'undefined' && crypto.randomUUID) {
    return crypto.randomUUID();
  }
  return Date.now().toString();
};

export const BookingProvider = ({ children }) => {
  const { user } = useAuth();

  // These states now live only in memory for the current session.
  // Source of truth is Supabase; on login we load all bookings for that user.
  const [roomBookings, setRoomBookings] = useState([]);
  const [restaurantBookings, setRestaurantBookings] = useState([]);
  const [spaBookings, setSpaBookings] = useState([]);

  /**
   * Helpers: map rows from Supabase to the unified shape
   * that the rest of the app (UserDashboard, etc.) is already using.
   */
  const mapRoomBookingFromDb = (row) => ({
    id: row.id,
    confirmationCode: row.confirmation_code,
    roomId: row.room_id,
    roomName: row.room_name,
    userId: row.user_id,
    userEmail: row.user_email,
    userName: row.user_name,
    checkIn: row.check_in,
    checkOut: row.check_out,
    adults: row.num_adults,
    kids: row.num_children,
    totalNights: row.total_nights,
    totalPrice: Number(row.total_amount) || 0,
    pricingBreakdown: row.pricing_breakdown || [],
    note: row.note,
    promoCode: row.promo_code,
    subtotal: Number(row.subtotal) || 0,
    discount: Number(row.discount) || 0,
    status: row.status,
    type: 'room',
    createdAt: row.created_at,
    history: row.history || [],
  });

  const mapRestaurantBookingFromDb = (row) => ({
    id: row.id,
    confirmationCode: row.confirmation_code,
    type: 'restaurant',
    userId: row.user_id,
    userEmail: row.email,
    userName: row.name,
    checkIn: row.reservation_at,
    checkOut: row.reservation_at,
    guests: row.guests,
    specialRequests: row.special_requests,
    totalPrice: Number(row.total_price) || 0,
    status: row.status,
    createdAt: row.created_at,
  });

  const mapSpaBookingFromDb = (row) => ({
    id: row.id,
    confirmationCode: row.confirmation_code,
    type: 'spa',
    userId: row.user_id,
    userEmail: row.email,
    userName: row.name,
    checkIn: row.appointment_at,
    checkOut: row.appointment_at,
    serviceName: row.service_name,
    duration: row.service_duration,
    therapist: row.therapist,
    specialRequests: row.special_requests,
    totalPrice: Number(row.total_price) || 0,
    status: row.status,
    createdAt: row.created_at,
  });

  /**
   * Load all bookings for the current user from Supabase.
   * Runs on initial load and whenever user.id changes.
   */
  useEffect(() => {
    const loadUserBookings = async () => {
      if (!user?.id) {
        setRoomBookings([]);
        setRestaurantBookings([]);
        setSpaBookings([]);
        return;
      }

      try {
        const [roomRows, restaurantRows, spaRows] = await Promise.all([
          fetchUserBookings(user.id),
          fetchUserRestaurantBookings(user.id),
          fetchUserSpaBookings(user.id),
        ]);

        setRoomBookings((roomRows || []).map(mapRoomBookingFromDb));
        setRestaurantBookings((restaurantRows || []).map(mapRestaurantBookingFromDb));
        setSpaBookings((spaRows || []).map(mapSpaBookingFromDb));
      } catch (err) {
        console.error('Failed to load bookings for user', user.id, err);
      }
    };

    loadUserBookings();
  }, [user?.id]);

  const createRoomBookingHandler = (bookingData) => {
    const confirmationCode = `ROOM-${Math.random().toString(36).substring(2, 7).toUpperCase()}`;
    const newBooking = {
      id: createId(),
      confirmationCode,
      bookingType: 'room',
      ...bookingData,
      status: 'pending_payment',
      createdAt: new Date().toISOString(),
    };

    // Prepare data for Supabase (matching schema in 01_create_schema_tables.txt)
    const supabaseData = {
      user_id: bookingData.userId,
      confirmation_code: confirmationCode,
      check_in: bookingData.checkIn,
      check_out: bookingData.checkOut,
      room_id: bookingData.roomId,
      room_name: bookingData.roomName,
      user_name: bookingData.userName,
      user_email: bookingData.userEmail,
      guest_name: bookingData.guestName,
      guest_phone: bookingData.guestPhone,
      note: bookingData.note,
      num_adults: bookingData.numAdults || 1,
      num_children: bookingData.numChildren || 0,
      total_nights: bookingData.totalNights || 1,
      subtotal: bookingData.subtotal || 0,
      discount: bookingData.discount || 0,
      total_amount: bookingData.totalAmount || 0,
      pricing_breakdown: bookingData.pricingBreakdown || [],
      status: 'pending_payment',
    };

    // ✅ SAVE TO SUPABASE
    createBooking(supabaseData).then((dbBooking) => {
      if (dbBooking) {
        newBooking.id = dbBooking.id;
        setRoomBookings(prev => [newBooking, ...prev]);
        console.log('✅ Room booking synced:', confirmationCode);
      }
    }).catch((err) => {
      console.error('❌ Failed to save room booking to Supabase:', err);
      // Fallback to localStorage
      setRoomBookings(prev => [newBooking, ...prev]);
    });

    return { success: true, booking: newBooking };
  };

  const createRestaurantBookingHandler = (bookingData) => {
    const confirmationCode = `RES-${Math.random().toString(36).substring(2, 7).toUpperCase()}`;
    const newBooking = {
      id: createId(),
      confirmationCode,
      type: 'restaurant',
      userId: bookingData.userId,
      userEmail: bookingData.userEmail || bookingData.email,
      userName: bookingData.userName || bookingData.name,
      checkIn: bookingData.date,
      checkOut: bookingData.date,
      guests: bookingData.guests || 1,
      specialRequests: bookingData.specialRequests || '',
      totalPrice: bookingData.totalPrice || bookingData.price || 0,
      status: 'pending_payment',
      createdAt: new Date().toISOString(),
    };

    // ✅ SAVE TO SUPABASE
    createRestaurantBooking({
      userId: bookingData.userId,
      confirmationCode,
      name: bookingData.name || bookingData.userName,
      email: bookingData.email || bookingData.userEmail,
      phone: bookingData.phone,
      reservationAt: bookingData.date,
      guests: bookingData.guests || 1,
      specialRequests: bookingData.specialRequests || '',
      price: bookingData.price || 0,
      totalPrice: bookingData.totalPrice || 0,
      status: 'pending_payment',
    }).then((dbBooking) => {
      if (dbBooking) {
        newBooking.id = dbBooking.id;
        setRestaurantBookings(prev => [newBooking, ...prev]);
        console.log('✅ Restaurant booking synced:', confirmationCode);
      }
    }).catch((err) => {
      console.error('❌ Failed to save to Supabase:', err);
      // Fallback to localStorage
      setRestaurantBookings(prev => [newBooking, ...prev]);
    });

    return { success: true, booking: newBooking };
  };

  const createSpaBookingHandler = (bookingData) => {
    const confirmationCode = `SPA-${Math.random().toString(36).substring(2, 7).toUpperCase()}`;
    const newBooking = {
      id: createId(),
      confirmationCode,
      type: 'spa',
      userId: bookingData.userId,
      userEmail: bookingData.userEmail || bookingData.email,
      userName: bookingData.userName || bookingData.name,
      checkIn: bookingData.date,
      checkOut: bookingData.date,
      serviceName: bookingData.serviceName || bookingData.service,
      duration: bookingData.duration,
      therapist: bookingData.therapist,
      specialRequests: bookingData.specialRequests || '',
      totalPrice: bookingData.totalPrice || bookingData.price || 0,
      status: 'pending_payment',
      createdAt: new Date().toISOString(),
    };

    // ✅ SAVE TO SUPABASE
    createSpaBooking({
      userId: bookingData.userId,
      confirmationCode,
      name: bookingData.name || bookingData.userName,
      email: bookingData.email || bookingData.userEmail,
      phone: bookingData.phone,
      appointmentAt: bookingData.date,
      serviceName: bookingData.serviceName || bookingData.service,
      duration: bookingData.duration || '',
      therapist: bookingData.therapist || '',
      specialRequests: bookingData.specialRequests || '',
      price: bookingData.price || 0,
      totalPrice: bookingData.totalPrice || 0,
      status: 'pending_payment',
    }).then((dbBooking) => {
      if (dbBooking) {
        newBooking.id = dbBooking.id;
        setSpaBookings(prev => [newBooking, ...prev]);
        console.log('✅ Spa booking synced:', confirmationCode);
      }
    }).catch((err) => {
      console.error('❌ Failed to save to Supabase:', err);
      // Fallback to localStorage
      setSpaBookings(prev => [newBooking, ...prev]);
    });

    return { success: true, booking: newBooking };
  };

  const confirmRoomBooking = (bookingId, paymentData) => {
    let confirmedBooking = null;
    setRoomBookings(prev => prev.map(booking => {
      if (booking.id !== bookingId) return booking;
      confirmedBooking = {
        ...booking,
        ...paymentData,
        status: 'confirmed',
        paidAt: paymentData.paidAt || new Date().toISOString(),
      };

      // ✅ SYNC TO SUPABASE
      updateBookingStatus(booking.id, 'confirmed', {
        payment_method: paymentData.paymentMethod,
        payment_code: paymentData.paymentCode,
        paid_at: confirmedBooking.paidAt,
      }).catch((err) => {
        console.error('❌ Failed to update Supabase:', err);
      });
      
      // Automatically send invoice email (async, don't block)
      sendBookingConfirmationEmail({
        toEmail: booking.userEmail || booking.email,
        toName: booking.userName || booking.name,
        booking: confirmedBooking
      }).catch((err) => {
        console.warn('Failed to send booking confirmation email:', err);
        // Don't block the flow if email fails
      });
      
      return confirmedBooking;
    }));
    return confirmedBooking;
  };

  const confirmRestaurantBooking = (bookingId, paymentData) => {
    let confirmedBooking = null;
    setRestaurantBookings(prev => prev.map(booking => {
      if (booking.id !== bookingId) return booking;
      confirmedBooking = {
        ...booking,
        ...paymentData,
        status: 'confirmed',
        paidAt: paymentData.paidAt || new Date().toISOString(),
      };

      // ✅ SYNC TO SUPABASE
      updateRestaurantBookingStatus(booking.id, 'confirmed', {
        payment_method: paymentData.paymentMethod,
        payment_code: paymentData.paymentCode,
        paid_at: confirmedBooking.paidAt,
      }).catch((err) => {
        console.error('❌ Failed to update Supabase:', err);
      });
      
      // Automatically send invoice email (async, don't block)
      sendBookingConfirmationEmail({
        toEmail: booking.userEmail || booking.email,
        toName: booking.userName || booking.name,
        booking: confirmedBooking
      }).catch((err) => {
        console.warn('Failed to send booking confirmation email:', err);
        // Don't block the flow if email fails
      });
      
      return confirmedBooking;
    }));
    return confirmedBooking;
  };

  const confirmSpaBooking = (bookingId, paymentData) => {
    let confirmedBooking = null;
    setSpaBookings(prev => prev.map(booking => {
      if (booking.id !== bookingId) return booking;
      confirmedBooking = {
        ...booking,
        ...paymentData,
        status: 'confirmed',
        paidAt: paymentData.paidAt || new Date().toISOString(),
      };

      // ✅ SYNC TO SUPABASE
      updateSpaBookingStatus(booking.id, 'confirmed', {
        payment_method: paymentData.paymentMethod,
        payment_code: paymentData.paymentCode,
        paid_at: confirmedBooking.paidAt,
      }).catch((err) => {
        console.error('❌ Failed to update Supabase:', err);
      });
      
      // Automatically send invoice email (async, don't block)
      sendBookingConfirmationEmail({
        toEmail: booking.userEmail || booking.email,
        toName: booking.userName || booking.name,
        booking: confirmedBooking
      }).catch((err) => {
        console.warn('Failed to send booking confirmation email:', err);
        // Don't block the flow if email fails
      });
      
      return confirmedBooking;
    }));
    return confirmedBooking;
  };

  const getUserRoomBookings = (userId) => {
    return roomBookings.filter(booking => booking.userId === userId);
  };

  const getUserRestaurantBookings = (userId) => {
    return restaurantBookings.filter(booking => booking.userId === userId);
  };

  const getUserSpaBookings = (userId) => {
    return spaBookings.filter(booking => booking.userId === userId);
  };

  const getAllBookings = () => {
    return {
      room: roomBookings,
      restaurant: restaurantBookings,
      spa: spaBookings,
    };
  };

  const value = {
    roomBookings,
    restaurantBookings,
    spaBookings,
    createRoomBooking: createRoomBookingHandler,
    createRestaurantBooking: createRestaurantBookingHandler,
    createSpaBooking: createSpaBookingHandler,
    confirmRoomBooking,
    confirmRestaurantBooking,
    confirmSpaBooking,
    getUserRoomBookings,
    getUserRestaurantBookings,
    getUserSpaBookings,
    getAllBookings,
  };

  return (
    <BookingContext.Provider value={value}>
      {children}
    </BookingContext.Provider>
  );
};

export const useBookingContext = () => {
  const context = useContext(BookingContext);
  if (!context) {
    throw new Error('useBookingContext must be used within BookingProvider');
  }
  return context;
};

--- END FILE: src\context\BookingContext.jsx ---

--- START FILE: src\context\LanguageContext.jsx ---
import { createContext, useContext, useEffect, useMemo, useState, useCallback } from 'react';
import translations from '../constants/translations';

const LanguageInfo = createContext();

const getNestedValue = (obj, path) => {
  return path.split('.').reduce((acc, segment) => (acc && acc[segment] !== undefined ? acc[segment] : null), obj);
};

export const LanguageProvider = ({ children }) => {
  // Ngôn ngữ hiện tại chỉ lưu trong state (không ghi vào localStorage)
  const [language, setLanguage] = useState('en');

  const t = useCallback(
    (key, fallbackValue) => {
      const value = getNestedValue(translations[language], key);
      if (typeof value === 'function') {
        return value(fallbackValue);
      }
      if (value !== null && value !== undefined) return value;
      const fallback = getNestedValue(translations.en, key);
      return fallback ?? fallbackValue ?? key;
    },
    [language]
  );

  const value = useMemo(
    () => ({
      language,
      setLanguage,
      t,
    }),
    [language, t]
  );

  return <LanguageInfo.Provider value={value}>{children}</LanguageInfo.Provider>;
};

export const useLanguage = () => useContext(LanguageInfo);


--- END FILE: src\context\LanguageContext.jsx ---

--- START FILE: src\context\RoomContext.jsx ---
import { createContext, useContext, useEffect, useMemo, useState } from "react";
import {
  isBookingEmailConfigured,
  sendBookingConfirmationEmail,
} from "../utils/emailService";
import {
  fetchRoomsWithImages,
  fetchRoomReviews,
  createReview,
  checkRoomAvailability,
  hasUserBookedRoomType,
  fetchPriceRules,
  fetchPromotions,
  fetchHolidayCalendar,
  updateRoomStatus,
  addRoomStatusHistory,
  fetchRoomStatusBoard,
} from "../services/roomService";
import {
  fetchUserBookings,
  createBooking,
  updateBookingStatus,
  createBookingItems,
  createBookingPricingBreakdown,
} from "../services/bookingService";
import { useAuth } from "./SimpleAuthContext";
import { getImageUrlsByRoomType } from "../utils/supabaseStorageUrls";

const RoomInfo = createContext();

const HOLIDAY_CALENDAR = [
  "2025-01-01",
  "2025-02-03",
  "2025-04-30",
  "2025-05-01",
  "2025-09-02",
  "2025-12-24",
  "2025-12-31",
];

const PRICING_DEFAULTS = {
  weekendMultiplier: 1.15,
  holidayMultiplier: 1.35,
  hourlyRateFactor: 0.25,
};

// Reviews/bookings are now kept only in memory for the current session.
// No persistence to localStorage.
const getInitialReviews = () => {
  return {};
};

/**
 * Transform DB room object to frontend shape
 * DB shape: { id, room_no, floor, room_type_id, status, room_types: {...}, image_url, image_lg_url }
 * Frontend shape: { id, name, type, category, price, maxPerson, size, facilities, reviews, image, imageLg, ... }
 */
const transformDbRoomToFrontend = (dbRoom, reviews = []) => {
  const rt = dbRoom.room_types || {};
  // Ưu tiên dùng dữ liệu từ room cụ thể, fallback về room type nếu không có
  const roomName = dbRoom.name || rt.name || `Room ${dbRoom.room_no}`;
  const roomPrice = dbRoom.price != null ? Number(dbRoom.price) : (Number(rt.base_price) || 115);
  const roomDescription = dbRoom.description || rt.description || 'A comfortable room.';
  const roomTypeCode = rt.code || 'STD';
  
  // Get fallback image URLs if image_url is null
  const fallbackImages = getImageUrlsByRoomType(roomTypeCode);
  const imageUrl = dbRoom.image_url || fallbackImages?.image_url || null;
  const imageLgUrl = dbRoom.image_lg_url || fallbackImages?.image_lg_url || null;
  
  return {
    id: dbRoom.id, // UUID string from DB
    roomTypeId: rt.id, // UUID string of room type (NEW)
    roomNo: dbRoom.room_no,
    floor: dbRoom.floor,
    name: roomName, // Ưu tiên từ room cụ thể
    type: roomTypeCode,
    category: rt.code || 'standard',
    description: roomDescription, // Ưu tiên từ room cụ thể
    price: roomPrice, // Ưu tiên từ room cụ thể
    maxPerson: rt.max_person || 2,
    size: dbRoom.size || 35, // From rooms table
    image: imageUrl, // From room_images (Supabase Storage URL) or fallback
    imageLg: imageLgUrl, // From room_images large version or fallback
    facilities: (rt.facilities || []).map((name) => ({ name })),
    reviews: reviews || [],
    pricing: {
      weekendMultiplier: 1.15,
      holidayMultiplier: 1.35,
      hourlyRate: Math.round(roomPrice * 0.25), // Dùng roomPrice thay vì rt.base_price
    },
  };
};

/**
 * Fallback: Generate local seed rooms (when Supabase unavailable)
 * Creates basic room data with placeholder images
 */
const enhanceRoomsWithReviews = () => {
  const persistedReviews = getInitialReviews();
  
  // Generate 40 sample rooms (5 types × 8 rooms each)
  const roomTypes = [
    { id: 'std', code: 'STD', name: 'Standard Room', basePrice: 115, maxPerson: 2 },
    { id: 'dlx', code: 'DLX', name: 'Deluxe Room', basePrice: 200, maxPerson: 2 },
    { id: 'sui', code: 'SUI', name: 'Suite', basePrice: 350, maxPerson: 4 },
    { id: 'pen', code: 'PEN', name: 'Penthouse', basePrice: 500, maxPerson: 4 },
    { id: 'cmb', code: 'CMB', name: 'Combo Package', basePrice: 400, maxPerson: 3 },
  ];
  
  const localRooms = [];
  roomTypes.forEach((roomType, typeIdx) => {
    for (let i = 1; i <= 8; i++) {
      const roomId = `room-${typeIdx * 8 + i}`;
      localRooms.push({
        id: roomId,
        roomNo: `${roomType.code}-${String(i).padStart(2, '0')}`,
        floor: Math.ceil(i / 4),
        name: `${roomType.name} #${i}`,
        type: roomType.code,
        category: roomType.id,
        description: `${roomType.name} - Comfortable and well-equipped`,
        price: roomType.basePrice,
        maxPerson: roomType.maxPerson,
        size: 35,
        // Use fallback image URLs from Supabase Storage based on room type
        ...(getImageUrlsByRoomType(roomType.code) || { image: null, imageLg: null }),
        facilities: [
          { name: 'Free Wi-Fi' },
          { name: 'Air Conditioning' },
          { name: 'Flat-screen TV' },
        ],
        reviews: persistedReviews[roomId] || [],
        pricing: {
          weekendMultiplier: 1.15,
          holidayMultiplier: 1.35,
          hourlyRate: Math.round(roomType.basePrice * 0.25),
        },
      });
    }
  });
  
  return localRooms;
};


const getPriceBounds = (rooms) => {
  const prices = rooms.map((room) => room.price);
  if (prices.length === 0) return { min: 115, max: 545 };
  return {
    min: Math.min(...prices),
    max: Math.max(...prices),
  };
};

const getAverageRating = (room) => {
  if (!room?.reviews?.length) return 0;
  const sum = room.reviews.reduce((acc, review) => acc + review.rating, 0);
  return sum / room.reviews.length;
};

const createId = () => {
  if (typeof crypto !== "undefined" && crypto.randomUUID) {
    return crypto.randomUUID();
  }
  return Date.now().toString();
};

const formatDateKey = (date) => {
  if (!date) return "";
  const d = new Date(date);
  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(
    2,
    "0"
  )}-${String(d.getDate()).padStart(2, "0")}`;
};

const normalizeDateInput = (value) => {
  if (!value) return null;
  return formatDateKey(value);
};

const addDays = (date, days) => {
  const result = new Date(date);
  result.setDate(result.getDate() + days);
  return result;
};

const iterateDates = (start, end, callback) => {
  let cursor = new Date(start);
  const limit = new Date(end);
  while (cursor < limit) {
    callback(new Date(cursor));
    cursor = addDays(cursor, 1);
  }
};

const isOverlap = (startA, endA, startB, endB) => {
  return new Date(startA) < new Date(endB) && new Date(startB) < new Date(endA);
};

export const RoomContext = ({ children }) => {
  const { user } = useAuth();
  const [allRooms, setAllRooms] = useState([]);
  const [rooms, setRooms] = useState([]);
  const [loading, setLoading] = useState(true);
  const [dbConnected, setDbConnected] = useState(false);

  const [adults, setAdults] = useState("1 Adult");
  const [kids, setKids] = useState("0 Kid");
  const [checkInDate, setCheckInDate] = useState(null);
  const [checkOutDate, setCheckOutDate] = useState(null);
  const [selectedRoomTypes, setSelectedRoomTypes] = useState([]);
  const [selectedAmenities, setSelectedAmenities] = useState([]);

  const [searchTerm, setSearchTerm] = useState("");
  const [sortOption, setSortOption] = useState("recommended");
  const [selectedCategory, setSelectedCategory] = useState(null);

  const [bookings, setBookings] = useState([]);
  const [priceRange, setPriceRange] = useState([115, 545]);
  
  // Pricing state
  const [priceRules, setPriceRules] = useState([]);
  const [promotions, setPromotions] = useState([]);
  const [holidayCalendar, setHolidayCalendar] = useState([]);

  /**
   * Load rooms from Supabase (with fallback to local seed data)
   */
  useEffect(() => {
    const loadRooms = async () => {
      setLoading(true);
      try {
        // Try to fetch from Supabase (with images)
        const [dbRooms, dbRules, dbPromotions, dbHolidays] = await Promise.all([
          fetchRoomsWithImages(),
          fetchPriceRules(),
          fetchPromotions(),
          fetchHolidayCalendar(),
        ]);
        
        if (dbRooms && dbRooms.length > 0) {
          // Transform DB rooms to frontend shape
          const transformedRooms = dbRooms.map((dbRoom) =>
            transformDbRoomToFrontend(dbRoom, [])
          );
          setAllRooms(transformedRooms);
          setRooms(transformedRooms);
          setPriceRules(dbRules);
          setPromotions(dbPromotions);
          setHolidayCalendar(dbHolidays || []);
          setDbConnected(true);
          console.log(`✓ Loaded ${transformedRooms.length} rooms, ${dbRules.length} rules, ${dbPromotions.length} promotions, ${dbHolidays?.length || 0} holidays from Supabase`);
        } else {
          throw new Error('No rooms from DB');
        }
      } catch (error) {
        console.warn('Supabase unavailable, using local seed data:', error.message);
        // Fallback to local seed data
        const localRooms = enhanceRoomsWithReviews();
        setAllRooms(localRooms);
        setRooms(localRooms);
        setDbConnected(false);
      } finally {
        setLoading(false);
      }
    };

    loadRooms();
  }, []);

  // Update price bounds based on loaded rooms
  const priceBounds = useMemo(() => getPriceBounds(allRooms), [allRooms]);

  useEffect(() => {
    setPriceRange([priceBounds.min, priceBounds.max]);
  }, [priceBounds]);

  /**
   * Load user bookings from Supabase when user logs in
   */
  useEffect(() => {
    const loadUserBookings = async () => {
      if (!user?.id || !dbConnected) {
        setBookings([]);
        return;
      }

      try {
        const dbBookings = await fetchUserBookings(user.id);
        if (dbBookings && dbBookings.length > 0) {
          // Transform DB bookings to frontend format
          const transformedBookings = dbBookings.map((dbBooking) => ({
            id: dbBooking.id,
            confirmationCode: dbBooking.confirmation_code,
            roomId: dbBooking.room_id,
            roomName: dbBooking.room_name,
            userId: dbBooking.user_id,
            userEmail: dbBooking.user_email,
            userName: dbBooking.user_name,
            checkIn: dbBooking.check_in,
            checkOut: dbBooking.check_out,
            adults: dbBooking.num_adults,
            kids: dbBooking.num_children,
            totalNights: dbBooking.total_nights,
            totalPrice: parseFloat(dbBooking.total_amount) || 0,
            pricingBreakdown: dbBooking.pricing_breakdown || [],
            note: dbBooking.note,
            promoCode: dbBooking.promo_code,
            subtotal: parseFloat(dbBooking.subtotal) || 0,
            discount: parseFloat(dbBooking.discount) || 0,
            status: dbBooking.status,
            type: "room",
            createdAt: dbBooking.created_at,
            history: dbBooking.history || [],
          }));
          setBookings(transformedBookings);
          console.log(`✅ Loaded ${transformedBookings.length} room bookings from Supabase for user ${user.id}`);
        } else {
          setBookings([]);
        }
      } catch (err) {
        console.error('Failed to load user bookings:', err);
        setBookings([]);
      }
    };

    loadUserBookings();
  }, [user?.id, dbConnected]);

  /**
   * Auto-mark completed bookings in memory (no localStorage persistence).
   */
  useEffect(() => {
    setBookings((prev) => {
      let changed = false;
      const now = new Date();
      const updated = prev.map((booking) => {
        if (booking.status === "cancelled" || booking.status === "completed")
          return booking;
        if (new Date(booking.checkOut) < now) {
          changed = true;
          return { ...booking, status: "completed" };
        }
        return booking;
      });
      return changed ? updated : prev;
    });
  }, [bookings.length]);

  const availableRoomTypes = useMemo(() => {
    const types = new Set();
    allRooms.forEach((room) => types.add(room.type));
    return Array.from(types);
  }, [allRooms]);

  const availableAmenities = useMemo(() => {
    const amenities = new Set();
    allRooms.forEach((room) =>
      room.facilities.forEach((f) => amenities.add(f.name))
    );
    return Array.from(amenities).sort();
  }, [allRooms]);

  const totalGuests = useMemo(() => {
    const adultNumber = parseInt(adults, 10) || 0;
    const kidNumber = parseInt(kids, 10) || 0;
    return adultNumber + kidNumber;
  }, [adults, kids]);

  const getRoomById = (roomId) => allRooms.find((room) => room.id === roomId);

  // Check if a date is a holiday
  const isHoliday = (date) => {
    const dateKey = formatDateKey(date);
    return holidayCalendar.find(h => 
      h.is_active && 
      formatDateKey(h.holiday_date) === dateKey
    );
  };

  const getApplicablePriceRules = (roomTypeId, date) => {
    const day = date.getDay(); // 0=Sun, 6=Sat
    const dateKey = formatDateKey(date);
    const holiday = isHoliday(date);

    // 1. Filter rules relevant to the room type or all types (room_type_id IS NULL implies all types, but our seeded data links rules to specific types)
    const applicableRules = priceRules.filter(rule =>
      rule.is_active &&
      (rule.room_type_id === null || roomTypeId === rule.room_type_id)
    );

    // 2. Find the highest priority rule for the date
    let bestRule = null;
    let highestPriority = Infinity;

    for (const rule of applicableRules) {
      let isApplied = false;

      // Check holiday rules first (highest priority)
      if (holiday && rule.rule_type === 'holiday') {
        isApplied = true;
      }
      
      // Check date range rules (seasonal, holiday defined by date range)
      if (!isApplied && rule.start_date && rule.end_date) {
        if (dateKey >= formatDateKey(rule.start_date) && dateKey < formatDateKey(rule.end_date)) {
          isApplied = true;
        }
      }
      
      // Check day of week rules (weekend) - only if not a holiday
      if (!isApplied && !holiday && rule.rule_type === 'weekend') {
        if (rule.apply_sun && day === 0) isApplied = true;
        if (rule.apply_fri && day === 5) isApplied = true;
        if (rule.apply_sat && day === 6) isApplied = true;
      }

      if (isApplied && rule.priority < highestPriority) {
        highestPriority = rule.priority;
        bestRule = rule;
      }
    }
    
    return { rule: bestRule, holiday };
  };

  const calculatePricingForRoom = (room, start, end) => {
    if (!room || !start || !end) {
      return {
        total: room?.price || 0,
        breakdown: [],
        hourlyRate: room?.pricing?.hourlyRate || 0,
      };
    }

    const roomBasePrice = Number(room.price);
    const roomTypeId = room.roomTypeId; // Using the newly exposed roomTypeId (UUID)

    const breakdown = [];
    let total = 0;

    iterateDates(start, end, (currentDate) => {
      const dayKey = formatDateKey(currentDate);
      let label = "Standard rate";
      let rate = roomBasePrice;

      // 1. Check if date is a holiday
      const holiday = isHoliday(currentDate);
      
      // 2. Find Price Rule (Highest Priority applies)
      const ruleResult = getApplicablePriceRules(roomTypeId, currentDate);
      const rule = ruleResult.rule;
      
      if (rule) {
        // Price field in DB can be:
        // - Multiplier (e.g., 1.15, 1.35) → multiply with base price
        // - Fixed price (e.g., 200, 300) → use directly
        // Logic: If price is between 0.5 and 10, it's likely a multiplier
        // Otherwise, it's a fixed price
        const rulePrice = Number(rule.price);
        const isFixedPrice = rulePrice < 0.5 || rulePrice > 10;
        
        if (isFixedPrice) {
          // Fixed price - use directly
          rate = Math.round(rulePrice);
        } else {
          // Multiplier - multiply with base price
          rate = Math.round(roomBasePrice * rulePrice);
        }
        
        // Use rule type/description for label
        label = rule.description || `${rule.rule_type} rate`;
      } else if (holiday) {
        // Apply holiday multiplier from holiday_calendar if no specific rule
        const multiplier = Number(holiday.multiplier) || PRICING_DEFAULTS.holidayMultiplier;
        rate = Math.round(roomBasePrice * multiplier);
        label = holiday.name || "Holiday rate";
      }
      
      // We ignore promotions here, promotions are applied globally to the total booking amount later.

      breakdown.push({
        date: dayKey,
        label,
        rate,
      });
      total += rate;
    });

    return {
      total,
      breakdown,
      hourlyRate:
        room.pricing?.hourlyRate ??
        Math.round(roomBasePrice * PRICING_DEFAULTS.hourlyRateFactor),
    };
  };

  const isRoomAvailable = (roomId, start, end, excludeBookingId = null) => {
    if (!start || !end) return true;

    // Ưu tiên dùng DB nếu có kết nối (đảm bảo kiểm tra cả booking từ session khác)
    if (dbConnected) {
      return checkAvailabilityAsync(roomId, start, end, excludeBookingId);
    }

    // Fallback: chỉ kiểm tra bookings trong memory của session hiện tại
    return bookings
      .filter(
        (booking) =>
          booking.roomId === roomId &&
          booking.status !== "cancelled" &&
          booking.id !== excludeBookingId
      )
      .every(
        (booking) => !isOverlap(start, end, booking.checkIn, booking.checkOut)
      );
  };

  /**
   * Async availability check (if Supabase available, use DB; else use local cache)
   */
  const checkAvailabilityAsync = async (roomId, start, end, excludeBookingId = null) => {
    if (dbConnected) {
      return await checkRoomAvailability(roomId, start, end, excludeBookingId);
    }
    return isRoomAvailable(roomId, start, end, excludeBookingId);
  };

  const sortRooms = (roomsList, sortValue = sortOption) => {
    if (sortValue === "price-low") {
      return [...roomsList].sort((a, b) => a.price - b.price);
    }
    if (sortValue === "price-high") {
      return [...roomsList].sort((a, b) => b.price - a.price);
    }
    if (sortValue === "rating-high") {
      return [...roomsList].sort(
        (a, b) => getAverageRating(b) - getAverageRating(a)
      );
    }
    return roomsList;
  };

  const filterRooms = (options = {}) => {
    const term = (options.searchTerm ?? searchTerm ?? "").toLowerCase().trim();
    const [minPrice, maxPrice] = options.priceRange ?? priceRange;
    const sortValue = options.sortOption ?? sortOption;
    const roomTypes = options.selectedRoomTypes ?? selectedRoomTypes;
    const amenities = options.selectedAmenities ?? selectedAmenities;
    const rangeCheckIn = options.checkIn ?? checkInDate;
    const rangeCheckOut = options.checkOut ?? checkOutDate;
    const category = options.selectedCategory ?? selectedCategory;

    const baseRooms = options.sourceRooms ?? allRooms;

    const filtered = baseRooms.filter((room) => {
      const matchesGuests =
        totalGuests === 0 ? true : totalGuests <= room.maxPerson;
      const matchesPrice = room.price >= minPrice && room.price <= maxPrice;
      const matchesTerm =
        !term ||
        room.name.toLowerCase().includes(term) ||
        room.description.toLowerCase().includes(term);
      const matchesType =
        roomTypes.length === 0 || roomTypes.includes(room.type);
      const matchesCategory = !category || room.category === category;
      const roomAmenities = room.facilities.map((f) => f.name);
      const matchesAmenities =
        amenities.length === 0 ||
        amenities.every((item) => roomAmenities.includes(item));
      const matchesAvailability =
        !rangeCheckIn || !rangeCheckOut
          ? true
          : isRoomAvailable(room.id, rangeCheckIn, rangeCheckOut);

      return (
        matchesGuests &&
        matchesPrice &&
        matchesTerm &&
        matchesType &&
        matchesCategory &&
        matchesAmenities &&
        matchesAvailability
      );
    });

    return sortRooms(filtered, sortValue);
  };

  // Reviews are currently only stored in memory. This helper is kept
  // for potential future persistence (e.g. remote cache) but is a no-op now.
  const persistReviews = () => {};

  const handleCheck = (e) => {
    e.preventDefault();
    setLoading(true);
    setTimeout(() => {
      setRooms(filterRooms());
      setLoading(false);
    }, 800);
  };

  const resetRoomFilterData = () => {
    setAdults("1 Adult");
    setKids("0 Kid");
    setSearchTerm("");
    setPriceRange([priceBounds.min, priceBounds.max]);
    setSortOption("recommended");
    setCheckInDate(null);
    setCheckOutDate(null);
    setSelectedRoomTypes([]);
    setSelectedAmenities([]);
    setRooms(allRooms);
  };

  const updateSearch = (value) => {
    setSearchTerm(value);
    setRooms(filterRooms({ searchTerm: value }));
  };

  const updatePriceRange = (min, max) => {
    const sanitizedMin = Math.max(priceBounds.min, Math.min(min, max));
    const sanitizedMax = Math.min(priceBounds.max, Math.max(max, sanitizedMin));
    const nextRange = [sanitizedMin, sanitizedMax];
    setPriceRange(nextRange);
    setRooms(filterRooms({ priceRange: nextRange }));
  };

  const updateSortOption = (value) => {
    setSortOption(value);
    setRooms(filterRooms({ sortOption: value }));
  };

  const toggleRoomType = (type) => {
    setSelectedRoomTypes((prev) => {
      const next = prev.includes(type)
        ? prev.filter((item) => item !== type)
        : [...prev, type];
      setRooms(filterRooms({ selectedRoomTypes: next }));
      return next;
    });
  };

  const toggleAmenity = (amenity) => {
    setSelectedAmenities((prev) => {
      const next = prev.includes(amenity)
        ? prev.filter((item) => item !== amenity)
        : [...prev, amenity];
      setRooms(filterRooms({ selectedAmenities: next }));
      return next;
    });
  };

  const updateCategory = (category) => {
    setSelectedCategory(category);
    setRooms(filterRooms({ selectedCategory: category }));
  };

  const clearAllFilters = () => {
    setSelectedRoomTypes([]);
    setSelectedAmenities([]);
    setCheckInDate(null);
    setCheckOutDate(null);
    setPriceRange([priceBounds.min, priceBounds.max]);
    setSortOption("recommended");
    setSearchTerm("");
    setSelectedCategory(null);
    setRooms(
      filterRooms({
        selectedRoomTypes: [],
        selectedAmenities: [],
        searchTerm: "",
        checkIn: null,
        checkOut: null,
        priceRange: [priceBounds.min, priceBounds.max],
        sortOption: "recommended",
        selectedCategory: null,
      })
    );
  };

  const saveBookings = (updater) => {
    setBookings((prev) =>
      typeof updater === "function" ? updater(prev) : updater
    );
  };

  const bookRoom = ({
    roomId,
    roomName,
    userId,
    userName,
    userEmail,
    checkIn,
    checkOut,
    adults: bookingAdults,
    kids: bookingKids,
    note,
    promoCode = null,
    // Guest booking fields
    guestName = null,
    guestEmail = null,
    guestPhone = null,
  }) => {
    const room = getRoomById(roomId);
    if (!room) {
      return { success: false, error: "Room not found" };
    }
    if (!checkIn || !checkOut) {
      return {
        success: false,
        error: "Please select check-in and check-out dates",
      };
    }
    if (!isRoomAvailable(roomId, checkIn, checkOut)) {
      return {
        success: false,
        error: "Room is not available for the selected dates",
      };
    }

    const normalizedCheckIn = normalizeDateInput(checkIn);
    const normalizedCheckOut = normalizeDateInput(checkOut);

    const { total, breakdown } = calculatePricingForRoom(
      room,
      normalizedCheckIn,
      normalizedCheckOut
    );
    const confirmationCode = `AD-${Math.random()
      .toString(36)
      .substring(2, 7)
      .toUpperCase()}`;

    // --- 1. Apply Promotion (if provided) ---
    let discount = 0;
    let finalTotal = total;
    let promo = null;
    let promoError = null;

    if (promoCode) {
      const now = new Date();
      const promoCodeUpper = promoCode.trim().toUpperCase();
      
      // Find promotion with full validation
      promo = promotions.find(p => {
        if (!p.is_active) return false;
        if (p.code.toUpperCase() !== promoCodeUpper) return false;
        
        // Check date range
        const startDate = new Date(p.start_date);
        const endDate = new Date(p.end_date);
        
        if (now < startDate) {
          promoError = `Promotion "${p.code}" starts on ${startDate.toLocaleDateString()}`;
          return false;
        }
        if (now > endDate) {
          promoError = `Promotion "${p.code}" expired on ${endDate.toLocaleDateString()}`;
          return false;
        }
        
        return true;
      });
      
      if (!promo && promoCode) {
        // Promotion not found or invalid
        if (!promoError) {
          promoError = `Promotion code "${promoCode}" not found or invalid`;
        }
        // Return error but don't block booking - user can proceed without promo
        console.warn('⚠ Promotion validation failed:', promoError);
      } else if (promo) {
        // Valid promotion - apply discount
        if (promo.discount_kind === 'percent') {
          discount = Math.round(total * (Number(promo.discount_value) / 100));
        } else if (promo.discount_kind === 'fixed') {
          discount = Math.min(Number(promo.discount_value), total); // Don't exceed total
        }
        finalTotal = total - discount;
        if (finalTotal < 0) finalTotal = 0;
      }
    }

    // Prepare booking object
    const newBooking = {
      id: dbConnected ? undefined : createId(), // Let DB generate UUID if connected
      confirmation_code: confirmationCode,
      user_id: userId, // null for guest bookings
      user_email: userEmail,
      user_name: userName,
      // Guest booking fields (for non-authenticated users)
      guest_name: guestName || null,
      guest_phone: guestPhone || null,
      room_name: roomName,
      room_id: roomId, // References room UUID
      check_in: normalizedCheckIn,
      check_out: normalizedCheckOut,
      num_adults: bookingAdults,
      num_children: bookingKids,
      note,
      promo_code: promo?.code || null, // Store applied promo code
      subtotal: total, // Store total BEFORE discount
      discount: discount, // Store applied discount amount
      status: "pending_payment",
      total_nights: breakdown.length,
      total_amount: finalTotal, // Store total AFTER discount
      pricing_breakdown: breakdown,
      created_at: new Date().toISOString(),
      history: [],
    };

    // Save to DB if available; otherwise keep only in memory
    if (dbConnected) {
      // Create in Supabase (async, but we'll optimistically update UI)
      createBooking(newBooking).then((dbBooking) => {
        if (dbBooking) {
          // Create booking items (one per night)
          createBookingItems(
            dbBooking.id,
            roomId,
            roomTypeId,
            breakdown
          ).catch((err) => {
            console.error('❌ Failed to create booking items:', err);
          });
          
          // Create pricing breakdown records
          createBookingPricingBreakdown(
            dbBooking.id,
            breakdown
          ).catch((err) => {
            console.error('❌ Failed to create pricing breakdown:', err);
          });
          
          const frontendBooking = {
            id: dbBooking.id,
            confirmationCode: dbBooking.confirmation_code,
            roomId: dbBooking.room_id,
            roomName: dbBooking.room_name,
            userId: dbBooking.user_id,
            userEmail: dbBooking.user_email,
            userName: dbBooking.user_name,
            guestName: dbBooking.guest_name || null, // Guest booking info
            guestPhone: dbBooking.guest_phone || null,
            checkIn: dbBooking.check_in,
            checkOut: dbBooking.check_out,
            adults: dbBooking.num_adults,
            kids: dbBooking.num_children,
            totalNights: dbBooking.total_nights,
            totalPrice: parseFloat(dbBooking.total_amount),
            pricingBreakdown: dbBooking.pricing_breakdown || [],
            note: dbBooking.note,
            status: dbBooking.status,
            type: "room",
            createdAt: dbBooking.created_at,
            history: dbBooking.history || [],
            promoCode: dbBooking.promo_code, // NEW
            subtotal: parseFloat(dbBooking.subtotal) || 0, // NEW
            discount: parseFloat(dbBooking.discount) || 0, // NEW
          };
          // Add to state and reload from DB to ensure consistency
          saveBookings((prev) => [frontendBooking, ...prev]);
          // Reload from DB to get latest data
          if (user?.id) {
            fetchUserBookings(user.id).then((dbBookings) => {
              if (dbBookings && dbBookings.length > 0) {
                const transformed = dbBookings.map((db) => ({
                  id: db.id,
                  confirmationCode: db.confirmation_code,
                  roomId: db.room_id,
                  roomName: db.room_name,
                  userId: db.user_id,
                  userEmail: db.user_email,
                  userName: db.user_name,
                  guestName: db.guest_name || null, // Guest booking info
                  guestPhone: db.guest_phone || null,
                  checkIn: db.check_in,
                  checkOut: db.check_out,
                  adults: db.num_adults,
                  kids: db.num_children,
                  totalNights: db.total_nights,
                  totalPrice: parseFloat(db.total_amount) || 0,
                  pricingBreakdown: db.pricing_breakdown || [],
                  note: db.note,
                  promoCode: db.promo_code,
                  subtotal: parseFloat(db.subtotal) || 0,
                  discount: parseFloat(db.discount) || 0,
                  status: db.status,
                  type: "room",
                  createdAt: db.created_at,
                  history: db.history || [],
                }));
                setBookings(transformed);
              }
            });
          }
        }
      }).catch((err) => {
        console.error('❌ Failed to save booking to Supabase:', err);
      });
    } else {
      // Local storage only
      const frontendBooking = {
        id: createId(),
        confirmationCode,
        roomId,
        roomName,
        userId,
        userEmail,
        userName,
        guestName: guestName || null, // Guest booking info
        guestPhone: guestPhone || null,
        checkIn: normalizedCheckIn,
        checkOut: normalizedCheckOut,
        adults: bookingAdults,
        kids: bookingKids,
        totalNights: breakdown.length,
        totalPrice: finalTotal, // Use final total
        pricingBreakdown: breakdown,
        note,
        promoCode: promo?.code || null, // Store applied promo code
        subtotal: total,
        discount: discount,
        status: "pending_payment",
        type: "room",
        createdAt: new Date().toISOString(),
        history: [],
      };
      saveBookings((prev) => [frontendBooking, ...prev]);
    }

    // Return optimistic booking data
    return {
      success: true,
      booking: {
        id: dbConnected ? "pending-db-sync" : createId(),
        confirmationCode,
        roomId,
        roomName,
        userId,
        userEmail,
        userName,
        guestName: guestName || null, // Guest booking info
        guestPhone: guestPhone || null,
        checkIn: normalizedCheckIn,
        checkOut: normalizedCheckOut,
        adults: bookingAdults,
        kids: bookingKids,
        totalNights: breakdown.length,
        totalPrice: finalTotal, // Use final total
        pricingBreakdown: breakdown,
        note,
        promoCode: promo?.code || null,
        subtotal: total,
        discount: discount,
        status: "pending_payment",
        type: "room",
        createdAt: new Date().toISOString(),
        history: [],
      },
      promoError: promoError || null, // Return promo error if any (for UI display)
    };
  };

  const confirmBookingPayment = (bookingId, paymentData) => {
    let confirmedBooking = null;
    saveBookings((prev) =>
      prev.map((booking) => {
        if (booking.id !== bookingId) return booking;
        confirmedBooking = {
          ...booking,
          ...paymentData,
          status: "confirmed",
          paidAt: paymentData.paidAt || new Date().toISOString(),
        };

        // ✅ SYNC TO SUPABASE
        if (dbConnected && booking.id !== "pending") {
          updateBookingStatus(booking.id, "confirmed", {
            payment_method: paymentData.paymentMethod,
            payment_code: paymentData.paymentCode,
            paid_at: confirmedBooking.paidAt,
          }).then((updated) => {
            // Move room to occupied & log history (best effort)
            const roomId = updated?.room_id || booking.roomId;
            if (roomId) {
              updateRoomStatus(roomId, "occupied");
              addRoomStatusHistory({
                roomId,
                status: "occupied",
                note: `Booking ${booking.confirmationCode} confirmed`,
                actor: user?.id || null,
              });
            }
          }).catch((err) => {
            console.error('❌ Failed to update Supabase:', err);
          });
        }

        // Send confirmation email
        if (isBookingEmailConfigured()) {
          sendBookingConfirmationEmail({
            toEmail: booking.userEmail,
            toName: booking.userName,
            booking: confirmedBooking,
          });
        }

        return confirmedBooking;
      })
    );
    return confirmedBooking;
  };

  const checkInBooking = (bookingId) => {
    let updatedBooking = null;
    saveBookings((prev) =>
      prev.map((booking) => {
        if (booking.id !== bookingId) return booking;
        updatedBooking = {
          ...booking,
          status: "checked_in",
          checkedInAt: new Date().toISOString(),
        };

        if (dbConnected && booking.id !== "pending") {
          updateBookingStatus(booking.id, "checked_in", {
            checked_in_at: updatedBooking.checkedInAt,
          })
            .then((updated) => {
              const roomId = updated?.room_id || booking.roomId;
              if (roomId) {
                updateRoomStatus(roomId, "occupied");
                addRoomStatusHistory({
                  roomId,
                  status: "occupied",
                  note: `Booking ${booking.confirmationCode} checked in`,
                  actor: user?.id || null,
                });
              }
            })
            .catch((err) => console.error("❌ Failed to update Supabase:", err));
        }

        return updatedBooking;
      })
    );
    return updatedBooking;
  };

  const checkOutBooking = (bookingId) => {
    let updatedBooking = null;
    saveBookings((prev) =>
      prev.map((booking) => {
        if (booking.id !== bookingId) return booking;
        updatedBooking = {
          ...booking,
          status: "checked_out",
          checkedOutAt: new Date().toISOString(),
        };

        if (dbConnected && booking.id !== "pending") {
          updateBookingStatus(booking.id, "checked_out", {
            checked_out_at: updatedBooking.checkedOutAt,
          })
            .then((updated) => {
              const roomId = updated?.room_id || booking.roomId;
              if (roomId) {
                updateRoomStatus(roomId, "available");
                addRoomStatusHistory({
                  roomId,
                  status: "available",
                  note: `Booking ${booking.confirmationCode} checked out`,
                  actor: user?.id || null,
                });
              }
            })
            .catch((err) => console.error("❌ Failed to update Supabase:", err));
        }

        return updatedBooking;
      })
    );
    return updatedBooking;
  };

  const cancelBooking = (bookingId, reason = "Cancelled by guest") => {
    let cancelledBooking = null;
    saveBookings((prev) =>
      prev.map((booking) => {
        if (booking.id !== bookingId) return booking;
        cancelledBooking = {
          ...booking,
          status: "cancelled",
          cancelledAt: new Date().toISOString(),
          cancelReason: reason,
          history: [
            ...(booking.history || []),
            { type: "cancel", reason, at: new Date().toISOString() },
          ],
        };

        // ✅ SYNC TO SUPABASE
        if (dbConnected && booking.id !== "pending") {
          updateBookingStatus(booking.id, "cancelled", {
            note: reason,
          }).catch((err) => {
            console.error('❌ Failed to update Supabase:', err);
          });
          const roomId = booking.roomId;
          if (roomId) {
            updateRoomStatus(roomId, "available");
            addRoomStatusHistory({
              roomId,
              status: "available",
              note: `Booking ${booking.confirmationCode} cancelled`,
              actor: user?.id || null,
            });
          }
        }

        return cancelledBooking;
      })
    );
    return cancelledBooking;
  };

  const modifyBookingDates = (bookingId, { checkIn, checkOut }) => {
    let updatedBooking = null;
    saveBookings((prev) =>
      prev.map((booking) => {
        if (booking.id !== bookingId) return booking;
        const normalizedCheckIn = normalizeDateInput(checkIn);
        const normalizedCheckOut = normalizeDateInput(checkOut);

        if (
          !isRoomAvailable(
            booking.roomId,
            normalizedCheckIn,
            normalizedCheckOut,
            bookingId
          )
        ) {
          throw new Error("Room is not available for the new dates");
        }
        const room = getRoomById(booking.roomId);
        const { total, breakdown } = calculatePricingForRoom(
          room,
          normalizedCheckIn,
          normalizedCheckOut
        );
        updatedBooking = {
          ...booking,
          checkIn: normalizedCheckIn,
          checkOut: normalizedCheckOut,
          totalNights: breakdown.length,
          totalPrice: total,
          pricingBreakdown: breakdown,
          status: "modified",
          history: [
            ...(booking.history || []),
            {
              type: "modify",
              at: new Date().toISOString(),
              checkIn: normalizedCheckIn,
              checkOut: normalizedCheckOut,
            },
          ],
        };

        // ✅ SYNC TO SUPABASE
        if (dbConnected && booking.id !== "pending") {
          updateBookingStatus(booking.id, "modified", {
            check_in: normalizedCheckIn,
            check_out: normalizedCheckOut,
          }).then((updated) => {
            const roomId = updated?.room_id || booking.roomId;
            if (roomId) {
              addRoomStatusHistory({
                roomId,
                status: "occupied",
                note: `Booking ${booking.confirmationCode} modified`,
                actor: user?.id || null,
              });
            }
          }).catch((err) => {
            console.error('❌ Failed to update Supabase:', err);
          });
        }

        return updatedBooking;
      })
    );
    return updatedBooking;
  };

  /**
   * Auto-cancel pending_payment bookings older than 15 minutes (DB + local)
   */
  useEffect(() => {
    const expiryMinutes = 15;
    const interval = setInterval(() => {
      const now = Date.now();
      saveBookings((prev) =>
        prev.map((booking) => {
          if (booking.status !== "pending_payment") return booking;
          const created = booking.createdAt
            ? new Date(booking.createdAt).getTime()
            : now;
          if (now - created < expiryMinutes * 60 * 1000) return booking;

          // Mark as cancelled locally
          const cancelled = {
            ...booking,
            status: "cancelled",
            cancelReason: "Payment timeout",
            cancelledAt: new Date().toISOString(),
          };

          // Sync to Supabase best-effort
          if (dbConnected && booking.id && booking.id !== "pending") {
            updateBookingStatus(booking.id, "cancelled", {
              note: "Auto-cancelled: payment timeout",
            })
              .then((updated) => {
                const roomId = updated?.room_id || booking.roomId;
                if (roomId) {
                  updateRoomStatus(roomId, "available");
                  addRoomStatusHistory({
                    roomId,
                    status: "available",
                    note: `Booking ${booking.confirmationCode} expired (pending_payment timeout)`,
                    actor: null,
                  });
                }
              })
              .catch((err) =>
                console.error("❌ Failed to cancel pending payment:", err)
              );
          }

          return cancelled;
        })
      );
    }, 60 * 1000); // check every minute

    return () => clearInterval(interval);
  }, [dbConnected]);

  const hasUserBookedRoom = async (userId, roomId) => {
    if (!userId || !roomId) return false;

    // Nếu đã kết nối DB, ưu tiên kiểm tra trực tiếp trên Supabase (bookings table)
    if (dbConnected) {
      try {
        // roomId trong frontend là room UUID; booking lưu room_id + room_type_id.
        // hasUserBookedRoomType kiểm tra theo room_type_id, nên cần map từ roomId -> roomTypeId.
        const room = getRoomById(roomId);
        const roomTypeId = room?.roomTypeId || roomId;
        return await hasUserBookedRoomType(userId, roomTypeId);
      } catch (err) {
        console.error("Error checking booking from DB:", err);
      }
    }

    // Fallback: dùng danh sách bookings trong memory (cùng session)
    return bookings.some(
      (booking) =>
        booking.userId === userId &&
        booking.roomId === roomId &&
        booking.status !== "cancelled"
    );
  };

  /**
   * Add review - save to DB if available, else keep only in memory
   */
  const addReview = (roomId, review) => {
    // Optimistically update UI
    setAllRooms((prevRooms) => {
      const updatedRooms = prevRooms.map((room) =>
        room.id === roomId
          ? { ...room, reviews: [review, ...(room.reviews || [])] }
          : room
      );
      persistReviews(updatedRooms);
      setRooms(filterRooms({ sourceRooms: updatedRooms }));
      return updatedRooms;
    });

    // ✅ SAVE TO SUPABASE
    if (dbConnected) {
      const reviewData = {
        room_type_id: roomId, // Note: DB schema expects room_type_id, not room_id
        user_id: review.userId,
        user_name: review.userName,
        user_email: review.userEmail,
        rating: review.rating,
        comment: review.comment,
        stay_date: review.stayDate || null,
        created_at: review.createdAt || new Date().toISOString(),
      };
      createReview(reviewData)
        .then((dbReview) => {
          if (dbReview) {
            console.log('✅ Review saved to Supabase');
          }
        })
        .catch((err) => {
          console.error('❌ Error saving review to Supabase:', err);
        });
    }
  };

  const getUserBookings = (userId) =>
    bookings.filter((booking) => booking.userId === userId);

  const shareWithChildren = {
    allRooms,
    rooms,
    loading,
    priceRules,
    promotions,
    holidayCalendar,
    fetchRoomStatusBoard,
    updateRoomStatus,
    addRoomStatusHistory,
    dbConnected, // Indicates if Supabase is available
    adults,
    setAdults,
    kids,
    setKids,
    checkInDate,
    setCheckInDate,
    checkOutDate,
    setCheckOutDate,
    selectedRoomTypes,
    toggleRoomType,
    availableRoomTypes,
    selectedAmenities,
    toggleAmenity,
    availableAmenities,
    selectedCategory,
    updateCategory,
    clearAllFilters,
    handleCheck,
    resetRoomFilterData,
    searchTerm,
    updateSearch,
    priceRange,
    priceBounds,
    updatePriceRange,
    sortOption,
    updateSortOption,
    bookRoom,
    bookings,
    getUserBookings,
    confirmBookingPayment,
    checkInBooking,
    checkOutBooking,
    cancelBooking,
    modifyBookingDates,
    hasUserBookedRoom,
    addReview,
    calculatePricingForRoom,
    getRoomPricingPreview: (roomId, start, end) =>
      calculatePricingForRoom(getRoomById(roomId), start, end),
  };

  return (
    <RoomInfo.Provider value={shareWithChildren}>{children}</RoomInfo.Provider>
  );
};

export const useRoomContext = () => useContext(RoomInfo);

--- END FILE: src\context\RoomContext.jsx ---

--- START FILE: src\context\SimpleAuthContext.jsx ---
/**
 * Simple Auth Context - Không dùng Supabase Auth
 * Chỉ dùng Supabase như database, tự quản lý session
 */

import { createContext, useContext, useState, useEffect, useCallback } from 'react';
import {
  registerUser,
  loginUser,
  getUserById,
  updateUserProfile,
  changePassword,
  requestPasswordReset,
  resetPassword,
} from '../services/simpleAuthService';

const AuthInfo = createContext();

const SESSION_KEY = 'hotel_booking_session';

/**
 * Lưu session vào localStorage
 */
const saveSession = (user) => {
  localStorage.setItem(SESSION_KEY, JSON.stringify({
    userId: user.id,
    email: user.email,
    expiresAt: Date.now() + 7 * 24 * 60 * 60 * 1000, // 7 ngày
  }));
};

/**
 * Lấy session từ localStorage
 */
const getSession = () => {
  try {
    const sessionData = localStorage.getItem(SESSION_KEY);
    if (!sessionData) return null;
    
    const session = JSON.parse(sessionData);
    if (session.expiresAt < Date.now()) {
      localStorage.removeItem(SESSION_KEY);
      return null;
    }
    
    return session;
  } catch {
    return null;
  }
};

/**
 * Xóa session
 */
const clearSession = () => {
  localStorage.removeItem(SESSION_KEY);
};

export const SimpleAuthContext = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  /**
   * Initialize auth state on app load
   */
  useEffect(() => {
    const initializeAuth = async () => {
      try {
        setLoading(true);
        setError(null);

        const session = getSession();
        if (session && session.userId) {
          // Load user data
          const userData = await getUserById(session.userId);
          if (userData) {
            setUser(userData);
          } else {
            // User không tồn tại, xóa session
            clearSession();
            setUser(null);
          }
        } else {
          setUser(null);
        }
      } catch (err) {
        console.error('Error initializing auth:', err);
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    initializeAuth();
  }, []);

  /**
   * Register
   */
  const register = useCallback(async (email, password, name = '') => {
    try {
      setLoading(true);
      setError(null);

      const result = await registerUser(email, password, name);

      if (result.success) {
        setUser(result.user);
        saveSession(result.user);
        return { success: true, user: result.user };
      } else {
        setError(result.error);
        return { success: false, error: result.error };
      }
    } catch (err) {
      const errorMsg = err.message || 'An error occurred during registration';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    } finally {
      setLoading(false);
    }
  }, []);

  /**
   * Login
   */
  const login = useCallback(async (email, password) => {
    try {
      setLoading(true);
      setError(null);

      const result = await loginUser(email, password);

      if (result.success) {
        setUser(result.user);
        saveSession(result.user);
        return { success: true, user: result.user };
      } else {
        setError(result.error);
        return { success: false, error: result.error };
      }
    } catch (err) {
      const errorMsg = err.message || 'An error occurred during login';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    } finally {
      setLoading(false);
    }
  }, []);

  /**
   * Admin Login (same as login, but with admin check)
   */
  const adminLogin = useCallback(async (email, password) => {
    try {
      setLoading(true);
      setError(null);

      const result = await loginUser(email, password);

      if (result.success) {
        if (!result.user.isAdmin) {
          setError('User does not have admin privileges');
          return { success: false, error: 'User does not have admin privileges' };
        }
        setUser(result.user);
        saveSession(result.user);
        return { success: true, user: result.user };
      } else {
        setError(result.error);
        return { success: false, error: result.error };
      }
    } catch (err) {
      const errorMsg = err.message || 'An error occurred during admin login';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    } finally {
      setLoading(false);
    }
  }, []);

  /**
   * Logout
   */
  const logout = useCallback(async () => {
    try {
      setLoading(true);
      setError(null);
      clearSession();
      setUser(null);
      return { success: true };
    } catch (err) {
      const errorMsg = err.message || 'An error occurred during logout';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    } finally {
      setLoading(false);
    }
  }, []);

  /**
   * Reset Password Request
   */
  const resetPasswordRequest = useCallback(async (email) => {
    try {
      setLoading(true);
      setError(null);
      const result = await requestPasswordReset(email);
      if (result.success) {
        return { success: true, resetCode: result.resetCode }; // Trả về code để test
      } else {
        setError(result.error);
        return { success: false, error: result.error };
      }
    } catch (err) {
      const errorMsg = err.message || 'An error occurred during password reset';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    } finally {
      setLoading(false);
    }
  }, []);

  /**
   * Reset Password với code
   */
  const resetPasswordWithCode = useCallback(async (email, code, newPassword) => {
    try {
      setLoading(true);
      setError(null);
      const result = await resetPassword(email, code, newPassword);
      if (result.success) {
        return { success: true };
      } else {
        setError(result.error);
        return { success: false, error: result.error };
      }
    } catch (err) {
      const errorMsg = err.message || 'An error occurred during password reset';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    } finally {
      setLoading(false);
    }
  }, []);

  /**
   * Update Password (for logged-in user)
   */
  const updatePassword = useCallback(async (currentPassword, newPassword) => {
    try {
      setLoading(true);
      setError(null);

      if (!user?.id) {
        throw new Error('User not authenticated');
      }

      const result = await changePassword(user.id, currentPassword, newPassword);
      if (result.success) {
        return { success: true };
      } else {
        setError(result.error);
        return { success: false, error: result.error };
      }
    } catch (err) {
      const errorMsg = err.message || 'An error occurred updating password';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    } finally {
      setLoading(false);
    }
  }, [user?.id]);

  /**
   * Update User Profile
   */
  const updateUserProfileHandler = useCallback(async (updates) => {
    try {
      setLoading(true);
      setError(null);

      if (!user?.id) {
        throw new Error('User not authenticated');
      }

      const result = await updateUserProfile(user.id, updates);
      if (result.success) {
        setUser(result.user);
        return { success: true, user: result.user };
      } else {
        setError(result.error);
        return { success: false, error: result.error };
      }
    } catch (err) {
      const errorMsg = err.message || 'An error occurred updating profile';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    } finally {
      setLoading(false);
    }
  }, [user?.id]);

  /**
   * OAuth Login với C# API và Fallback Supabase
   * Tự động fallback nếu C# API không khả dụng
   */
  const loginWithOAuth = useCallback(async (provider) => {
    try {
      setError('');
      setLoading(true);
      const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';
      
      // Bước 1: Thử gọi C# API để lấy OAuth URL (với timeout)
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 giây timeout
        
        const urlsResponse = await fetch(`${API_URL}/api/auth/oauth/urls`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' },
          signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        if (urlsResponse.ok) {
          const urls = await urlsResponse.json();
          
          // Redirect đến OAuth provider qua C# API
          if (provider === 'google' && urls.googleAuthUrl) {
            window.location.href = urls.googleAuthUrl;
            return { success: true, redirecting: true, method: 'csharp' };
          } else if (provider === 'facebook' && urls.facebookAuthUrl) {
            window.location.href = urls.facebookAuthUrl;
            return { success: true, redirecting: true, method: 'csharp' };
          }
        }
      } catch (apiError) {
        // C# API không khả dụng, fallback sang Supabase
        if (apiError.name === 'AbortError') {
          console.warn('C# API timeout, falling back to Supabase OAuth');
        } else {
          console.warn('C# API not available, falling back to Supabase OAuth:', apiError);
        }
      }
      
      // Bước 2: Fallback - Dùng Supabase OAuth nếu C# API không khả dụng
      const { supabase } = await import('../utils/supabaseClient');
      
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: provider,
        options: {
          redirectTo: `${window.location.origin}/auth/callback`
        }
      });

      if (error) {
        throw new Error(`Supabase OAuth error: ${error.message}`);
      }
      
      return { success: true, data, method: 'supabase' };
    } catch (err) {
      console.error('OAuth login error:', err);
      setError(err.message);
      return { success: false, error: err.message };
    } finally {
      setLoading(false);
    }
  }, [setError, setLoading]);

  /**
   * Helper functions
   */
  const isAuthenticated = useCallback(() => {
    return user !== null && getSession() !== null;
  }, [user]);

  const isAdmin = useCallback(() => {
    return user?.isAdmin === true;
  }, [user]);

  const clearError = useCallback(() => {
    setError(null);
  }, []);
  const loginManual = useCallback((userData) => {
    setUser(userData);
    saveSession(userData); // Lưu vào LocalStorage
  }, []);

  const shareWithChildren = {
    // State
    user,
    setUser,
    loginManual,
    loading,
    error,
    session: user ? { user } : null, // Compatible với code cũ

    // Auth methods
    login,
    adminLogin,
    register,
    loginWithOAuth,
    logout,
    resetPassword: resetPasswordRequest,
    resetPasswordWithCode,
    updatePassword,
    updateUserProfile: updateUserProfileHandler,

    // Helper methods
    isAuthenticated,
    isAdmin,
    clearError,
  };

  return (
    <AuthInfo.Provider value={shareWithChildren}>
      {children}
    </AuthInfo.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthInfo);
  if (!context) {
    throw new Error('useAuth must be used within SimpleAuthContext provider');
  }
  return context;
};


--- END FILE: src\context\SimpleAuthContext.jsx ---

--- START FILE: src\features\admin\AdminHeader.jsx ---
/**
 * AdminHeader Component
 * Reusable header for admin sections
 * Props:
 *   - title: String
 *   - description: String
 *   - onAddNew: Function
 *   - addButtonLabel: String
 */

import { FaPlus } from 'react-icons/fa';

const AdminHeader = ({
  title,
  description,
  onAddNew,
  addButtonLabel = 'Add New'
}) => {
  return (
    <>
      <div className="mb-8">
        <h1 className="h2 text-primary mb-2">{title}</h1>
        <p className="text-gray-600">{description}</p>
      </div>

      <div className="bg-white rounded-lg shadow-md p-6 mb-6">
        <button
          onClick={onAddNew}
          className="btn btn-primary btn-sm flex items-center gap-2 w-auto"
        >
          <FaPlus /> {addButtonLabel}
        </button>
      </div>
    </>
  );
};

export default AdminHeader;

--- END FILE: src\features\admin\AdminHeader.jsx ---

--- START FILE: src\features\admin\AdminModal.jsx ---
/**
 * AdminModal Component
 * Reusable modal component for admin forms
 * Props:
 *   - isOpen: Boolean
 *   - title: String
 *   - onClose: Function
 *   - onSubmit: Function
 *   - isLoading: Boolean
 *   - children: ReactNode (form fields)
 *   - submitLabel: String
 */

import { FaCheck } from 'react-icons/fa';

const AdminModal = ({
  isOpen,
  title,
  onClose,
  onSubmit,
  isLoading,
  children,
  submitLabel = 'Save'
}) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6 border-b border-gray-200">
          <h2 className="h3 text-primary">{title}</h2>
        </div>

        <form onSubmit={onSubmit} className="p-6 space-y-4">
          {children}

          <div className="flex gap-4 pt-4 border-t border-gray-200">
            <button
              type="submit"
              disabled={isLoading}
              className="btn btn-primary btn-sm flex-1 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <FaCheck /> {isLoading ? 'Saving...' : submitLabel}
            </button>
            <button
              type="button"
              onClick={onClose}
              disabled={isLoading}
              className="btn btn-secondary btn-sm flex-1 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default AdminModal;

--- END FILE: src\features\admin\AdminModal.jsx ---

--- START FILE: src\features\admin\AdminTable.jsx ---
/**
 * AdminTable Component
 * Reusable table component for admin panels
 * Props:
 *   - columns: Array of { key, label, render? }
 *   - data: Array of data
 *   - isLoading: Boolean
 *   - error: String
 *   - onEdit: Function
 *   - onDelete: Function
 *   - onRetry: Function
 */

import { FaEdit, FaTrash } from 'react-icons/fa';

const AdminTable = ({
  columns,
  data,
  isLoading,
  error,
  onEdit,
  onDelete,
  onRetry,
  emptyMessage = 'No data yet'
}) => {
  if (isLoading) {
    return (
      <div className="bg-white rounded-lg shadow-md p-12 text-center">
        <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
        <p className="mt-4 text-gray-600">Loading...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="bg-red-50 border border-red-200 rounded-lg shadow-md p-6 mb-6">
        <p className="text-red-700 font-semibold">❌ Error: {error}</p>
        <button
          onClick={onRetry}
          className="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
        >
          Retry
        </button>
      </div>
    );
  }

  return (
    <div className="bg-white rounded-lg shadow-md overflow-hidden">
      <div className="overflow-x-auto">
        <table className="w-full">
          <thead className="bg-accent text-white">
            <tr>
              {columns.map((col) => (
                <th
                  key={col.key}
                  className="px-6 py-4 text-left font-tertiary tracking-wider"
                >
                  {col.label}
                </th>
              ))}
              <th className="px-6 py-4 text-center font-tertiary tracking-wider">
                Actions
              </th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-200">
            {data.length === 0 ? (
              <tr>
                <td
                  colSpan={columns.length + 1}
                  className="px-6 py-12 text-center text-gray-500"
                >
                  {emptyMessage}
                </td>
              </tr>
            ) : (
              data.map((item) => (
                <tr key={item.id} className="hover:bg-gray-50">
                  {columns.map((col) => (
                    <td key={`${item.id}-${col.key}`} className="px-6 py-4">
                      {col.render ? col.render(item[col.key], item) : item[col.key]}
                    </td>
                  ))}
                  <td className="px-6 py-4">
                    <div className="flex items-center justify-center gap-2">
                      <button
                        onClick={() => onEdit(item)}
                        className="p-2 text-accent hover:bg-accent/10 rounded transition-colors"
                        title="Edit"
                      >
                        <FaEdit />
                      </button>
                      <button
                        onClick={() => {
                          if (window.confirm('Are you sure you want to delete this item?')) {
                            onDelete(item.id);
                          }
                        }}
                        className="p-2 text-red-500 hover:bg-red-50 rounded transition-colors"
                        title="Delete"
                      >
                        <FaTrash />
                      </button>
                    </div>
                  </td>
                </tr>
              ))
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default AdminTable;

--- END FILE: src\features\admin\AdminTable.jsx ---

--- START FILE: src\features\admin\index.js ---
/**
 * Admin Features Index
 * Central export point for admin components
 */

export { default as AdminTable } from './AdminTable';
export { default as AdminModal } from './AdminModal';
export { default as AdminHeader } from './AdminHeader';

--- END FILE: src\features\admin\index.js ---

--- START FILE: src\hooks\index.js ---
/**
 * Hooks Index
 * Central export point for all custom hooks
 */

export { useCRUD } from './useCRUD';
export { useModalForm } from './useModalForm';

--- END FILE: src\hooks\index.js ---

--- START FILE: src\hooks\useCRUD.js ---
/**
 * Custom Hook: useCRUD
 * Reusable CRUD operations for any Supabase table
 * Handles: Fetch, Create, Update, Delete with loading/error states
 */

import { useState, useCallback, useMemo } from 'react';
import { notifySuccess, notifyError } from '../utils/notifications';
import { supabase } from '../utils/supabaseClient';

/**
 * Defines the required structure for the service layer API used by this hook.
 *
 * @typedef {object} CRUDServiceAPI
 * @property {string} resourceName - Name of the resource (e.g., 'Room Types') for logging and notifications.
 * @property {(filters?: object, orderBy?: { column: string, ascending?: boolean }) => Promise<Array<any>>} fetch - Function to fetch data.
 * @property {(values: object, options?: object) => Promise<any>} create - Function to create a new record.
 * @property {(id: number, values: object, options?: object) => Promise<any>} update - Function to update an existing record.
 * @property {(id: number, options?: object) => Promise<any>} remove - Function to delete a record.
 */

/**
 * Custom Hook: useCRUD
 * Reusable CRUD operations, decoupled from direct Supabase calls via a Service Layer API.
 * Handles: Fetch, Create, Update, Delete with loading/error states
 *
 * Supports two usage patterns:
 * 1. useCRUD({ resourceName, fetch, create, update, remove }) - With service API object
 * 2. useCRUD(tableName, selectString) - Direct Supabase table access (legacy compatibility)
 *
 * @param {CRUDServiceAPI|string} apiOrTableName - Either an API object or table name string
 * @param {string} [selectString] - Select string for Supabase query (when using table name)
 */
export const useCRUD = (apiOrTableName, selectString = '*') => {
  // Legacy mode: if first param is a string, create Supabase service automatically
  if (typeof apiOrTableName === 'string') {
    const tableName = apiOrTableName;
    
    const resourceName = tableName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    
    // Wrap API functions in useMemo to prevent recreation on every render
    const apiFunctions = useMemo(() => {
      const fetchApi = async (filters = {}, orderBy = null) => {
        let query = supabase.from(tableName).select(selectString);
        
        // Apply filters
        Object.entries(filters).forEach(([key, value]) => {
          if (value !== null && value !== undefined && value !== '') {
            query = query.eq(key, value);
          }
        });
        
        // Apply ordering
        if (orderBy) {
          query = query.order(orderBy.column || 'created_at', { ascending: orderBy.ascending !== false });
        }
        
        const { data, error } = await query;
        if (error) throw error;
        return data || [];
      };
      
      const createApi = async (values) => {
        const { data, error } = await supabase.from(tableName).insert([values]).select(selectString);
        if (error) throw error;
        return data?.[0] || null;
      };
      
      const updateApi = async (id, values) => {
        const { data, error } = await supabase.from(tableName).update(values).eq('id', id).select(selectString);
        if (error) throw error;
        return data?.[0] || null;
      };
      
      const removeApi = async (id) => {
        const { error } = await supabase.from(tableName).delete().eq('id', id);
        if (error) throw error;
      };
      
      return { fetchApi, createApi, updateApi, removeApi };
    }, [tableName, selectString]); // Only recreate if tableName or selectString changes
    
    return useCRUDInternal({ 
      resourceName, 
      fetch: apiFunctions.fetchApi, 
      create: apiFunctions.createApi, 
      update: apiFunctions.updateApi, 
      remove: apiFunctions.removeApi 
    });
  }
  
  // Modern mode: use provided API object
  return useCRUDInternal(apiOrTableName);
};

const useCRUDInternal = ({ resourceName, fetch: fetchApi, create: createApi, update: updateApi, remove: removeApi }) => {
  const [data, setData] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  
  // Ensure the resource name is available for logging
  const name = resourceName || 'Resource';

  // FETCH
  const fetchData = useCallback(async (filters = {}, orderBy = null) => {
    if (!fetchApi) {
        console.error(`❌ ${name} does not support fetching.`);
        return [];
    }
    
    try {
      setIsLoading(true);
      setError(null);

      // The service layer function handles the actual DB querying, filtering, and ordering
      const result = await fetchApi(filters, orderBy);

      console.log(`✔ Fetched ${name}:`, result);
      setData(result || []);
      return result || [];
    } catch (err) {
      console.error(`❌ Error fetching ${name}:`, err);
      setError(err.message);
      notifyError(`Error fetching ${name}: ${err.message}`);
      return [];
    } finally {
      setIsLoading(false);
    }
  }, [name, fetchApi]); // Removed setData from dependencies (it's stable)

  // CREATE
  const create = useCallback(async (values, successMessage = `Created ${name} successfully`) => {
    if (!createApi) {
        console.error(`❌ ${name} does not support creation.`);
        throw new Error('Creation not supported');
    }

    try {
      setIsLoading(true);
      
      const result = await createApi(values);
      
      console.log(`✅ Created ${name}:`, result);
      notifySuccess(successMessage);
      await fetchData(); // Refresh data after creation
      return result;
    } catch (err) {
      console.error(`❌ Error creating ${name}:`, err);
      notifyError(`Error creating ${name}: ${err.message}`);
      throw err;
    } finally {
      setIsLoading(false);
    }
  }, [name, createApi, fetchData]);

  // UPDATE
  const update = useCallback(async (id, values, successMessage = `Updated ${name} successfully`) => {
    if (!updateApi) {
        console.error(`❌ ${name} does not support updating.`);
        throw new Error('Updating not supported');
    }

    try {
      setIsLoading(true);
      
      const result = await updateApi(id, values);

      console.log(`✅ Updated ${name}:`, result);
      notifySuccess(successMessage);
      await fetchData(); // Refresh data after update
      return result;
    } catch (err) {
      console.error(`❌ Error updating ${name}:`, err);
      notifyError(`Error updating ${name}: ${err.message}`);
      throw err;
    } finally {
      setIsLoading(false);
    }
  }, [name, updateApi, fetchData]);

  // DELETE
  const remove = useCallback(async (id, successMessage = `Deleted ${name} successfully`) => {
    if (!removeApi) {
        console.error(`❌ ${name} does not support deletion.`);
        throw new Error('Deletion not supported');
    }

    try {
      setIsLoading(true);
      
      await removeApi(id);

      console.log(`✅ Deleted ${name}`);
      notifySuccess(successMessage);
      await fetchData(); // Refresh data after deletion
    } catch (err) {
      console.error(`❌ Error deleting ${name}:`, err);
      notifyError(`Error deleting ${name}: ${err.message}`);
      throw err;
    } finally {
      setIsLoading(false);
    }
  }, [name, removeApi, fetchData]);

  return {
    data,
    setData,
    isLoading,
    error,
    fetchData,
    create,
    update,
    remove
  };
};

--- END FILE: src\hooks\useCRUD.js ---

--- START FILE: src\hooks\useModalForm.js ---
/**
 * Custom Hook: useModalForm
 * Reusable modal form management
 * Handles: Open/Close modal, Edit/Create mode, Form data reset
 */

import { useState, useCallback } from 'react';

export const useModalForm = (initialFormData) => {
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingItem, setEditingItem] = useState(null);
  const [formData, setFormData] = useState(initialFormData);

  // Open modal for creating new item
  const openCreateModal = useCallback(() => {
    setEditingItem(null);
    setFormData(initialFormData);
    setIsModalOpen(true);
  }, [initialFormData]);

  // Open modal for editing existing item
  const openEditModal = useCallback((item) => {
    setEditingItem(item);
    setFormData(item);
    setIsModalOpen(true);
  }, []);

  // Close modal
  const closeModal = useCallback(() => {
    setIsModalOpen(false);
    setEditingItem(null);
    setFormData(initialFormData);
  }, [initialFormData]);

  // Update form data
  const updateFormData = useCallback((updates) => {
    setFormData(prev => ({ ...prev, ...updates }));
  }, []);

  // Reset form data
  const resetFormData = useCallback(() => {
    setFormData(initialFormData);
  }, [initialFormData]);

  return {
    isModalOpen,
    editingItem,
    formData,
    setFormData,
    openCreateModal,
    openEditModal,
    closeModal,
    updateFormData,
    resetFormData,
    isEditing: !!editingItem
  };
};

--- END FILE: src\hooks\useModalForm.js ---

--- START FILE: src\main.jsx ---
import { RoomContext } from './context/RoomContext';
import { SimpleAuthContext } from './context/SimpleAuthContext';
import { LanguageProvider } from './context/LanguageContext';
import { BookingProvider } from './context/BookingContext';
import ReactDOM from 'react-dom/client'
import React from 'react'
import App from './App'
import './style/index.css';


ReactDOM
  .createRoot(document.getElementById('root'))
  .render(
    <LanguageProvider>
      <SimpleAuthContext>
        <RoomContext>
          <BookingProvider>
            <React.StrictMode>
              <App />
            </React.StrictMode>
          </BookingProvider>
        </RoomContext>
      </SimpleAuthContext>
    </LanguageProvider>,
  )
--- END FILE: src\main.jsx ---

--- START FILE: src\pages\Admin.jsx ---
import { useState } from 'react';
import AdminSidebar from '../components/AdminSidebar';
import RoomTypesManagement from '../components/admin/RoomTypesManagement';
import RoomsManagement from '../components/admin/RoomsManagement';
import PriceRulesManagement from '../components/admin/PriceRulesManagement';
import PromotionsManagement from '../components/admin/PromotionsManagement';
import BookingsManagement from '../components/admin/BookingsManagement';
import UsersManagement from '../components/admin/UsersManagement';
import AuditLogsManagement from '../components/admin/AuditLogsManagement';
import ReportsManagement from '../components/admin/ReportsManagement';

const Admin = () => {
  const [activeSection, setActiveSection] = useState('room-types');

  const renderContent = () => {
    switch (activeSection) {
      case 'room-types':
        return <RoomTypesManagement />;
      case 'rooms':
        return <RoomsManagement />;
      case 'price-rules':
        return <PriceRulesManagement />;
      case 'promotions':
        return <PromotionsManagement />;
      case 'bookings':
        return <BookingsManagement />;
      case 'users':
        return <UsersManagement />;
      case 'audit-logs':
        return <AuditLogsManagement />;
      case 'reports':
        return <ReportsManagement />;
      default:
        return <RoomTypesManagement />;
    }
  };

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="flex relative">
        {/* Sidebar */}
        <AdminSidebar activeSection={activeSection} setActiveSection={setActiveSection} />
        
        {/* Main Content */}
        <div className="flex-1 lg:ml-64">
          <div className="p-4 lg:p-8">
            {renderContent()}
          </div>
        </div>
      </div>
    </div>
  );
};

export default Admin;


--- END FILE: src\pages\Admin.jsx ---

--- START FILE: src\pages\AuthCallback.jsx ---
import { useEffect, useState } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { supabase } from '../utils/supabaseClient';
import { useAuth } from '../context/SimpleAuthContext';
import { FaSpinner, FaCheckCircle, FaTimesCircle } from 'react-icons/fa';

const AuthCallback = () => {
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();
  const { setUser, loginManual } = useAuth();
  const [status, setStatus] = useState('processing');
  const [message, setMessage] = useState('Processing login...');

  useEffect(() => {
    const handleCallback = async () => {
      try {
        const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';
        const code = searchParams.get('code');
        const provider = searchParams.get('provider') || 
                        (window.location.href.includes('google') ? 'google' : 
                         window.location.href.includes('facebook') ? 'facebook' : 'google');

        // Nếu có email và name từ query params (từ C# API redirect)
        const emailFromQuery = searchParams.get('email');
        const nameFromQuery = searchParams.get('name');
        const errorFromQuery = searchParams.get('error');

        if (errorFromQuery) {
          setStatus('error');
          setMessage(errorFromQuery);
          setTimeout(() => navigate('/login'), 5000);
          return;
        }

        if (emailFromQuery) {
          // User info đã được C# API xử lý và redirect về đây
          try {
            const { data: existingUser, error: dbError } = await supabase
              .from('users')
              .select('*')
              .eq('email', emailFromQuery)
              .single();

            // Nếu có lỗi và không phải "not found", throw error
            if (dbError) {
              if (dbError.code === 'PGRST116') {
                // User không tồn tại, sẽ tạo mới
              } else {
                console.error('Database error when finding user:', dbError);
                throw new Error(`Database error: ${dbError.message}`);
              }
            }

            if (!existingUser) {
              // Tạo user mới với password_hash = 'oauth_user' (cần set password sau)
              const { data: newUser, error: createError } = await supabase
                .from('users')
                .insert([{
                  email: emailFromQuery,
                  full_name: nameFromQuery || emailFromQuery,
                  is_admin: false,
                  is_email_verified: true,
                  password_hash: 'oauth_user' // Đánh dấu cần set password
                }])
                .select()
                .single();

              if (createError) {
                console.error('Error creating user:', createError);
                throw new Error(`Unable to create account: ${createError.message}`);
              }

              if (!newUser) {
                throw new Error('Account creation failed - no data received');
              }

              // Set user vào context
              try {
                setUser(newUser);
              } catch (setUserError) {
                console.error('Error setting user in context:', setUserError);
                // Vẫn tiếp tục vì user đã được tạo
              }

              // Redirect đến SetPassword để đặt mật khẩu
              setStatus('success');
              setMessage('Login successful! Please set password.');
              setTimeout(() => {
                navigate(`/set-password?email=${encodeURIComponent(emailFromQuery)}`);
              }, 3000);
              return;
            } else {
              // User đã tồn tại
              // Update last_login
              const { error: updateError } = await supabase
                .from('users')
                .update({ last_login: new Date().toISOString() })
                .eq('id', existingUser.id);

              if (updateError) {
                console.warn('Error updating last_login:', updateError);
                // Không throw, chỉ log warning
              }

              // Set user vào context
              try {
                setUser(existingUser);
              } catch (setUserError) {
                console.error('Error setting user in context:', setUserError);
                throw new Error('Error When Login');
              }

              // Check xem user có cần set password không (trim để tránh whitespace)
              const passwordHash = String(existingUser.password_hash || '').trim();
              if (passwordHash === 'oauth_user' || passwordHash === '' || !passwordHash) {
                setStatus('success');
                setMessage('Login successful! Please set password.');
                setTimeout(() => {
                  navigate(`/set-password?email=${encodeURIComponent(emailFromQuery)}`);
                }, 3000);
                return;
              }

              // User đã có password, login thành công
              setStatus('success');
              setMessage('Login successful!');
              setTimeout(() => navigate('/'), 5000);
              return;
            }
          } catch (userError) {
            console.error('Error processing user:', userError);
            throw userError; // Re-throw để catch ở ngoài
          }
        }

        // Ưu tiên: Thử xử lý qua C# API trước (nếu có code)
        if (code) {
          try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 giây timeout
            
            const response = await fetch(`${API_URL}/api/auth/${provider}/callback?code=${code}`, {
              method: 'GET',
              signal: controller.signal
            });

            clearTimeout(timeoutId);

            // C# API sẽ redirect, không cần xử lý response ở đây
            if (response.redirected) {
              // Đã được redirect, sẽ xử lý ở lần load tiếp theo
              return;
            }

            if (response.ok) {
              const result = await response.json();
              if (result.success && result.user) {
                // Lưu user vào database nếu chưa có
                const { data: existingUser, error: dbError } = await supabase
                  .from('users')
                  .select('*')
                  .eq('email', result.user.email)
                  .single();

                if (dbError && dbError.code !== 'PGRST116') {
                  console.error('Database error:', dbError);
                }

                if (!existingUser) {
                  // Tạo user mới với password_hash = 'oauth_user' (cần set password sau)
                  const { data: newUser, error: createError } = await supabase
                    .from('users')
                    .insert([{
                      email: result.user.email,
                      full_name: result.user.name || result.user.email,
                      is_admin: false,
                      is_email_verified: true,
                      password_hash: 'oauth_user' // Đánh dấu cần set password
                    }])
                    .select()
                    .single();

                  if (createError) {
                    console.error('Error creating user:', createError);
                    throw new Error(`Unable to create account: ${createError.message}`);
                  }

                  if (!newUser) {
                    throw new Error('Account creation failed - no data received');
                  }

                  // Set user vào context
                  try {
                    setUser(newUser);
                  } catch (setUserError) {
                    console.error('Error setting user in context:', setUserError);
                  }

                  // Redirect đến SetPassword để đặt mật khẩu
                  setStatus('success');
                  setMessage('Login successful! Please set password.');
                  setTimeout(() => {
                    navigate(`/set-password?email=${encodeURIComponent(result.user.email)}`);
                  }, 3000);
                  return;
                } else {
                  // Update last_login
                  const { error: updateError } = await supabase
                    .from('users')
                    .update({ last_login: new Date().toISOString() })
                    .eq('id', existingUser.id);

                  if (updateError) {
                    console.warn('Error updating last_login:', updateError);
                  }

                  // Set user vào context
                  try {
                    setUser(existingUser);
                  } catch (setUserError) {
                    console.error('Error setting user in context:', setUserError);
                    throw new Error('Error when logging in');
                  }

                  // Check xem user có cần set password không (trim để tránh whitespace)
                  const passwordHash = String(existingUser.password_hash || '').trim();
                  if (passwordHash === 'oauth_user' || passwordHash === '' || !passwordHash) {
                    setStatus('success');
                    setMessage('Login successful! Please set password.');
                    setTimeout(() => {
                      navigate(`/set-password?email=${encodeURIComponent(result.user.email)}`);
                    }, 3000);
                    return;
                  }

                  // User đã có password, login thành công
                  setStatus('success');
                  setMessage('Login successful!');
                  setTimeout(() => navigate('/'), 5000);
                  return;
                }
              }
            }
          } catch (apiError) {
            // C# API không khả dụng hoặc timeout, fallback sang Supabase
            if (apiError.name === 'AbortError') {
              console.warn('C# API timeout, falling back to Supabase OAuth');
            } else {
              console.warn('C# API callback failed, trying Supabase fallback:', apiError);
            }
            // Tiếp tục với Supabase fallback
          }
        }

        // Fallback: Xử lý qua Supabase Auth (chỉ khi không có code hoặc C# API fail)
        const { data: { session }, error } = await supabase.auth.getSession();
        
        if (error) {
          console.error('Supabase session error:', error);
          throw error;
        }

        if (session?.user) {
          const supabaseUser = session.user;
          
          const { data: existingUser, error: dbError } = await supabase
            .from('users')
            .select('*')
            .eq('email', supabaseUser.email)
            .single();

          if (dbError && dbError.code !== 'PGRST116') {
            console.error('Database error:', dbError);
          }

          if (!existingUser) {
            // Tạo user mới với password_hash = 'oauth_user' (cần set password sau)
            const { data: newUser, error: createError } = await supabase
              .from('users')
              .insert([{
                email: supabaseUser.email,
                full_name: supabaseUser.user_metadata?.full_name || supabaseUser.email,
                is_admin: false,
                is_email_verified: true,
                password_hash: 'oauth_user' // Đánh dấu cần set password
              }])
              .select()
              .single();

            if (createError) {
              console.error('Error creating user:', createError);
              throw new Error(`Unable to create account: ${createError.message}`);
            }

            if (!newUser) {
              throw new Error('Account creation failed - no data received');
            }

            // Set user vào context
            try {
              setUser(newUser);
            } catch (setUserError) {
              console.error('Error setting user in context:', setUserError);
            }

            // Redirect đến SetPassword để đặt mật khẩu
            setStatus('success');
            setMessage('Login successful! Please set password.');
            setTimeout(() => {
              navigate(`/set-password?email=${encodeURIComponent(supabaseUser.email)}`);
            }, 3000);
            return;
          } else {
            // Update last_login
            const { error: updateError } = await supabase
              .from('users')
              .update({ last_login: new Date().toISOString() })
              .eq('id', existingUser.id);

            if (updateError) {
              console.warn('Error updating last_login:', updateError);
            }

            // Set user vào context
            try {
              loginManual(existingUser);
            } catch (setUserError) {
              console.error('Error setting user in context:', setUserError);
              throw new Error('Error when logging in');
            }

            // Check xem user có cần set password không (trim để tránh whitespace)
            const passwordHash = String(existingUser.password_hash || '').trim();
            if (passwordHash === 'oauth_user' || passwordHash === '' || !passwordHash) {
              setStatus('success');
              setMessage('Login successful! Please set password.');
              setTimeout(() => {
                navigate(`/set-password?email=${encodeURIComponent(supabaseUser.email)}`);
              }, 3000);
              return;
            }

            // User đã có password, login thành công
            setStatus('success');
            setMessage('Login successful!');
            setTimeout(() => navigate('/'), 5000);
            return;
          }
        }

        setStatus('error');
        setMessage('Login failed. Please try again.');
        setTimeout(() => navigate('/login'), 3000);
      } catch (err) {
        console.error('Callback error:', err);
        console.error('Error details:', {
          message: err.message,
          stack: err.stack,
          name: err.name
        });
        setStatus('error');
        setMessage(err.message || 'An error occurred. Redirecting to login...');
        setTimeout(() => navigate('/login'), 3000);
      }
    };

    handleCallback();
  }, [navigate, searchParams, setUser]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary via-primary to-accent/20 flex items-center justify-center p-4">
      <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
        {status === 'processing' && (
          <>
            <FaSpinner className="animate-spin text-4xl text-accent mx-auto mb-4" />
            <p className="text-lg text-primary">{message}</p>
          </>
        )}
        {status === 'success' && (
          <>
            <FaCheckCircle className="text-green-500 text-5xl mx-auto mb-4" />
            <p className="text-lg text-primary font-semibold">{message}</p>
            <p className="text-sm text-gray-500 mt-2">Redirecting...</p>
          </>
        )}
        {status === 'error' && (
          <>
            <FaTimesCircle className="text-red-500 text-5xl mx-auto mb-4" />
            <p className="text-lg text-primary">{message}</p>
            <button
              onClick={() => navigate('/login')}
              className="mt-4 btn btn-primary"
            >
              Back to Login
            </button>
          </>
        )}
      </div>
    </div>
  );
};

export default AuthCallback;


--- END FILE: src\pages\AuthCallback.jsx ---

--- START FILE: src\pages\CleanupPage.jsx ---
import { useNavigate } from "react-router-dom";
import { LogoDark } from "../assets";

const CleanupPage = () => {
  const navigate = useNavigate();

  // Trang này giờ chỉ là trang thông tin; các nút thao tác xoá localStorage
  // đã được vô hiệu hóa vì hệ thống không còn lưu booking/review ở local.

  return (
    <div className="min-h-screen py-12 bg-gradient-to-br from-red-50 to-orange-50">
      <div className="container mx-auto px-6 max-w-md">
        <LogoDark className="w-40 mx-auto mb-10 opacity-80" />

        <div className="bg-white rounded-2xl shadow-xl p-8 space-y-6">
          <div>
            <h1 className="text-3xl font-primary text-primary mb-2">
              System Cleanup
            </h1>
            <p className="text-primary/70 text-sm">
              Delete test data to start fresh
            </p>
          </div>

          <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
            <p className="text-sm text-yellow-800">
              ⚠️ <strong>Warning:</strong> These actions cannot be undone.
              Deleted data will be permanently removed.
            </p>
          </div>

          <div className="space-y-3">
            <button
              disabled
              className="w-full py-3 px-4 bg-gray-300 text-gray-600 rounded-lg font-semibold cursor-not-allowed"
            >
              Local data cleanup is no longer required
            </button>
          </div>

          <button
            onClick={() => navigate("/")}
            className="w-full py-2 px-4 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-semibold transition"
          >
            ← Back to Home
          </button>

          <div className="text-xs text-primary/60 text-center pt-4 border-t">
            <p>
              Booking and review data is now stored exclusively in Supabase.
              This utility page is kept only for backward compatibility.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default CleanupPage;

--- END FILE: src\pages\CleanupPage.jsx ---

--- START FILE: src\pages\Contact.jsx ---
import { useState } from 'react';
import { ScrollToTop, Toast } from '../components';
import { FaEnvelope, FaMapMarkerAlt, FaPhoneAlt, FaClock } from 'react-icons/fa';

const STORAGE_URL = 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms';

const contactCards = [
  {
    title: 'Concierge Desk',
    detail: '+84 24 1234 5678',
    subtitle: 'Available 24/7 for urgent assistance',
    icon: FaPhoneAlt,
  },
  {
    title: 'Reservations',
    detail: 'booking@adinahotel.com',
    subtitle: 'Response within 30 minutes',
    icon: FaEnvelope,
  },
  {
    title: 'Visit Us',
    detail: '12 Tran Hung Dao, Hoan Kiem, Ha Noi',
    subtitle: 'Private transfers on request',
    icon: FaMapMarkerAlt,
  },
  {
    title: 'Opening Hours',
    detail: 'Daily • 06:00 - 23:00',
    subtitle: 'Spa & Restaurant 09:00 - 22:00',
    icon: FaClock,
  },
];

const initialFormState = {
  fullName: '',
  email: '',
  phone: '',
  subject: '',
  message: '',
};

const Contact = () => {
  const [formData, setFormData] = useState(initialFormState);
  const [errors, setErrors] = useState({});
  const [submitting, setSubmitting] = useState(false);
  const [toast, setToast] = useState(null);

  const validate = () => {
    const nextErrors = {};
    if (!formData.fullName.trim()) nextErrors.fullName = 'Please enter your full name.';
    if (!formData.email.trim()) {
      nextErrors.email = 'Please enter an email address.';
    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) {
      nextErrors.email = 'Email format looks incorrect.';
    }
    if (!formData.phone.trim()) nextErrors.phone = 'Please enter a phone number.';
    if (!formData.subject.trim()) nextErrors.subject = 'Please add a subject.';
    if (formData.message.trim().length < 10) nextErrors.message = 'Message should be at least 10 characters.';
    return nextErrors;
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
    setErrors((prev) => ({ ...prev, [name]: '' }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    const validationErrors = validate();
    if (Object.keys(validationErrors).length) {
      setErrors(validationErrors);
      return;
    }

    setSubmitting(true);
    try {
      // Try to save to database (if contact_messages table exists)
      const { supabase } = await import('../utils/supabaseClient');
      
      try {
        const { error: dbError } = await supabase
          .from('contact_messages')
          .insert([{
            full_name: formData.fullName,
            email: formData.email,
            phone: formData.phone,
            subject: formData.subject,
            message: formData.message,
            created_at: new Date().toISOString(),
          }]);
        
        if (dbError) {
          console.warn('Contact message table not found or error:', dbError);
          // Continue with email fallback
        }
      } catch (dbErr) {
        console.warn('Database save failed, using email only:', dbErr);
      }
      
      // Try to send email notification (if email service is configured)
      try {
        const { sendContactEmail, isContactEmailConfigured } = await import('../utils/emailService');
        
        if (isContactEmailConfigured && isContactEmailConfigured()) {
          await sendContactEmail({
            fromName: formData.fullName,
            fromEmail: formData.email,
            phone: formData.phone,
            subject: formData.subject,
            message: formData.message,
          });
        }
      } catch (emailErr) {
        console.warn('Email service not configured or failed:', emailErr);
        // Still show success to user
      }
      
      setToast({
        type: 'success',
        message: 'Thank you! Our concierge will get back to you within 30 minutes.',
      });
      setFormData(initialFormState);
    } catch (error) {
      console.error(error);
      setToast({
        type: 'error',
        message: 'Something went wrong, please try again shortly.',
      });
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <div className='bg-[#f7f4ef] min-h-screen'>
      <ScrollToTop />
      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

      <section className='relative h-[50vh] min-h-[420px] flex items-center justify-center text-center'>
        <img
          src={`${STORAGE_URL}/img/heroSlider/2.jpg`}
          alt='Lobby welcome area'
          className='absolute inset-0 h-full w-full object-cover'
        />
        <div className='absolute inset-0 bg-black/60' />
        <div className='relative z-10 max-w-2xl px-6 text-white'>
          <p className='font-tertiary uppercase tracking-[6px] text-sm mb-4'>
            We are at your service
          </p>
          <h1 className='font-primary text-4xl md:text-5xl lg:text-6xl leading-tight mb-6'>
            Contact Adina Hotel &amp; Spa
          </h1>
          <p className='text-lg text-white/80'>
            Whether it is tailor-made experiences, private events, or urgent support—our concierge team is always on standby.
          </p>
        </div>
      </section>

      <section className='container mx-auto px-6 lg:px-0 mt-10 relative z-20'>
        <div className='bg-white/95 shadow-2xl border border-[#eadfcf] rounded-lg px-6 py-8 lg:px-10 lg:py-10'>
          <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6'>
            {contactCards.map(({ title, detail, subtitle, icon: Icon }) => (
              <div key={title} className='h-full border border-[#eadfcf]/60 rounded-lg p-6 flex flex-col gap-3 bg-white min-w-0'>
                <Icon className='text-accent text-3xl' />
                <p className='font-tertiary uppercase tracking-[3px] text-xs text-primary/70'>
                  {title}
                </p>
                <h3 className='font-primary text-2xl leading-tight break-words'>{detail}</h3>
                <p className='text-sm text-primary/70'>{subtitle}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section className='container mx-auto px-6 lg:px-0 py-16 grid grid-cols-1 lg:grid-cols-2 gap-10'>
        <div className='bg-white p-8 shadow-sm border border-[#eadfcf]'>
          <p className='font-tertiary uppercase tracking-[4px] text-xs text-primary/70 mb-2'>
            Leave a Message
          </p>
          <h2 className='font-primary text-3xl mb-6'>Book a Private Consultation</h2>
          <form onSubmit={handleSubmit} className='space-y-5'>
            <div>
              <label className='block text-sm font-semibold mb-2'>Full name</label>
              <input
                type='text'
                name='fullName'
                value={formData.fullName}
                onChange={handleChange}
                className={`w-full border px-4 py-3 focus:outline-none focus:border-accent ${
                  errors.fullName ? 'border-red-400' : 'border-[#eadfcf]'
                }`}
                placeholder='John Carter'
              />
              {errors.fullName && <p className='text-sm text-red-500 mt-1'>{errors.fullName}</p>}
            </div>

            <div className='grid grid-cols-1 md:grid-cols-2 gap-5'>
              <div>
                <label className='block text-sm font-semibold mb-2'>Email</label>
                <input
                  type='email'
                  name='email'
                  value={formData.email}
                  onChange={handleChange}
                  className={`w-full border px-4 py-3 focus:outline-none focus:border-accent ${
                    errors.email ? 'border-red-400' : 'border-[#eadfcf]'
                  }`}
                  placeholder='ban@example.com'
                />
                {errors.email && <p className='text-sm text-red-500 mt-1'>{errors.email}</p>}
              </div>
              <div>
                <label className='block text-sm font-semibold mb-2'>Phone number</label>
                <input
                  type='tel'
                  name='phone'
                  value={formData.phone}
                  onChange={handleChange}
                  className={`w-full border px-4 py-3 focus:outline-none focus:border-accent ${
                    errors.phone ? 'border-red-400' : 'border-[#eadfcf]'
                  }`}
                  placeholder='+84 987 654 321'
                />
                {errors.phone && <p className='text-sm text-red-500 mt-1'>{errors.phone}</p>}
              </div>
            </div>

            <div>
              <label className='block text-sm font-semibold mb-2'>Subject</label>
              <input
                type='text'
                name='subject'
                value={formData.subject}
                onChange={handleChange}
                className={`w-full border px-4 py-3 focus:outline-none focus:border-accent ${
                  errors.subject ? 'border-red-400' : 'border-[#eadfcf]'
                }`}
                placeholder='Request for stay, event planning...'
              />
              {errors.subject && <p className='text-sm text-red-500 mt-1'>{errors.subject}</p>}
            </div>

            <div>
              <label className='block text-sm font-semibold mb-2'>Message</label>
              <textarea
                name='message'
                value={formData.message}
                onChange={handleChange}
                rows={5}
                className={`w-full border px-4 py-3 focus:outline-none focus:border-accent resize-none ${
                  errors.message ? 'border-red-400' : 'border-[#eadfcf]'
                }`}
                placeholder='Share your expectations so we can curate every detail...'
              />
              {errors.message && <p className='text-sm text-red-500 mt-1'>{errors.message}</p>}
            </div>

            <button
              type='submit'
              className='btn btn-primary w-full uppercase tracking-[4px]'
              disabled={submitting}
            >
              {submitting ? 'Sending...' : 'Send request'}
            </button>
            <p className='text-xs text-primary/60 text-center'>
              *We respond to every inquiry within 30 working minutes.
            </p>
          </form>
        </div>

        <div className='bg-white border border-[#eadfcf] shadow-sm'>
          <iframe
            title='Adina Hotel Location'
            src='https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3724.0085669024215!2d105.84117087606554!3d21.03151128743644!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135abbd6fb5ef07%3A0x6f8dfb1ea1f7597!2zMTIgVHLhuqduIEjGsG5nIERhbywgSOG6o2kgS2nhu4FuLCBIw6AgTuG7mWkgMTAwMDA!5e0!3m2!1svi!2svi!4v1731810000000!5m2!1svi!2svi'
            width='100%'
            height='100%'
            className='min-h-[420px] w-full border-0'
            allowFullScreen=''
            loading='lazy'
            referrerPolicy='no-referrer-when-downgrade'
          ></iframe>
          <div className='p-6'>
            <h3 className='font-primary text-2xl mb-3'>Getting here</h3>
            <ul className='space-y-2 text-primary/80 text-sm'>
              <li>• 35 minutes from Noi Bai airport via private limousine</li>
              <li>• 5 minutes from Hanoi Railway Station with VIP pick-up</li>
              <li>• Complimentary valet parking available 24/7</li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  );
};

export default Contact;
--- END FILE: src\pages\Contact.jsx ---

--- START FILE: src\pages\ForgotPassword.jsx ---
import { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { getLogoUrl } from '../utils/supabaseStorageUrls';
import { FaEnvelope, FaSpinner, FaArrowLeft, FaCheckCircle } from 'react-icons/fa';
import Toast from '../components/Toast';
import { useAuth } from '../context/SimpleAuthContext';

const ForgotPassword = () => {
  const [email, setEmail] = useState('');
  const [toast, setToast] = useState(null);
  const [successMessage, setSuccessMessage] = useState('');
  const [resetCode, setResetCode] = useState('');
  const navigate = useNavigate();
  const { resetPassword, loading, error: authError } = useAuth();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setSuccessMessage('');
    setResetCode('');

    if (!email) {
      setToast({
        message: 'Please enter your email address',
        type: 'error'
      });
      return;
    }

    // Thử gọi C# API trước
    const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';
    
    try {
      const apiResponse = await fetch(`${API_URL}/api/auth/forgot-password`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });

      if (apiResponse.ok) {
        const apiResult = await apiResponse.json();
        if (apiResult.success) {
          const code = apiResult.resetCode || 'N/A';
          setResetCode(code);
          setToast({
            message: 'Password reset email sent successfully!',
            type: 'success'
          });
          setSuccessMessage(`A password reset code has been sent to your email. Code expires in 15 minutes.`);
          setTimeout(() => {
            navigate(`/reset-password?email=${encodeURIComponent(email)}&code=${code}`);
          }, 3000);
          return;
        }
      }
    } catch (apiError) {
      console.warn('C# API not available, using fallback:', apiError);
    }

    // Fallback: Dùng logic hiện tại
    const result = await resetPassword(email);
    
    if (result.success) {
      const code = result.resetCode || 'N/A';
      setResetCode(code);
      setToast({
        message: `Password reset code generated!`,
        type: 'success'
      });
      setSuccessMessage(`A password reset code has been generated. Use this code to reset your password. Code expires in 1 hour.`);
      
      setTimeout(() => {
        navigate(`/reset-password?email=${encodeURIComponent(email)}&code=${code}`);
      }, 3000);
    } else {
      setToast({
        message: result.error || 'Failed to generate reset code. Please try again.',
        type: 'error'
      });
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary via-primary to-accent/20 flex items-center justify-center p-4">
      {/* Background decoration */}
      <div className="absolute inset-0 overflow-hidden">
        <div className="absolute top-0 left-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
        <div className="absolute bottom-0 right-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl translate-x-1/2 translate-y-1/2"></div>
      </div>

      {/* Forgot Password Card */}
      <div className="relative z-10 w-full max-w-md">
        <div className="bg-white rounded-2xl shadow-2xl overflow-hidden">
          {/* Header */}
          <div className="bg-gradient-to-r from-accent to-accent-hover p-8 text-center">
            <div className="flex justify-center mb-4">
          <img src={getLogoUrl('dark')} alt="logo" className="w-[180px] brightness-0 invert" />
            </div>
            <h1 className="text-2xl font-primary text-white mb-2">Forgot Password?</h1>
            <p className="text-white/90 text-sm">We'll send you a password reset link</p>
          </div>

          {/* Form */}
          {!successMessage ? (
            <form onSubmit={handleSubmit} className="p-8 space-y-6">
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  Email Address
                </label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <FaEnvelope className="text-gray-400" />
                  </div>
                  <input
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    className="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                    placeholder="your@email.com"
                    required
                    disabled={loading}
                  />
                </div>
                <p className="text-xs text-gray-500 mt-2">
                  Enter the email address associated with your account and we'll send you a password reset link.
                </p>
              </div>

              <button
                type="submit"
                disabled={loading}
                className="w-full btn btn-primary btn-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {loading ? (
                  <>
                    <FaSpinner className="animate-spin" />
                    Sending...
                  </>
                ) : (
                  <>
                    <FaEnvelope />
                    Send Reset Link
                  </>
                )}
              </button>

              {/* Back to Login */}
              <div className="text-center pt-4">
                <Link
                  to="/login"
                  className="inline-flex items-center gap-2 text-sm text-accent hover:text-accent-hover transition-colors"
                >
                  <FaArrowLeft />
                  Back to Sign In
                </Link>
              </div>
            </form>
          ) : (
            <div className="p-8 space-y-6">
              <div className="text-center mb-6">
                <FaCheckCircle className="text-5xl text-green-500 mx-auto mb-4" />
                <h2 className="text-xl font-semibold text-gray-800 mb-2">Reset Link Sent!</h2>
              </div>
              
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2">
                <p className="text-sm text-blue-900">
                  {successMessage}
                </p>
                {resetCode && (
                  <div className="mt-3 p-3 bg-white rounded border-2 border-blue-300">
                    <p className="text-xs text-blue-700 mb-1 font-semibold">Your Reset Code:</p>
                    <p className="text-2xl font-mono font-bold text-blue-900 tracking-wider text-center">
                      {resetCode}
                    </p>
                    <p className="text-xs text-blue-600 mt-2 text-center">
                      (You will be redirected to reset page in 3 seconds)
                    </p>
                  </div>
                )}
              </div>

              <div className="space-y-3">
                <Link
                  to="/login"
                  className="block w-full btn btn-primary btn-lg text-center"
                >
                  Back to Sign In
                </Link>
                <button
                  onClick={() => {
                    setSuccessMessage('');
                    setEmail('');
                    setResetCode('');
                  }}
                  className="w-full btn btn-secondary btn-sm"
                >
                  Request Another Code
                </button>
              </div>
            </div>
          )}

          {/* Footer */}
          <div className="px-8 py-4 bg-gray-50 border-t border-gray-200 text-center">
            <p className="text-xs text-gray-500">
              © {new Date().getFullYear()} Hotel Booking. All rights reserved.
            </p>
          </div>
        </div>
      </div>

      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}
    </div>
  );
};

export default ForgotPassword;


--- END FILE: src\pages\ForgotPassword.jsx ---

--- START FILE: src\pages\Home.jsx ---
import { BookForm, HeroSlider, Rooms, ScrollToTop } from '../components';


const Home = () => {

  return (
    <div>
      <ScrollToTop />

      <HeroSlider />

      <div className='container mx-auto relative'>

        <div className='bg-accent/20 mt-4 p-4 lg:absolute lg:left-0 lg:right-0 lg:p-0 lg:-top-12 lg:z-30 lg:shadow-xl'>
          <BookForm />
        </div>

      </div>

      <Rooms />
    </div>
  );
};

export default Home;

--- END FILE: src\pages\Home.jsx ---

--- START FILE: src\pages\index.js ---
export { default as RoomDetails } from "./RoomDetails";
export { default as Home } from "./Home";
export { default as Admin } from "./Admin";
export { default as Login } from "./Login";
export { default as Register } from "./Register";
export { default as ForgotPassword } from "./ForgotPassword";
export { default as ResetPassword } from "./ResetPassword";
export { default as RoomsPage } from "./RoomsPage";
export { default as Contact } from "./Contact";
export { default as UserDashboard } from "./UserDashboard";
export { default as RestaurantPage } from "./RestaurantPage";
export { default as SpaPage } from "./SpaPage";
export { default as NotFound404 } from "./NotFound404";
export { default as AuthCallback } from "./AuthCallback";
export { default as SetPassword } from "./SetPassword";

--- END FILE: src\pages\index.js ---

--- START FILE: src\pages\Login.jsx ---
import { useState, useEffect } from 'react';
import { useNavigate, useLocation, Link } from 'react-router-dom';
import { useAuth } from '../context/SimpleAuthContext';
import { FaEnvelope, FaLock, FaSpinner, FaGoogle, FaFacebook, FaUserShield, FaUser } from 'react-icons/fa';
import Toast from '../components/Toast';
import { getLogoUrl } from '../utils/supabaseStorageUrls';

const Login = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [userRole, setUserRole] = useState('user'); // 'user' or 'admin'
  const [toast, setToast] = useState(null);
  
  const { login, adminLogin, loginWithOAuth, loading, isAuthenticated } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();

  useEffect(() => {
    // Auto-detect role from URL path
    const isAdmin = location.pathname === '/admin/login' || location.search.includes('admin=true');
    if (isAdmin) {
      setUserRole('admin');
    }
  }, [location]);

  useEffect(() => {
    if (isAuthenticated()) {
      const from = location.state?.from?.pathname || (userRole === 'admin' ? '/admin' : '/');
      navigate(from, { replace: true });
    }
  }, [isAuthenticated, navigate, location, userRole]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (!email || !password) {
      setError('Please fill in all fields');
      return;
    }

    // Sử dụng role được chọn để quyết định login method
    const result = userRole === 'admin'
      ? await adminLogin(email, password)
      : await login(email, password);
    
    if (result.success) {
      setToast({
        message: `Welcome back, ${result.user.name || result.user.email}!`,
        type: 'success'
      });
      setTimeout(() => {
        // Redirect dựa trên role được chọn hoặc role thực tế của user
        let redirectPath = '/';
        if (userRole === 'admin' || result.user.isAdmin) {
          redirectPath = '/admin';
        } else {
          redirectPath = '/';
        }
        const from = location.state?.from?.pathname || redirectPath;
        navigate(from, { replace: true });
      }, 1500);
    } else {
      setError(result.error || 'Login failed');
    }
  };

  const handleOAuthLogin = async (provider) => {
    if (userRole === 'admin') {
      setError('OAuth login is not available for admin');
      return;
    }

    setError('');
    
    try {
      const result = await loginWithOAuth(provider);
      
      if (result.success) {
        // Nếu đang redirect, không cần hiển thị toast
        if (result.redirecting) {
          // Đang redirect đến OAuth provider, không cần làm gì
          return;
        }
        
        // Nếu có user data (trường hợp hiếm)
        if (result.user) {
          setToast({
            message: `Welcome, ${result.user.name || result.user.email}!`,
            type: 'success'
          });
          setTimeout(() => {
            navigate('/', { replace: true });
          }, 1500);
        }
      } else {
        setError(result.error || `Failed to login with ${provider}`);
      }
    } catch (err) {
      console.error('OAuth login error:', err);
      setError(`Failed to login with ${provider}. Please try again.`);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary via-primary to-accent/20 flex items-center justify-center p-4">
      <div className="absolute inset-0 overflow-hidden">
        <div className="absolute top-0 left-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
        <div className="absolute bottom-0 right-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl translate-x-1/2 translate-y-1/2"></div>
      </div>

      <div className="relative z-10 w-full max-w-md">
        <div className="bg-white rounded-2xl shadow-2xl overflow-hidden">
          <div className="bg-gradient-to-r from-accent to-accent-hover p-8 text-center">
            <div className="flex justify-center mb-4">
              <img src={getLogoUrl('dark')} alt="logo" className="w-[180px] brightness-0 invert" />
            </div>
            <h1 className="text-2xl font-primary text-white mb-2">
              Sign In
            </h1>
            <p className="text-white/90 text-sm">
              Welcome back
            </p>
          </div>

          <form onSubmit={handleSubmit} className="p-8 space-y-6">
            {/* Role Selection */}
            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Login As
              </label>
              <div className="grid grid-cols-2 gap-3">
                <button
                  type="button"
                  onClick={() => setUserRole('user')}
                  className={`flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 transition-all ${
                    userRole === 'user'
                      ? 'border-accent bg-accent/10 text-accent'
                      : 'border-gray-300 bg-white text-gray-600 hover:border-gray-400'
                  }`}
                >
                  <FaUser />
                  <span className="font-semibold">User</span>
                </button>
                <button
                  type="button"
                  onClick={() => setUserRole('admin')}
                  className={`flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 transition-all ${
                    userRole === 'admin'
                      ? 'border-accent bg-accent/10 text-accent'
                      : 'border-gray-300 bg-white text-gray-600 hover:border-gray-400'
                  }`}
                >
                  <FaUserShield />
                  <span className="font-semibold">Admin</span>
                </button>
              </div>
              {userRole === 'admin' && (
                <p className="mt-2 text-xs text-gray-500">
                  Admin login requires admin privileges
                </p>
              )}
            </div>
            {error && (
              <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                {error}
              </div>
            )}

            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Email
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <FaEnvelope className="text-gray-400" />
                </div>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                  placeholder="admin@hotel.com"
                  required
                  disabled={loading}
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Password
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <FaLock className="text-gray-400" />
                </div>
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full pl-12 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                  placeholder="••••••••"
                  required
                  disabled={loading}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-accent transition-colors text-sm"
                >
                  {showPassword ? 'Hide' : 'Show'}
                </button>
              </div>
            </div>

            <div className="flex items-center justify-between">
              <label className="flex items-center">
                <input
                  type="checkbox"
                  className="w-4 h-4 text-accent border-gray-300 rounded focus:ring-accent"
                />
                <span className="ml-2 text-sm text-gray-600">Remember me</span>
              </label>
              <Link to="/forgot-password" className="text-sm text-accent hover:text-accent-hover transition-colors">
                Forgot password?
              </Link>
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full btn btn-primary btn-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? (
                <>
                  <FaSpinner className="animate-spin" />
                  Signing in...
                </>
              ) : (
                'Sign In'
              )}
            </button>

            {userRole === 'user' && (
              <>
                <div className="relative my-6">
                  <div className="absolute inset-0 flex items-center">
                    <div className="w-full border-t border-gray-300"></div>
                  </div>
                  <div className="relative flex justify-center text-sm">
                    <span className="px-2 bg-white text-gray-500">Or continue with</span>
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <button
                    type="button"
                    onClick={() => handleOAuthLogin('google')}
                    disabled={loading}
                    className="flex items-center justify-center gap-2 px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    <FaGoogle className="text-red-500" />
                    <span className="text-sm font-semibold">Google</span>
                  </button>

                  <button
                    type="button"
                    onClick={() => handleOAuthLogin('facebook')}
                    disabled={loading}
                    className="flex items-center justify-center gap-2 px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    <FaFacebook className="text-blue-600" />
                    <span className="text-sm font-semibold">Facebook</span>
                  </button>
                </div>
              </>
            )}

            {userRole === 'admin' && (
              <div className="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                {/* <p className="text-xs font-semibold text-gray-700 mb-2">Admin Credentials:</p>
                <div className="text-xs text-gray-600 space-y-1">
                  <p><strong>Email:</strong> admin@hotel.com</p>
                  <p><strong>Password:</strong> admin123</p>
                </div> */}
              </div>
            )}

            {userRole === 'user' && (
              <div className="text-center pt-4">
                <p className="text-sm text-gray-600">
                  Don't have an account?{' '}
                  <Link to="/register" className="text-accent hover:text-accent-hover font-semibold">
                    Sign Up
                  </Link>
                </p>
              </div>
            )}
          </form>

          <div className="px-8 py-4 bg-gray-50 border-t border-gray-200 text-center">
            <p className="text-xs text-gray-500">
              © {new Date().getFullYear()} Hotel Booking. All rights reserved.
            </p>
          </div>
        </div>
      </div>

      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}
    </div>
  );
};

export default Login;
--- END FILE: src\pages\Login.jsx ---

--- START FILE: src\pages\NotFound404.jsx ---
import { Link } from 'react-router-dom';
import { FaHome, FaArrowLeft, FaExclamationTriangle } from 'react-icons/fa';

const NotFound404 = () => {
  return (
    <div className="min-h-screen bg-[#f7f4ef] flex items-center justify-center px-6">
      <div className="text-center max-w-2xl">
        {/* 404 Number */}
        <div className="mb-8">
          <h1 className="font-primary text-9xl md:text-[12rem] text-accent leading-none mb-4">
            404
          </h1>
          <div className="flex items-center justify-center gap-3 mb-6">
            <FaExclamationTriangle className="text-4xl text-accent" />
            <h2 className="font-primary text-4xl md:text-5xl text-primary">
              Page Not Found
            </h2>
          </div>
        </div>

        {/* Message */}
        <p className="text-lg md:text-xl text-primary/70 mb-8 leading-relaxed">
          Oops! The page you're looking for seems to have checked out early.
          <br />
          It might have been moved, deleted, or never existed.
        </p>

        {/* Action Buttons */}
        <div className="flex flex-col sm:flex-row items-center justify-center gap-4">
          <Link
            to="/"
            className="btn btn-primary flex items-center gap-2 px-8 py-4 uppercase tracking-[2px]"
          >
            <FaHome />
            Back to Home
          </Link>
          <button
            onClick={() => window.history.back()}
            className="btn btn-secondary flex items-center gap-2 px-8 py-4 uppercase tracking-[2px]"
          >
            <FaArrowLeft />
            Go Back
          </button>
        </div>

        {/* Helpful Links */}
        <div className="mt-12 pt-8 border-t border-[#eadfcf]">
          <p className="text-sm text-primary/60 mb-4">You might be looking for:</p>
          <div className="flex flex-wrap justify-center gap-4">
            <Link
              to="/rooms"
              className="text-accent hover:underline text-sm font-semibold"
            >
              Browse Rooms
            </Link>
            <Link
              to="/restaurant"
              className="text-accent hover:underline text-sm font-semibold"
            >
              Restaurant
            </Link>
            <Link
              to="/spa"
              className="text-accent hover:underline text-sm font-semibold"
            >
              Spa Services
            </Link>
            <Link
              to="/contact"
              className="text-accent hover:underline text-sm font-semibold"
            >
              Contact Us
            </Link>
          </div>
        </div>
      </div>
    </div>
  );
};

export default NotFound404;


--- END FILE: src\pages\NotFound404.jsx ---

--- START FILE: src\pages\Register.jsx ---
import { useState, useEffect, useMemo } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useAuth } from '../context/SimpleAuthContext';
import { FaEnvelope, FaLock, FaUser, FaSpinner, FaGoogle, FaFacebook, FaCheck, FaTimes } from 'react-icons/fa';
import Toast from '../components/Toast';
import { getLogoUrl } from '../utils/supabaseStorageUrls';

const Register = () => {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
    confirmPassword: ''
  });
  const [error, setError] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [toast, setToast] = useState(null);
  
  const { register, loginWithOAuth, loading, isAuthenticated } = useAuth();
  const navigate = useNavigate();

  useEffect(() => {
    // Chỉ check một lần khi component mount, không check liên tục
    const checkAuth = () => {
      if (isAuthenticated()) {
        navigate('/', { replace: true });
      }
    };
    
    checkAuth();
    // Không thêm dependencies để tránh loop vô hạn
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
    setError('');
  };

  const validateEmail = (email) => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  };

  // Password strength validation
  const passwordRequirements = useMemo(() => {
    const password = formData.password;
    return {
      minLength: password.length >= 8,
      hasUpperCase: /[A-Z]/.test(password),
      hasLowerCase: /[a-z]/.test(password),
      hasNumber: /[0-9]/.test(password),
      hasSpecialChar: /[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/.test(password),
    };
  }, [formData.password]);

  const isPasswordValid = useMemo(() => {
    return Object.values(passwordRequirements).every(req => req === true);
  }, [passwordRequirements]);

  // Check if passwords match
  const passwordsMatch = useMemo(() => {
    if (!formData.confirmPassword) return null; // Not checked yet
    return formData.password === formData.confirmPassword;
  }, [formData.password, formData.confirmPassword]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (!formData.name || !formData.email || !formData.password || !formData.confirmPassword) {
      setError('Please fill in all fields');
      return;
    }

    if (formData.name.trim().length < 2) {
      setError('Name must be at least 2 characters');
      return;
    }

    if (!validateEmail(formData.email)) {
      setError('Please enter a valid email address');
      return;
    }

    // Validate password strength
    if (!isPasswordValid) {
      setError('Password does not meet all requirements. Please check the password requirements.');
      return;
    }

    if (formData.password !== formData.confirmPassword) {
      setError('Passwords do not match');
      return;
    }

    const result = await register(formData.email, formData.password, formData.name);
    
    if (result.success) {
      setToast({
        message: `Account created successfully! Welcome, ${result.user.name}!`,
        type: 'success'
      });
      setTimeout(() => {
        navigate('/', { replace: true });
      }, 1500);
    } else {
      setError(result.error || 'Registration failed');
    }
  };

  const handleOAuthLogin = async (provider) => {
    setError('');
    const result = await loginWithOAuth(provider);
    
    if (result.success) {
      setToast({
        message: `Welcome, ${result.user.name || result.user.email}!`,
        type: 'success'
      });
      setTimeout(() => {
        navigate('/', { replace: true });
      }, 1500);
    } else {
      setError(`Failed to login with ${provider}`);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary via-primary to-accent/20 flex items-center justify-center p-4 py-12">
      <div className="absolute inset-0 overflow-hidden">
        <div className="absolute top-0 left-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
        <div className="absolute bottom-0 right-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl translate-x-1/2 translate-y-1/2"></div>
      </div>

      <div className="relative z-10 w-full max-w-md">
        <div className="bg-white rounded-2xl shadow-2xl overflow-hidden">
          <div className="bg-gradient-to-r from-accent to-accent-hover p-8 text-center">
            <div className="flex justify-center mb-4">
              <img src={getLogoUrl('dark')} alt="logo" className="w-[180px] brightness-0 invert" />
            </div>
            <h1 className="text-2xl font-primary text-white mb-2">Create Account</h1>
            <p className="text-white/90 text-sm">Join us and start booking</p>
          </div>

          <form onSubmit={handleSubmit} className="p-8 space-y-5">
            {error && (
              <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                {error}
              </div>
            )}

            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Full Name
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <FaUser className="text-gray-400" />
                </div>
                <input
                  type="text"
                  name="name"
                  value={formData.name}
                  onChange={handleChange}
                  className="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                  placeholder="John Doe"
                  required
                  disabled={loading}
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Email
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <FaEnvelope className="text-gray-400" />
                </div>
                <input
                  type="email"
                  name="email"
                  value={formData.email}
                  onChange={handleChange}
                  className="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                  placeholder="john@example.com"
                  required
                  disabled={loading}
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Password
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <FaLock className="text-gray-400" />
                </div>
                <input
                  type={showPassword ? 'text' : 'password'}
                  name="password"
                  value={formData.password}
                  onChange={handleChange}
                  className={`w-full pl-12 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all ${
                    formData.password && !isPasswordValid 
                      ? 'border-red-300 focus:ring-red-500' 
                      : formData.password && isPasswordValid
                      ? 'border-green-300 focus:ring-green-500'
                      : 'border-gray-300'
                  }`}
                  placeholder="••••••••"
                  required
                  disabled={loading}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-accent transition-colors text-sm"
                >
                  {showPassword ? 'Hide' : 'Show'}
                </button>
              </div>
              
              {/* Password Strength Indicator - Below input */}
              {formData.password && (
                <div className="mt-3 bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-1.5">
                  <p className="text-xs font-semibold text-gray-700 mb-2">Password Requirements:</p>
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-1.5">
                    <div className={`flex items-center gap-2 text-xs ${passwordRequirements.minLength ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.minLength ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>At least 8 characters</span>
                    </div>
                    <div className={`flex items-center gap-2 text-xs ${passwordRequirements.hasUpperCase ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.hasUpperCase ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>One uppercase (A-Z)</span>
                    </div>
                    <div className={`flex items-center gap-2 text-xs ${passwordRequirements.hasLowerCase ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.hasLowerCase ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>One lowercase (a-z)</span>
                    </div>
                    <div className={`flex items-center gap-2 text-xs ${passwordRequirements.hasNumber ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.hasNumber ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>One number (0-9)</span>
                    </div>
                    <div className={`flex items-center gap-2 text-xs sm:col-span-2 ${passwordRequirements.hasSpecialChar ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.hasSpecialChar ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>One special character (!@#$%...)</span>
                    </div>
                  </div>
                  {isPasswordValid && (
                    <div className="mt-2 pt-2 border-t border-green-200">
                      <p className="text-xs font-semibold text-green-600 flex items-center gap-1">
                        <FaCheck /> Password is strong!
                      </p>
                    </div>
                  )}
                </div>
              )}
            </div>

            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Confirm Password
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <FaLock className="text-gray-400" />
                </div>
                <input
                  type={showConfirmPassword ? 'text' : 'password'}
                  name="confirmPassword"
                  value={formData.confirmPassword}
                  onChange={handleChange}
                  className={`w-full pl-12 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all ${
                    formData.confirmPassword && passwordsMatch === false
                      ? 'border-red-300 focus:ring-red-500' 
                      : formData.confirmPassword && passwordsMatch === true
                      ? 'border-green-300 focus:ring-green-500'
                      : 'border-gray-300'
                  }`}
                  placeholder="••••••••"
                  required
                  disabled={loading}
                />
                <div className="absolute inset-y-0 right-0 flex items-center gap-2 pr-4">
                  {/* Password match indicator */}
                  {formData.confirmPassword && passwordsMatch !== null && (
                    <div className={`flex items-center ${passwordsMatch ? 'text-green-600' : 'text-red-500'}`}>
                      {passwordsMatch ? (
                        <FaCheck className="text-green-600" />
                      ) : (
                        <FaTimes className="text-red-500" />
                      )}
                    </div>
                  )}
                  <button
                    type="button"
                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                    className="text-gray-400 hover:text-accent transition-colors text-sm"
                  >
                    {showConfirmPassword ? 'Hide' : 'Show'}
                  </button>
                </div>
              </div>
              {/* Password match message */}
              {formData.confirmPassword && passwordsMatch !== null && (
                <div className={`mt-2 text-xs flex items-center gap-1 ${
                  passwordsMatch ? 'text-green-600' : 'text-red-600'
                }`}>
                  {passwordsMatch ? (
                    <>
                      <FaCheck /> Passwords match
                    </>
                  ) : (
                    <>
                      <FaTimes /> Passwords do not match
                    </>
                  )}
                </div>
              )}
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full btn btn-primary btn-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? (
                <>
                  <FaSpinner className="animate-spin" />
                  Creating Account...
                </>
              ) : (
                'Create Account'
              )}
            </button>

            <div className="relative my-6">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-gray-300"></div>
              </div>
              <div className="relative flex justify-center text-sm">
                <span className="px-2 bg-white text-gray-500">Or continue with</span>
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <button
                type="button"
                onClick={() => handleOAuthLogin('google')}
                disabled={loading}
                className="flex items-center justify-center gap-2 px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <FaGoogle className="text-red-500" />
                <span className="text-sm font-semibold">Google</span>
              </button>

              <button
                type="button"
                onClick={() => handleOAuthLogin('facebook')}
                disabled={loading}
                className="flex items-center justify-center gap-2 px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <FaFacebook className="text-blue-600" />
                <span className="text-sm font-semibold">Facebook</span>
              </button>
            </div>

            <div className="text-center pt-4">
              <p className="text-sm text-gray-600">
                Already have an account?{' '}
                <Link to="/login" className="text-accent hover:text-accent-hover font-semibold">
                  Sign In
                </Link>
              </p>
            </div>
          </form>

          <div className="px-8 py-4 bg-gray-50 border-t border-gray-200 text-center">
            <p className="text-xs text-gray-500">
              © {new Date().getFullYear()} Hotel Booking. All rights reserved.
            </p>
          </div>
        </div>
      </div>

      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}
    </div>
  );
};

export default Register;
--- END FILE: src\pages\Register.jsx ---

--- START FILE: src\pages\ResetPassword.jsx ---
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams, Link } from 'react-router-dom';
import { getLogoUrl } from '../utils/supabaseStorageUrls';
import { FaLock, FaSpinner, FaCheck, FaArrowLeft } from 'react-icons/fa';
import Toast from '../components/Toast';
import { useAuth } from '../context/SimpleAuthContext';

const ResetPassword = () => {
  const [searchParams] = useSearchParams();
  const [formData, setFormData] = useState({
    email: '',
    code: '',
    newPassword: '',
    confirmPassword: ''
  });
  const [toast, setToast] = useState(null);
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [successMessage, setSuccessMessage] = useState('');
  const navigate = useNavigate();
  const { resetPasswordWithCode, loading, error: authError } = useAuth();

  // Lấy code và email từ URL query params
  const codeFromUrl = searchParams.get('code');
  const emailFromUrl = searchParams.get('email');

  useEffect(() => {
    if (codeFromUrl) {
      setFormData(prev => ({ ...prev, code: codeFromUrl }));
    }
    if (emailFromUrl) {
      setFormData(prev => ({ ...prev, email: emailFromUrl }));
    }
  }, [codeFromUrl, emailFromUrl]);

  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    // Validation
    if (!formData.email || !formData.code || !formData.newPassword || !formData.confirmPassword) {
      setToast({
        message: 'Please fill in all fields',
        type: 'error'
      });
      return;
    }

    if (formData.newPassword.length < 6) {
      setToast({
        message: 'Password must be at least 6 characters',
        type: 'error'
      });
      return;
    }

    if (formData.newPassword !== formData.confirmPassword) {
      setToast({
        message: 'Passwords do not match',
        type: 'error'
      });
      return;
    }

    const result = await resetPasswordWithCode(formData.email, formData.code, formData.newPassword);
    
    if (result.success) {
      setToast({
        message: 'Password reset successfully!',
        type: 'success'
      });
      setSuccessMessage('Your password has been reset successfully. You will be redirected to the login page.');
      
      setTimeout(() => {
        navigate('/login', { replace: true });
      }, 3000);
    } else {
      setToast({
        message: result.error || 'Failed to reset password. Please try again.',
        type: 'error'
      });
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary via-primary to-accent/20 flex items-center justify-center p-4 py-12">
      {/* Background decoration */}
      <div className="absolute inset-0 overflow-hidden">
        <div className="absolute top-0 left-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
        <div className="absolute bottom-0 right-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl translate-x-1/2 translate-y-1/2"></div>
      </div>

      {/* Reset Password Card */}
      <div className="relative z-10 w-full max-w-md">
        <div className="bg-white rounded-2xl shadow-2xl overflow-hidden">
          {/* Header */}
          <div className="bg-gradient-to-r from-accent to-accent-hover p-8 text-center">
            <div className="flex justify-center mb-4">
          <img src={getLogoUrl('dark')} alt="logo" className="w-[180px] brightness-0 invert" />
            </div>
            <h1 className="text-2xl font-primary text-white mb-2">Reset Password</h1>
            <p className="text-white/90 text-sm">Enter your new password</p>
          </div>

          {!successMessage ? (
            <form onSubmit={handleSubmit} className="p-8 space-y-5">
              {/* Email */}
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  Email *
                </label>
                <input
                  type="email"
                  name="email"
                  value={formData.email}
                  onChange={handleChange}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                  placeholder="your@email.com"
                  required
                  disabled={loading || !!emailFromUrl}
                />
              </div>

              {/* Reset Code */}
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  Reset Code *
                </label>
                <input
                  type="text"
                  name="code"
                  value={formData.code}
                  onChange={handleChange}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all uppercase"
                  placeholder="ABC123"
                  required
                  disabled={loading || !!codeFromUrl}
                  maxLength="6"
                />
                <p className="text-xs text-gray-500 mt-1">
                  Enter the 6-character code sent to your email
                </p>
              </div>

              {/* New Password */}
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  New Password *
                </label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <FaLock className="text-gray-400" />
                  </div>
                  <input
                    type={showPassword ? 'text' : 'password'}
                    name="newPassword"
                    value={formData.newPassword}
                    onChange={handleChange}
                    className="w-full pl-12 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                    placeholder="••••••••"
                    required
                    disabled={loading}
                    minLength="6"
                  />
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-accent transition-colors text-sm"
                  >
                    {showPassword ? 'Hide' : 'Show'}
                  </button>
                </div>
                <p className="text-xs text-gray-500 mt-1">
                  At least 6 characters
                </p>
              </div>

              {/* Confirm Password */}
              <div>
                <label className="block text-sm font-semibold mb-2 text-primary">
                  Confirm New Password *
                </label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <FaLock className="text-gray-400" />
                  </div>
                  <input
                    type={showConfirmPassword ? 'text' : 'password'}
                    name="confirmPassword"
                    value={formData.confirmPassword}
                    onChange={handleChange}
                    className="w-full pl-12 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                    placeholder="••••••••"
                    required
                    disabled={loading}
                    minLength="6"
                  />
                  <button
                    type="button"
                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                    className="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-accent transition-colors text-sm"
                  >
                    {showConfirmPassword ? 'Hide' : 'Show'}
                  </button>
                </div>
              </div>

              {/* Submit Button */}
              <button
                type="submit"
                disabled={loading}
                className="w-full btn btn-primary btn-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {loading ? (
                  <>
                    <FaSpinner className="animate-spin" />
                    Resetting Password...
                  </>
                ) : (
                  <>
                    <FaCheck />
                    Reset Password
                  </>
                )}
              </button>

              {/* Back Links */}
              <div className="text-center pt-2">
                <Link
                  to="/login"
                  className="inline-flex items-center gap-2 text-sm text-accent hover:text-accent-hover transition-colors"
                >
                  <FaArrowLeft />
                  Back to Sign In
                </Link>
              </div>
            </form>
          ) : (
            <div className="p-8 space-y-6">
              <div className="text-center mb-6">
                <FaCheck className="text-5xl text-green-500 mx-auto mb-4" />
                <h2 className="text-xl font-semibold text-gray-800 mb-2">Password Reset Successfully!</h2>
              </div>
              
              <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                <p className="text-sm text-green-900">
                  {successMessage}
                </p>
              </div>

              <Link
                to="/login"
                className="block w-full btn btn-primary btn-lg text-center"
              >
                Go to Sign In
              </Link>
            </div>
          )}

          {/* Footer */}
          <div className="px-8 py-4 bg-gray-50 border-t border-gray-200 text-center">
            <p className="text-xs text-gray-500">
              © {new Date().getFullYear()} Hotel Booking. All rights reserved.
            </p>
          </div>
        </div>
      </div>

      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}
    </div>
  );
};

export default ResetPassword;


--- END FILE: src\pages\ResetPassword.jsx ---

--- START FILE: src\pages\RestaurantPage.jsx ---
import { useState, useEffect } from "react";
import { ScrollToTop, Toast } from "../components";
import QRPayment from "../components/QRPayment";
import Invoice from "../components/Invoice";
import { useBookingContext } from "../context/BookingContext";
import { useAuth } from "../context/SimpleAuthContext";
import {
  fetchRestaurantMenuItems,
  fetchRestaurantSlotsByDateTime,
  updateRestaurantSlotUsage,
} from "../services/bookingService";
// ⚠️ Local images removed - now use Supabase URLs

const STORAGE_URL = "https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms";
const PLACEHOLDER_IMG_MENU = "https://via.placeholder.com/400x300?text=Menu+Image";
import {
  FaUtensils,
  FaWineGlassAlt,
  FaClock,
  FaMapMarkerAlt,
  FaPhoneAlt,
  FaStar,
  FaCheck,
} from "react-icons/fa";

const PLACEHOLDER_IMG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect fill='%23ddd' width='300' height='200'/%3E%3Ctext x='50%' y='50%' font-size='14' fill='%23999' text-anchor='middle' dy='.3em'%3EMenu Image%3C/text%3E%3C/svg%3E";

// Helper function to get image for menu items (using Supabase Storage URLs)
const getMenuItemImage = (id) => {
  if (!id) return PLACEHOLDER_IMG_MENU;
  
  // Cycle through images 1-8 (large version)
  // Assumes restaurant images match the room images for diversity
  const imgIndex = (id % 8) === 0 ? 8 : (id % 8);
  return `${STORAGE_URL}/${imgIndex}-lg.png` || PLACEHOLDER_IMG_MENU;
};


const menuCategories = [
  { id: "appetizers", name: "Appetizers", icon: FaUtensils },
  { id: "mains", name: "Main Courses", icon: FaUtensils },
  { id: "desserts", name: "Desserts", icon: FaUtensils },
  { id: "beverages", name: "Beverages", icon: FaWineGlassAlt },
  { id: "combos", name: "Combo Meals", icon: FaUtensils },
];

const menuItems = {
  appetizers: [
    {
      id: 1,
      name: "Truffle Arancini",
      description: "Crispy risotto balls with black truffle and parmesan",
      price: 28,
      popular: true,
      image: getMenuItemImage(1),
    },
    {
      id: 2,
      name: "Wagyu Beef Carpaccio",
      description: "Thinly sliced premium wagyu with arugula and truffle oil",
      price: 45,
      popular: true,
      image: getMenuItemImage(2),
    },
    {
      id: 3,
      name: "Lobster Bisque",
      description: "Creamy bisque with cognac and fresh herbs",
      price: 32,
      image: getMenuItemImage(3),
    },
    {
      id: 4,
      name: "Foie Gras Terrine",
      description: "Duck liver terrine with fig compote and brioche",
      price: 38,
      image: getMenuItemImage(4),
    },
    {
      id: 5,
      name: "Oysters Rockefeller",
      description: "Fresh oysters with spinach, herbs, and pernod",
      price: 35,
      image: getMenuItemImage(5),
    },
  ],
  mains: [
    {
      id: 6,
      name: "Wagyu Ribeye Steak",
      description:
        "Premium 300g ribeye with roasted vegetables and red wine jus",
      price: 95,
      popular: true,
      image: getMenuItemImage(6),
    },
    {
      id: 7,
      name: "Pan-Seared Sea Bass",
      description:
        "Wild-caught sea bass with lemon beurre blanc and seasonal vegetables",
      price: 68,
      image: getMenuItemImage(7),
    },
    {
      id: 8,
      name: "Duck Confit",
      description: "Slow-cooked duck leg with cherry sauce and potato gratin",
      price: 72,
      image: getMenuItemImage(8),
    },
    {
      id: 9,
      name: "Lobster Thermidor",
      description: "Whole lobster with gruyère cheese and brandy cream",
      price: 88,
      popular: true,
      image: getMenuItemImage(9),
    },
    {
      id: 10,
      name: "Vegetarian Risotto",
      description:
        "Creamy arborio rice with seasonal vegetables and truffle oil",
      price: 42,
      image: getMenuItemImage(10),
    },
    {
      id: 11,
      name: "Rack of Lamb",
      description:
        "Herb-crusted lamb with mint jus and roasted root vegetables",
      price: 78,
      image: getMenuItemImage(11),
    },
  ],
  desserts: [
    {
      id: 12,
      name: "Chocolate Soufflé",
      description: "Warm dark chocolate soufflé with vanilla ice cream",
      price: 24,
      popular: true,
      image: getMenuItemImage(12),
    },
    {
      id: 13,
      name: "Crème Brûlée",
      description: "Classic vanilla custard with caramelized sugar",
      price: 18,
      image: getMenuItemImage(13),
    },
    {
      id: 14,
      name: "Tiramisu",
      description: "Traditional Italian dessert with espresso and mascarpone",
      price: 22,
      image: getMenuItemImage(14),
    },
    {
      id: 15,
      name: "Lemon Tart",
      description: "Tangy lemon curd in buttery pastry with fresh berries",
      price: 20,
      image: getMenuItemImage(15),
    },
    {
      id: 16,
      name: "Cheese Selection",
      description: "Artisan cheeses with honey, nuts, and crackers",
      price: 32,
      image: getMenuItemImage(16),
    },
  ],
  beverages: [
    {
      id: 17,
      name: "Wine Selection",
      description: "Curated wines from renowned vineyards",
      price: 45,
      popular: true,
      image: getMenuItemImage(17),
    },
    {
      id: 18,
      name: "Craft Cocktails",
      description: "Signature cocktails crafted by our mixologist",
      price: 18,
      image: getMenuItemImage(18),
    },
    {
      id: 19,
      name: "Champagne",
      description: "Premium champagne selection",
      price: 120,
      image: getMenuItemImage(19),
    },
    {
      id: 20,
      name: "Fresh Juices",
      description: "Seasonal fresh fruit juices",
      price: 12,
      image: getMenuItemImage(20),
    },
    {
      id: 21,
      name: "Espresso & Tea",
      description: "Premium coffee and tea selection",
      price: 8,
      image: getMenuItemImage(21),
    },
  ],
  combos: [
    {
      id: 22,
      name: "Romantic Dinner for Two",
      description: "Appetizer, two main courses, dessert, and wine pairing",
      price: 220,
      popular: true,
      image: getMenuItemImage(22),
      items: [
        "Wagyu Beef Carpaccio",
        "Wagyu Ribeye Steak",
        "Pan-Seared Sea Bass",
        "Chocolate Soufflé",
        "Wine Selection",
      ],
    },
    {
      id: 23,
      name: "Family Feast",
      description:
        "Perfect for 4 people: appetizers, mains, desserts, and beverages",
      price: 380,
      popular: true,
      image: getMenuItemImage(23),
      items: [
        "Truffle Arancini",
        "Lobster Thermidor",
        "Duck Confit",
        "Rack of Lamb",
        "Tiramisu",
        "Crème Brûlée",
        "Fresh Juices",
      ],
    },
    {
      id: 24,
      name: "Seafood Lovers",
      description: "Lobster bisque, sea bass, lobster thermidor, and champagne",
      price: 280,
      image: getMenuItemImage(24),
      items: [
        "Lobster Bisque",
        "Pan-Seared Sea Bass",
        "Lobster Thermidor",
        "Champagne",
      ],
    },
    {
      id: 25,
      name: "Vegetarian Delight",
      description:
        "Complete vegetarian menu with seasonal vegetables and risotto",
      price: 120,
      image: getMenuItemImage(25),
      items: [
        "Vegetarian Risotto",
        "Seasonal Salad",
        "Lemon Tart",
        "Fresh Juices",
      ],
    },
    {
      id: 26,
      name: "Business Lunch",
      description:
        "Quick and elegant lunch combo: appetizer, main, and dessert",
      price: 85,
      image: getMenuItemImage(26),
      items: [
        "Truffle Arancini",
        "Wagyu Ribeye Steak",
        "Crème Brûlée",
        "Espresso & Tea",
      ],
    },
  ],
};

const chefSpecials = [
  {
    title: "Chef's Tasting Menu",
    description:
      "A curated 7-course journey showcasing seasonal ingredients and culinary artistry",
    price: 185,
    duration: "2.5 hours",
    includes: ["7 courses", "Wine pairing option", "Chef interaction"],
    image: getMenuItemImage(27),
  },
  {
    title: "Weekend Brunch",
    description:
      "Indulgent brunch experience with bottomless mimosas and live jazz",
    price: 65,
    duration: "11:00 - 15:00",
    includes: [
      "Unlimited brunch items",
      "Bottomless beverages",
      "Live entertainment",
    ],
    image: getMenuItemImage(28),
  },
  {
    title: "Private Dining",
    description:
      "Exclusive private room for intimate gatherings and celebrations",
    price: 250,
    duration: "Custom",
    includes: ["Private room", "Customized menu", "Dedicated service"],
    image: getMenuItemImage(29),
  },
];

const openingHours = [
  { day: "Monday - Thursday", time: "18:00 - 22:30" },
  { day: "Friday - Saturday", time: "18:00 - 23:30" },
  { day: "Sunday", time: "12:00 - 21:00" },
  { day: "Brunch", time: "Saturday & Sunday 11:00 - 15:00" },
];

const RestaurantPage = () => {
  const { user } = useAuth();
  const { createRestaurantBooking, confirmRestaurantBooking } =
    useBookingContext();
  const [categories, setCategories] = useState(menuCategories);
  const [menuData, setMenuData] = useState(menuItems);
  const [activeCategory, setActiveCategory] = useState("appetizers");
  const [toast, setToast] = useState(null);
  const [showQRPayment, setShowQRPayment] = useState(false);
  const [showInvoice, setShowInvoice] = useState(false);
  const [currentBooking, setCurrentBooking] = useState(null);
  const [reservationForm, setReservationForm] = useState({
    name: "",
    email: "",
    phone: "",
    date: "",
    time: "",
    guests: "2",
    specialRequests: "",
  });

  // Auto-fill form when user is logged in
  useEffect(() => {
    if (user) {
      setReservationForm((prev) => ({
        ...prev,
        name: user.full_name || user.name || "",
        email: user.email || "",
        phone: user.phone || "",
      }));
    }
  }, [user]);

  // Load menu items from Supabase (fallback to static if fails)
  useEffect(() => {
    const loadMenu = async () => {
      try {
        const data = await fetchRestaurantMenuItems();
        if (!data || data.length === 0) return;

        const catSet = Array.from(
          new Set(
            data
              .map((i) => i.category || "others")
              .map((c) => c.toLowerCase())
          )
        );
        const mappedCategories = catSet.map((c) => ({
          id: c,
          name: c.charAt(0).toUpperCase() + c.slice(1),
          icon: c.includes("beverage") ? FaWineGlassAlt : FaUtensils,
        }));
        const grouped = data.reduce((acc, item) => {
          const key = (item.category || "others").toLowerCase();
          acc[key] = acc[key] || [];
          acc[key].push({
            id: item.id,
            name: item.name,
            description: item.description,
            price: Number(item.price) || 0,
            popular: item.popular || false,
            image: item.image_url || PLACEHOLDER_IMG_MENU,
            items: item.items || [],
          });
          return acc;
        }, {});

        setCategories(mappedCategories);
        setMenuData(grouped);
        setActiveCategory(mappedCategories[0]?.id || "appetizers");
      } catch (err) {
        console.warn("Fallback to static menu, fetch error:", err);
      }
    };
    loadMenu();
  }, []);

  const handleReservationSubmit = async (e) => {
    e.preventDefault();
    if (
      !reservationForm.name ||
      !reservationForm.email ||
      !reservationForm.date ||
      !reservationForm.time
    ) {
      setToast({
        type: "error",
        message: "Please fill in all required fields.",
      });
      return;
    }

    const guests = parseInt(reservationForm.guests, 10) || 1;
    const reservationAt = `${reservationForm.date}T${reservationForm.time}`;

    // Check slot availability from Supabase
    const slots = await fetchRestaurantSlotsByDateTime(reservationAt);
    const availableSlot = slots
      .filter(
        (slot) =>
          slot.status !== "booked" &&
          (slot.capacity_limit - slot.capacity_used) >= guests
      )
      .sort(
        (a, b) =>
          (a.restaurant_tables?.capacity || a.capacity_limit) -
          (b.restaurant_tables?.capacity || b.capacity_limit)
      )[0];

    if (!availableSlot) {
      setToast({
        type: "error",
        message: "No available table for this time/guest count.",
      });
      return;
    }

    // Update slot usage (best-effort)
    await updateRestaurantSlotUsage(availableSlot.id, guests);

    // Price demo: $50/guest if no menu selection
    const price = guests * 50;

    const result = createRestaurantBooking({
      name: reservationForm.name,
      email: reservationForm.email,
      phone: reservationForm.phone,
      date: reservationAt,
      guests,
      specialRequests: reservationForm.specialRequests,
      userId: user?.id,
      userName: reservationForm.name,
      userEmail: reservationForm.email,
      price,
      totalPrice: price,
    });

    if (result?.success) {
      setCurrentBooking(result.booking);
      setShowQRPayment(true);
    }
  };

  const handlePaymentSuccess = (paymentData) => {
    if (!currentBooking) return;

    const confirmedBooking = confirmRestaurantBooking(
      currentBooking.id,
      paymentData
    );
    setCurrentBooking(confirmedBooking);
    setShowQRPayment(false);
    setShowInvoice(true);
    setToast({
      type: "success",
      message: "Payment successful! Your reservation is confirmed.",
    });
    setReservationForm({
      name: "",
      email: "",
      phone: "",
      date: "",
      time: "",
      guests: "2",
      specialRequests: "",
    });
  };

  const handleCloseQRPayment = () => {
    setShowQRPayment(false);
    setCurrentBooking(null);
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setReservationForm((prev) => ({ ...prev, [name]: value }));
  };

  return (
    <div className="min-h-screen bg-[#f7f4ef]">
      <ScrollToTop />
      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}

      {/* Hero Section */}
      <section className="relative h-[60vh] min-h-[480px] flex items-center justify-center text-center">
        <img
          src={`${STORAGE_URL}/2-lg.png`}
          alt="Restaurant interior"
          className="absolute inset-0 h-full w-full object-cover"
        />
        <div className="absolute inset-0 bg-black/60" />
        <div className="relative z-10 max-w-3xl px-6 text-white">
          <p className="font-tertiary uppercase tracking-[6px] text-sm mb-4">
            Adina Hotel & Spa
          </p>
          <h1 className="font-primary text-4xl md:text-5xl lg:text-6xl leading-tight mb-6">
            Fine Dining Experience
          </h1>
          <p className="text-lg text-white/80">
            Indulge in culinary excellence with our award-winning chefs, curated
            wine selection, and elegant ambiance.
          </p>
        </div>
      </section>

      {/* Menu Section */}
      <section className="container mx-auto px-6 lg:px-0 py-20">
        <div className="text-center mb-12">
          <p className="font-tertiary uppercase tracking-[4px] text-xs text-primary/70 mb-2">
            Our Menu
          </p>
          <h2 className="font-primary text-4xl mb-4">Culinary Excellence</h2>
          <p className="text-primary/70 max-w-2xl mx-auto">
            Each dish is crafted with precision, using the finest ingredients
            sourced from local artisans and international purveyors.
          </p>
        </div>

        {/* Category Tabs */}
        <div className="flex flex-wrap justify-center gap-4 mb-12">
          {categories.map((category) => {
            const Icon = category.icon;
            return (
              <button
                key={category.id}
                onClick={() => setActiveCategory(category.id)}
                className={`flex items-center gap-2 px-6 py-3 border rounded-full transition ${
                  activeCategory === category.id
                    ? "bg-accent text-white border-accent"
                    : "border-[#eadfcf] text-primary hover:border-accent"
                }`}
              >
                <Icon />
                <span>{category.name}</span>
              </button>
            );
          })}
        </div>

        {/* Menu Items Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {(menuData[activeCategory] || []).map((item) => (
            <div
              key={item.id}
              className="bg-white shadow-sm border border-[#eadfcf] hover:shadow-lg transition-shadow overflow-hidden"
            >
              <div className="relative h-48 overflow-hidden">
                <img
                  src={item.image}
                  alt={item.name}
                  className="w-full h-full object-cover hover:scale-110 transition-transform duration-300"
                />
                {item.popular && (
                  <span className="absolute top-3 right-3 flex items-center gap-1 bg-accent text-white px-3 py-1 rounded-full text-xs">
                    <FaStar />
                    <span>Popular</span>
                  </span>
                )}
              </div>
              <div className="p-6">
                <h3 className="font-primary text-xl mb-2">{item.name}</h3>
                <p className="text-sm text-primary/70 mb-3">
                  {item.description}
                </p>
                {item.items && (
                  <div className="mb-3">
                    <p className="text-xs font-semibold text-primary/60 mb-1">
                      Includes:
                    </p>
                    <ul className="text-xs text-primary/70 space-y-1">
                      {item.items.map((foodItem, idx) => (
                        <li key={idx} className="flex items-center gap-1">
                          <FaCheck className="text-accent text-[10px]" />
                          <span>{foodItem}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
                <p className="font-primary text-2xl text-accent">
                  ${item.price}
                </p>
              </div>
            </div>
          ))}
        </div>
      </section>

      {/* Chef's Specials */}
      <section className="bg-white py-20">
        <div className="container mx-auto px-6 lg:px-0">
          <div className="text-center mb-12">
            <p className="font-tertiary uppercase tracking-[4px] text-xs text-primary/70 mb-2">
              Special Experiences
            </p>
            <h2 className="font-primary text-4xl mb-4">Chef's Specials</h2>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            {chefSpecials.map((special, index) => (
              <div
                key={index}
                className="bg-[#f7f4ef] border border-[#eadfcf] hover:shadow-lg transition-shadow overflow-hidden"
              >
                <div className="relative h-48 overflow-hidden">
                  <img
                    src={special.image}
                    alt={special.title}
                    className="w-full h-full object-cover hover:scale-110 transition-transform duration-300"
                  />
                </div>
                <div className="p-8">
                  <h3 className="font-primary text-2xl mb-3">
                    {special.title}
                  </h3>
                  <p className="text-primary/70 mb-4">{special.description}</p>
                  <div className="mb-4">
                    <p className="font-primary text-3xl text-accent mb-2">
                      ${special.price}
                    </p>
                    <p className="text-sm text-primary/60">
                      {special.duration}
                    </p>
                  </div>
                  <ul className="space-y-2">
                    {special.includes.map((item, idx) => (
                      <li
                        key={idx}
                        className="flex items-center gap-2 text-sm text-primary/70"
                      >
                        <FaCheck className="text-accent" />
                        <span>{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* Reservation Section */}
      <section className="container mx-auto px-6 lg:px-0 py-20">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
          {/* Reservation Form */}
          <div className="bg-white p-8 shadow-sm border border-[#eadfcf]">
            <p className="font-tertiary uppercase tracking-[4px] text-xs text-primary/70 mb-2">
              Reserve a Table
            </p>
            <h2 className="font-primary text-3xl mb-6">Book Your Experience</h2>
            <form onSubmit={handleReservationSubmit} className="space-y-5">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label className="block text-sm font-semibold mb-2">
                    Full Name *
                  </label>
                  <input
                    type="text"
                    name="name"
                    value={reservationForm.name}
                    onChange={handleInputChange}
                    className="w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent"
                    placeholder="John Carter"
                    required
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2">
                    Email *
                  </label>
                  <input
                    type="email"
                    name="email"
                    value={reservationForm.email}
                    onChange={handleInputChange}
                    className="w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent"
                    placeholder="john@example.com"
                    required
                  />
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label className="block text-sm font-semibold mb-2">
                    Phone
                  </label>
                  <input
                    type="tel"
                    name="phone"
                    value={reservationForm.phone}
                    onChange={handleInputChange}
                    className="w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent"
                    placeholder="+84 987 654 321"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2">
                    Number of Guests *
                  </label>
                  <select
                    name="guests"
                    value={reservationForm.guests}
                    onChange={handleInputChange}
                    className="w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent bg-white"
                    required
                  >
                    {[1, 2, 3, 4, 5, 6, 7, 8].map((num) => (
                      <option key={num} value={num}>
                        {num} {num === 1 ? "Guest" : "Guests"}
                      </option>
                    ))}
                  </select>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label className="block text-sm font-semibold mb-2">
                    Date *
                  </label>
                  <input
                    type="date"
                    name="date"
                    value={reservationForm.date}
                    onChange={handleInputChange}
                    min={new Date().toISOString().split("T")[0]}
                    className="w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent"
                    required
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold mb-2">
                    Time *
                  </label>
                  <input
                    type="time"
                    name="time"
                    value={reservationForm.time}
                    onChange={handleInputChange}
                    className="w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent"
                    required
                  />
                </div>
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2">
                  Special Requests
                </label>
                <textarea
                  name="specialRequests"
                  value={reservationForm.specialRequests}
                  onChange={handleInputChange}
                  rows={3}
                  className="w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent resize-none"
                  placeholder="Dietary restrictions, celebration, etc."
                />
              </div>

              <button
                type="submit"
                className="btn btn-primary w-full uppercase tracking-[4px]"
              >
                Reserve Table
              </button>
            </form>
          </div>

          {/* Restaurant Info */}
          <div className="space-y-8">
            <div className="bg-white p-8 shadow-sm border border-[#eadfcf]">
              <h3 className="font-primary text-2xl mb-6">Opening Hours</h3>
              <div className="space-y-4">
                {openingHours.map((schedule, index) => (
                  <div
                    key={index}
                    className="flex items-center justify-between pb-4 border-b border-[#eadfcf] last:border-0"
                  >
                    <div className="flex items-center gap-3">
                      <FaClock className="text-accent" />
                      <span className="font-semibold">{schedule.day}</span>
                    </div>
                    <span className="text-primary/70">{schedule.time}</span>
                  </div>
                ))}
              </div>
            </div>

            <div className="bg-white p-8 shadow-sm border border-[#eadfcf]">
              <h3 className="font-primary text-2xl mb-6">
                Contact Information
              </h3>
              <div className="space-y-4">
                <div className="flex items-start gap-4">
                  <FaMapMarkerAlt className="text-accent mt-1" />
                  <div>
                    <p className="font-semibold">Location</p>
                    <p className="text-primary/70">
                      12 Tran Hung Dao, Hoan Kiem, Ha Noi
                    </p>
                  </div>
                </div>
                <div className="flex items-start gap-4">
                  <FaPhoneAlt className="text-accent mt-1" />
                  <div>
                    <p className="font-semibold">Reservations</p>
                    <p className="text-primary/70">+84 24 1234 5678</p>
                  </div>
                </div>
                <div className="flex items-start gap-4">
                  <FaUtensils className="text-accent mt-1" />
                  <div>
                    <p className="font-semibold">Email</p>
                    <p className="text-primary/70">restaurant@adinahotel.com</p>
                  </div>
                </div>
              </div>
            </div>

            <div className="bg-accent/10 p-8 border border-accent/20">
              <h3 className="font-primary text-xl mb-3">Dress Code</h3>
              <p className="text-primary/70 text-sm">
                Smart casual attire is recommended. We kindly request no
                sportswear or beachwear in the dining room.
              </p>
            </div>
          </div>
        </div>
      </section>

      {showQRPayment && currentBooking && (
        <QRPayment
          bookingData={currentBooking}
          onPaymentSuccess={handlePaymentSuccess}
          onClose={handleCloseQRPayment}
          type="restaurant"
        />
      )}

      {showInvoice && currentBooking && (
        <Invoice
          booking={currentBooking}
          onClose={() => setShowInvoice(false)}
          onDownload={() => {
            setToast({
              type: "success",
              message: "PDF downloaded successfully!",
            });
          }}
        />
      )}
    </div>
  );
};

export default RestaurantPage;

--- END FILE: src\pages\RestaurantPage.jsx ---

--- START FILE: src\pages\RoomDetails.jsx ---
import { ScrollToTop, Toast } from '../components';
import QRPayment from '../components/QRPayment';
import Invoice from '../components/Invoice';
import { useRoomContext } from '../context/RoomContext';
import { useAuth } from '../context/SimpleAuthContext';
import { hotelRules } from '../constants/data';
import { useParams, Link } from 'react-router-dom';
import {
  FaCheck,
  FaStar,
  FaWifi,
  FaDumbbell,
  FaSwimmingPool,
  FaUtensils,
  FaCar,
  FaSnowflake,
} from 'react-icons/fa';
import { useMemo, useState, useEffect } from 'react';
import { fetchRoomReviews, createReview } from '../services/roomService';

// Placeholder image - will be replaced by Supabase Storage URL
const PLACEHOLDER_IMG =
  "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Crect fill='%23ddd' width='800' height='600'/%3E%3Ctext x='50%' y='50%' font-size='24' fill='%23999' text-anchor='middle' dy='.3em'%3ELoading image...%3C/text%3E%3C/svg%3E";

// Map facility name -> icon (purely visual, không thay đổi layout)
const getFacilityIcon = (rawName) => {
  const name = (typeof rawName === 'string' ? rawName : rawName?.name || '').toLowerCase();

  if (name.includes('wifi') || name.includes('wi-fi')) return <FaWifi className="text-3xl text-accent" />;
  if (name.includes('gym') || name.includes('fitness')) return <FaDumbbell className="text-3xl text-accent" />;
  if (name.includes('pool') || name.includes('swim')) return <FaSwimmingPool className="text-3xl text-accent" />;
  if (name.includes('restaurant') || name.includes('breakfast') || name.includes('dining'))
    return <FaUtensils className="text-3xl text-accent" />;
  if (name.includes('parking') || name.includes('car')) return <FaCar className="text-3xl text-accent" />;
  if (name.includes('air') || name.includes('conditioning') || name.includes('ac'))
    return <FaSnowflake className="text-3xl text-accent" />;

  return <FaCheck className="text-3xl text-accent" />;
};

const createLocalId = () => {
  if (typeof crypto !== 'undefined' && crypto.randomUUID) {
    return crypto.randomUUID();
  }
  return Date.now().toString();
};

const RoomDetails = () => {
  const { roomNo } = useParams();
  const {
    allRooms,
    bookRoom,
    confirmBookingPayment,
    hasUserBookedRoom,
    calculatePricingForRoom,
    getUserBookings,
  } = useRoomContext();
  const { user, isAuthenticated } = useAuth();

  // Tìm room theo room_no thay vì UUID để bảo mật URL
  const room = allRooms.find(roomItem => 
    roomItem.roomNo === roomNo || roomItem.room_no === roomNo
  );

  const [reservation, setReservation] = useState({
    checkIn: '',
    checkOut: '',
    adults: 2,
    kids: 0,
    note: '',
    promoCode: '', // New field for promotion code
    guestName: '', // For guest bookings
    guestEmail: '', // For guest bookings
    guestPhone: '', // For guest bookings
  });
  const [reviewForm, setReviewForm] = useState({
    rating: 5,
    comment: '',
  });
  const [toast, setToast] = useState(null);
  const [showQRPayment, setShowQRPayment] = useState(false);
  const [showInvoice, setShowInvoice] = useState(false);
  const [currentBooking, setCurrentBooking] = useState(null);
  const [reviews, setReviews] = useState([]);

  const maxGuests = room?.maxPerson || 1;

  const nights = useMemo(() => {
    if (!reservation.checkIn || !reservation.checkOut) return 1;
    const start = new Date(reservation.checkIn);
    const end = new Date(reservation.checkOut);
    const diff = end.getTime() - start.getTime();
    const days = Math.max(1, Math.ceil(diff / (1000 * 60 * 60 * 24)));
    return Number.isFinite(days) ? days : 1;
  }, [reservation.checkIn, reservation.checkOut]);

  const averageRating = useMemo(() => {
    if (!reviews.length) return null;
    const score = reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length;
    return score.toFixed(1);
  }, [reviews]);

  if (!room) {
    return (
      <section className='min-h-screen flex items-center justify-center'>
        <div className='text-center'>
          <p className='text-xl text-primary/70 mb-4'>Không tìm thấy phòng với mã: {roomNo}</p>
          <Link to='/rooms' className='btn btn-secondary'>Xem danh sách phòng</Link>
        </div>
      </section>
    );
  }

  const totalGuests = reservation.adults + reservation.kids;
  const pricingPreview = useMemo(() => {
    if (!room || !reservation.checkIn || !reservation.checkOut) return null;
    return calculatePricingForRoom(room, reservation.checkIn, reservation.checkOut);
  }, [room, reservation.checkIn, reservation.checkOut, calculatePricingForRoom]);
  const totalPrice = pricingPreview?.total ?? nights * room.price;

  // Load existing reviews for this specific room from Supabase
  useEffect(() => {
    let isMounted = true;

    const loadReviews = async () => {
      if (!room?.id) return;
      // Fetch reviews theo room_id cụ thể, không phải room_type_id
      const data = await fetchRoomReviews(room.id, null);
      if (!isMounted) return;
      const normalized = (data || []).map((r) => ({
        id: r.id,
        userId: r.user_id,
        userName: r.user_name,
        userEmail: r.user_email,
        rating: r.rating,
        comment: r.comment,
        createdAt: r.created_at,
      }));
      setReviews(normalized);
    };

    loadReviews();

    return () => {
      isMounted = false;
    };
  }, [room?.id]);

  // Với yêu cầu hiện tại: chỉ cần đăng nhập là có thể bình luận
  // (không bắt buộc phải có booking trước đó)

  const showToast = (payload) => {
    setToast(payload);
    setTimeout(() => setToast(null), 4000);
  };

  const handleReservationChange = (field, value) => {
    setReservation(prev => ({ ...prev, [field]: value }));
  };

  const validateBooking = () => {
    // Check dates
    if (!reservation.checkIn || !reservation.checkOut) {
      showToast({ type: 'error', message: 'Select both check-in and check-out dates.' });
      return false;
    }
    if (new Date(reservation.checkOut) <= new Date(reservation.checkIn)) {
      showToast({ type: 'error', message: 'Check-out must be after check-in.' });
      return false;
    }
    if (totalGuests > maxGuests) {
      showToast({ type: 'error', message: `This category hosts up to ${maxGuests} guests.` });
      return false;
    }
    
    // Check authentication or guest info
    if (!isAuthenticated()) {
      // Guest booking: require guest information
      if (!reservation.guestName || !reservation.guestName.trim()) {
        showToast({ type: 'error', message: 'Please provide your name for guest booking.' });
        return false;
      }
      if (!reservation.guestEmail || !reservation.guestEmail.trim()) {
        showToast({ type: 'error', message: 'Please provide your email for guest booking.' });
        return false;
      }
      // Basic email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(reservation.guestEmail)) {
        showToast({ type: 'error', message: 'Please provide a valid email address.' });
        return false;
      }
    }
    
    return true;
  };

  const handleBooking = (e) => {
    e.preventDefault();
    if (!validateBooking()) return;

    // Determine if this is a guest booking or authenticated booking
    const isGuestBooking = !isAuthenticated();
    
    const result = bookRoom({
      roomId: room.id,
      roomName: room.name,
      userId: isGuestBooking ? null : user?.id, // null for guest bookings
      userName: isGuestBooking ? reservation.guestName : (user?.name || user?.email?.split('@')[0]),
      userEmail: isGuestBooking ? reservation.guestEmail : user?.email,
      checkIn: reservation.checkIn,
      checkOut: reservation.checkOut,
      adults: reservation.adults,
      kids: reservation.kids,
      note: reservation.note,
      promoCode: reservation.promoCode,
      // Guest booking fields
      guestName: isGuestBooking ? reservation.guestName : null,
      guestEmail: isGuestBooking ? reservation.guestEmail : null,
      guestPhone: isGuestBooking ? reservation.guestPhone : null,
    });

    if (result?.success) {
      setCurrentBooking(result.booking);
      setShowQRPayment(true);
      
      // Show promo error as warning if booking succeeded but promo failed
      if (result.promoError) {
        showToast({
          type: 'warning',
          message: result.promoError + '. Booking created without promotion.',
        });
      }
    } else {
      showToast({
        type: 'error',
        message: result?.error || 'Unable to complete booking. Please try another selection.',
      });
    }
  };

  const handlePaymentSuccess = (paymentData) => {
    if (!currentBooking) return;
    
    const confirmedBooking = confirmBookingPayment(currentBooking.id, paymentData);
    setCurrentBooking(confirmedBooking);
    setShowQRPayment(false);
    setShowInvoice(true);
    showToast({
      type: 'success',
      message: 'Payment successful! Your booking is confirmed.',
    });
    setReservation(prev => ({ ...prev, note: '' }));
  };

  const handleCloseQRPayment = () => {
    setShowQRPayment(false);
    setCurrentBooking(null);
  };

  const handleReviewSubmit = async (e) => {
    e.preventDefault();
    if (!isAuthenticated()) {
      showToast({ type: 'info', message: 'Sign in to share your review.' });
      return;
    }
    if (!reviewForm.comment.trim()) {
      showToast({ type: 'error', message: 'Please add your thoughts before submitting.' });
      return;
    }

    const newReview = {
      id: createLocalId(),
      userId: user?.id,
      userName: user?.name || user?.email?.split('@')[0],
      userEmail: user?.email,
      rating: reviewForm.rating,
      comment: reviewForm.comment,
      createdAt: new Date().toISOString(),
    };

    // Cập nhật UI ngay
    setReviews((prev) => [newReview, ...prev]);
    showToast({ type: 'success', message: 'Thank you for sharing your experience!' });
    setReviewForm({ rating: 5, comment: '' });

    // Lưu về Supabase (theo room_id cụ thể)
    if (room?.id) {
      createReview({
        room_id: room.id,
        room_type_id: room.roomTypeId, // Vẫn giữ để backward compatibility
        user_id: newReview.userId,
        user_name: newReview.userName,
        user_email: newReview.userEmail,
        rating: newReview.rating,
        comment: newReview.comment,
        created_at: newReview.createdAt,
      }).catch((err) => {
        console.error('Error saving review to Supabase:', err);
      });
    }
  };

  return (
    <section>
      <ScrollToTop />
      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

      <div className='bg-room h-[560px] relative flex justify-center items-center bg-cover bg-center'>
        <div className='absolute w-full h-full bg-black/70' />
        <h1 className='text-5xl lg:text-6xl text-white z-20 font-primary text-center'>{room.name} Details</h1>
      </div>

      <div className='container mx-auto'>
        <div className='flex flex-col lg:flex-row lg:gap-x-8 h-full py-24'>
          <div className='w-full lg:w-[60%] h-full text-justify'>
            <h2 className='h2'>{room.name}</h2>
            <p className='mb-8 text-primary/80'>{room.description}</p>
            <img
              className='mb-8'
              src={room.imageLg || room.image || PLACEHOLDER_IMG}
              alt={room.name}
              onError={(e) => {
                console.warn('❌ Large image failed to load from Supabase:', room.imageLg);
                e.target.src = PLACEHOLDER_IMG;
              }}
            />

            <div className='flex items-center gap-4 mb-10'>
              <div className='text-4xl font-primary text-accent'>
                {averageRating ? averageRating : 'N/A'}
              </div>
              <div className='flex text-accent'>
                {[...Array(5)].map((_, index) => (
                  <FaStar
                    key={index}
                    className={`text-2xl ${averageRating && index < Math.round(averageRating) ? 'text-accent' : 'text-accent/20'}`}
                  />
                ))}
              </div>
              <p className='text-sm text-primary/70'>
                {room.reviews?.length ? `${room.reviews.length} reviews` : 'Be the first to review this stay'}
              </p>
            </div>


            <div className='mt-12'>
              <h3 className='h3 mb-3'>Details</h3>
              <p className='mb-12'>
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Blanditiis accusantium sapiente quas quos explicabo, odit nostrum? Reiciendis illum dolor eos dicta. Illum vero at hic nostrum sint et quod porro.
              </p>

              {/* icons grid */}
              <div className="grid grid-cols-3 gap-6 mb-12">
                {room.facilities && room.facilities.length > 0 ? (
                  room.facilities.map((item, index) => (
                    <div key={index} className="flex items-center gap-x-3 flex-1">
                      {getFacilityIcon(item)}
                      <div className="text-base">{typeof item === 'string' ? item : item.name}</div>
                    </div>
                  ))
                ) : (
                  <p className="text-primary/70 col-span-3">No facilities information available</p>
                )}
              </div>
            </div>

            <div className='space-y-6'>
              <h3 className='h3'>Guest impressions</h3>
              <div className='space-y-4'>
                {reviews.length ? (
                  reviews.map(review => (
                    <div key={review.id} className='border border-accent/10 p-5 bg-white shadow-sm'>
                      <div className='flex justify-between items-center mb-2'>
                        <div>
                          <p className='font-semibold'>{review.userName}</p>
                          <span className='text-xs text-primary/60'>
                            {review.stayDate ||
                              (review.createdAt
                                ? new Date(review.createdAt).toLocaleDateString('vi-VN')
                                : 'Khách ẩn danh')}
                          </span>
                        </div>
                        <div className='flex text-accent'>
                          {[...Array(5)].map((_, index) => (
                            <FaStar
                              key={index}
                              className={`${index < review.rating ? 'text-accent' : 'text-accent/20'}`}
                            />
                          ))}
                        </div>
                      </div>
                      <p className='text-primary/80 leading-relaxed'>{review.comment}</p>
                    </div>
                  ))
                ) : (
                  <p className='text-primary/70'>No reviews for this room yet.</p>
                )}
              </div>

              <div className='mt-8'>
                <h4 className='font-primary text-2xl mb-4'>Share your stay experience</h4>
                {isAuthenticated() ? (
                  <form onSubmit={handleReviewSubmit} className='space-y-4'>
                    <div>
                      <label className='block text-sm font-semibold mb-2'>Rating</label>
                      <select
                        value={reviewForm.rating}
                        onChange={(e) => setReviewForm(prev => ({ ...prev, rating: Number(e.target.value) }))}
                        className='border border-accent/20 px-4 py-3 w-full focus:outline-none focus:border-accent'
                      >
                        {[5, 4, 3, 2, 1].map(score => (
                          <option key={score} value={score}>
                            {score} Star
                          </option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className='block text-sm font-semibold mb-2'>Your thoughts</label>
                      <textarea
                        value={reviewForm.comment}
                        onChange={(e) => setReviewForm(prev => ({ ...prev, comment: e.target.value }))}
                        rows={4}
                        className='border border-accent/20 px-4 py-3 w-full focus:outline-none focus:border-accent resize-none'
                        placeholder='What delighted you the most during your stay?'
                      />
                    </div>
                    <button type='submit' className='btn btn-secondary'>
                      Submit review
                    </button>
                  </form>
                ) : (
                  <p className='text-sm text-primary/70'>
                    Sign in to unlock review privileges.
                  </p>
                )}
              </div>
            </div>
          </div>

          <div className='w-full lg:w-[40%] h-full'>
            <div className='py-8 px-6 bg-accent/20 mb-12'>
              <h3 className='h3 mb-6'>Your Reservation</h3>
              <div className='flex justify-between items-center mb-6'>
                <div>
                  <p className='text-sm text-primary/60'>Rate per night</p>
                  <p className='text-3xl font-primary text-accent'>${room.price}</p>
                </div>
                <div className='text-sm text-primary/60 text-right'>
                  <p>Up to {maxGuests} guests</p>
                  <p>{nights} night(s) • ${totalPrice}</p>
                </div>
              </div>

              <form className='space-y-4' onSubmit={handleBooking}>
                <div className='grid grid-cols-1 sm:grid-cols-2 gap-4'>
                  <div>
                    <label className='text-xs uppercase tracking-[2px] text-primary/60'>Check-in</label>
                    <input
                      type='date'
                      value={reservation.checkIn}
                      onChange={(e) => handleReservationChange('checkIn', e.target.value)}
                      className='w-full bg-white border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent'
                    />
                  </div>
                  <div>
                    <label className='text-xs uppercase tracking-[2px] text-primary/60'>Check-out</label>
                    <input
                      type='date'
                      value={reservation.checkOut}
                      onChange={(e) => handleReservationChange('checkOut', e.target.value)}
                      className='w-full bg-white border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent'
                    />
                  </div>
                </div>

                <div className='grid grid-cols-1 sm:grid-cols-2 gap-4'>
                  <div>
                    <label className='text-xs uppercase tracking-[2px] text-primary/60 mb-2 block'>Adults</label>
                    <select
                      value={reservation.adults}
                      onChange={(e) => {
                        const nextAdults = Number(e.target.value);
                        const spare = Math.max(0, maxGuests - nextAdults);
                        const nextKids = Math.min(reservation.kids, spare);
                        setReservation(prev => ({ ...prev, adults: nextAdults, kids: nextKids }));
                      }}
                      className='w-full border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent bg-white cursor-pointer'
                    >
                      {Array.from({ length: maxGuests }, (_, idx) => idx + 1).map(value => (
                        <option key={value} value={value}>{value} {value === 1 ? 'Adult' : 'Adults'}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className='text-xs uppercase tracking-[2px] text-primary/60 mb-2 block'>Kids</label>
                    <select
                      value={reservation.kids}
                      onChange={(e) => {
                        const selectedKids = Number(e.target.value);
                        const total = reservation.adults + selectedKids;
                        if (total <= maxGuests) {
                          handleReservationChange('kids', selectedKids);
                        } else {
                          const maxKids = Math.max(0, maxGuests - reservation.adults);
                          handleReservationChange('kids', maxKids);
                          showToast({ 
                            type: 'error', 
                            message: `Maximum ${maxGuests} guests allowed. Kids adjusted to ${maxKids}.` 
                          });
                        }
                      }}
                      className='w-full border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent bg-white cursor-pointer'
                      disabled={reservation.adults >= maxGuests}
                    >
                      {Array.from({ length: Math.max(0, maxGuests - reservation.adults) + 1 }, (_, idx) => idx).map(value => (
                        <option key={value} value={value}>
                          {value === 0 ? 'No Kids' : `${value} ${value === 1 ? 'Kid' : 'Kids'}`}
                        </option>
                      ))}
                    </select>
                    {reservation.adults >= maxGuests && (
                      <p className='text-xs text-primary/50 mt-1'>Maximum guests reached</p>
                    )}
                  </div>
                </div>
                {/* Guest Booking Fields - Only show if not authenticated */}
                {!isAuthenticated() && (
                  <>
                    <div className='border-t border-accent/20 pt-4 mt-4'>
                      <p className='text-sm font-semibold text-primary mb-3'>Guest Information</p>
                    </div>
                    <div>
                      <label className='text-xs uppercase tracking-[2px] text-primary/60'>Full Name *</label>
                      <input
                        type='text'
                        required
                        value={reservation.guestName}
                        onChange={(e) => handleReservationChange('guestName', e.target.value)}
                        className='w-full bg-white border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent'
                        placeholder='Your full name'
                      />
                    </div>
                    <div>
                      <label className='text-xs uppercase tracking-[2px] text-primary/60'>Email *</label>
                      <input
                        type='email'
                        required
                        value={reservation.guestEmail}
                        onChange={(e) => handleReservationChange('guestEmail', e.target.value)}
                        className='w-full bg-white border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent'
                        placeholder='your.email@example.com'
                      />
                    </div>
                    <div>
                      <label className='text-xs uppercase tracking-[2px] text-primary/60'>Phone (Optional)</label>
                      <input
                        type='tel'
                        value={reservation.guestPhone}
                        onChange={(e) => handleReservationChange('guestPhone', e.target.value)}
                        className='w-full bg-white border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent'
                        placeholder='+84 123 456 789'
                      />
                    </div>
                  </>
                )}

                <div>
                  <label className='text-xs uppercase tracking-[2px] text-primary/60'>Promo Code (Optional)</label>
                  <input
                    type='text'
                    value={reservation.promoCode}
                    onChange={(e) => handleReservationChange('promoCode', e.target.value)}
                    className='w-full bg-white border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent'
                    placeholder='E.g. WELCOME25'
                  />
                </div>
                <div>
                  <label className='text-xs uppercase tracking-[2px] text-primary/60'>Special requests</label>
                  <textarea
                    rows={3}
                    value={reservation.note}
                    onChange={(e) => handleReservationChange('note', e.target.value)}
                    className='w-full bg-white border border-accent/20 px-4 py-3 focus:outline-none focus:border-accent resize-none'
                    placeholder='E.g. birthday setup, dietary requirements...'
                  />
                </div>

                <button type='submit' className='btn btn-primary w-full uppercase tracking-[4px]'>
                  {isAuthenticated() ? 'Confirm reservation' : 'Continue as guest'}
                </button>
                {!isAuthenticated() && (
                  <p className='text-xs text-primary/60 text-center mt-2'>
                    Or <Link to='/login' className='text-accent underline'>sign in</Link> to save your booking history
                  </p>
                )}
              </form>

              {pricingPreview?.breakdown?.length > 0 && (
                <div className='mt-8 bg-white border border-accent/20 rounded'>
                  <div className='px-4 py-3 border-b border-accent/10'>
                    <p className='text-sm font-semibold text-primary'>Nightly breakdown</p>
                  </div>
                  <ul className='divide-y divide-accent/10'>
                    {pricingPreview.breakdown.map((night) => (
                      <li key={night.date} className='px-4 py-3 flex items-center justify-between text-sm'>
                        <div>
                          <p className='font-semibold'>{night.date}</p>
                          <p className='text-primary/60'>{night.label}</p>
                        </div>
                        <p className='font-primary text-lg text-accent'>${night.rate}</p>
                      </li>
                    ))}
                  </ul>
                </div>
              )}
            </div>

            <div>
              <h3 className='h3'>Hotel Rules</h3>
              <p className='mb-6 text-justify'>
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Commodi dolores iure fugiat eligendi illo est, aperiam quasi distinctio necessitatibus suscipit nemo provident eaque voluptas earum.
              </p>

              <ul className='flex flex-col gap-y-4'>
                {
                  hotelRules.map(({ rules }, idx) =>
                    <li key={idx} className='flex items-center gap-x-4'>
                      <FaCheck className='text-accent' />
                      {rules}
                    </li>
                  )
                }
              </ul>
            </div>

          </div>

        </div>
      </div>

      {showQRPayment && currentBooking && (
        <QRPayment
          bookingData={currentBooking}
          onPaymentSuccess={handlePaymentSuccess}
          onClose={handleCloseQRPayment}
          type="room"
        />
      )}

      {showInvoice && currentBooking && (
        <Invoice
          booking={currentBooking}
          onClose={() => setShowInvoice(false)}
          onDownload={() => {
            showToast({ type: 'success', message: 'PDF downloaded successfully!' });
          }}
        />
      )}
    </section>
  );
};

export default RoomDetails;

--- END FILE: src\pages\RoomDetails.jsx ---

--- START FILE: src\pages\RoomsPage.jsx ---
import { BookForm, Rooms, ScrollToTop, CategoryFilter } from "../components";
import {
  FaCrown,
  FaConciergeBell,
  FaWineGlassAlt,
  FaUmbrellaBeach,
} from "react-icons/fa";
import { useRoomContext } from "../context/RoomContext";
import { useMemo } from "react";

const STORAGE_URL = 'https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms';

const highlights = [
  {
    title: "Signature Suites",
    description: "Spacious villas with private terraces and curated amenities.",
    icon: FaCrown,
  },
  {
    title: "Butler Service",
    description: "24/7 dedicated hosts ready to personalize every detail.",
    icon: FaConciergeBell,
  },
  {
    title: "Gourmet Moments",
    description:
      "In-room dining with pairing menus from our award-winning chefs.",
    icon: FaWineGlassAlt,
  },
  {
    title: "Resort Experiences",
    description:
      "Private spa rituals, yacht cruises, and sunset lounge access.",
    icon: FaUmbrellaBeach,
  },
];

const stats = [
  { label: "Suites & Villas", value: "80+" },
  { label: "Average Size", value: "120 m²" },
  { label: "Guest Rating", value: "4.9/5" },
  { label: "Concierge Team", value: "24/7" },
];

const RoomsPage = () => {
  const { rooms } = useRoomContext();

  const resultText = useMemo(() => {
    if (!rooms?.length) return "No matching rooms";
    if (rooms.length === 1) return "1 room available";
    return `${rooms.length} rooms available`;
  }, [rooms]);

  return (
    <div className="min-h-screen bg-[#f7f4ef]">
      <ScrollToTop />

      <section className="relative h-[60vh] min-h-[480px] flex items-center justify-center text-center">
        <img
          src={`${STORAGE_URL}/img/heroSlider/3.jpg`}
          alt="Panoramic hotel suite"
          className="absolute inset-0 h-full w-full object-cover"
        />
        <div className="absolute inset-0 bg-black/60" />
        <div className="relative z-10 max-w-3xl px-6 text-white">
          <p className="font-tertiary uppercase tracking-[6px] text-sm mb-4">
            Adina Hotel &amp; Spa
          </p>
          <h1 className="font-primary text-4xl md:text-5xl lg:text-6xl leading-tight mb-6">
            Curated Rooms &amp; Bespoke Suites
          </h1>
          <p className="text-lg text-white/80">
            Discover sophisticated residences bathed in natural light with
            handcrafted interiors, premium linens, and immersive smart-home
            comforts.
          </p>
        </div>
      </section>

      <section className="container mx-auto px-6 lg:px-0 mt-10 relative z-20">
        <div className="bg-white shadow-2xl border border-white/60">
          <div className="bg-accent/10 px-6 py-4 flex items-center justify-between flex-wrap gap-4">
            <div>
              <p className="font-tertiary uppercase tracking-[4px] text-xs text-primary">
                Plan your stay
              </p>
              <h3 className="font-primary text-2xl">
                Availability &amp; Rates
              </h3>
            </div>
            <p className="text-sm text-primary/70 max-w-sm">
              Select your travel dates and group size to view tailor-made
              options instantly.
            </p>
          </div>
          <div className="p-4 lg:p-6 bg-white">
            <BookForm />
          </div>
        </div>
      </section>

      <section className="container mx-auto px-6 lg:px-0 py-20">
        <CategoryFilter />

        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
          {stats.map((stat) => (
            <div
              key={stat.label}
              className="bg-white shadow-sm border border-[#eadfcf] p-6"
            >
              <p className="font-tertiary uppercase tracking-[3px] text-xs text-primary/70">
                {stat.label}
              </p>
              <p className="font-primary text-4xl text-accent mt-2">
                {stat.value}
              </p>
            </div>
          ))}
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {highlights.map(({ title, description, icon: Icon }) => (
            <div
              key={title}
              className="bg-white p-6 shadow-sm border border-[#eadfcf] hover:-translate-y-1 transition-transform duration-300"
            >
              <Icon className="text-accent text-3xl mb-4" />
              <h3 className="font-primary text-xl mb-2">{title}</h3>
              <p className="text-sm text-primary/70 leading-relaxed">
                {description}
              </p>
            </div>
          ))}
        </div>
      </section>

      <Rooms />
    </div>
  );
};

export default RoomsPage;
--- END FILE: src\pages\RoomsPage.jsx ---

--- START FILE: src\pages\SetPassword.jsx ---
import { useState, useEffect, useMemo } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { useAuth } from '../context/SimpleAuthContext';
import { supabase } from '../utils/supabaseClient';
import { hashPassword } from '../services/simpleAuthService';
import { FaLock, FaEye, FaEyeSlash, FaSpinner, FaCheckCircle, FaCheck, FaTimes } from 'react-icons/fa';
import Toast from '../components/Toast';

const SetPassword = () => {
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();
  const { user, setUser } = useAuth();
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [toast, setToast] = useState(null);

  const email = searchParams.get('email') || user?.email;

  useEffect(() => {
    // Nếu không có email, redirect về login
    if (!email && !user) {
      navigate('/login');
    }
  }, [email, user, navigate]);

  // Password strength validation - Tương tự Register.jsx
  const passwordRequirements = useMemo(() => {
    return {
      minLength: password.length >= 8,
      hasUpperCase: /[A-Z]/.test(password),
      hasLowerCase: /[a-z]/.test(password),
      hasNumber: /[0-9]/.test(password),
      hasSpecialChar: /[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/.test(password),
    };
  }, [password]);

  const isPasswordValid = useMemo(() => {
    return Object.values(passwordRequirements).every(req => req === true);
  }, [passwordRequirements]);

  // Check if passwords match
  const passwordsMatch = useMemo(() => {
    if (!confirmPassword) return null; // Not checked yet
    return password === confirmPassword;
  }, [password, confirmPassword]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    // Validation - Tương tự Register.jsx
    if (!password || !confirmPassword) {
      setError('Vui lòng điền đầy đủ thông tin');
      setLoading(false);
      return;
    }

    // Validate password strength
    if (!isPasswordValid) {
      setError('Mật khẩu không đáp ứng đủ yêu cầu. Vui lòng kiểm tra các yêu cầu bên dưới.');
      setLoading(false);
      return;
    }

    if (password !== confirmPassword) {
      setError('Mật khẩu xác nhận không khớp');
      setLoading(false);
      return;
    }

    try {
      // Hash password
      const passwordHash = await hashPassword(password);

      // Tìm user hiện tại
      const targetEmail = email || user?.email;
      if (!targetEmail) {
        throw new Error('Không tìm thấy email');
      }

      const { data: existingUser, error: findError } = await supabase
        .from('users')
        .select('*')
        .eq('email', targetEmail)
        .single();

      if (findError && findError.code !== 'PGRST116') {
        throw new Error('Không tìm thấy tài khoản');
      }

      if (!existingUser) {
        throw new Error('Tài khoản không tồn tại');
      }

      // Update password
      const { data: updatedUser, error: updateError } = await supabase
        .from('users')
        .update({
          password_hash: passwordHash,
          updated_at: new Date().toISOString()
        })
        .eq('id', existingUser.id)
        .select()
        .single();

      if (updateError) {
        throw new Error('Không thể cập nhật mật khẩu: ' + updateError.message);
      }

      // Update user trong context
      setUser(updatedUser);

      setToast({
        message: 'Đặt mật khẩu thành công!',
        type: 'success'
      });

      // Redirect về home sau 1.5 giây
      setTimeout(() => {
        navigate('/');
      }, 1500);
    } catch (err) {
      console.error('Set password error:', err);
      setError(err.message || 'Có lỗi xảy ra. Vui lòng thử lại.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary via-primary to-accent/20 flex items-center justify-center p-4">
      <div className="absolute inset-0 overflow-hidden">
        <div className="absolute top-0 left-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
        <div className="absolute bottom-0 right-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl translate-x-1/2 translate-y-1/2"></div>
      </div>

      <div className="relative z-10 w-full max-w-md">
        <div className="bg-white rounded-2xl shadow-2xl p-8">
          <div className="text-center mb-6">
            <div className="inline-flex items-center justify-center w-16 h-16 bg-accent/10 rounded-full mb-4">
              <FaLock className="text-2xl text-accent" />
            </div>
            <h2 className="text-2xl font-bold text-primary mb-2">
              Đặt Mật Khẩu
            </h2>
            <p className="text-gray-600 text-sm">
              Vui lòng đặt mật khẩu cho tài khoản của bạn
            </p>
            {email && (
              <p className="text-gray-500 text-xs mt-2">
                Email: {email}
              </p>
            )}
          </div>

          {toast && (
            <Toast
              message={toast.message}
              type={toast.type}
              onClose={() => setToast(null)}
            />
          )}

          <form onSubmit={handleSubmit} className="space-y-4">
            {error && (
              <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                {error}
              </div>
            )}

            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Mật khẩu mới
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <FaLock className="text-gray-400" />
                </div>
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full pl-12 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all"
                  placeholder="Nhập mật khẩu mới"
                  required
                  disabled={loading}
                  minLength={8}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-accent transition-colors"
                >
                  {showPassword ? <FaEyeSlash /> : <FaEye />}
                </button>
              </div>
              
              {/* Password Strength Indicator - Tương tự Register.jsx */}
              {password && (
                <div className="mt-3 bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-1.5">
                  <p className="text-xs font-semibold text-gray-700 mb-2">Yêu cầu mật khẩu:</p>
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-1.5">
                    <div className={`flex items-center gap-2 text-xs ${passwordRequirements.minLength ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.minLength ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>Ít nhất 8 ký tự</span>
                    </div>
                    <div className={`flex items-center gap-2 text-xs ${passwordRequirements.hasUpperCase ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.hasUpperCase ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>Một chữ hoa (A-Z)</span>
                    </div>
                    <div className={`flex items-center gap-2 text-xs ${passwordRequirements.hasLowerCase ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.hasLowerCase ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>Một chữ thường (a-z)</span>
                    </div>
                    <div className={`flex items-center gap-2 text-xs ${passwordRequirements.hasNumber ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.hasNumber ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>Một số (0-9)</span>
                    </div>
                    <div className={`flex items-center gap-2 text-xs sm:col-span-2 ${passwordRequirements.hasSpecialChar ? 'text-green-600' : 'text-gray-500'}`}>
                      {passwordRequirements.hasSpecialChar ? (
                        <FaCheck className="text-green-600 flex-shrink-0" />
                      ) : (
                        <FaTimes className="text-gray-400 flex-shrink-0" />
                      )}
                      <span>Một ký tự đặc biệt (!@#$%...)</span>
                    </div>
                  </div>
                  {isPasswordValid && (
                    <div className="mt-2 pt-2 border-t border-gray-200">
                      <p className="text-xs text-green-600 font-semibold flex items-center gap-2">
                        <FaCheck className="flex-shrink-0" />
                        Mật khẩu đáp ứng tất cả yêu cầu
                      </p>
                    </div>
                  )}
                </div>
              )}
            </div>

            <div>
              <label className="block text-sm font-semibold mb-2 text-primary">
                Xác nhận mật khẩu
              </label>
              <div className="relative">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <FaLock className="text-gray-400" />
                </div>
                <input
                  type={showConfirmPassword ? 'text' : 'password'}
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  className={`w-full pl-12 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-accent focus:border-transparent transition-all ${
                    confirmPassword && passwordsMatch === false
                      ? 'border-red-300 bg-red-50'
                      : confirmPassword && passwordsMatch === true
                      ? 'border-green-300 bg-green-50'
                      : 'border-gray-300'
                  }`}
                  placeholder="Nhập lại mật khẩu"
                  required
                  disabled={loading}
                  minLength={8}
                />
                <button
                  type="button"
                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                  className="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-accent transition-colors"
                >
                  {showConfirmPassword ? <FaEyeSlash /> : <FaEye />}
                </button>
              </div>
              {confirmPassword && passwordsMatch !== null && (
                <div className="mt-1.5">
                  {passwordsMatch ? (
                    <p className="text-xs text-green-600 flex items-center gap-1.5">
                      <FaCheck className="flex-shrink-0" />
                      Mật khẩu khớp
                    </p>
                  ) : (
                    <p className="text-xs text-red-600 flex items-center gap-1.5">
                      <FaTimes className="flex-shrink-0" />
                      Mật khẩu không khớp
                    </p>
                  )}
                </div>
              )}
            </div>

            <button
              type="submit"
              disabled={loading || !isPasswordValid || passwordsMatch === false}
              className="w-full btn btn-primary btn-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? (
                <>
                  <FaSpinner className="animate-spin" />
                  Đang xử lý...
                </>
              ) : (
                <>
                  <FaCheckCircle />
                  Xác nhận
                </>
              )}
            </button>
          </form>

          <div className="mt-6 text-center">
            <button
              onClick={() => navigate('/')}
              className="text-sm text-gray-600 hover:text-accent transition-colors"
            >
              Bỏ qua (có thể đặt sau)
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default SetPassword;


--- END FILE: src\pages\SetPassword.jsx ---

--- START FILE: src\pages\SpaPage.jsx ---
import { useState, useEffect } from 'react';
import { ScrollToTop, Toast } from '../components';
import QRPayment from '../components/QRPayment';
import Invoice from '../components/Invoice';
import { useBookingContext } from '../context/BookingContext';
import { useAuth } from '../context/SimpleAuthContext';
import {
  fetchSpaServices,
  fetchSpaSlotsByDateTime,
  updateSpaSlotUsage,
} from '../services/bookingService';
// ⚠️ Local images removed - now use Supabase URLs
import { FaSpa, FaClock, FaMapMarkerAlt, FaPhoneAlt, FaStar, FaCheck, FaLeaf, FaWater, FaHandSparkles } from 'react-icons/fa';

const STORAGE_URL = "https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms";
const PLACEHOLDER_IMG_SERVICE = "https://via.placeholder.com/400x300?text=Service+Image";

const PLACEHOLDER_IMG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect fill='%23ddd' width='300' height='200'/%3E%3Ctext x='50%' y='50%' font-size='14' fill='%23999' text-anchor='middle' dy='.3em'%3ESpa Service%3C/text%3E%3C/svg%3E";

const spaCategories = [
  { id: 'massage', name: 'Massage Therapies', icon: FaHandSparkles },
  { id: 'facial', name: 'Facial Treatments', icon: FaSpa },
  { id: 'body', name: 'Body Treatments', icon: FaLeaf },
  { id: 'wellness', name: 'Wellness Packages', icon: FaWater },
];

// Helper function to get image for spa services
// Uses Supabase Storage URLs based on room types when available
const getSpaServiceImage = (id) => {
  // Use id to cycle through images 1-8.png
  // Images are named 1-lg.png through 8-lg.png for large format
  if (!id) return PLACEHOLDER_IMG_SERVICE;
  
  const imgIndex = (id % 8) === 0 ? 8 : (id % 8);
  return `${STORAGE_URL}/${imgIndex}-lg.png` || PLACEHOLDER_IMG_SERVICE;
};

const spaServices = {
  massage: [
    { id: 1, name: 'Swedish Massage', description: 'Classic relaxation massage with long, flowing strokes', duration: '60 min', price: 95, popular: true, image: getSpaServiceImage(1) },
    { id: 2, name: 'Deep Tissue Massage', description: 'Therapeutic massage targeting muscle tension and knots', duration: '90 min', price: 135, image: getSpaServiceImage(2) },
    { id: 3, name: 'Hot Stone Massage', description: 'Heated stones for deep muscle relaxation and stress relief', duration: '90 min', price: 145, popular: true, image: getSpaServiceImage(3) },
    { id: 4, name: 'Aromatherapy Massage', description: 'Essential oils combined with therapeutic massage techniques', duration: '60 min', price: 105, image: getSpaServiceImage(4) },
    { id: 5, name: 'Thai Massage', description: 'Traditional Thai stretching and acupressure techniques', duration: '90 min', price: 125, image: getSpaServiceImage(5) },
    { id: 6, name: 'Couples Massage', description: 'Side-by-side massage experience in a private suite', duration: '90 min', price: 280, image: getSpaServiceImage(6) },
  ],
  facial: [
    { id: 7, name: 'Signature Facial', description: 'Deep cleansing, exfoliation, and hydration treatment', duration: '60 min', price: 120, popular: true, image: getSpaServiceImage(7) },
    { id: 8, name: 'Anti-Aging Facial', description: 'Advanced treatment to reduce fine lines and improve elasticity', duration: '75 min', price: 165, image: getSpaServiceImage(8) },
    { id: 9, name: 'Hydrating Facial', description: 'Intensive moisture treatment for dry and dehydrated skin', duration: '60 min', price: 115, image: getSpaServiceImage(9) },
    { id: 10, name: 'Brightening Facial', description: 'Vitamin C treatment to even skin tone and reduce pigmentation', duration: '60 min', price: 130, image: getSpaServiceImage(10) },
    { id: 11, name: 'Acne Treatment', description: 'Specialized treatment for acne-prone and sensitive skin', duration: '75 min', price: 140, image: getSpaServiceImage(11) },
  ],
  body: [
    { id: 12, name: 'Body Scrub', description: 'Exfoliating treatment with natural sea salt and essential oils', duration: '60 min', price: 110, popular: true, image: getSpaServiceImage(12) },
    { id: 13, name: 'Body Wrap', description: 'Detoxifying wrap with mineral-rich mud and algae', duration: '90 min', price: 150, image: getSpaServiceImage(13) },
    { id: 14, name: 'Cellulite Treatment', description: 'Targeted treatment to reduce appearance of cellulite', duration: '75 min', price: 140, image: getSpaServiceImage(14) },
    { id: 15, name: 'Full Body Polish', description: 'Complete body exfoliation and hydration treatment', duration: '90 min', price: 160, image: getSpaServiceImage(15) },
  ],
  wellness: [
    { id: 16, name: 'Spa Day Package', description: 'Full day experience: massage, facial, body treatment, and lunch', duration: '5 hours', price: 450, popular: true, image: getSpaServiceImage(16), includes: ['Swedish Massage', 'Signature Facial', 'Body Scrub', 'Gourmet Lunch'] },
    { id: 17, name: 'Couples Retreat', description: 'Romantic package for two with couples massage and champagne', duration: '3 hours', price: 520, image: getSpaServiceImage(17), includes: ['Couples Massage', 'Side-by-side Facial', 'Champagne Service'] },
    { id: 18, name: 'Detox & Renewal', description: 'Complete detox package with body wrap, massage, and herbal tea', duration: '4 hours', price: 380, image: getSpaServiceImage(18), includes: ['Body Wrap', 'Aromatherapy Massage', 'Herbal Tea Service'] },
    { id: 19, name: 'Ultimate Relaxation', description: 'Premium package with all signature treatments and private suite', duration: '6 hours', price: 650, image: getSpaServiceImage(19), includes: ['Hot Stone Massage', 'Anti-Aging Facial', 'Full Body Polish', 'Private Suite Access'] },
  ],
};

const facilities = [
  { name: 'Steam Room', description: 'Relaxing steam therapy for detoxification' },
  { name: 'Sauna', description: 'Traditional Finnish sauna experience' },
  { name: 'Jacuzzi', description: 'Hydrotherapy pool with heated water' },
  { name: 'Relaxation Lounge', description: 'Peaceful space with herbal teas and light refreshments' },
  { name: 'Private Treatment Rooms', description: 'Elegant suites for personalized treatments' },
  { name: 'Fitness Center', description: 'State-of-the-art equipment with personal training available' },
];

const openingHours = [
  { day: 'Monday - Friday', time: '09:00 - 21:00' },
  { day: 'Saturday - Sunday', time: '08:00 - 22:00' },
  { day: 'Holidays', time: '10:00 - 20:00' },
];

const testimonials = [
  {
    name: 'Sarah Johnson',
    rating: 5,
    comment: 'The most relaxing experience I\'ve ever had. The hot stone massage was incredible!',
  },
  {
    name: 'Michael Chen',
    rating: 5,
    comment: 'The couples retreat package was perfect for our anniversary. Highly recommended!',
  },
  {
    name: 'Emma Williams',
    rating: 5,
    comment: 'The facial treatment left my skin glowing. The staff is professional and attentive.',
  },
];

const SpaPage = () => {
  const { user } = useAuth();
  const { createSpaBooking, confirmSpaBooking } = useBookingContext();
  const [servicesByCategory, setServicesByCategory] = useState(spaServices);
  const [serviceLookup, setServiceLookup] = useState({});
  const [activeCategory, setActiveCategory] = useState('massage');
  const [toast, setToast] = useState(null);
  const [showQRPayment, setShowQRPayment] = useState(false);
  const [showInvoice, setShowInvoice] = useState(false);
  const [currentBooking, setCurrentBooking] = useState(null);
  const [bookingForm, setBookingForm] = useState({
    name: '',
    email: '',
    phone: '',
    date: '',
    time: '',
    service: '',
    therapist: '',
    specialRequests: '',
  });

  // Auto-fill form when user is logged in
  useEffect(() => {
    if (user) {
      setBookingForm((prev) => ({
        ...prev,
        name: user.full_name || user.name || '',
        email: user.email || '',
        phone: user.phone || '',
      }));
    }
  }, [user]);

  // Load spa services from Supabase (fallback to static if error)
  useEffect(() => {
    const loadSpaServices = async () => {
      try {
        const data = await fetchSpaServices();
        if (!data || data.length === 0) return;

        const grouped = data.reduce((acc, item) => {
          const cat = (item.category || 'other').toLowerCase();
          acc[cat] = acc[cat] || [];
          acc[cat].push({
            id: item.id,
            code: item.code,
            name: item.name,
            description: item.description,
            duration: `${item.duration_minutes} min`,
            price: Number(item.price) || 0,
            popular: item.is_active,
            image: item.image_url || PLACEHOLDER_IMG_SERVICE,
            includes: item.includes || item.perks || null,
          });
          return acc;
        }, {});

        const lookup = {};
        Object.values(grouped).forEach((list) => {
          list.forEach((svc) => {
            lookup[svc.name] = svc;
          });
        });

        setServicesByCategory(grouped);
        setServiceLookup(lookup);
        setActiveCategory(Object.keys(grouped)[0] || 'massage');
      } catch (err) {
        console.warn('Fallback to static spa services, fetch error:', err);
      }
    };
    loadSpaServices();
  }, []);

  const handleBookingSubmit = async (e) => {
    e.preventDefault();
    if (!bookingForm.name || !bookingForm.email || !bookingForm.date || !bookingForm.time || !bookingForm.service) {
      setToast({
        type: 'error',
        message: 'Please fill in all required fields.',
      });
      return;
    }

    // Find service data (Supabase first, fallback static)
    const allServices = Object.values(servicesByCategory).flat();
    const selectedService = allServices.find(s => s.name === bookingForm.service);
    const price = selectedService?.price || 100;
    const duration = selectedService?.duration || '60 min';
    const appointmentAt = `${bookingForm.date}T${bookingForm.time}`;

    // Check spa slot availability (if we have service id)
    if (selectedService?.id) {
      const slots = await fetchSpaSlotsByDateTime(selectedService.id, appointmentAt, bookingForm.therapist || null);
      const availableSlot = slots.find((s) => s.status === 'available');
      if (!availableSlot) {
        setToast({
          type: 'error',
          message: 'No available slot for this time/service.',
        });
        return;
      }
      await updateSpaSlotUsage(availableSlot.id);
    }

    const result = createSpaBooking({
      name: bookingForm.name,
      email: bookingForm.email,
      phone: bookingForm.phone,
      date: `${bookingForm.date}T${bookingForm.time}`,
      service: bookingForm.service,
      serviceName: bookingForm.service,
      therapist: bookingForm.therapist,
      specialRequests: bookingForm.specialRequests,
      userId: user?.id,
      userName: bookingForm.name,
      userEmail: bookingForm.email,
      price,
      totalPrice: price,
      duration,
    });

    if (result?.success) {
      setCurrentBooking(result.booking);
      setShowQRPayment(true);
    }
  };

  const handlePaymentSuccess = (paymentData) => {
    if (!currentBooking) return;
    
    const confirmedBooking = confirmSpaBooking(currentBooking.id, paymentData);
    setCurrentBooking(confirmedBooking);
    setShowQRPayment(false);
    setShowInvoice(true);
    setToast({
      type: 'success',
      message: 'Payment successful! Your appointment is confirmed.',
    });
    setBookingForm({
      name: '',
      email: '',
      phone: '',
      date: '',
      time: '',
      service: '',
      therapist: '',
      specialRequests: '',
    });
  };

  const handleCloseQRPayment = () => {
    setShowQRPayment(false);
    setCurrentBooking(null);
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setBookingForm((prev) => ({ ...prev, [name]: value }));
  };

  const handleServiceSelect = (serviceName) => {
    setBookingForm((prev) => ({ ...prev, service: serviceName }));
  };

  return (
    <div className='min-h-screen bg-[#f7f4ef]'>
      <ScrollToTop />
      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

      {/* Hero Section */}
      <section className='relative h-[60vh] min-h-[480px] flex items-center justify-center text-center'>
        <img
          src={`${STORAGE_URL}/3-lg.png`}
          alt='Spa relaxation'
          className='absolute inset-0 h-full w-full object-cover'
        />
        <div className='absolute inset-0 bg-black/60' />
        <div className='relative z-10 max-w-3xl px-6 text-white'>
          <p className='font-tertiary uppercase tracking-[6px] text-sm mb-4'>
            Adina Hotel &amp; Spa
          </p>
          <h1 className='font-primary text-4xl md:text-5xl lg:text-6xl leading-tight mb-6'>
            Sanctuary of Wellness
          </h1>
          <p className='text-lg text-white/80'>
            Rejuvenate your mind, body, and soul with our world-class spa treatments and holistic wellness experiences.
          </p>
        </div>
      </section>

      {/* Services Section */}
      <section className='container mx-auto px-6 lg:px-0 py-20'>
        <div className='text-center mb-12'>
          <p className='font-tertiary uppercase tracking-[4px] text-xs text-primary/70 mb-2'>
            Our Services
          </p>
          <h2 className='font-primary text-4xl mb-4'>Spa Treatments</h2>
          <p className='text-primary/70 max-w-2xl mx-auto'>
            Indulge in our curated selection of therapeutic treatments designed to restore balance and promote well-being.
          </p>
        </div>

        {/* Category Tabs */}
        <div className='flex flex-wrap justify-center gap-4 mb-12'>
          {spaCategories.map((category) => {
            const Icon = category.icon;
            return (
              <button
                key={category.id}
                onClick={() => setActiveCategory(category.id)}
                className={`flex items-center gap-2 px-6 py-3 border rounded-full transition ${
                  activeCategory === category.id
                    ? 'bg-accent text-white border-accent'
                    : 'border-[#eadfcf] text-primary hover:border-accent'
                }`}
              >
                <Icon />
                <span>{category.name}</span>
              </button>
            );
          })}
        </div>

        {/* Services Grid */}
        <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'>
          {(servicesByCategory[activeCategory] || []).map((service) => (
            <div
              key={service.id}
              className='bg-white shadow-sm border border-[#eadfcf] hover:shadow-lg transition-shadow cursor-pointer overflow-hidden'
              onClick={() => handleServiceSelect(service.name)}
            >
              <div className='relative h-48 overflow-hidden'>
                <img
                  src={service.image}
                  alt={service.name}
                  className='w-full h-full object-cover hover:scale-110 transition-transform duration-300'
                />
                {service.popular && (
                  <span className='absolute top-3 right-3 flex items-center gap-1 bg-accent text-white px-3 py-1 rounded-full text-xs'>
                    <FaStar />
                    <span>Popular</span>
                  </span>
                )}
              </div>
              <div className='p-6'>
                <h3 className='font-primary text-xl mb-2'>{service.name}</h3>
                <p className='text-sm text-primary/70 mb-3'>{service.description}</p>
                {service.includes && (
                  <div className='mb-3'>
                    <p className='text-xs font-semibold text-primary/60 mb-1'>Includes:</p>
                    <ul className='text-xs text-primary/70 space-y-1'>
                      {service.includes.map((item, idx) => (
                        <li key={idx} className='flex items-center gap-1'>
                          <FaCheck className='text-accent text-[10px]' />
                          <span>{item}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
                <div className='flex items-center justify-between'>
                  <span className='text-sm text-primary/60'>{service.duration}</span>
                  <p className='font-primary text-2xl text-accent'>${service.price}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>

      {/* Facilities Section */}
      <section className='bg-white py-20'>
        <div className='container mx-auto px-6 lg:px-0'>
          <div className='text-center mb-12'>
            <p className='font-tertiary uppercase tracking-[4px] text-xs text-primary/70 mb-2'>
              Our Facilities
            </p>
            <h2 className='font-primary text-4xl mb-4'>Wellness Amenities</h2>
          </div>

          <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'>
            {facilities.map((facility, index) => {
              // Use Supabase images or placeholder (1-6)
              const imgIndex = (index % 6) + 1;
              let facilityImage = `${STORAGE_URL}/${imgIndex}-lg.png`;
              
              return (
                <div
                  key={index}
                  className='bg-[#f7f4ef] border border-[#eadfcf] hover:shadow-lg transition-shadow overflow-hidden'
                >
                  <div className='relative h-40 overflow-hidden'>
                    <img
                      src={facilityImage}
                      alt={facility.name}
                      className='w-full h-full object-cover hover:scale-110 transition-transform duration-300'
                    />
                  </div>
                  <div className='p-6'>
                    <h3 className='font-primary text-xl mb-2'>{facility.name}</h3>
                    <p className='text-sm text-primary/70'>{facility.description}</p>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </section>

      {/* Booking Section */}
      <section className='container mx-auto px-6 lg:px-0 py-20'>
        <div className='grid grid-cols-1 lg:grid-cols-2 gap-12'>
          {/* Booking Form */}
          <div className='bg-white p-8 shadow-sm border border-[#eadfcf]'>
            <p className='font-tertiary uppercase tracking-[4px] text-xs text-primary/70 mb-2'>
              Book Your Treatment
            </p>
            <h2 className='font-primary text-3xl mb-6'>Schedule an Appointment</h2>
            <form onSubmit={handleBookingSubmit} className='space-y-5'>
              <div className='grid grid-cols-1 md:grid-cols-2 gap-5'>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Full Name *</label>
                  <input
                    type='text'
                    name='name'
                    value={bookingForm.name}
                    onChange={handleInputChange}
                    className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
                    placeholder='John Carter'
                    required
                  />
                </div>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Email *</label>
                  <input
                    type='email'
                    name='email'
                    value={bookingForm.email}
                    onChange={handleInputChange}
                    className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
                    placeholder='john@example.com'
                    required
                  />
                </div>
              </div>

              <div className='grid grid-cols-1 md:grid-cols-2 gap-5'>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Phone *</label>
                  <input
                    type='tel'
                    name='phone'
                    value={bookingForm.phone}
                    onChange={handleInputChange}
                    className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
                    placeholder='+84 987 654 321'
                    required
                  />
                </div>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Preferred Therapist</label>
                  <select
                    name='therapist'
                    value={bookingForm.therapist}
                    onChange={handleInputChange}
                    className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent bg-white'
                  >
                    <option value=''>No preference</option>
                    <option value='Sarah'>Sarah - Massage Specialist</option>
                    <option value='Emma'>Emma - Facial Expert</option>
                    <option value='Michael'>Michael - Body Treatment Specialist</option>
                  </select>
                </div>
              </div>

              <div>
                <label className='block text-sm font-semibold mb-2'>Service *</label>
                <input
                  type='text'
                  name='service'
                  value={bookingForm.service}
                  onChange={handleInputChange}
                  className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
                  placeholder='Select a service from above or type here'
                  required
                />
                <p className='text-xs text-primary/60 mt-1'>Click on a service card above to auto-fill</p>
              </div>

              <div className='grid grid-cols-1 md:grid-cols-2 gap-5'>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Date *</label>
                  <input
                    type='date'
                    name='date'
                    value={bookingForm.date}
                    onChange={handleInputChange}
                    min={new Date().toISOString().split('T')[0]}
                    className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
                    required
                  />
                </div>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Time *</label>
                  <input
                    type='time'
                    name='time'
                    value={bookingForm.time}
                    onChange={handleInputChange}
                    className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
                    required
                  />
                </div>
              </div>

              <div>
                <label className='block text-sm font-semibold mb-2'>Special Requests</label>
                <textarea
                  name='specialRequests'
                  value={bookingForm.specialRequests}
                  onChange={handleInputChange}
                  rows={3}
                  className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent resize-none'
                  placeholder='Allergies, pressure preference, etc.'
                />
              </div>

              <button type='submit' className='btn btn-primary w-full uppercase tracking-[4px]'>
                Book Appointment
              </button>
            </form>
          </div>

          {/* Spa Info */}
          <div className='space-y-8'>
            <div className='bg-white p-8 shadow-sm border border-[#eadfcf]'>
              <h3 className='font-primary text-2xl mb-6'>Opening Hours</h3>
              <div className='space-y-4'>
                {openingHours.map((schedule, index) => (
                  <div key={index} className='flex items-center justify-between pb-4 border-b border-[#eadfcf] last:border-0'>
                    <div className='flex items-center gap-3'>
                      <FaClock className='text-accent' />
                      <span className='font-semibold'>{schedule.day}</span>
                    </div>
                    <span className='text-primary/70'>{schedule.time}</span>
                  </div>
                ))}
              </div>
            </div>

            <div className='bg-white p-8 shadow-sm border border-[#eadfcf]'>
              <h3 className='font-primary text-2xl mb-6'>Contact Information</h3>
              <div className='space-y-4'>
                <div className='flex items-start gap-4'>
                  <FaMapMarkerAlt className='text-accent mt-1' />
                  <div>
                    <p className='font-semibold'>Location</p>
                    <p className='text-primary/70'>12 Tran Hung Dao, Hoan Kiem, Ha Noi</p>
                  </div>
                </div>
                <div className='flex items-start gap-4'>
                  <FaPhoneAlt className='text-accent mt-1' />
                  <div>
                    <p className='font-semibold'>Reservations</p>
                    <p className='text-primary/70'>+84 24 1234 5678</p>
                  </div>
                </div>
                <div className='flex items-start gap-4'>
                  <FaSpa className='text-accent mt-1' />
                  <div>
                    <p className='font-semibold'>Email</p>
                    <p className='text-primary/70'>spa@adinahotel.com</p>
                  </div>
                </div>
              </div>
            </div>

            <div className='bg-accent/10 p-8 border border-accent/20'>
              <h3 className='font-primary text-xl mb-3'>What to Expect</h3>
              <ul className='space-y-2 text-sm text-primary/70'>
                <li className='flex items-start gap-2'>
                  <FaCheck className='text-accent mt-1' />
                  <span>Arrive 15 minutes early for check-in</span>
                </li>
                <li className='flex items-start gap-2'>
                  <FaCheck className='text-accent mt-1' />
                  <span>Complimentary robe and slippers provided</span>
                </li>
                <li className='flex items-start gap-2'>
                  <FaCheck className='text-accent mt-1' />
                  <span>Silence your phone for a peaceful experience</span>
                </li>
                <li className='flex items-start gap-2'>
                  <FaCheck className='text-accent mt-1' />
                  <span>Hydrate before and after treatments</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      {/* Testimonials Section */}
      <section className='bg-white py-20'>
        <div className='container mx-auto px-6 lg:px-0'>
          <div className='text-center mb-12'>
            <p className='font-tertiary uppercase tracking-[4px] text-xs text-primary/70 mb-2'>
              Guest Reviews
            </p>
            <h2 className='font-primary text-4xl mb-4'>What Our Guests Say</h2>
          </div>

          <div className='grid grid-cols-1 md:grid-cols-3 gap-8'>
            {testimonials.map((testimonial, index) => (
              <div key={index} className='bg-[#f7f4ef] p-6 border border-[#eadfcf]'>
                <div className='flex items-center gap-1 mb-3'>
                  {[...Array(testimonial.rating)].map((_, i) => (
                    <FaStar key={i} className='text-accent' />
                  ))}
                </div>
                <p className='text-primary/70 mb-4 italic'>&quot;{testimonial.comment}&quot;</p>
                <p className='font-semibold text-primary'>{testimonial.name}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      {showQRPayment && currentBooking && (
        <QRPayment
          bookingData={currentBooking}
          onPaymentSuccess={handlePaymentSuccess}
          onClose={handleCloseQRPayment}
          type="spa"
        />
      )}

      {showInvoice && currentBooking && (
        <Invoice
          booking={currentBooking}
          onClose={() => setShowInvoice(false)}
          onDownload={() => {
            setToast({ type: 'success', message: 'PDF downloaded successfully!' });
          }}
        />
      )}
    </div>
  );
};

export default SpaPage;


--- END FILE: src\pages\SpaPage.jsx ---

--- START FILE: src\pages\UserDashboard.jsx ---
import { useMemo, useState, useEffect } from 'react';
import { useAuth } from '../context/SimpleAuthContext';
import { useRoomContext } from '../context/RoomContext';
import { useBookingContext } from '../context/BookingContext'; // NEW
import { Link } from 'react-router-dom';
import DatePicker from 'react-datepicker';
import 'react-datepicker/dist/react-datepicker.css';
import Toast from '../components/Toast';
import { FaSuitcaseRolling, FaCalendarAlt, FaUserCircle, FaCamera, FaEdit, FaTimes, FaLock, FaEnvelope } from 'react-icons/fa';
import { getLogoUrl } from '../utils/supabaseStorageUrls';
import { sendVerificationCode, verifyCodeAndResetPassword } from '../services/csharpApiService';
import { hashPassword } from '../services/simpleAuthService';
import { supabase } from '../utils/supabaseClient';

const tabs = [
  { id: 'overview', label: 'Overview' },
  { id: 'bookings', label: 'Bookings' },
  { id: 'profile', label: 'Profile & Preferences' },
];

const bookingFilterOptions = [
  { id: 'upcoming', label: 'Upcoming' },
  { id: 'past', label: 'Past' },
  { id: 'cancelled', label: 'Cancelled' },
];

const statusBadgeClasses = {
  confirmed: 'bg-emerald-100 text-emerald-700',
  modified: 'bg-sky-100 text-sky-700',
  completed: 'bg-gray-100 text-gray-600',
  cancelled: 'bg-red-100 text-red-600',
};

const UserDashboard = () => {
  const { user, updateUserProfile } = useAuth();
  const {
    getUserBookings: getRoomBookings, // Đổi tên để tránh xung đột
    cancelBooking,
    modifyBookingDates,
  } = useRoomContext();
  
  const {
    getUserRestaurantBookings,
    getUserSpaBookings,
    confirmRestaurantBooking, // Cần cho việc quản lý booking sau này
    confirmSpaBooking,
    restaurantBookings, // Dữ liệu từ context
    spaBookings,
  } = useBookingContext();

  const [activeTab, setActiveTab] = useState('overview');
  const [bookingFilter, setBookingFilter] = useState('upcoming');
  const [toast, setToast] = useState(null);
  const [modalState, setModalState] = useState({ type: null, booking: null });
  const [rescheduleDates, setRescheduleDates] = useState({ checkIn: null, checkOut: null });
  const [profileForm, setProfileForm] = useState({
    name: '',
    email: '',
    phone: '',
    country: '',
    city: '',
    language: 'en',
    bio: '',
    newsletter: true,
  });
  const [showPasswordReset, setShowPasswordReset] = useState(false);
  const [passwordResetStep, setPasswordResetStep] = useState('email'); // 'email', 'code', 'newPassword'
  const [verificationCode, setVerificationCode] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [confirmNewPassword, setConfirmNewPassword] = useState('');
  const [passwordResetLoading, setPasswordResetLoading] = useState(false);

  useEffect(() => {
    if (user) {
      setProfileForm({
        name: user.name || '',
        email: user.email || '',
        phone: user.phone || '',
        country: user.country || '',
        city: user.city || '',
        language: user.language || 'en',
        bio: user.bio || '',
        newsletter: user.newsletter !== undefined ? user.newsletter : true,
      });
    }
  }, [user]);

  const userBookings = useMemo(() => {
    // Combine all types of bookings (Room, Restaurant, Spa) using
    // the normalized objects provided by RoomContext + BookingContext.
    if (!user?.id) return [];

    const roomBookings = getRoomBookings(user.id);
    const restBookings = getUserRestaurantBookings(user.id);
    const spaBookings = getUserSpaBookings(user.id);

    return [
      ...(roomBookings || []),
      ...(restBookings || []),
      ...(spaBookings || []),
    ];
  }, [user, getRoomBookings, getUserRestaurantBookings, getUserSpaBookings]);

  const categorized = useMemo(() => {
    const data = {
      upcoming: [],
      past: [],
      cancelled: [],
      pending: [],
    };
    const now = new Date();

    userBookings.forEach((booking) => {
      if (booking.status === 'cancelled') {
        data.cancelled.push(booking);
      } else if (booking.type === 'room') {
        // Với phòng: mọi trạng thái (pending_payment, confirmed, ...) đều coi là upcoming
        // nếu ngày checkOut >= hôm nay; nếu đã qua thì đưa vào past.
        const checkOut = new Date(booking.checkOut);
        if (checkOut < now) {
          data.past.push(booking);
        } else {
          data.upcoming.push(booking);
        }
      } else {
        // Với restaurant/spa: dùng checkIn làm mốc
        const checkIn = new Date(booking.checkIn);
        if (checkIn < now) {
          data.past.push(booking);
        } else {
          data.upcoming.push(booking);
        }
      }
    });
    
    // Sort upcoming by earliest checkIn date/time
    data.upcoming.sort((a, b) => new Date(a.checkIn) - new Date(b.checkIn));
    
    return data;
  }, [userBookings]);

  const filteredBookings = categorized[bookingFilter] || [];

  const nextBooking = useMemo(() => {
    return categorized.upcoming
      .slice()
      .sort((a, b) => new Date(a.checkIn) - new Date(b.checkIn))[0];
  }, [categorized.upcoming]);

  const loyaltyNights = useMemo(() => {
    return userBookings.reduce((total, booking) => {
      if (booking.status === 'cancelled') return total;
      return total + (booking.totalNights || 0);
    }, 0);
  }, [userBookings]);

  const showToast = (payload) => {
    setToast(payload);
    setTimeout(() => setToast(null), 4000);
  };

  const handleCancelBooking = (booking) => {
    cancelBooking(booking.id);
    showToast({ type: 'info', message: `Booking ${booking.confirmationCode} was cancelled.` });
    setModalState({ type: null, booking: null });
  };

  const handleModifyBooking = (booking, newCheckIn, newCheckOut) => {
    if (!newCheckIn || !newCheckOut) {
      showToast({ type: 'error', message: 'Please choose both dates.' });
      return;
    }
    try {
      modifyBookingDates(booking.id, { checkIn: newCheckIn, checkOut: newCheckOut });
      showToast({ type: 'success', message: 'Booking updated successfully!' });
      setModalState({ type: null, booking: null });
    } catch (error) {
      showToast({ type: 'error', message: error.message || 'Unable to reschedule booking.' });
    }
  };

  const handleAvatarChange = (event) => {
    const file = event.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onloadend = () => {
      updateUserProfile({ avatar: reader.result });
      showToast({ type: 'success', message: 'Profile photo updated.' });
    };
    reader.readAsDataURL(file);
  };

  const handleProfileSubmit = (e) => {
    e.preventDefault();
    
    // Validation
    if (!profileForm.name || profileForm.name.trim().length < 2) {
      showToast({ type: 'error', message: 'Name must be at least 2 characters' });
      return;
    }

    if (!profileForm.email || !profileForm.email.includes('@')) {
      showToast({ type: 'error', message: 'Please enter a valid email' });
      return;
    }
    
    const phoneRegex = /^[\d\s\-\+\(\)]*$/;
    if (profileForm.phone && !phoneRegex.test(profileForm.phone)) {
      showToast({ type: 'error', message: 'Please enter a valid phone number' });
      return;
    }
    
    if (!profileForm.country || profileForm.country.trim() === '') {
      showToast({ type: 'error', message: 'Please select a country' });
      return;
    }
    
    updateUserProfile(profileForm);
    showToast({ type: 'success', message: 'Profile updated successfully!' });
  };

  const bookingIsEditable = (booking) => new Date(booking.checkIn) > new Date() && booking.status !== 'cancelled';

  const perks = [
    { label: 'Late checkout', detail: 'Complimentary 1-hour grace period on availability' },
    { label: 'Spa credit', detail: '$25 spa credit for every 5 nights stayed' },
    { label: 'Concierge chat', detail: 'Direct WhatsApp line for bespoke planning' },
  ];

  const renderOverview = () => (
    <div className='space-y-8'>
      <div className='bg-gradient-to-r from-[#f1d7b1] via-[#f7f4ef] to-[#e7d8c2] rounded-2xl p-6 text-primary shadow-lg border border-white/60 flex flex-col md:flex-row md:items-center md:justify-between gap-6'>
        <div>
          <p className='uppercase tracking-[6px] text-xs text-primary/70'>Welcome back</p>
          <h3 className='font-primary text-3xl mb-2'>Your private Maison awaits, {user.name?.split(' ')[0] || 'guest'}</h3>
          <p className='text-sm text-primary/70 max-w-xl'>
            Track upcoming retreats, earn loyalty nights, and curate personal details for a seamless arrival. Our concierge is on standby 24/7.
          </p>
        </div>
        <div className='bg-white/80 rounded-xl p-4 w-full md:w-auto min-w-[220px]'>
          <p className='uppercase text-xs tracking-[3px] text-primary/60 mb-1'>Loyalty tier</p>
          <p className='font-primary text-2xl'>Golden Orchid</p>
          <p className='text-sm text-primary/70'>Next upgrade in {Math.max(0, 10 - loyaltyNights)} nights</p>
        </div>
      </div>

      <div className='grid sm:grid-cols-3 gap-6'>
        <div className='bg-white/90 p-6 border border-[#eadfcf] rounded shadow-md'>
          <p className='uppercase tracking-[3px] text-xs text-primary/60'>Upcoming stays</p>
          <p className='text-4xl font-primary mt-2'>{categorized.upcoming.length}</p>
        </div>
        <div className='bg-white/90 p-6 border border-[#eadfcf] rounded shadow-md'>
          <p className='uppercase tracking-[3px] text-xs text-primary/60'>Completed stays</p>
          <p className='text-4xl font-primary mt-2'>{categorized.past.length}</p>
        </div>
        <div className='bg-white/90 p-6 border border-[#eadfcf] rounded shadow-md'>
          <p className='uppercase tracking-[3px] text-xs text-primary/60'>Loyalty nights</p>
          <p className='text-4xl font-primary mt-2'>{loyaltyNights}</p>
        </div>
      </div>

      <div className='grid lg:grid-cols-3 gap-6'>
        <div className='lg:col-span-2 bg-white/95 border border-[#eadfcf] rounded-2xl p-6 shadow-md'>
          <div className='flex items-center justify-between mb-4'>
            <h4 className='font-primary text-2xl'>Next reservation</h4>
            <Link to='/rooms' className='text-accent hover:underline text-sm'>Book another stay</Link>
          </div>
          {nextBooking ? (
            <div className='flex flex-col md:flex-row md:items-center md:justify-between gap-4'>
              <div>
                <p className='font-semibold text-lg'>{nextBooking.roomName}</p>
                <p className='text-primary/70 text-sm flex items-center gap-2'>
                  <FaCalendarAlt />
                  {nextBooking.checkIn} → {nextBooking.checkOut}
                </p>
              </div>
              <div className='flex items-center gap-3 flex-wrap'>
                <span className={`px-3 py-1 rounded-full text-xs ${statusBadgeClasses[nextBooking.status] || 'bg-gray-100 text-gray-600'}`}>
                  {nextBooking.status}
                </span>
                <button
                  onClick={() => setActiveTab('bookings')}
                  className='btn btn-secondary btn-sm'
                >
                  Manage booking
                </button>
              </div>
            </div>
          ) : (
            <div className='text-primary/70 text-sm'>
              No upcoming stay yet. Start planning your next visit!
            </div>
          )}
        </div>

        <div className='bg-white/95 border border-[#eadfcf] rounded-2xl p-6 shadow-md'>
          <p className='uppercase tracking-[3px] text-xs text-primary/60 mb-4'>Concierge perks</p>
          <ul className='space-y-4 text-sm'>
            {perks.map((perk) => (
              <li key={perk.label} className='border-l-4 border-accent pl-3'>
                <p className='font-semibold text-primary'>{perk.label}</p>
                <p className='text-primary/70'>{perk.detail}</p>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  );

  const renderBookings = () => (
    <div className='space-y-6'>
      <div className='flex flex-wrap items-center gap-3'>
        {bookingFilterOptions.map((option) => (
          <button
            key={option.id}
            onClick={() => setBookingFilter(option.id)}
            className={`px-4 py-2 rounded-full text-sm border transition ${
              bookingFilter === option.id ? 'bg-primary text-white border-primary' : 'border-[#eadfcf] text-primary'
            }`}
          >
            {option.label}
          </button>
        ))}
      </div>

      {filteredBookings.length === 0 ? (
        <div className='bg-white border border-[#eadfcf] rounded p-8 text-center text-primary/70'>
          No bookings in this segment yet.
        </div>
      ) : (
        <div className='space-y-4'>
          {filteredBookings.map((booking) => (
            <div key={booking.id} className='bg-white border border-[#eadfcf] rounded p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4'>
              <div>
                {booking.type === 'room' && (
                  <>
                    <p className='font-semibold text-lg'>{booking.roomName || 'Room Booking'}</p>
                    <p className='text-sm text-primary/70 flex items-center gap-2'>
                      <FaCalendarAlt />
                      Check-in: {booking.checkIn} → Check-out: {booking.checkOut}
                    </p>
                    <p className='text-sm text-primary/70'>Guests: {booking.adults} adult(s){booking.kids ? `, ${booking.kids} kid(s)` : ''}</p>
                  </>
                )}
                {booking.type === 'restaurant' && (
                  <>
                    <p className='font-semibold text-lg'>Restaurant Reservation</p>
                    <p className='text-sm text-primary/70 flex items-center gap-2'>
                      <FaCalendarAlt />
                      Time: {new Date(booking.checkIn).toLocaleString('vi-VN')}
                    </p>
                    <p className='text-sm text-primary/70'>Guests: {booking.guests} people. Table for {booking.name}</p>
                  </>
                )}
                {booking.type === 'spa' && (
                  <>
                    <p className='font-semibold text-lg'>Spa Appointment: {booking.serviceName}</p>
                    <p className='text-sm text-primary/70 flex items-center gap-2'>
                      <FaCalendarAlt />
                      Time: {new Date(booking.checkIn).toLocaleString('vi-VN')}
                    </p>
                    <p className='text-sm text-primary/70'>Therapist: {booking.therapist || 'Any'} ({booking.serviceDuration})</p>
                  </>
                )}
                <span className='inline-block mt-1 px-2 py-0.5 rounded text-xs font-medium uppercase tracking-wider bg-accent/20 text-accent'>{booking.type}</span>
              </div>
              <div className='flex items-center gap-3 flex-wrap'>
                <span className={`px-3 py-1 rounded-full text-xs ${statusBadgeClasses[booking.status] || 'bg-gray-100 text-gray-600'}`}>
                  {booking.status}
                </span>
                <p className='font-semibold text-accent'>${booking.totalPrice || booking.total_price}</p>
                {booking.type === 'room' && bookingIsEditable(booking) && (
                  <>
                    <button
                      onClick={() => {
                        setRescheduleDates({
                          checkIn: booking.checkIn ? new Date(booking.checkIn) : new Date(),
                          checkOut: booking.checkOut ? new Date(booking.checkOut) : new Date(new Date().getTime() + 24 * 60 * 60 * 1000),
                        });
                        setModalState({ type: 'modify', booking });
                      }}
                      className='btn btn-secondary btn-sm flex items-center gap-2'
                    >
                      <FaEdit /> Modify
                    </button>
                    <button
                      onClick={() => setModalState({ type: 'cancel', booking })}
                      className='btn btn-primary btn-sm flex items-center gap-2 bg-red-500 hover:bg-red-600 border-red-500'
                    >
                      <FaTimes /> Cancel
                    </button>
                  </>
                )}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );

  const renderProfile = () => (
    <form className='space-y-6' onSubmit={handleProfileSubmit}>
      <div className='grid md:grid-cols-2 gap-6'>
        <div>
          <label className='block text-sm font-semibold mb-2'>Full name</label>
          <input
            type='text'
            value={profileForm.name}
            onChange={(e) => setProfileForm({ ...profileForm, name: e.target.value })}
            className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
          />
        </div>
        <div>
          <label className='block text-sm font-semibold mb-2'>Email</label>
          <input
            type='email'
            value={profileForm.email}
            onChange={(e) => setProfileForm({ ...profileForm, email: e.target.value })}
            className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
          />
        </div>
      </div>

      <div className='grid md:grid-cols-2 gap-6'>
        <div>
          <label className='block text-sm font-semibold mb-2'>Phone</label>
          <input
            type='tel'
            value={profileForm.phone}
            onChange={(e) => setProfileForm({ ...profileForm, phone: e.target.value })}
            className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
          />
        </div>
        <div>
          <label className='block text-sm font-semibold mb-2'>Country</label>
          <input
            type='text'
            value={profileForm.country}
            onChange={(e) => setProfileForm({ ...profileForm, country: e.target.value })}
            className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
          />
        </div>
        <div>
          <label className='block text-sm font-semibold mb-2'>City</label>
          <input
            type='text'
            value={profileForm.city}
            onChange={(e) => setProfileForm({ ...profileForm, city: e.target.value })}
            className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
          />
        </div>
      </div>

      <div>
        <label className='block text-sm font-semibold mb-2'>Preferred language</label>
        <select
          value={profileForm.language}
          onChange={(e) => setProfileForm({ ...profileForm, language: e.target.value })}
          className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent bg-white'
        >
          <option value='en'>English</option>
          <option value='vi'>Vietnamese</option>
          <option value='fr'>French</option>
        </select>
      </div>

      <div>
        <label className='block text-sm font-semibold mb-2'>Short bio</label>
        <textarea
          rows={4}
          value={profileForm.bio}
          onChange={(e) => setProfileForm({ ...profileForm, bio: e.target.value })}
          className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent resize-none'
          placeholder='Tell us about your travel preferences...'
        />
      </div>

      <div className='flex items-center gap-3'>
        <input
          id='newsletter'
          type='checkbox'
          checked={profileForm.newsletter}
          onChange={(e) => setProfileForm({ ...profileForm, newsletter: e.target.checked })}
          className='w-4 h-4 accent-accent'
        />
        <label htmlFor='newsletter' className='text-sm text-primary/70'>
          Receive curated offers and member-only experiences.
        </label>
      </div>

      <button type='submit' className='btn btn-primary'>
        Save profile
      </button>

      {/* Password Reset Section */}
      <div className='mt-8 pt-8 border-t border-[#eadfcf]'>
        <div className='flex items-center justify-between mb-4'>
          <div>
            <h3 className='font-primary text-xl mb-1'>Change Password</h3>
            <p className='text-sm text-primary/70'>Reset your password using email verification</p>
          </div>
          <button
            type='button'
            onClick={() => {
              setShowPasswordReset(!showPasswordReset);
              if (!showPasswordReset) {
                setPasswordResetStep('email');
                setVerificationCode('');
                setNewPassword('');
                setConfirmNewPassword('');
              }
            }}
            className='btn btn-secondary btn-sm'
          >
            {showPasswordReset ? 'Cancel' : 'Reset Password'}
          </button>
        </div>

        {showPasswordReset && (
          <div className='space-y-4 bg-gray-50 p-6 rounded-lg border border-[#eadfcf]'>
            {passwordResetStep === 'email' && (
              <div className='space-y-4'>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Email Address</label>
                  <div className='relative'>
                    <div className='absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none'>
                      <FaEnvelope className='text-gray-400' />
                    </div>
                    <input
                      type='email'
                      value={user?.email || ''}
                      disabled
                      className='w-full pl-12 pr-4 py-3 border border-[#eadfcf] bg-gray-100 rounded-lg'
                    />
                  </div>
                  <p className='text-xs text-primary/70 mt-2'>
                    A verification code will be sent to this email address.
                  </p>
                </div>
                <button
                  type='button'
                  onClick={async () => {
                    if (!user?.email) return;
                    setPasswordResetLoading(true);
                    try {
                      const result = await sendVerificationCode(user.email);
                      if (result.success) {
                        showToast({ type: 'success', message: 'Verification code sent to your email!' });
                        setPasswordResetStep('code');
                      } else {
                        showToast({ type: 'error', message: result.message || 'Failed to send verification code' });
                      }
                    } catch (error) {
                      showToast({ type: 'error', message: 'Error sending verification code' });
                    } finally {
                      setPasswordResetLoading(false);
                    }
                  }}
                  disabled={passwordResetLoading}
                  className='btn btn-primary w-full'
                >
                  {passwordResetLoading ? 'Sending...' : 'Send Verification Code'}
                </button>
              </div>
            )}

            {passwordResetStep === 'code' && (
              <div className='space-y-4'>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Verification Code</label>
                  <input
                    type='text'
                    value={verificationCode}
                    onChange={(e) => setVerificationCode(e.target.value.replace(/\D/g, '').slice(0, 6))}
                    placeholder='Enter 6-digit code'
                    maxLength={6}
                    className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent text-center text-2xl tracking-widest'
                  />
                  <p className='text-xs text-primary/70 mt-2'>
                    Enter the 6-digit code sent to your email.
                  </p>
                </div>
                <div className='flex gap-3'>
                  <button
                    type='button'
                    onClick={() => setPasswordResetStep('email')}
                    className='btn btn-secondary flex-1'
                  >
                    Back
                  </button>
                  <button
                    type='button'
                    onClick={async () => {
                      if (verificationCode.length !== 6) {
                        showToast({ type: 'error', message: 'Please enter a valid 6-digit code' });
                        return;
                      }
                      setPasswordResetStep('newPassword');
                    }}
                    className='btn btn-primary flex-1'
                  >
                    Verify Code
                  </button>
                </div>
              </div>
            )}

            {passwordResetStep === 'newPassword' && (
              <div className='space-y-4'>
                <div>
                  <label className='block text-sm font-semibold mb-2'>New Password</label>
                  <div className='relative'>
                    <div className='absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none'>
                      <FaLock className='text-gray-400' />
                    </div>
                    <input
                      type='password'
                      value={newPassword}
                      onChange={(e) => setNewPassword(e.target.value)}
                      placeholder='Enter new password (min 8 characters)'
                      minLength={8}
                      className='w-full pl-12 pr-4 py-3 border border-[#eadfcf] focus:outline-none focus:border-accent'
                    />
                  </div>
                </div>
                <div>
                  <label className='block text-sm font-semibold mb-2'>Confirm New Password</label>
                  <div className='relative'>
                    <div className='absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none'>
                      <FaLock className='text-gray-400' />
                    </div>
                    <input
                      type='password'
                      value={confirmNewPassword}
                      onChange={(e) => setConfirmNewPassword(e.target.value)}
                      placeholder='Confirm new password'
                      minLength={8}
                      className='w-full pl-12 pr-4 py-3 border border-[#eadfcf] focus:outline-none focus:border-accent'
                    />
                  </div>
                  {confirmNewPassword && newPassword !== confirmNewPassword && (
                    <p className='text-xs text-red-600 mt-1'>Passwords do not match</p>
                  )}
                </div>
                <div className='flex gap-3'>
                  <button
                    type='button'
                    onClick={() => setPasswordResetStep('code')}
                    className='btn btn-secondary flex-1'
                  >
                    Back
                  </button>
                  <button
                    type='button'
                    onClick={async () => {
                      if (!newPassword || newPassword.length < 8) {
                        showToast({ type: 'error', message: 'Password must be at least 8 characters' });
                        return;
                      }
                      if (newPassword !== confirmNewPassword) {
                        showToast({ type: 'error', message: 'Passwords do not match' });
                        return;
                      }
                      if (!user?.email) {
                        showToast({ type: 'error', message: 'User email not found' });
                        return;
                      }

                      setPasswordResetLoading(true);
                      try {
                        // Verify code and reset password via C# API
                        const result = await verifyCodeAndResetPassword(user.email, verificationCode, newPassword);
                        
                        if (result.success) {
                          // Update password in Supabase database
                          const passwordHash = await hashPassword(newPassword);
                          const { error: updateError } = await supabase
                            .from('users')
                            .update({ password_hash: passwordHash })
                            .eq('id', user.id);

                          if (updateError) {
                            throw new Error('Failed to update password in database');
                          }

                          showToast({ type: 'success', message: 'Password reset successfully!' });
                          setShowPasswordReset(false);
                          setPasswordResetStep('email');
                          setVerificationCode('');
                          setNewPassword('');
                          setConfirmNewPassword('');
                        } else {
                          showToast({ type: 'error', message: result.message || 'Failed to reset password' });
                        }
                      } catch (error) {
                        console.error('Error resetting password:', error);
                        showToast({ type: 'error', message: 'Error resetting password. Please try again.' });
                      } finally {
                        setPasswordResetLoading(false);
                      }
                    }}
                    disabled={passwordResetLoading || newPassword !== confirmNewPassword || newPassword.length < 8}
                    className='btn btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed'
                  >
                    {passwordResetLoading ? 'Resetting...' : 'Reset Password'}
                  </button>
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </form>
  );

  const renderModal = () => {
    if (!modalState.type || !modalState.booking) return null;

    if (modalState.type === 'cancel') {
      return (
        <div className='fixed inset-0 bg-black/60 flex items-center justify-center z-40 p-4'>
          <div className='bg-white rounded-lg shadow-xl max-w-md w-full p-6 space-y-4'>
            <h3 className='font-primary text-2xl'>Cancel booking?</h3>
            <p className='text-primary/70 text-sm'>
              You are about to cancel reservation {modalState.booking.confirmationCode}. This action cannot be undone.
            </p>
            <div className='flex gap-4'>
              <button className='btn btn-secondary flex-1' onClick={() => setModalState({ type: null, booking: null })}>
                Keep booking
              </button>
              <button
                className='btn btn-primary flex-1 bg-red-500 border-red-500 hover:bg-red-600'
                onClick={() => handleCancelBooking(modalState.booking)}
              >
                Cancel stay
              </button>
            </div>
          </div>
        </div>
      );
    }

    if (modalState.type === 'modify') {
      return (
        <div className='fixed inset-0 bg-black/60 flex items-center justify-center z-40 p-4'>
          <div className='bg-white rounded-lg shadow-xl max-w-lg w-full p-6 space-y-4'>
            <h3 className='font-primary text-2xl'>Reschedule booking</h3>
            <p className='text-primary/70 text-sm'>
              Update stay for {modalState.booking.roomName}
            </p>
            <div className='grid grid-cols-1 md:grid-cols-2 gap-4'>
              <div>
                <p className='text-xs uppercase tracking-[2px] text-primary/60 mb-1'>New check-in</p>
                <DatePicker
                  selected={rescheduleDates.checkIn}
                  onChange={(date) => setRescheduleDates(prev => ({ ...prev, checkIn: date }))}
                  minDate={new Date()}
                  className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
                />
              </div>
              <div>
                <p className='text-xs uppercase tracking-[2px] text-primary/60 mb-1'>New check-out</p>
                <DatePicker
                  selected={rescheduleDates.checkOut}
                  onChange={(date) => setRescheduleDates(prev => ({ ...prev, checkOut: date }))}
                  minDate={rescheduleDates.checkIn ? new Date(rescheduleDates.checkIn.getTime() + 24 * 60 * 60 * 1000) : new Date()}
                  className='w-full border border-[#eadfcf] px-4 py-3 focus:outline-none focus:border-accent'
                />
              </div>
            </div>
            <div className='flex gap-4'>
              <button className='btn btn-secondary flex-1' onClick={() => setModalState({ type: null, booking: null })}>
                Go back
              </button>
              <button
                className='btn btn-primary flex-1'
                onClick={() => handleModifyBooking(modalState.booking, rescheduleDates.checkIn, rescheduleDates.checkOut)}
              >
                Save changes
              </button>
            </div>
          </div>
        </div>
      );
    }

    return null;
  };

  if (!user) {
    return (
      <div className='min-h-screen flex items-center justify-center'>
        <p className='text-primary/70'>Please sign in to access your dashboard.</p>
      </div>
    );
  }

  return (
    <div className='min-h-screen py-12 bg-[radial-gradient(circle_at_top,_rgba(255,255,255,0.94),_rgba(247,244,239,0.98))]'>
      <div className='container mx-auto px-6 lg:px-0'>
        <img src={getLogoUrl('dark')} alt="logo" className='w-40 mx-auto mb-10 opacity-80' />
        <div className='grid lg:grid-cols-4 gap-8'>
          <aside className='bg-white/95 backdrop-blur-sm border border-[#eadfcf] rounded-2xl p-6 shadow-xl'>
            <div className='text-center mb-8'>
              <div className='relative inline-block'>
                <div className='w-28 h-28 rounded-full border-4 border-accent/20 overflow-hidden bg-primary/5 flex items-center justify-center'>
                  {user.avatar ? (
                    <img src={user.avatar} alt={user.name} className='w-full h-full object-cover' />
                  ) : (
                    <FaUserCircle className='text-8xl text-primary/30' />
                  )}
                </div>
                <label className='absolute bottom-0 right-0 bg-accent text-white p-2 rounded-full cursor-pointer shadow-lg'>
                  <FaCamera />
                  <input type='file' accept='image/*' className='hidden' onChange={handleAvatarChange} />
                </label>
              </div>
              <h2 className='font-primary text-2xl mt-4'>{user.name}</h2>
              <p className='text-primary/70 text-sm'>{user.email}</p>
            </div>

            <nav className='space-y-2'>
              {tabs.map((tab) => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`w-full text-left px-4 py-3 rounded-lg transition ${
                    activeTab === tab.id ? 'bg-primary text-white' : 'bg-[#f7f4ef] text-primary'
                  }`}
                >
                  {tab.label}
                </button>
              ))}
            </nav>

            <div className='mt-8 space-y-4'>
              <Link to='/rooms' className='btn btn-secondary w-full flex items-center justify-center gap-2'>
                <FaSuitcaseRolling /> Book a room
              </Link>
              <Link to='/' className='text-sm text-primary/70 hover:text-primary text-center block'>
                Back to homepage
              </Link>
            </div>
          </aside>

          <main className='lg:col-span-3 bg-white/95 backdrop-blur-sm border border-[#eadfcf] rounded-2xl p-6 shadow-xl'>
            {activeTab === 'overview' && renderOverview()}
            {activeTab === 'bookings' && renderBookings()}
            {activeTab === 'profile' && renderProfile()}
          </main>
        </div>
      </div>

      {renderModal()}
      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
    </div>
  );
};

export default UserDashboard;


--- END FILE: src\pages\UserDashboard.jsx ---

--- START FILE: src\services\adminService.js ---
import { supabase } from '../utils/supabaseClient';

/**
 * Service layer for admin-specific data fetching
 */

export const fetchAllRoomBookingsForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('bookings')
      .select(`
        *,
        rooms:room_id (room_no),
        users:user_id (id, full_name, email)
      `)
      .order('created_at', { ascending: false });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching all room bookings for admin:', err);
    return [];
  }
};

export const fetchAllRestaurantBookingsForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('restaurant_bookings')
      .select(`
        *,
        users:user_id (id, full_name, email)
      `)
      .order('created_at', { ascending: false });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching all restaurant bookings for admin:', err);
    return [];
  }
};

export const fetchAllSpaBookingsForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('spa_bookings')
      .select(`
        *,
        users:user_id (id, full_name, email)
      `)
      .order('created_at', { ascending: false });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching all spa bookings for admin:', err);
    return [];
  }
};

export const updateRoomBookingStatus = async (id, status) => {
  try {
    const { data, error } = await supabase
      .from('bookings')
      .update({ status })
      .eq('id', id)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating room booking status:', err);
    throw err;
  }
};

export const updateRestaurantBookingStatus = async (id, status) => {
  try {
    const { data, error } = await supabase
      .from('restaurant_bookings')
      .update({ status })
      .eq('id', id)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating restaurant booking status:', err);
    throw err;
  }
};

export const updateSpaBookingStatus = async (id, status) => {
  try {
    const { data, error } = await supabase
      .from('spa_bookings')
      .update({ status })
      .eq('id', id)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating spa booking status:', err);
    throw err;
  }
};

export const deleteRoomBooking = async (id) => {
  try {
    const { error } = await supabase
      .from('bookings')
      .delete()
      .eq('id', id);
    if (error) throw error;
    return true;
  } catch (err) {
    console.error('Error deleting room booking:', err);
    throw err;
  }
};

export const deleteRestaurantBooking = async (id) => {
  try {
    const { error } = await supabase
      .from('restaurant_bookings')
      .delete()
      .eq('id', id);
    if (error) throw error;
    return true;
  } catch (err) {
    console.error('Error deleting restaurant booking:', err);
    throw err;
  }
};

export const deleteSpaBooking = async (id) => {
  try {
    const { error } = await supabase
      .from('spa_bookings')
      .delete()
      .eq('id', id);
    if (error) throw error;
    return true;
  } catch (err) {
    console.error('Error deleting spa booking:', err);
    throw err;
  }
};

/**
 * ROOM TYPES CRUD
 */
export const fetchRoomTypesForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('room_types')
      .select('*')
      .order('code', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching room types:', err);
    throw err;
  }
};

export const createRoomType = async (roomTypeData) => {
  try {
    const { data, error } = await supabase
      .from('room_types')
      .insert([roomTypeData])
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error creating room type:', err);
    throw err;
  }
};

export const updateRoomTypeAdmin = async (id, roomTypeData) => {
  try {
    const { data, error } = await supabase
      .from('room_types')
      .update(roomTypeData)
      .eq('id', id)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating room type:', err);
    throw err;
  }
};

export const deleteRoomTypeAdmin = async (id) => {
  try {
    const { error } = await supabase
      .from('room_types')
      .delete()
      .eq('id', id);
    if (error) throw error;
    return true;
  } catch (err) {
    console.error('Error deleting room type:', err);
    throw err;
  }
};

/**
 * ROOMS CRUD
 */
export const fetchRoomsForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('rooms')
      .select(`
        *,
        room_types:room_type_id (id, code, name)
      `)
      .order('room_no', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching rooms:', err);
    throw err;
  }
};

export const createRoomAdmin = async (roomData) => {
  try {
    const { data, error } = await supabase
      .from('rooms')
      .insert([roomData])
      .select(`
        *,
        room_types:room_type_id (id, code, name)
      `);
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error creating room:', err);
    throw err;
  }
};

export const updateRoomAdmin = async (id, roomData) => {
  try {
    const { data, error } = await supabase
      .from('rooms')
      .update(roomData)
      .eq('id', id)
      .select(`
        *,
        room_types:room_type_id (id, code, name)
      `);
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating room:', err);
    throw err;
  }
};

export const deleteRoomAdmin = async (id) => {
  try {
    const { error } = await supabase
      .from('rooms')
      .delete()
      .eq('id', id);
    if (error) throw error;
    return true;
  } catch (err) {
    console.error('Error deleting room:', err);
    throw err;
  }
};

/**
 * USERS CRUD
 */
export const fetchUsersForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('users')
      .select('id, email, full_name, phone, is_admin, created_at, last_login')
      .order('created_at', { ascending: false });
    if (error) throw error;
    // Map to match expected structure with role field
    return (data || []).map(user => ({
      ...user,
      role: user.is_admin ? 'admin' : 'user'
    }));
  } catch (err) {
    console.error('Error fetching users:', err);
    throw err;
  }
};

export const updateUserAdmin = async (id, userData) => {
  try {
    // Map role back to is_admin if needed
    const updateData = { ...userData };
    if (userData.role !== undefined) {
      updateData.is_admin = userData.role === 'admin';
      delete updateData.role;
    }
    
    const { data, error } = await supabase
      .from('users')
      .update(updateData)
      .eq('id', id)
      .select('id, email, full_name, phone, is_admin, created_at, last_login');
    if (error) throw error;
    const updated = data?.[0];
    return updated ? { ...updated, role: updated.is_admin ? 'admin' : 'user' } : null;
  } catch (err) {
    console.error('Error updating user:', err);
    throw err;
  }
};

export const deleteUserProfileAdmin = async (id) => {
  try {
    const { error } = await supabase
      .from('users')
      .delete()
      .eq('id', id);
    if (error) throw error;
    return true;
  } catch (err) {
    console.error('Error deleting user:', err);
    throw err;
  }
};

/**
 * ADMIN ACCOUNTS MANAGEMENT (Sử dụng users table với is_admin)
 */
export const fetchAdminAccountsForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('users')
      .select('id, email, full_name, phone, is_admin, created_at, last_login')
      .eq('is_admin', true)
      .order('created_at', { ascending: false });
    if (error) throw error;
    return (data || []).map(user => ({
      ...user,
      role: 'admin'
    }));
  } catch (err) {
    console.error('Error fetching admin accounts:', err);
    throw err;
  }
};

export const createAdminAccount = async (adminData) => {
  try {
    const { data, error } = await supabase
      .from('users')
      .upsert({
        id: adminData.user_id,
        full_name: adminData.full_name,
        phone: adminData.phone || null,
        is_admin: true,
      }, {
        onConflict: 'id'
      })
      .select('id, email, full_name, phone, is_admin, created_at, last_login');
    if (error) throw error;
    const created = data?.[0];
    return created ? { ...created, role: 'admin' } : null;
  } catch (err) {
    console.error('Error creating admin account:', err);
    throw err;
  }
};

export const updateAdminAccount = async (adminId, adminData) => {
  try {
    const { data, error } = await supabase
      .from('users')
      .update({
        full_name: adminData.full_name,
        phone: adminData.phone,
      })
      .eq('id', adminId)
      .select('id, email, full_name, phone, is_admin, created_at, last_login');
    if (error) throw error;
    const updated = data?.[0];
    return updated ? { ...updated, role: 'admin' } : null;
  } catch (err) {
    console.error('Error updating admin account:', err);
    throw err;
  }
};

export const deactivateAdminAccount = async (adminId) => {
  try {
    const { data, error } = await supabase
      .from('users')
      .update({ is_admin: false })
      .eq('id', adminId)
      .select('id, email, full_name, phone, is_admin, created_at, last_login');
    if (error) throw error;
    const updated = data?.[0];
    return updated ? { ...updated, role: 'user' } : null;
  } catch (err) {
    console.error('Error deactivating admin account:', err);
    throw err;
  }
};

export default {
  // Bookings
  fetchAllRoomBookingsForAdmin,
  fetchAllRestaurantBookingsForAdmin,
  fetchAllSpaBookingsForAdmin,
  updateRoomBookingStatus,
  updateRestaurantBookingStatus,
  updateSpaBookingStatus,
  deleteRoomBooking,
  deleteRestaurantBooking,
  deleteSpaBooking,
  // Room Types
  fetchRoomTypesForAdmin,
  createRoomType,
  updateRoomTypeAdmin,
  deleteRoomTypeAdmin,
  // Rooms
  fetchRoomsForAdmin,
  createRoomAdmin,
  updateRoomAdmin,
  deleteRoomAdmin,
  // Users
  fetchUsersForAdmin,
  updateUserAdmin,
  deleteUserProfileAdmin,
  // Admin Accounts (riêng biệt từ users)
  fetchAdminAccountsForAdmin,
  createAdminAccount,
  updateAdminAccount,
  deactivateAdminAccount,
};
--- END FILE: src\services\adminService.js ---

--- START FILE: src\services\adminService_REFACTORED.js ---
import { supabase } from '../utils/supabaseClient';

/**
 * ============================================================================
 * ADMIN SERVICE LAYER - FINALIZED
 * ============================================================================
 * 
 * This service centralizes ALL admin-related database operations.
 * Provides clean, normalized data to admin components.
 * 
 * Patterns:
 * - All functions return array/object or null on error
 * - All functions include try/catch with logging
 * - Normalization happens here, not in components
 * - Booking types are combined into single functions where appropriate
 * ============================================================================
 */

// ============================================================================
// BOOKING MANAGEMENT - FETCH
// ============================================================================

/**
 * Fetch all room bookings with related data
 * @returns {Promise<Array>} Array of normalized room bookings
 */
export const fetchAllRoomBookingsForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('bookings')
      .select(`
        *,
        rooms:room_id (id, room_no),
        profiles:user_id (id, full_name, email, phone)
      `)
      .order('created_at', { ascending: false });
    
    if (error) throw error;
    
    return (data || []).map(booking => ({
      ...booking,
      type: 'room',
      item_name: booking.rooms?.room_no || 'N/A',
      guestName: booking.profiles?.full_name,
      guestEmail: booking.profiles?.email,
      guestPhone: booking.profiles?.phone,
      totalPrice: parseFloat(booking.total_amount || 0),
    }));
  } catch (err) {
    console.error('❌ Error fetching room bookings for admin:', err);
    return [];
  }
};

/**
 * Fetch all restaurant bookings with related data
 * @returns {Promise<Array>} Array of normalized restaurant bookings
 */
export const fetchAllRestaurantBookingsForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('restaurant_bookings')
      .select(`
        *,
        profiles:user_id (id, full_name, email, phone)
      `)
      .order('created_at', { ascending: false });
    
    if (error) throw error;
    
    return (data || []).map(booking => ({
      ...booking,
      type: 'restaurant',
      item_name: 'Restaurant Table',
      guestName: booking.name || booking.profiles?.full_name,
      guestEmail: booking.email || booking.profiles?.email,
      guestPhone: booking.phone || booking.profiles?.phone,
      totalPrice: parseFloat(booking.total_price || 0),
      checkIn: booking.reservation_at,
      checkOut: booking.reservation_at,
    }));
  } catch (err) {
    console.error('❌ Error fetching restaurant bookings for admin:', err);
    return [];
  }
};

/**
 * Fetch all spa bookings with related data
 * @returns {Promise<Array>} Array of normalized spa bookings
 */
export const fetchAllSpaBookingsForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('spa_bookings')
      .select(`
        *,
        profiles:user_id (id, full_name, email, phone)
      `)
      .order('created_at', { ascending: false });
    
    if (error) throw error;
    
    return (data || []).map(booking => ({
      ...booking,
      type: 'spa',
      item_name: booking.service_name || 'Spa Service',
      guestName: booking.name || booking.profiles?.full_name,
      guestEmail: booking.email || booking.profiles?.email,
      guestPhone: booking.phone || booking.profiles?.phone,
      totalPrice: parseFloat(booking.total_price || 0),
      checkIn: booking.appointment_at,
      checkOut: booking.appointment_at,
    }));
  } catch (err) {
    console.error('❌ Error fetching spa bookings for admin:', err);
    return [];
  }
};

/**
 * Fetch ALL bookings (Room + Restaurant + Spa) combined and normalized
 * @returns {Promise<Array>} Single array of all booking types, sorted by date
 */
export const fetchAllBookingsForAdmin = async () => {
  try {
    const [roomBookings, restBookings, spaBookings] = await Promise.all([
      fetchAllRoomBookingsForAdmin(),
      fetchAllRestaurantBookingsForAdmin(),
      fetchAllSpaBookingsForAdmin(),
    ]);

    // Combine and sort by created_at descending
    const combined = [...roomBookings, ...restBookings, ...spaBookings]
      .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

    console.log(`✅ Loaded ${combined.length} total bookings (${roomBookings.length} room, ${restBookings.length} restaurant, ${spaBookings.length} spa)`);
    return combined;
  } catch (err) {
    console.error('❌ Error fetching all bookings:', err);
    return [];
  }
};

// ============================================================================
// BOOKING MANAGEMENT - UPDATE & DELETE
// ============================================================================

/**
 * Update booking status for any booking type
 * @param {string} bookingId - Booking ID
 * @param {string} bookingType - 'room', 'restaurant', or 'spa'
 * @param {string} status - New status value
 * @param {object} extraData - Additional fields to update
 * @returns {Promise<object|null>} Updated booking or null
 */
export const updateBookingStatus = async (bookingId, bookingType, status, extraData = {}) => {
  try {
    const tableMap = {
      room: 'bookings',
      restaurant: 'restaurant_bookings',
      spa: 'spa_bookings',
    };

    const table = tableMap[bookingType];
    if (!table) throw new Error(`Invalid booking type: ${bookingType}`);

    const { data, error } = await supabase
      .from(table)
      .update({
        status,
        updated_at: new Date().toISOString(),
        ...extraData,
      })
      .eq('id', bookingId)
      .select();

    if (error) throw error;

    console.log(`✅ Booking ${bookingId} (${bookingType}) updated to status: ${status}`);
    const updated = data?.[0] || null;

    // Side-effect: update room status/history when room booking
    if (bookingType === 'room' && updated?.room_id) {
      try {
        if (status === 'checked_in' || status === 'confirmed') {
          await supabase
            .from('rooms')
            .update({ status: 'occupied', updated_at: new Date().toISOString() })
            .eq('id', updated.room_id);
          await supabase.from('room_status_history').insert([{
            room_id: updated.room_id,
            status: 'occupied',
            note: `Admin set booking ${bookingId} to ${status}`,
          }]);
        } else if (status === 'checked_out' || status === 'cancelled') {
          await supabase
            .from('rooms')
            .update({ status: 'available', updated_at: new Date().toISOString() })
            .eq('id', updated.room_id);
          await supabase.from('room_status_history').insert([{
            room_id: updated.room_id,
            status: 'available',
            note: `Admin set booking ${bookingId} to ${status}`,
          }]);
        }
      } catch (sideErr) {
        console.warn('Room status history side-effect failed:', sideErr);
      }
    }

    return updated;
  } catch (err) {
    console.error(`❌ Error updating booking status:`, err);
    return null;
  }
};

/**
 * Delete a booking (any type)
 * @param {string} bookingId - Booking ID
 * @param {string} bookingType - 'room', 'restaurant', or 'spa'
 * @returns {Promise<boolean>} Success or failure
 */
export const deleteBooking = async (bookingId, bookingType) => {
  try {
    const tableMap = {
      room: 'bookings',
      restaurant: 'restaurant_bookings',
      spa: 'spa_bookings',
    };

    const table = tableMap[bookingType];
    if (!table) throw new Error(`Invalid booking type: ${bookingType}`);

    const { error } = await supabase
      .from(table)
      .delete()
      .eq('id', bookingId);

    if (error) throw error;

    console.log(`✅ Booking ${bookingId} (${bookingType}) deleted`);
    return true;
  } catch (err) {
    console.error(`❌ Error deleting booking:`, err);
    return false;
  }
};

// ============================================================================
// ROOM STATUS BOARD (view)
// ============================================================================
export const fetchRoomStatusBoardForAdmin = async () => {
  try {
    const { data, error } = await supabase
      .from('room_status_board')
      .select('*')
      .order('room_no', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('❌ Error fetching room status board:', err);
    return [];
  }
};

// ============================================================================
// USER MANAGEMENT - FETCH
// ============================================================================

/**
 * Fetch all users/profiles with admin-relevant data
 * @returns {Promise<Array>} Array of user profiles
 */
export const fetchAllUsers = async () => {
  try {
    const { data, error } = await supabase
      .from('profiles')
      .select('id, full_name, email, phone, role, created_at, updated_at')
      .order('created_at', { ascending: false });

    if (error) throw error;

    console.log(`✅ Loaded ${data?.length || 0} users`);
    return data || [];
  } catch (err) {
    console.error('❌ Error fetching users:', err);
    return [];
  }
};

/**
 * Fetch user by ID with detailed info
 * @param {string} userId - User ID
 * @returns {Promise<object|null>} User profile or null
 */
export const fetchUserById = async (userId) => {
  try {
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', userId)
      .single();

    if (error) throw error;
    return data || null;
  } catch (err) {
    console.error(`❌ Error fetching user ${userId}:`, err);
    return null;
  }
};

/**
 * Update user profile (admin operation)
 * @param {string} userId - User ID
 * @param {object} updateData - Fields to update
 * @returns {Promise<object|null>} Updated user or null
 */
export const updateUser = async (userId, updateData) => {
  try {
    const { data, error } = await supabase
      .from('profiles')
      .update({
        ...updateData,
        updated_at: new Date().toISOString(),
      })
      .eq('id', userId)
      .select();

    if (error) throw error;

    console.log(`✅ User ${userId} profile updated`);
    return data?.[0] || null;
  } catch (err) {
    console.error(`❌ Error updating user:`, err);
    return null;
  }
};

/**
 * Delete user profile (admin operation)
 * @param {string} userId - User ID
 * @returns {Promise<boolean>} Success or failure
 */
export const deleteUser = async (userId) => {
  try {
    const { error } = await supabase
      .from('profiles')
      .delete()
      .eq('id', userId);

    if (error) throw error;

    console.log(`✅ User ${userId} deleted`);
    return true;
  } catch (err) {
    console.error(`❌ Error deleting user:`, err);
    return false;
  }
};

// ============================================================================
// AUDIT & LOGS
// ============================================================================

/**
 * Fetch audit logs (if table exists)
 * @param {number} limit - Number of records to fetch
 * @returns {Promise<Array>} Array of audit log entries
 */
export const fetchAuditLogs = async (limit = 100) => {
  try {
    const { data, error } = await supabase
      .from('audit_logs')
      .select(`
        *,
        user:user_id (id, full_name, email)
      `)
      .order('created_at', { ascending: false })
      .limit(limit);

    if (error) throw error;

    console.log(`✅ Loaded ${data?.length || 0} audit logs`);
    return data || [];
  } catch (err) {
    console.error('❌ Error fetching audit logs:', err);
    return [];
  }
};

/**
 * Create audit log entry
 * @param {object} logData - Log entry data
 * @returns {Promise<object|null>} Created log entry or null
 */
export const createAuditLog = async (logData) => {
  try {
    const { data, error } = await supabase
      .from('audit_logs')
      .insert([{
        user_id: logData.userId,
        action: logData.action,
        entity_type: logData.entityType,
        entity_id: logData.entityId,
        description: logData.description,
        changes: logData.changes || {},
        ip_address: logData.ipAddress,
        created_at: new Date().toISOString(),
      }])
      .select();

    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('❌ Error creating audit log:', err);
    return null;
  }
};

// ============================================================================
// STATISTICS & ANALYTICS
// ============================================================================

/**
 * Get dashboard statistics (bookings, users, revenue)
 * @returns {Promise<object>} Stats object
 */
export const getAdminDashboardStats = async () => {
  try {
    // Fetch counts in parallel
    const [
      { count: totalRoomBookings },
      { count: totalRestaurantBookings },
      { count: totalSpaBookings },
      { count: totalUsers },
      roomBookingsData,
      restaurantBookingsData,
      spaBookingsData,
    ] = await Promise.all([
      supabase.from('bookings').select('id', { count: 'exact', head: true }),
      supabase.from('restaurant_bookings').select('id', { count: 'exact', head: true }),
      supabase.from('spa_bookings').select('id', { count: 'exact', head: true }),
      supabase.from('profiles').select('id', { count: 'exact', head: true }),
      supabase.from('bookings').select('total_amount, status'),
      supabase.from('restaurant_bookings').select('total_price, status'),
      supabase.from('spa_bookings').select('total_price, status'),
    ]);

    // Calculate revenue
    const roomRevenue = (roomBookingsData.data || [])
      .reduce((sum, b) => sum + (parseFloat(b.total_amount) || 0), 0);
    const restRevenue = (restaurantBookingsData.data || [])
      .reduce((sum, b) => sum + (parseFloat(b.total_price) || 0), 0);
    const spaRevenue = (spaBookingsData.data || [])
      .reduce((sum, b) => sum + (parseFloat(b.total_price) || 0), 0);

    const totalRevenue = roomRevenue + restRevenue + spaRevenue;

    const stats = {
      totalBookings: (totalRoomBookings || 0) + (totalRestaurantBookings || 0) + (totalSpaBookings || 0),
      totalRoomBookings: totalRoomBookings || 0,
      totalRestaurantBookings: totalRestaurantBookings || 0,
      totalSpaBookings: totalSpaBookings || 0,
      totalUsers: totalUsers || 0,
      totalRevenue: totalRevenue.toFixed(2),
      roomRevenue: roomRevenue.toFixed(2),
      restaurantRevenue: restRevenue.toFixed(2),
      spaRevenue: spaRevenue.toFixed(2),
    };

    console.log('✅ Dashboard stats loaded:', stats);
    return stats;
  } catch (err) {
    console.error('❌ Error fetching dashboard stats:', err);
    return {
      totalBookings: 0,
      totalRoomBookings: 0,
      totalRestaurantBookings: 0,
      totalSpaBookings: 0,
      totalUsers: 0,
      totalRevenue: '0.00',
      roomRevenue: '0.00',
      restaurantRevenue: '0.00',
      spaRevenue: '0.00',
    };
  }
};

/**
 * Get booking status breakdown (how many in each status)
 * @returns {Promise<object>} Status breakdown counts
 */
export const getBookingStatusBreakdown = async () => {
  try {
    const statuses = ['pending', 'pending_payment', 'approved', 'confirmed', 'checked_in', 'checked_out', 'completed', 'cancelled', 'modified', 'rejected'];

    const breakdowns = {};

    for (const status of statuses) {
      const [
        { count: roomCount },
        { count: restCount },
        { count: spaCount },
      ] = await Promise.all([
        supabase.from('bookings').select('id', { count: 'exact', head: true }).eq('status', status),
        supabase.from('restaurant_bookings').select('id', { count: 'exact', head: true }).eq('status', status),
        supabase.from('spa_bookings').select('id', { count: 'exact', head: true }).eq('status', status),
      ]);

      breakdowns[status] = {
        room: roomCount || 0,
        restaurant: restCount || 0,
        spa: spaCount || 0,
        total: (roomCount || 0) + (restCount || 0) + (spaCount || 0),
      };
    }

    console.log('✅ Booking status breakdown loaded');
    return breakdowns;
  } catch (err) {
    console.error('❌ Error fetching booking status breakdown:', err);
    return {};
  }
};

// ============================================================================
// EXPORTS
// ============================================================================

export default {
  // Bookings - Fetch
  fetchAllRoomBookingsForAdmin,
  fetchAllRestaurantBookingsForAdmin,
  fetchAllSpaBookingsForAdmin,
  fetchAllBookingsForAdmin,

  // Bookings - Update/Delete
  updateBookingStatus,
  deleteBooking,

  // Users
  fetchAllUsers,
  fetchUserById,
  updateUser,
  deleteUser,

  // Audit & Logs
  fetchAuditLogs,
  createAuditLog,

  // Statistics
  getAdminDashboardStats,
  getBookingStatusBreakdown,
};

--- END FILE: src\services\adminService_REFACTORED.js ---

--- START FILE: src\services\authApiService.js ---
/**
 * C# Auth API Service
 * Service để gọi C# backend API cho OAuth và Email
 * 
 * LƯU Ý: Code React hiện tại KHÔNG BỊ THAY ĐỔI
 * Chỉ thêm service mới này để có thể gọi C# API nếu cần
 */

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';

/**
 * Google Login via C# API
 * @param {string} idToken - Google ID token từ frontend
 */
export const googleLoginViaAPI = async (idToken) => {
  try {
    const response = await fetch(`${API_URL}/api/auth/google/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ idToken })
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    const result = await response.json();
    return result;
  } catch (error) {
    console.error('C# API not available for Google login:', error);
    return null;
  }
};

/**
 * Facebook Login via C# API
 * @param {string} accessToken - Facebook access token từ frontend
 */
export const facebookLoginViaAPI = async (accessToken) => {
  try {
    const response = await fetch(`${API_URL}/api/auth/facebook/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ accessToken })
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    const result = await response.json();
    return result;
  } catch (error) {
    console.error('C# API not available for Facebook login:', error);
    return null;
  }
};

/**
 * Send password reset email via C# API
 * @param {string} email - User email
 */
export const sendPasswordResetEmailViaAPI = async (email) => {
  try {
    const response = await fetch(`${API_URL}/api/auth/forgot-password`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    const result = await response.json();
    return result;
  } catch (error) {
    console.error('C# API not available for password reset:', error);
    return null;
  }
};

/**
 * Get OAuth URLs from C# API
 */
export const getOAuthUrls = async () => {
  try {
    const response = await fetch(`${API_URL}/api/auth/oauth/urls`);
    
    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    const result = await response.json();
    return result;
  } catch (error) {
    console.error('C# API not available for OAuth URLs:', error);
    return null;
  }
};
--- END FILE: src\services\authApiService.js ---

--- START FILE: src\services\authService.js ---
import { supabase } from '../utils/supabaseClient';

/**
 * Authentication service layer for Supabase Auth operations
 */

/**
 * Sign in with email and password
 */
export const signInWithEmail = async (email, password) => {
  try {
    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });
    if (error) throw error;
    return { success: true, data };
  } catch (err) {
    console.error('Sign in error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Sign up with email and password
 */
export const signUpWithEmail = async (email, password, userData = {}) => {
  try {
    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        data: {
          full_name: userData.name || '',
          role: userData.role || 'user',
          ...userData,
        },
      },
    });
    if (error) throw error;
    return { success: true, data };
  } catch (err) {
    console.error('Sign up error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Sign in with OAuth provider
 */
export const signInWithProvider = async (provider, redirectUrl = null) => {
  try {
    const redirectTo = redirectUrl || `${window.location.origin}/`;
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider,
      options: {
        redirectTo,
      },
    });
    if (error) throw error;
    return { success: true, data };
  } catch (err) {
    console.error('OAuth sign in error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Sign out
 */
export const signOut = async () => {
  try {
    const { error } = await supabase.auth.signOut();
    if (error) throw error;
    return { success: true };
  } catch (err) {
    console.error('Sign out error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Get current session
 */
export const getSession = async () => {
  try {
    const {
      data: { session },
      error,
    } = await supabase.auth.getSession();
    if (error) throw error;
    return { success: true, session };
  } catch (err) {
    console.error('Get session error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Get current user
 */
export const getCurrentUser = async () => {
  try {
    const {
      data: { user },
      error,
    } = await supabase.auth.getUser();
    if (error) throw error;
    return { success: true, user };
  } catch (err) {
    console.error('Get user error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Request password reset
 */
export const resetPasswordRequest = async (email, redirectUrl = null) => {
  try {
    const redirectTo = redirectUrl || `${window.location.origin}/reset-password`;
    const { error } = await supabase.auth.resetPasswordForEmail(email, {
      redirectTo,
    });
    if (error) throw error;
    return { success: true };
  } catch (err) {
    console.error('Password reset request error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Update password with new password
 */
export const updateUserPassword = async (newPassword) => {
  try {
    const { error } = await supabase.auth.updateUser({
      password: newPassword,
    });
    if (error) throw error;
    return { success: true };
  } catch (err) {
    console.error('Update password error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Update user metadata
 */
export const updateUserMetadata = async (metadata) => {
  try {
    const { error } = await supabase.auth.updateUser({
      data: metadata,
    });
    if (error) throw error;
    return { success: true };
  } catch (err) {
    console.error('Update metadata error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Verify email OTP
 */
export const verifyEmail = async (token) => {
  try {
    const { error } = await supabase.auth.verifyOtp({
      token,
      type: 'email',
    });
    if (error) throw error;
    return { success: true };
  } catch (err) {
    console.error('Email verification error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Resend verification email
 */
export const resendVerificationEmail = async (email) => {
  try {
    const { error } = await supabase.auth.resend({
      type: 'signup',
      email,
    });
    if (error) throw error;
    return { success: true };
  } catch (err) {
    console.error('Resend verification error:', err);
    return { success: false, error: err.message };
  }
};

/**
 * Fetch user profile from database
 */
export const fetchUserProfile = async (userId) => {
  try {
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', userId)
      .single();

    if (error) {
      console.warn('Profile fetch error:', error);
      return null;
    }
    return data;
  } catch (err) {
    console.error('Error fetching user profile:', err);
    return null;
  }
};

/**
 * Create or update user profile in database
 */
export const upsertUserProfile = async (userId, userData) => {
  try {
    const { error } = await supabase
      .from('profiles')
      .upsert(
        {
          id: userId,
          full_name: userData.name,
          phone: userData.phone,
          avatar_url: userData.avatar,
          country: userData.country,
          city: userData.city,
          preferences: userData.preferences || [],
          language: userData.language || 'en',
          newsletter: userData.newsletter !== false,
          bio: userData.bio,
          is_admin: userData.is_admin || false,  // Sử dụng is_admin thay vì role
          updated_at: new Date().toISOString(),
        },
        { onConflict: 'id' }
      );

    if (error) {
      console.error('Error upserting profile:', error);
      return false;
    }
    return true;
  } catch (err) {
    console.error('Error in upsertUserProfile:', err);
    return false;
  }
};

/**
 * Listen for auth state changes
 */
export const onAuthStateChange = (callback) => {
  const {
    data: { subscription },
  } = supabase.auth.onAuthStateChange((event, session) => {
    callback(event, session);
  });

  // Return unsubscribe function
  return () => {
    subscription?.unsubscribe();
  };
};

export default {
  signInWithEmail,
  signUpWithEmail,
  signInWithProvider,
  signOut,
  getSession,
  getCurrentUser,
  resetPasswordRequest,
  updateUserPassword,
  updateUserMetadata,
  verifyEmail,
  resendVerificationEmail,
  fetchUserProfile,
  upsertUserProfile,
  onAuthStateChange,
};
--- END FILE: src\services\authService.js ---

--- START FILE: src\services\bookingService.js ---
import { supabase } from '../utils/supabaseClient';

/**
 * Service layer for room booking operations
 */

export const createBooking = async (bookingData) => {
  try {
    // Không gửi trường id lên Supabase để dùng default gen_random_uuid()
    const { id, ...payload } = bookingData || {};

    const { data, error } = await supabase
      .from('bookings')
      .insert([payload])
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error creating room booking:', err);
    return null;
  }
};

export const fetchUserBookings = async (userId) => {
  try {
    const { data, error } = await supabase
      .from('bookings')
      .select('*')
      .eq('user_id', userId)
      .order('created_at', { ascending: false });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching user room bookings:', err);
    return [];
  }
};

export const updateBookingStatus = async (bookingId, status, extraData = {}) => {
  try {
    const { data, error } = await supabase
      .from('bookings')
      .update({ status, ...extraData })
      .eq('id', bookingId)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating room booking status:', err);
    return null;
  }
};

export const createBookingItems = async (bookingId, roomId, roomTypeId, pricingBreakdown) => {
  try {
    if (!pricingBreakdown || pricingBreakdown.length === 0) {
      console.warn('No pricing breakdown provided for booking items');
      return [];
    }
    
    // Create one item per night
    const items = pricingBreakdown.map((night) => ({
      booking_id: bookingId,
      room_id: roomId,
      room_type_id: roomTypeId,
      price_per_night: night.rate,
      nights: 1, // Each breakdown item is 1 night
      amount: night.rate,
    }));
    
    const { data, error } = await supabase
      .from('booking_items')
      .insert(items)
      .select();
    if (error) throw error;
    console.log(`✅ Created ${data.length} booking items for booking ${bookingId}`);
    return data || [];
  } catch (err) {
    console.error('Error creating booking items:', err);
    return [];
  }
};

export const createBookingPricingBreakdown = async (bookingId, pricingBreakdown) => {
  try {
    if (!pricingBreakdown || pricingBreakdown.length === 0) {
      console.warn('No pricing breakdown provided');
      return [];
    }
    
    // Create one record per night with rate_type
    const breakdownRecords = pricingBreakdown.map((night) => ({
      booking_id: bookingId,
      stay_date: night.date, // Format: YYYY-MM-DD
      rate_type: night.label || 'Standard rate', // e.g., "Weekend rate", "Holiday rate"
      rate: night.rate,
    }));
    
    const { data, error } = await supabase
      .from('booking_pricing_breakdown')
      .insert(breakdownRecords)
      .select();
    if (error) throw error;
    console.log(`✅ Created ${data.length} pricing breakdown records for booking ${bookingId}`);
    return data || [];
  } catch (err) {
    console.error('Error creating booking pricing breakdown:', err);
    return [];
  }
};

/**
 * Service layer for restaurant booking operations
 */

export const createRestaurantBooking = async (bookingData) => {
  try {
    const { data, error } = await supabase
      .from('restaurant_bookings')
      .insert([{
        user_id: bookingData.userId,
        confirmation_code: bookingData.confirmationCode,
        name: bookingData.name,
        email: bookingData.email,
        phone: bookingData.phone,
        reservation_at: bookingData.reservationAt,
        guests: bookingData.guests || 1,
        special_requests: bookingData.specialRequests || '',
        price: bookingData.price || 0,
        total_price: bookingData.totalPrice || 0,
        status: bookingData.status || 'pending_payment',
        payment_method: bookingData.paymentMethod || null,
        paid_at: bookingData.paidAt || null,
      }])
      .select();
    if (error) throw error;
    console.log('✅ Restaurant booking saved:', data?.[0]?.confirmation_code);
    return data?.[0] || null;
  } catch (err) {
    console.error('❌ Error creating restaurant booking:', err);
    return null;
  }
};

export const updateRestaurantBookingStatus = async (bookingId, status, extraData = {}) => {
  try {
    const { data, error } = await supabase
      .from('restaurant_bookings')
      .update({ 
        status,
        ...extraData,
        updated_at: new Date().toISOString()
      })
      .eq('id', bookingId)
      .select();
    if (error) throw error;
    console.log('✅ Restaurant booking updated:', status);
    return data?.[0] || null;
  } catch (err) {
    console.error('❌ Error updating restaurant booking:', err);
    return null;
  }
};

export const fetchUserRestaurantBookings = async (userId) => {
  try {
    const { data, error } = await supabase
      .from('restaurant_bookings')
      .select('*')
      .eq('user_id', userId)
      .order('created_at', { ascending: false });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching user restaurant bookings:', err);
    return [];
  }
};


/**
 * Service layer for spa booking operations
 */

export const createSpaBooking = async (bookingData) => {
  try {
    const { data, error } = await supabase
      .from('spa_bookings')
      .insert([{
        user_id: bookingData.userId,
        confirmation_code: bookingData.confirmationCode,
        name: bookingData.name,
        email: bookingData.email,
        phone: bookingData.phone,
        appointment_at: bookingData.appointmentAt,
        service_name: bookingData.serviceName,
        service_duration: bookingData.duration || '',
        therapist: bookingData.therapist || '',
        special_requests: bookingData.specialRequests || '',
        price: bookingData.price || 0,
        total_price: bookingData.totalPrice || 0,
        status: bookingData.status || 'pending_payment',
        payment_method: bookingData.paymentMethod || null,
        paid_at: bookingData.paidAt || null,
      }])
      .select();
    if (error) throw error;
    console.log('✅ Spa booking saved:', data?.[0]?.confirmation_code);
    return data?.[0] || null;
  } catch (err) {
    console.error('❌ Error creating spa booking:', err);
    return null;
  }
};

export const updateSpaBookingStatus = async (bookingId, status, extraData = {}) => {
  try {
    const { data, error } = await supabase
      .from('spa_bookings')
      .update({ 
        status,
        ...extraData,
        updated_at: new Date().toISOString()
      })
      .eq('id', bookingId)
      .select();
    if (error) throw error;
    console.log('✅ Spa booking updated:', status);
    return data?.[0] || null;
  } catch (err) {
    console.error('❌ Error updating spa booking:', err);
    return null;
  }
};

export const fetchUserSpaBookings = async (userId) => {
  try {
    const { data, error } = await supabase
      .from('spa_bookings')
      .select('*')
      .eq('user_id', userId)
      .order('created_at', { ascending: false });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching user spa bookings:', err);
    return [];
  }
};

/**
 * Restaurant data helpers (menu + slots)
 */
export const fetchRestaurantMenuItems = async () => {
  try {
    const { data, error } = await supabase
      .from('restaurant_menu_items')
      .select('*')
      .eq('is_active', true)
      .order('display_order', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching restaurant menu items:', err);
    return [];
  }
};

export const fetchRestaurantSlotsByDateTime = async (reservationAt) => {
  try {
    const { data, error } = await supabase
      .from('restaurant_slots')
      .select(`
        *,
        restaurant_tables:table_id (id, name, capacity, location, status)
      `)
      .eq('reservation_at', reservationAt)
      .order('reservation_at', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching restaurant slots:', err);
    return [];
  }
};

export const updateRestaurantSlotUsage = async (slotId, guests) => {
  try {
    // Fetch current slot to calculate new usage
    const { data: slotData, error: slotErr } = await supabase
      .from('restaurant_slots')
      .select('*')
      .eq('id', slotId)
      .single();
    if (slotErr) throw slotErr;

    const capacityUsed = (slotData?.capacity_used || 0) + guests;
    const isFull = capacityUsed >= (slotData?.capacity_limit || 0);

    const { data, error } = await supabase
      .from('restaurant_slots')
      .update({
        capacity_used: capacityUsed,
        status: isFull ? 'booked' : 'held',
        updated_at: new Date().toISOString(),
      })
      .eq('id', slotId)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating restaurant slot usage:', err);
    return null;
  }
};

/**
 * Spa data helpers (services + slots)
 */
export const fetchSpaServices = async () => {
  try {
    const { data, error } = await supabase
      .from('spa_services')
      .select('*')
      .eq('is_active', true)
      .order('display_order', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching spa services:', err);
    return [];
  }
};

export const fetchSpaSlotsByDateTime = async (serviceId, appointmentAt, therapist = null) => {
  try {
    let query = supabase
      .from('spa_slots')
      .select('*')
      .eq('service_id', serviceId)
      .eq('appointment_at', appointmentAt);

    if (therapist) {
      query = query.eq('therapist', therapist);
    }

    const { data, error } = await query.order('appointment_at', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching spa slots:', err);
    return [];
  }
};

export const updateSpaSlotUsage = async (slotId) => {
  try {
    const { data: slotData, error: slotErr } = await supabase
      .from('spa_slots')
      .select('*')
      .eq('id', slotId)
      .single();
    if (slotErr) throw slotErr;

    const isFull = true; // spa slot capacity default 1

    const { data, error } = await supabase
      .from('spa_slots')
      .update({
        status: isFull ? 'booked' : 'held',
        updated_at: new Date().toISOString(),
      })
      .eq('id', slotId)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating spa slot usage:', err);
    return null;
  }
};

/**
 * Cancellation functions with refund logic
 */
export const cancelRoomBooking = async (bookingId) => {
  try {
    const { data, error } = await supabase
      .from('bookings')
      .update({ 
        status: 'cancelled',
        cancelled_at: new Date().toISOString(),
        refund_amount: null // Calculate based on cancellation policy
      })
      .eq('id', bookingId)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error cancelling room booking:', err);
    throw err;
  }
};

export const cancelRestaurantBooking = async (bookingId) => {
  try {
    const { data, error } = await supabase
      .from('restaurant_bookings')
      .update({ 
        status: 'cancelled',
        cancelled_at: new Date().toISOString()
      })
      .eq('id', bookingId)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error cancelling restaurant booking:', err);
    throw err;
  }
};

export const cancelSpaBooking = async (bookingId) => {
  try {
    const { data, error } = await supabase
      .from('spa_bookings')
      .update({ 
        status: 'cancelled',
        cancelled_at: new Date().toISOString()
      })
      .eq('id', bookingId)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error cancelling spa booking:', err);
    throw err;
  }
};

export default {
    createBooking,
    fetchUserBookings,
    updateBookingStatus,
    createBookingItems,
    createBookingPricingBreakdown,
    createRestaurantBooking,
    updateRestaurantBookingStatus,
    fetchUserRestaurantBookings,
    createSpaBooking,
    updateSpaBookingStatus,
    fetchUserSpaBookings,
    cancelRoomBooking,
    cancelRestaurantBooking,
    cancelSpaBooking,
};
--- END FILE: src\services\bookingService.js ---

--- START FILE: src\services\csharpApiService.js ---
/**
 * C# API Service
 * Optional service to call C# backend API for complex business logic
 * 
 * To use: Set VITE_API_URL in .env file
 * Example: VITE_API_URL=http://localhost:5000
 */

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';

/**
 * Calculate booking price using C# backend
 * This provides more accurate pricing with weekend surcharges and promotions
 */
export const calculateBookingPrice = async (bookingData) => {
  try {
    const response = await fetch(`${API_URL}/api/bookings/calculate-price`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        checkIn: bookingData.checkIn,
        checkOut: bookingData.checkOut,
        basePricePerNight: bookingData.basePricePerNight,
        baseCapacity: bookingData.baseCapacity || 2,
        numAdults: bookingData.numAdults || 1,
        numChildren: bookingData.numChildren || 0,
        promoCode: bookingData.promoCode || null
      })
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    return await response.json();
  } catch (error) {
    console.warn('C# API not available, using frontend calculation:', error);
    // Fallback to frontend calculation if API is not available
    return null;
  }
};

/**
 * Validate booking using C# backend
 */
export const validateBooking = async (bookingData) => {
  try {
    const response = await fetch(`${API_URL}/api/bookings/validate`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        checkIn: bookingData.checkIn,
        checkOut: bookingData.checkOut,
        numAdults: bookingData.numAdults || 1,
        numChildren: bookingData.numChildren || 0,
        baseCapacity: bookingData.baseCapacity || 2,
        maxCapacity: bookingData.maxCapacity || 4
      })
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    return await response.json();
  } catch (error) {
    console.warn('C# API not available:', error);
    return { isValid: true, errors: [], warnings: [] };
  }
};

/**
 * Generate confirmation code using C# backend
 */
export const generateConfirmationCode = async (type = 'room') => {
  try {
    const response = await fetch(`${API_URL}/api/bookings/generate-confirmation-code?type=${type}`);
    
    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    const data = await response.json();
    return data.confirmationCode;
  } catch (error) {
    console.warn('C# API not available, using frontend generation:', error);
    // Fallback to frontend generation
    const prefix = type.toUpperCase().substring(0, 3);
    const random = Math.floor(Math.random() * 100000);
    return `${prefix}-${random}`;
  }
};

/**
 * Send verification code to email for password reset
 */
export const sendVerificationCode = async (email) => {
  try {
    const response = await fetch(`${API_URL}/api/auth/send-verification-code`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    return await response.json();
  } catch (error) {
    console.error('Error sending verification code via C# API:', error);
    return { success: false, message: 'Failed to send verification code.' };
  }
};

/**
 * Verify code and reset password
 */
export const verifyCodeAndResetPassword = async (email, code, newPassword) => {
  try {
    const response = await fetch(`${API_URL}/api/auth/verify-code-reset-password`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, code, newPassword })
    });

    if (!response.ok) {
      throw new Error(`API error: ${response.status}`);
    }

    return await response.json();
  } catch (error) {
    console.error('Error verifying code and resetting password via C# API:', error);
    return { success: false, message: 'Failed to reset password.' };
  }
};
--- END FILE: src\services\csharpApiService.js ---

--- START FILE: src\services\roomService.js ---
import { supabase } from '../utils/supabaseClient';

/**
 * Service layer for room and pricing operations
 */

export const fetchRoomTypes = async () => {
  try {
    const { data, error } = await supabase
      .from('room_types')
      .select('*')
      .eq('is_active', true)
      .order('code', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching room types:', err);
    return [];
  }
};

export const createRoomType = async (roomTypeData) => {
  try {
    const { data, error } = await supabase
      .from('room_types')
      .insert([roomTypeData])
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error creating room type:', err);
    throw err;
  }
};

export const updateRoomType = async (id, roomTypeData) => {
  try {
    const { data, error } = await supabase
      .from('room_types')
      .update(roomTypeData)
      .eq('id', id)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating room type:', err);
    throw err;
  }
};

export const deleteRoomType = async (id) => {
  try {
    const { error } = await supabase
      .from('room_types')
      .delete()
      .eq('id', id);
    if (error) throw error;
    return true;
  } catch (err) {
    console.error('Error deleting room type:', err);
    throw err;
  }
};

export const fetchRooms = async (roomTypeId = null) => {
  try {
    let query = supabase.from('rooms').select(`
      *,
      room_types:room_type_id (*)
    `);
    
    if (roomTypeId) {
      query = query.eq('room_type_id', roomTypeId);
    }
    
    const { data, error } = await query.order('room_no', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching rooms:', err);
    return [];
  }
};

export const createRoom = async (roomData) => {
  try {
    const { data, error } = await supabase
      .from('rooms')
      .insert([roomData])
      .select(`*, room_types:room_type_id (*)`);
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error creating room:', err);
    throw err;
  }
};

export const updateRoom = async (id, roomData) => {
  try {
    const { data, error } = await supabase
      .from('rooms')
      .update(roomData)
      .eq('id', id)
      .select(`*, room_types:room_type_id (*)`);
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating room:', err);
    throw err;
  }
};

export const deleteRoom = async (id) => {
  try {
    const { error } = await supabase
      .from('rooms')
      .delete()
      .eq('id', id);
    if (error) throw error;
    return true;
  } catch (err) {
    console.error('Error deleting room:', err);
    throw err;
  }
};

export const fetchRoomImages = async (roomTypeId = null) => {
  try {
    let query = supabase.from('room_images').select('*');
    
    if (roomTypeId) {
      query = query.eq('room_type_id', roomTypeId);
    }
    
    const { data, error } = await query;
    if (error) throw error;
    
    console.log('🖼️ Fetch Room Images - Result:', { count: data?.length, data });
    
    return data || [];
  } catch (err) {
    console.error('Error fetching room images:', err);
    return [];
  }
};

export const fetchRoomsWithImages = async () => {
  try {
    // 1. Fetch all rooms with their room_type relations
    const roomsData = await fetchRooms();

    // 2. For each room, fetch its room_type's images from room_images table
    const enrichedRooms = await Promise.all(
      roomsData.map(async (room) => {
        const roomTypeId = room.room_type_id;
        
        try {
          // Fetch images for this room type from Supabase
          const images = await fetchRoomImages(roomTypeId);
          
          // Get primary image (first one) and lg variant
          const primaryImage = images?.length > 0 ? images[0] : null;
          
          return {
            ...room,
            image_url: primaryImage?.image_url || null,
            image_lg_url: primaryImage?.image_lg_url || null,
            all_images: images || [],
          };
        } catch (imgErr) {
          console.warn(`Failed to load images for room type ${roomTypeId}:`, imgErr);
          return {
            ...room,
            image_url: null,
            image_lg_url: null,
            all_images: [],
          };
        }
      })
    );

    console.log(`✅ Loaded ${enrichedRooms.length} rooms from Supabase with real Storage images`);
    return enrichedRooms;
  } catch (err) {
    console.error('Error fetching rooms with images:', err);
    return [];
  }
};

export const checkRoomAvailability = async (roomId, checkIn, checkOut, excludeBookingId = null) => {
  try {
    // Calculate cutoff time: pending_payment bookings older than 15 minutes are considered expired
    const fifteenMinutesAgo = new Date(Date.now() - 15 * 60 * 1000).toISOString();
    
    let query = supabase
      .from('bookings')
      .select('id, status, created_at')
      .eq('room_id', roomId)
      .neq('status', 'cancelled')
      .lt('check_in', checkOut)
      .gt('check_out', checkIn);
    
    if (excludeBookingId) {
      query = query.neq('id', excludeBookingId);
    }
    
    const { data, error } = await query;
    if (error) throw error;
    
    if (!data || data.length === 0) {
      return true; // No bookings found, room is available
    }
    
    // Filter out bookings that don't block availability:
    // 1. confirmed or checked_in bookings (always block)
    // 2. pending_payment bookings that are recent (within 15 minutes) - block
    // 3. pending_payment bookings older than 15 minutes - don't block (expired)
    // 4. cancelled bookings - don't block (already filtered in query)
    const blockingBookings = data.filter(booking => {
      if (booking.status === 'confirmed' || booking.status === 'checked_in') {
        return true; // Always block
      }
      
      if (booking.status === 'pending_payment') {
        // Only block if created within last 15 minutes
        const createdAt = new Date(booking.created_at);
        const cutoffTime = new Date(fifteenMinutesAgo);
        return createdAt > cutoffTime;
      }
      
      // Other statuses (e.g., 'checked_out') don't block
      return false;
    });
    
    // If no blocking bookings found, room is available
    return blockingBookings.length === 0;
  } catch (err) {
    console.error('Error checking availability:', err);
    return true; // On error, assume room is available (safer for user experience)
  }
};

export const fetchPriceRules = async (roomTypeId = null) => {
  try {
    let query = supabase
      .from('price_rules')
      .select('*')
      .eq('is_active', true);
    
    // Chỉ filter theo room_type_id nếu có giá trị hợp lệ
    if (roomTypeId) {
      query = query.eq('room_type_id', roomTypeId);
    }
    
    const { data, error } = await query.order('priority', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching price rules:', err);
    return [];
  }
};

export const fetchPromotions = async () => {
  try {
    const { data, error } = await supabase
      .from('promotions')
      .select('*')
      .eq('is_active', true)
      .order('end_date', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching promotions:', err);
    return [];
  }
};

export const fetchHolidayCalendar = async () => {
  try {
    const { data, error } = await supabase
      .from('holiday_calendar')
      .select('*')
      .eq('is_active', true)
      .order('holiday_date', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching holiday calendar:', err);
    return [];
  }
};

export const fetchRoomReviews = async (roomId = null, roomTypeId = null) => {
  try {
    let query = supabase.from('room_reviews').select('*');
    
    // Ưu tiên fetch theo room_id cụ thể, fallback về room_type_id nếu không có room_id
    if (roomId) {
      query = query.eq('room_id', roomId);
    } else if (roomTypeId) {
      query = query.eq('room_type_id', roomTypeId);
    } else {
      return [];
    }
    
    const { data, error } = await query.order('created_at', { ascending: false });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching reviews:', err);
    return [];
  }
};

export const createReview = async (reviewData) => {
  try {
    const { data, error } = await supabase
      .from('room_reviews')
      .insert([reviewData])
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error creating review:', err);
    return null;
  }
};

export const hasUserBookedRoomType = async (userId, roomTypeId) => {
  try {
    const { data, error } = await supabase
      .from('bookings')
      .select('id')
      .eq('user_id', userId)
      .eq('room_type_id', roomTypeId)
      .neq('status', 'cancelled')
      .limit(1);
    if (error) throw error;
    return (data && data.length > 0);
  } catch (err) {
    console.error('Error checking user booking:', err);
    return false;
  }
};

/**
 * Get primary image for a room type
 * @param {string} roomTypeId - Room type UUID
 * @returns {object|null} Image object with image_url and image_lg_url, or null
 */
export const getPrimaryImage = async (roomTypeId) => {
  try {
    const { data, error } = await supabase
      .from('room_images')
      .select('*')
      .eq('room_type_id', roomTypeId)
      .order('display_order', { ascending: true })
      .limit(1);
    
    if (error) throw error;
    return data?.length > 0 ? data[0] : null;
  } catch (err) {
    console.error(`Error fetching primary image for room type ${roomTypeId}:`, err);
    return null;
  }
};

/**
 * Get all images for a room type
 * @param {string} roomTypeId - Room type UUID
 * @returns {array} Array of image objects
 */
export const getAllImages = async (roomTypeId) => {
  try {
    const { data, error } = await supabase
      .from('room_images')
      .select('*')
      .eq('room_type_id', roomTypeId)
      .order('display_order', { ascending: true });
    
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error(`Error fetching all images for room type ${roomTypeId}:`, err);
    return [];
  }
};

/**
 * Room status board (view) + history helpers
 */
export const fetchRoomStatusBoard = async () => {
  try {
    const { data, error } = await supabase
      .from('room_status_board')
      .select('*')
      .order('room_no', { ascending: true });
    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('Error fetching room status board:', err);
    return [];
  }
};

export const addRoomStatusHistory = async ({ roomId, status, note = null, actor = null }) => {
  try {
    const payload = {
      room_id: roomId,
      status,
      note,
      actor,
      started_at: new Date().toISOString(),
    };
    const { data, error } = await supabase
      .from('room_status_history')
      .insert([payload])
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error adding room status history:', err);
    return null;
  }
};

export const updateRoomStatus = async (roomId, status) => {
  try {
    const { data, error } = await supabase
      .from('rooms')
      .update({ status, updated_at: new Date().toISOString() })
      .eq('id', roomId)
      .select();
    if (error) throw error;
    return data?.[0] || null;
  } catch (err) {
    console.error('Error updating room status:', err);
    return null;
  }
};

export default {
  fetchRoomTypes,
  createRoomType,
  updateRoomType,
  deleteRoomType,
  fetchRooms,
  createRoom,
  updateRoom,
  deleteRoom,
  fetchRoomImages,
  fetchRoomsWithImages,
  checkRoomAvailability,
  fetchPriceRules,
  fetchPromotions,
  fetchHolidayCalendar,
  fetchRoomReviews,
  createReview,
  hasUserBookedRoomType,
  getPrimaryImage,
  getAllImages,
};
--- END FILE: src\services\roomService.js ---

--- START FILE: src\services\simpleAuthService.js ---
/**
 * Simple Authentication Service
 * Không dùng Supabase Auth, chỉ dùng Supabase như database
 * Hash password bằng Web Crypto API (SHA-256)
 */

import { supabase } from '../utils/supabaseClient';

/**
 * Hash password đơn giản bằng SHA-256
 * Lưu ý: Trong production nên dùng bcrypt, nhưng để đơn giản dùng SHA-256 + salt
 */
export const hashPassword = async (password) => {
  // Tạo salt ngẫu nhiên
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const saltHex = Array.from(salt).map(b => b.toString(16).padStart(2, '0')).join('');
  
  // Hash password + salt
  const encoder = new TextEncoder();
  const data = encoder.encode(password + saltHex);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  
  // Trả về hash + salt (để verify sau)
  return `${saltHex}:${hashHex}`;
};

/**
 * Verify password
 */
export const verifyPassword = async (password, passwordHash) => {
  try {
    // Kiểm tra passwordHash hợp lệ và trim
    if (!passwordHash) {
      console.error('Password hash is null or undefined');
      return false;
    }
    
    // Convert to string and trim
    const hashStr = String(passwordHash).trim();
    
    if (!hashStr || hashStr.length === 0) {
      console.error('Password hash is empty after trim');
      return false;
    }

    // Split salt và hash
    const parts = hashStr.split(':');
    if (parts.length !== 2) {
      console.error('Password hash format incorrect. Expected "salt:hash"');
      console.error('Got:', hashStr.substring(0, 100));
      console.error('Parts count:', parts.length);
      return false;
    }

    const [saltHex, storedHash] = parts.map(p => p.trim());
    
    if (!saltHex || !storedHash) {
      console.error('Salt or hash is missing after split');
      console.error('Salt:', saltHex ? saltHex.substring(0, 20) + '...' : 'null');
      console.error('Hash:', storedHash ? storedHash.substring(0, 20) + '...' : 'null');
      return false;
    }

    // Hash password với salt (đảm bảo format giống khi hash)
    const encoder = new TextEncoder();
    const data = encoder.encode(password + saltHex);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    
    // So sánh hash (case-sensitive)
    const isValid = hashHex === storedHash;
    
    if (!isValid) {
      console.warn('Password verification failed');
      console.warn('Password:', password);
      console.warn('Salt:', saltHex);
      console.warn('Expected hash length:', storedHash.length);
      console.warn('Computed hash length:', hashHex.length);
      console.warn('Expected hash (first 20):', storedHash.substring(0, 20));
      console.warn('Computed hash (first 20):', hashHex.substring(0, 20));
      console.warn('Hashes match:', hashHex === storedHash);
    } else {
      console.log('✅ Password verified successfully');
    }
    
    return isValid;
  } catch (err) {
    console.error('Error verifying password:', err);
    return false;
  }
};

/**
 * Register user mới
 */
export const registerUser = async (email, password, fullName = '') => {
  try {
    // Kiểm tra email đã tồn tại chưa
    const { data: existingUser } = await supabase
      .from('users')
      .select('id')
      .eq('email', email.toLowerCase().trim())
      .single();

    if (existingUser) {
      return { success: false, error: 'Email already exists' };
    }

    // Hash password
    const passwordHash = await hashPassword(password);

    // Tạo email verification token
    const verificationToken = crypto.getRandomValues(new Uint8Array(32));
    const tokenHex = Array.from(verificationToken).map(b => b.toString(16).padStart(2, '0')).join('');

    // Insert user
    const { data, error } = await supabase
      .from('users')
      .insert({
        email: email.toLowerCase().trim(),
        password_hash: passwordHash,
        full_name: fullName,
        is_admin: false,
        is_email_verified: false, // Có thể bật email verification sau
        email_verification_token: tokenHex,
      })
      .select()
      .single();

    if (error) {
      console.error('Register error:', error);
      return { success: false, error: error.message || 'Registration failed' };
    }

    // Tự động verify email cho đơn giản (có thể bỏ nếu muốn verify qua email)
    await supabase
      .from('users')
      .update({ is_email_verified: true, email_verification_token: null })
      .eq('id', data.id);

    return {
      success: true,
      user: {
        id: data.id,
        email: data.email,
        name: data.full_name,
        isAdmin: data.is_admin,
      },
    };
  } catch (err) {
    console.error('Register error:', err);
    return { success: false, error: err.message || 'Registration failed' };
  }
};

/**
 * Login user
 */
export const loginUser = async (email, password) => {
  try {
    // Tìm user theo email
    const { data: user, error } = await supabase
      .from('users')
      .select('*')
      .eq('email', email.toLowerCase().trim())
      .single();

    if (error || !user) {
      console.error('User not found:', error);
      return { success: false, error: 'Invalid email or password' };
    }

    // Kiểm tra password_hash có tồn tại không
    if (!user.password_hash) {
      console.error('User has no password hash');
      return { success: false, error: 'Invalid email or password' };
    }

    // Trim password_hash để tránh khoảng trắng
    const passwordHash = String(user.password_hash).trim();
    
    console.log('Attempting login for:', email);
    console.log('Password hash length:', passwordHash.length);
    console.log('Password hash format:', passwordHash.substring(0, 50) + '...');
    console.log('Password hash has colon:', passwordHash.includes(':'));

    // Verify password
    const isValid = await verifyPassword(password, passwordHash);
    if (!isValid) {
      console.error('Password verification failed for:', email);
      return { success: false, error: 'Invalid email or password' };
    }

    console.log('Login successful for:', email);

    // Update last_login
    await supabase
      .from('users')
      .update({ last_login: new Date().toISOString() })
      .eq('id', user.id);

    return {
      success: true,
      user: {
        id: user.id,
        email: user.email,
        name: user.full_name,
        phone: user.phone,
        avatar: user.avatar_url,
        country: user.country,
        city: user.city,
        preferences: user.preferences || [],
        language: user.language || 'en',
        newsletter: user.newsletter,
        bio: user.bio,
        isAdmin: user.is_admin,
        emailVerified: user.is_email_verified,
        createdAt: user.created_at,
      },
    };
  } catch (err) {
    console.error('Login error:', err);
    return { success: false, error: err.message || 'Login failed' };
  }
};

/**
 * Request password reset
 */
export const requestPasswordReset = async (email) => {
  try {
    // Tìm user
    const { data: user } = await supabase
      .from('users')
      .select('id, email')
      .eq('email', email.toLowerCase().trim())
      .single();

    if (!user) {
      // Không báo lỗi để tránh email enumeration
      return { success: true };
    }

    // Tạo reset code
    const resetCode = Math.random().toString(36).substring(2, 8).toUpperCase();
    const expiresAt = new Date();
    expiresAt.setHours(expiresAt.getHours() + 1); // Hết hạn sau 1 giờ

    // Lưu vào password_reset_requests
    await supabase
      .from('password_reset_requests')
      .insert({
        email: email.toLowerCase().trim(),
        code: resetCode,
        expires_at: expiresAt.toISOString(),
      });

    // Gửi email với reset code
    try {
      const { sendResetCodeEmail, isEmailConfigured } = await import('../utils/emailService');
      
      if (isEmailConfigured()) {
        // Email service đã được config - gửi email thật
        const emailResult = await sendResetCodeEmail(email, resetCode);
        if (!emailResult.success) {
          console.warn('Failed to send reset email, but code was saved:', emailResult.error);
        }
      } else {
        // Email service chưa config - log ra console (cho development)
        console.log('Password reset code for', email, ':', resetCode);
        console.log('Note: Email service not configured. In production, configure EmailJS to send emails automatically.');
      }
    } catch (emailError) {
      console.warn('Email service error (code still saved):', emailError);
      // Vẫn trả về success vì code đã được lưu vào DB
    }

    return { success: true, resetCode }; // Trả về code để test (trong production không nên nếu email đã được gửi)
  } catch (err) {
    console.error('Password reset error:', err);
    return { success: false, error: err.message || 'Failed to request password reset' };
  }
};

/**
 * Reset password với code
 */
export const resetPassword = async (email, code, newPassword) => {
  try {
    // Tìm reset request hợp lệ
    const { data: resetRequest } = await supabase
      .from('password_reset_requests')
      .select('*')
      .eq('email', email.toLowerCase().trim())
      .eq('code', code.toUpperCase())
      .is('used_at', null)
      .gt('expires_at', new Date().toISOString())
      .order('created_at', { ascending: false })
      .limit(1)
      .single();

    if (!resetRequest) {
      return { success: false, error: 'Invalid or expired reset code' };
    }

    // Hash password mới
    const passwordHash = await hashPassword(newPassword);

    // Update password
    const { error: updateError } = await supabase
      .from('users')
      .update({ password_hash: passwordHash })
      .eq('email', email.toLowerCase().trim());

    if (updateError) {
      return { success: false, error: updateError.message || 'Failed to reset password' };
    }

    // Đánh dấu reset request đã dùng
    await supabase
      .from('password_reset_requests')
      .update({ used_at: new Date().toISOString() })
      .eq('id', resetRequest.id);

    return { success: true };
  } catch (err) {
    console.error('Reset password error:', err);
    return { success: false, error: err.message || 'Failed to reset password' };
  }
};

/**
 * Get user by ID
 */
export const getUserById = async (userId) => {
  try {
    const { data, error } = await supabase
      .from('users')
      .select('*')
      .eq('id', userId)
      .single();

    if (error || !data) {
      return null;
    }

    return {
      id: data.id,
      email: data.email,
      name: data.full_name,
      phone: data.phone,
      avatar: data.avatar_url,
      country: data.country,
      city: data.city,
      preferences: data.preferences || [],
      language: data.language || 'en',
      newsletter: data.newsletter,
      bio: data.bio,
      isAdmin: data.is_admin,
      emailVerified: data.is_email_verified,
      createdAt: data.created_at,
    };
  } catch (err) {
    console.error('Get user error:', err);
    return null;
  }
};

/**
 * Update user profile
 */
export const updateUserProfile = async (userId, updates) => {
  try {
    const updateData = {};
    if (updates.name !== undefined) updateData.full_name = updates.name;
    if (updates.phone !== undefined) updateData.phone = updates.phone;
    if (updates.avatar !== undefined) updateData.avatar_url = updates.avatar;
    if (updates.country !== undefined) updateData.country = updates.country;
    if (updates.city !== undefined) updateData.city = updates.city;
    if (updates.preferences !== undefined) updateData.preferences = updates.preferences;
    if (updates.language !== undefined) updateData.language = updates.language;
    if (updates.newsletter !== undefined) updateData.newsletter = updates.newsletter;
    if (updates.bio !== undefined) updateData.bio = updates.bio;

    // Optional: update email nếu được truyền vào và khác hiện tại
    if (updates.email !== undefined) {
      const newEmail = updates.email.toLowerCase().trim();
      if (!newEmail.includes('@')) {
        return { success: false, error: 'Invalid email address' };
      }

      // Kiểm tra trùng email với user khác
      const { data: existing } = await supabase
        .from('users')
        .select('id')
        .eq('email', newEmail)
        .neq('id', userId)
        .maybeSingle();

      if (existing) {
        return { success: false, error: 'Email is already in use' };
      }

      updateData.email = newEmail;
    }

    const { data, error } = await supabase
      .from('users')
      .update(updateData)
      .eq('id', userId)
      .select()
      .single();

    if (error) {
      return { success: false, error: error.message };
    }

    return {
      success: true,
      user: {
        id: data.id,
        email: data.email,
        name: data.full_name,
        phone: data.phone,
        avatar: data.avatar_url,
        country: data.country,
        city: data.city,
        preferences: data.preferences || [],
        language: data.language || 'en',
        newsletter: data.newsletter,
        bio: data.bio,
        isAdmin: data.is_admin,
        emailVerified: data.is_email_verified,
        createdAt: data.created_at,
      },
    };
  } catch (err) {
    console.error('Update profile error:', err);
    return { success: false, error: err.message || 'Failed to update profile' };
  }
};

/**
 * Change password
 */
export const changePassword = async (userId, currentPassword, newPassword) => {
  try {
    // Lấy user
    const { data: user } = await supabase
      .from('users')
      .select('password_hash')
      .eq('id', userId)
      .single();

    if (!user) {
      return { success: false, error: 'User not found' };
    }

    // Verify current password
    const isValid = await verifyPassword(currentPassword, user.password_hash);
    if (!isValid) {
      return { success: false, error: 'Current password is incorrect' };
    }

    // Hash new password
    const passwordHash = await hashPassword(newPassword);

    // Update password
    const { error } = await supabase
      .from('users')
      .update({ password_hash: passwordHash })
      .eq('id', userId);

    if (error) {
      return { success: false, error: error.message || 'Failed to change password' };
    }

    return { success: true };
  } catch (err) {
    console.error('Change password error:', err);
    return { success: false, error: err.message || 'Failed to change password' };
  }
};
--- END FILE: src\services\simpleAuthService.js ---

--- START FILE: src\utils\aiAssistant.js ---
/**
 * AI Assistant utilities for hotel booking chatbot
 */

// Intelligent room recommendations based on user preferences
export const recommendRooms = (rooms, preferences) => {
  const { adults, kids, budget, amenities = [] } = preferences;

  const filtered = rooms.filter((room) => {
    const totalGuests = adults + kids;
    if (room.maxPerson < totalGuests) return false;
    if (budget && room.price > budget) return false;
    if (amenities.length > 0) {
      const roomAmenities = room.amenities?.map((a) => a.toLowerCase()) || [];
      return amenities.some((a) => roomAmenities.includes(a.toLowerCase()));
    }
    return true;
  });

  return filtered
    .sort((a, b) => {
      // Prioritize rooms that fit perfectly
      const aScore = a.maxPerson - (adults + kids);
      const bScore = b.maxPerson - (adults + kids);
      return aScore - bScore;
    })
    .slice(0, 5);
};

// Calculate stay duration and price
export const calculateStayInfo = (checkIn, checkOut) => {
  const startDate = new Date(checkIn);
  const endDate = new Date(checkOut);
  const nights = Math.max(
    1,
    Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24))
  );
  return { nights, startDate, endDate };
};

// Get dynamic pricing based on dates (weekday/weekend/holiday)
export const getDynamicPrice = (basePrice, date) => {
  const d = new Date(date);
  const dayOfWeek = d.getDay();
  const isWeekend = dayOfWeek === 5 || dayOfWeek === 6;

  if (isWeekend) {
    return Math.round(basePrice * 1.3); // 30% more on weekends
  }
  return basePrice;
};

// Validate booking information
export const validateBooking = (bookingData) => {
  const errors = [];

  if (!bookingData.name?.trim()) errors.push("Name cannot be empty");
  if (!bookingData.email?.trim() || !bookingData.email.includes("@"))
    errors.push("Invalid email address");
  if (bookingData.checkIn >= bookingData.checkOut)
    errors.push("Check-out date must be after check-in date");
  if (!bookingData.roomName?.trim()) errors.push("Please select a room");

  return {
    isValid: errors.length === 0,
    errors,
  };
};

// Format booking confirmation
export const formatConfirmation = (booking, room) => {
  const { nights } = calculateStayInfo(booking.checkIn, booking.checkOut);
  const totalPrice = room.price * nights;

  return {
    confirmationCode: booking.confirmationCode,
    room: room.name,
    guest: booking.name,
    checkIn: new Date(booking.checkIn).toLocaleDateString("en-US"),
    checkOut: new Date(booking.checkOut).toLocaleDateString("en-US"),
    nights,
    pricePerNight: room.price,
    totalPrice,
    adults: booking.adults,
    kids: booking.kids,
    specialRequests: booking.specialRequests,
  };
};

// Get conversation context to provide better recommendations
export const getContextFromChat = (messages) => {
  const context = {
    mentionedAmenities: [],
    budgetRange: null,
    preferredRoomType: null,
    specialNeeds: [],
  };

  messages.forEach((msg) => {
    if (msg.role === "user") {
      const text = msg.text.toLowerCase();

      // Detect amenities
      if (text.includes("pool") || text.includes("swimming"))
        context.mentionedAmenities.push("pool");
      if (text.includes("gym") || text.includes("fitness") || text.includes("workout"))
        context.mentionedAmenities.push("gym");
      if (text.includes("spa") || text.includes("massage"))
        context.mentionedAmenities.push("spa");
      if (text.includes("wifi")) context.mentionedAmenities.push("wifi");

      // Detect room preferences
      if (text.includes("deluxe")) context.preferredRoomType = "deluxe";
      if (text.includes("family"))
        context.preferredRoomType = "family";
      if (text.includes("view") || text.includes("sea view") || text.includes("ocean view"))
        context.preferredRoomType = "view";

      // Detect special needs
      if (text.includes("special") || text.includes("request") || text.includes("need"))
        context.specialNeeds.push(text);
    }
  });

  return context;
};

// Generate personalized greeting based on time
export const getTimeBasedGreeting = () => {
  const hour = new Date().getHours();

  if (hour < 12) return "Good morning! ☀️";
  if (hour < 17) return "Good afternoon! 🌤️";
  if (hour < 21) return "Good evening! 🌆";
  return "Good night! 🌙";
};

// Smart date suggestions
export const getSuggestedDates = () => {
  const today = new Date();
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);

  const nextWeek = new Date(today);
  nextWeek.setDate(nextWeek.getDate() + 7);

  const formatDate = (d) =>
    `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(
      d.getDate()
    ).padStart(2, "0")}`;

  return {
    tonight: { checkIn: formatDate(today), checkOut: formatDate(tomorrow) },
    weekend: {
      checkIn: formatDate(nextWeek),
      checkOut: formatDate(
        new Date(nextWeek.getTime() + 2 * 24 * 60 * 60 * 1000)
      ),
    },
    nextMonth: {
      checkIn: formatDate(new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000)),
      checkOut: formatDate(
        new Date(today.getTime() + 31 * 24 * 60 * 60 * 1000)
      ),
    },
  };
};

// Extract user intent from message
export const extractIntent = (userMessage) => {
  const text = userMessage.toLowerCase();

  const intents = {
    book: ["book", "booking", "reserve", "reservation", "make a booking"],
    search: ["search", "find", "look", "recommend", "suggest", "show me"],
    price: ["price", "cost", "how much", "discount", "promotion", "deal"],
    amenities: ["amenities", "facilities", "features", "what", "services"],
    cancel: ["cancel", "delete", "remove", "cancel booking"],
    modify: ["modify", "update", "change", "edit"],
    contact: ["contact", "support", "help", "hotline", "phone", "email"],
  };

  const detectedIntents = [];
  Object.entries(intents).forEach(([intent, keywords]) => {
    if (keywords.some((kw) => text.includes(kw))) {
      detectedIntents.push(intent);
    }
  });

  return detectedIntents.length > 0 ? detectedIntents[0] : "general";
};

// Generate helpful suggestions based on context
export const generateSuggestions = (userContext, stage) => {
  const suggestions = [];

  if (stage === "idle") {
    suggestions.push("💎 Deluxe Room - Luxurious with stunning views");
    suggestions.push("👨‍👩‍👧‍👦 Family Room - Spacious for families");
    suggestions.push("🏖️ Sea View Room - Ultimate relaxation");
  }

  if (stage === "filter" && userContext.mentionedAmenities.length > 0) {
    suggestions.push(`✓ Features ${userContext.mentionedAmenities.join(", ")}`);
  }

  return suggestions;
};

export default {
  recommendRooms,
  calculateStayInfo,
  getDynamicPrice,
  validateBooking,
  formatConfirmation,
  getContextFromChat,
  getTimeBasedGreeting,
  getSuggestedDates,
  extractIntent,
  generateSuggestions,
};

--- END FILE: src\utils\aiAssistant.js ---

--- START FILE: src\utils\chatboxConfig.js ---
/**
 * ChatBox Configuration & Customization Examples
 * Bạn có thể copy những ví dụ này vào ChatBox.jsx để tùy chỉnh
 */

// ============================================
// 1. THÊM THÊM QUICK ACTIONS
// ============================================

const EXTENDED_QUICK_ACTIONS = [
  { label: "🔍 Tìm phòng", type: "filter", icon: "🔍" },
  { label: "📋 Đặt ngay", type: "book", icon: "📋" },
  { label: "✨ Tiện nghi", type: "amenities", icon: "✨" },
  { label: "🎉 Khuyến mại", type: "promo", icon: "🎉" },
  { label: "📞 Liên hệ", type: "contact", icon: "📞" },
  // Thêm action mới
  { label: "💳 Thanh toán", type: "payment", icon: "💳" },
  { label: "⭐ Reviews", type: "reviews", icon: "⭐" },
  { label: "🎁 Loyalty", type: "loyalty", icon: "🎁" },
];

// ============================================
// 2. CUSTOM AI RESPONSES
// ============================================

const CUSTOM_AI_RESPONSES = {
  greetings: [
    "Xin chào! 👋 Tôi là trợ lý của khách sạn 5 sao. Tôi có thể giúp gì cho bạn?",
    "Chào mừng đến khách sạn của chúng tôi! 🏨 Bạn có nhu cầu gì hôm nay?",
    "Hi! 😊 Tôi ở đây để làm cho ngày của bạn trở nên tuyệt vời!",
  ],
  payment: [
    "💳 Chúng tôi chấp nhận: Thẻ Visa, Mastercard, Apple Pay, Google Pay",
    "💰 Thanh toán an toàn 100% với SSL encryption",
    "✅ Bạn có thể thanh toán online hoặc tại quầy",
  ],
  loyalty: [
    "⭐ Chương trình VIP: Mỗi đặt phòng = 10 điểm\n100 điểm = Discount 20%",
    "🎁 Thành viên được:\n• Nâng cấp phòng miễn phí\n• Breakfast voucher\n• Priority support",
  ],
  reviews: [
    "⭐⭐⭐⭐⭐ 4.8/5 sao từ 2000+ reviews",
    '"Phòng tuyệt vời, nhân viên thân thiện!" - Maria',
    '"Tôi sẽ quay lại!" - John',
  ],
};

// ============================================
// 3. DYNAMIC PRICING EXAMPLES
// ============================================

export const PRICING_RULES = {
  weekday: 1.0, // Thứ 2-4: Giá cơ bản
  friday: 1.15, // Thứ 5: +15%
  weekend: 1.3, // Thứ 6-7: +30%
  holiday: 1.5, // Ngày lễ: +50%
  peakSeason: 1.4, // Cao điểm: +40%
  lowSeason: 0.8, // Thấp điểm: -20%
};

export const HOLIDAY_DATES = [
  "2024-12-25", // Giáng sinh
  "2024-12-31", // Tết
  "2025-01-01", // Năm mới
  "2025-02-10", // Tết Nguyên Đán
  "2025-04-30", // Ngày Giải phóng
  "2025-09-02", // Quốc khánh
];

// ============================================
// 4. ROOM AMENITIES CONFIGURATION
// ============================================

export const ROOM_AMENITIES = {
  standard: ["WiFi", "AC", "TV"],
  deluxe: ["WiFi", "AC", "TV", "Mini Bar", "Bathrobe"],
  suite: ["WiFi", "AC", "TV", "Mini Bar", "Bathrobe", "Hot Tub", "Living Room"],
  family: ["WiFi", "AC", "TV", "Kids Amenities", "Kitchen", "Living Room"],
  vip: ["All amenities", "Butler service", "Premium toiletries", "Champagne"],
};

export const HOTEL_SERVICES = {
  pool: "🏊 Bể bơi Olympic (open 6AM-10PM)",
  gym: "🏋️ Phòng tập hiện đại (24/7)",
  spa: "🧖 Spa & massage (10AM-11PM)",
  restaurant: "🍽️ Nhà hàng 5 sao (6AM-12AM)",
  bar: "🍸 Bar & lounge (5PM-2AM)",
  parking: "🅿️ Bãi đỗ xe miễn phí",
  wifi: "📶 WiFi miễn phí (300 Mbps)",
  transfer: "🚗 Dịch vụ đ接 sân bay",
  concierge: "🎩 Concierge 24/7",
  laundry: "👕 Dịch vụ giặt (next day)",
};

// ============================================
// 5. MESSAGE TEMPLATES
// ============================================

export const MESSAGE_TEMPLATES = {
  welcome: (userName) => `Chào ${userName}! 👋 Chào mừng quay lại!`,

  roomSuggestion: (room, nights, totalPrice) =>
    `🏨 ${room.name}\n📅 ${nights} đêm\n💰 $${totalPrice} (${room.price}/đêm)`,

  bookingConfirmed: (code, roomName, checkIn, checkOut) =>
    `🎉 Xác nhận thành công!\nMã: ${code}\nPhòng: ${roomName}\nNhận: ${checkIn}\nTrara: ${checkOut}`,

  specialRequest: (request) =>
    `📝 Yêu cầu: ${request}\nChúng tôi sẽ xử lý ASAP!`,

  promotionAlert: (discount) =>
    `🎉 Ưu đãi HOT!\nGiảm ${discount}% cho đặt hôm nay!`,
};

// ============================================
// 6. VALIDATION RULES
// ============================================

export const VALIDATION_RULES = {
  name: {
    required: true,
    minLength: 2,
    maxLength: 100,
    pattern: /^[a-zA-Z\s'-]+$/,
    message: "Tên phải từ 2-100 ký tự, chỉ chứa chữ cái",
  },
  email: {
    required: true,
    pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
    message: "Email không hợp lệ",
  },
  phone: {
    required: false,
    pattern: /^(\+84|0)[0-9]{9,10}$/,
    message: "Số điện thoại Việt Nam",
  },
  adults: {
    required: true,
    min: 1,
    max: 10,
    message: "Từ 1-10 người lớn",
  },
  kids: {
    required: true,
    min: 0,
    max: 10,
    message: "Từ 0-10 trẻ em",
  },
};

// ============================================
// 7. CONVERSATION FLOWS
// ============================================

export const CONVERSATION_FLOWS = {
  newUser: [
    "Xin chào! Đây là lần đầu bạn đặt phòng?",
    "Bạn muốn tìm phòng hay có câu hỏi?",
  ],
  returningUser: ["Chào mừng bạn quay lại!", "Lần này bạn muốn đặt phòng nào?"],
  lastMinute: ["⚡ Đặt trong 24h: Giảm 20%!", "Phòng còn trống hôm nay?"],
  groupBooking: [
    "Nhóm từ 10 người trở lên: Giảm 30%",
    "Liên hệ: group@hotel.com hoặc +84123456789",
  ],
};

// ============================================
// 8. ERROR MESSAGES (TIẾNG VIỆT)
// ============================================

export const ERROR_MESSAGES = {
  NETWORK_ERROR: "❌ Lỗi kết nối. Vui lòng kiểm tra internet!",
  BOOKING_FAILED: "❌ Không thể tạo đặt phòng. Thử lại?",
  INVALID_INPUT: "❌ Thông tin không hợp lệ. Vui lòng kiểm tra!",
  ROOM_UNAVAILABLE: "❌ Phòng không còn trống cho ngày này.",
  PAYMENT_FAILED: "❌ Thanh toán thất bại. Thử phương thức khác?",
  SERVER_ERROR: "❌ Lỗi máy chủ. Vui lòng thử lại sau!",
  TOO_MANY_REQUESTS: "⏱️ Quá nhiều yêu cầu. Chờ 1 phút rồi thử lại!",
};

// ============================================
// 9. INTEGRATION EXAMPLES
// ============================================

// Webhook notification
export const notifyBookingEvent = async (event, data) => {
  const payload = {
    event,
    timestamp: new Date().toISOString(),
    ...data,
  };

  // Send to backend
  try {
    const response = await fetch("https://your-api.com/webhooks/booking", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });
    return response.json();
  } catch (error) {
    console.error("Webhook failed:", error);
  }
};

// Send email notification
export const sendBookingEmail = async (email, booking) => {
  try {
    const response = await fetch("https://your-api.com/email/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        to: email,
        template: "booking-confirmation",
        data: booking,
      }),
    });
    return response.json();
  } catch (error) {
    console.error("Email send failed:", error);
  }
};

// SMS notification (optional)
export const sendBookingSMS = async (phone, message) => {
  try {
    const response = await fetch("https://your-sms-api.com/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        phone,
        message,
      }),
    });
    return response.json();
  } catch (error) {
    console.error("SMS send failed:", error);
  }
};

// ============================================
// 10. CUSTOMIZATION GUIDE
// ============================================

/*
HOW TO USE THESE CONFIGURATIONS:

1. Copy các hàm này vào ChatBox.jsx hoặc utils file
2. Import và sử dụng:

   import { ROOM_AMENITIES, MESSAGE_TEMPLATES } from './config';

3. Ví dụ sử dụng:
   
   // Trong handleSend function:
   if (t.includes('tiện nghi')) {
     const amenitiesText = Object.entries(HOTEL_SERVICES)
       .map(([key, value]) => value)
       .join('\n');
     pushAI(amenitiesText);
   }

4. Tùy chỉnh theo hotel của bạn:
   - Đổi giá cước
   - Thêm dịch vụ mới
   - Thay đổi messages
   - Thêm promotion mới

5. Test toàn bộ flows:
   - New user flow
   - Returning user flow
   - Group booking flow
   - Emergency/support flow
*/

export default {
  EXTENDED_QUICK_ACTIONS,
  CUSTOM_AI_RESPONSES,
  PRICING_RULES,
  HOLIDAY_DATES,
  ROOM_AMENITIES,
  HOTEL_SERVICES,
  MESSAGE_TEMPLATES,
  VALIDATION_RULES,
  CONVERSATION_FLOWS,
  ERROR_MESSAGES,
  notifyBookingEvent,
  sendBookingEmail,
  sendBookingSMS,
};

--- END FILE: src\utils\chatboxConfig.js ---

--- START FILE: src\utils\chatboxTesting.js ---
/**
 * ChatBox Testing & Example Scenarios
 * Sử dụng những ví dụ này để test các tính năng của chatbox
 */

// ============================================
// 1. TEST SCENARIOS
// ============================================

export const TEST_SCENARIOS = {
  // Scenario 1: Khách mới tìm phòng
  scenario1_findRoom: {
    name: "Find Rooms - New User",
    steps: [
      { action: "click", target: "quick-action", params: { type: "filter" } },
      { action: "input", target: "checkIn", value: "2024-12-25" },
      { action: "input", target: "checkOut", value: "2024-12-27" },
      { action: "input", target: "adults", value: 2 },
      { action: "input", target: "kids", value: 0 },
      { action: "click", target: "apply-filter" },
    ],
    expectedResult: "Should show filtered rooms and navigate to rooms page",
  },

  // Scenario 2: Khách đặt phòng
  scenario2_booking: {
    name: "Book Room - Direct",
    steps: [
      { action: "click", target: "quick-action", params: { type: "book" } },
      { action: "input", target: "roomName", value: "Deluxe" },
      { action: "waitForSuggestions", timeout: 1000 },
      { action: "click", target: "room-suggestion", params: { index: 0 } },
      { action: "input", target: "name", value: "Nguyễn Văn A" },
      { action: "input", target: "email", value: "test@example.com" },
      { action: "input", target: "phone", value: "+84123456789" },
      { action: "click", target: "create-booking" },
    ],
    expectedResult: "Booking confirmation with code",
  },

  // Scenario 3: Hỏi tư vấn
  scenario3_consultation: {
    name: "Ask Consultation",
    steps: [
      { action: "type", value: "Tôi cần phòng cho 4 người, có bể bơi không?" },
      { action: "send" },
      { action: "waitForResponse", timeout: 2000 },
    ],
    expectedResult: "AI should suggest rooms with pool",
  },

  // Scenario 4: Hỏi về tiện nghi
  scenario4_amenities: {
    name: "Ask About Amenities",
    steps: [
      { action: "type", value: "Có gym, spa không?" },
      { action: "send" },
      { action: "waitForResponse", timeout: 1500 },
    ],
    expectedResult: "Show available amenities",
  },

  // Scenario 5: Hỏi giá
  scenario5_pricing: {
    name: "Ask About Pricing",
    steps: [
      { action: "type", value: "Phòng Deluxe giá bao nhiêu?" },
      { action: "send" },
      { action: "waitForResponse", timeout: 1500 },
    ],
    expectedResult: "Show pricing information",
  },

  // Scenario 6: Mobile responsiveness
  scenario6_mobile: {
    name: "Mobile Responsiveness",
    steps: [
      { action: "resize", width: 375, height: 667 }, // iPhone size
      { action: "click", target: "chatbox-button" },
      { action: "check", target: "chatbox-width", expected: "360px" },
    ],
    expectedResult: "Chatbox should be responsive",
  },
};

// ============================================
// 2. UNIT TEST EXAMPLES (Jest)
// ============================================

export const unitTestExamples = `
// Test: validateBookingForm
describe('validateBookingForm', () => {
  test('should fail with empty name', () => {
    const result = validateBookingForm({
      name: '',
      email: 'test@test.com',
      checkIn: '2024-12-25',
      checkOut: '2024-12-27',
      roomName: 'Deluxe',
      adults: 2,
      kids: 0
    });
    expect(result.isValid).toBe(false);
    expect(result.errors[0].code).toBe('INVALID_NAME');
  });

  test('should fail with invalid email', () => {
    const result = validateBookingForm({
      name: 'John Doe',
      email: 'invalid-email',
      checkIn: '2024-12-25',
      checkOut: '2024-12-27',
      roomName: 'Deluxe',
      adults: 2,
      kids: 0
    });
    expect(result.isValid).toBe(false);
    expect(result.errors[0].code).toBe('INVALID_EMAIL');
  });

  test('should fail with invalid dates', () => {
    const result = validateBookingForm({
      name: 'John Doe',
      email: 'test@test.com',
      checkIn: '2024-12-27',
      checkOut: '2024-12-25', // Before check-in!
      roomName: 'Deluxe',
      adults: 2,
      kids: 0
    });
    expect(result.isValid).toBe(false);
    expect(result.errors[0].code).toBe('INVALID_DATES');
  });

  test('should pass with valid data', () => {
    const result = validateBookingForm({
      name: 'John Doe',
      email: 'test@test.com',
      checkIn: '2024-12-25',
      checkOut: '2024-12-27',
      roomName: 'Deluxe',
      adults: 2,
      kids: 0
    });
    expect(result.isValid).toBe(true);
    expect(result.errors.length).toBe(0);
  });
});

// Test: extractIntent
describe('extractIntent', () => {
  test('should detect book intent', () => {
    expect(extractIntent('tôi muốn đặt phòng')).toBe('book');
    expect(extractIntent('book a room')).toBe('book');
  });

  test('should detect search intent', () => {
    expect(extractIntent('gợi ý phòng')).toBe('search');
    expect(extractIntent('suggest rooms')).toBe('search');
  });

  test('should detect price intent', () => {
    expect(extractIntent('giá bao nhiêu')).toBe('price');
    expect(extractIntent('how much')).toBe('price');
  });

  test('should return general for unknown', () => {
    expect(extractIntent('xin chào')).toBe('general');
  });
});

// Test: sanitizeInput
describe('sanitizeInput', () => {
  test('should sanitize HTML', () => {
    const input = '<script>alert("xss")</script>';
    const result = sanitizeInput(input);
    expect(result).not.toContain('<script>');
    expect(result).toContain('&lt;script&gt;');
  });

  test('should trim whitespace', () => {
    const input = '  hello world  ';
    const result = sanitizeInput(input);
    expect(result).toBe('hello world');
  });

  test('should limit length', () => {
    const input = 'a'.repeat(1000);
    const result = sanitizeInput(input);
    expect(result.length).toBeLessThanOrEqual(500);
  });
});

// Test: calculateNights
describe('calculateNights', () => {
  test('should calculate nights correctly', () => {
    expect(calculateNights('2024-12-25', '2024-12-26')).toBe(1);
    expect(calculateNights('2024-12-25', '2024-12-27')).toBe(2);
    expect(calculateNights('2024-12-25', '2024-12-30')).toBe(5);
  });

  test('should handle same day', () => {
    expect(calculateNights('2024-12-25', '2024-12-25')).toBe(0);
  });
});
`;

// ============================================
// 3. MANUAL TEST CHECKLIST
// ============================================

export const MANUAL_TEST_CHECKLIST = [
  {
    category: "Visual & UX",
    tests: [
      "✅ Chatbox button appears at bottom-right",
      "✅ Button has animate bounce effect",
      "✅ Clicking button opens chatbox",
      "✅ Chatbox has rounded corners (border-radius: 1.5rem)",
      "✅ Gradient header (blue-600 to blue-700)",
      "✅ Messages fade in smoothly",
      "✅ Timestamps visible on messages",
      "✅ Typing dots animate correctly",
      "✅ Scroll to latest message automatically",
      "✅ Mobile: responsive width adjustment",
    ],
  },
  {
    category: "Functionality",
    tests: [
      "✅ Sending messages works",
      "✅ Quick reply buttons trigger actions",
      "✅ Filter form inputs accept values",
      "✅ Booking form all fields fillable",
      "✅ Room suggestions appear when typing name",
      "✅ Apply filter navigates to rooms",
      "✅ Create booking generates confirmation code",
      "✅ Error messages display for invalid input",
      "✅ Close button works",
      "✅ Enter key sends message",
    ],
  },
  {
    category: "Validation",
    tests: [
      "✅ Name cannot be empty",
      "✅ Email must have @",
      "✅ Check-out must be after check-in",
      "✅ Adults cannot be 0 or > 10",
      "✅ Phone number validation (if filled)",
      "✅ Room name cannot be empty",
      "✅ Error messages are helpful",
      "✅ Can recover from error",
      "✅ Validation happens before booking",
      "✅ No booking created on validation fail",
    ],
  },
  {
    category: "Data Persistence",
    tests: [
      "✅ Chat history saves in localStorage",
      "✅ Chat history loads on page reload",
      "✅ Different users have separate history",
      "✅ LocalStorage key includes user ID",
      "✅ Analytics data tracked",
      "✅ Booking data passed to context",
      "✅ Timestamps stored correctly",
      "✅ No errors in console",
      "✅ Storage doesn't exceed limit",
    ],
  },
  {
    category: "AI Responses",
    tests: [
      "✅ Initial greeting message appears",
      "✅ Different response variants work",
      "✅ Typing delay (500-600ms) feels natural",
      "✅ Random responses vary",
      "✅ Intent detection works for book/search/price",
      "✅ Fallback response for unknown intent",
      "✅ Emoji display correctly",
      "✅ Vietnamese text displays correctly",
      "✅ Links work if included",
      "✅ Special characters display properly",
    ],
  },
  {
    category: "Mobile",
    tests: [
      "✅ Chatbox button visible on mobile",
      "✅ Chatbox opens/closes smoothly",
      "✅ Form fields readable on mobile",
      "✅ Text input usable on mobile",
      "✅ Buttons clickable (touch-friendly)",
      "✅ Scroll works on long messages",
      "✅ Emoji render correctly",
      "✅ No horizontal scroll",
      "✅ Keyboard doesn't overlap content",
      "✅ Portrait & landscape work",
    ],
  },
  {
    category: "Integration",
    tests: [
      "✅ RoomContext methods called",
      "✅ AuthContext user info used",
      "✅ React icons display",
      "✅ Tailwind classes applied",
      "✅ CSS animations work",
      "✅ No console errors",
      "✅ No memory leaks",
      "✅ Performance acceptable",
      "✅ Browser compatibility (Chrome, Firefox, Safari, Edge)",
      "✅ No unused variables/imports",
    ],
  },
  {
    category: "Accessibility",
    tests: [
      "✅ ARIA labels on buttons",
      "✅ Keyboard navigation works",
      "✅ Tab order logical",
      "✅ Color contrast sufficient",
      "✅ Focus indicators visible",
      "✅ No autofocus trap",
      "✅ Screen reader friendly",
      "✅ Text size readable",
      "✅ Links underlined if needed",
      "✅ Forms labeled properly",
    ],
  },
];

// ============================================
// 4. PERFORMANCE TEST
// ============================================

export const PERFORMANCE_TESTS = {
  chatOpen: {
    name: "Time to open chatbox",
    target: "< 200ms",
    test: () => {
      const start = performance.now();
      // Click button
      const end = performance.now();
      return end - start;
    },
  },
  messageSend: {
    name: "Time to send message",
    target: "< 100ms",
    test: () => {
      const start = performance.now();
      // Send message
      const end = performance.now();
      return end - start;
    },
  },
  roomFilter: {
    name: "Time to filter rooms",
    target: "< 500ms",
    test: () => {
      const start = performance.now();
      // Apply filter
      const end = performance.now();
      return end - start;
    },
  },
  validation: {
    name: "Time to validate form",
    target: "< 50ms",
    test: () => {
      const start = performance.now();
      // Validate
      const end = performance.now();
      return end - start;
    },
  },
};

// ============================================
// 5. DEBUG HELPERS
// ============================================

export const DEBUG_HELPERS = {
  // Log all messages
  logMessages: () => {
    console.warn("logMessages(): localStorage-based history has been removed.");
  },

  // Clear chat history
  clearHistory: () => {
    console.warn("clearHistory(): localStorage-based history has been removed.");
  },

  // Log analytics
  logAnalytics: () => {
    console.warn(
      "logAnalytics(): localStorage-based analytics has been removed."
    );
  },

  // Test validation
  testValidation: (data) => {
    const { validateBookingForm } = require("./chatboxValidation");
    const result = validateBookingForm(data);
    console.log("Validation result:", result);
    return result;
  },

  // Test intent detection
  testIntent: (message) => {
    const { extractIntent } = require("./aiAssistant");
    const intent = extractIntent(message);
    console.log(`Intent for "${message}": ${intent}`);
    return intent;
  },

  // Performance monitor
  monitorPerformance: () => {
    if (window.performance) {
      const perfData = window.performance.timing;
      console.log("Performance Metrics:");
      console.log(
        "DOM Content Loaded:",
        perfData.domContentLoadedEventEnd - perfData.navigationStart
      );
      console.log(
        "Page Load Time:",
        perfData.loadEventEnd - perfData.navigationStart
      );
    }
  },
};

// ============================================
// 6. SAMPLE TEST DATA
// ============================================

export const SAMPLE_DATA = {
  validBooking: {
    name: "Nguyễn Văn A",
    email: "nguyen@example.com",
    phone: "+84912345678",
    checkIn: "2024-12-25",
    checkOut: "2024-12-27",
    roomName: "Deluxe",
    adults: 2,
    kids: 1,
    specialRequests: "High floor, sea view",
  },

  invalidBooking: {
    name: "",
    email: "invalid-email",
    checkIn: "2024-12-27",
    checkOut: "2024-12-25",
    roomName: "",
    adults: 15,
  },

  sampleRooms: [
    {
      id: 1,
      name: "Deluxe Room",
      type: "deluxe",
      price: 150,
      maxPerson: 2,
      image: "url",
      beds: 1,
    },
    {
      id: 2,
      name: "Family Room",
      type: "family",
      price: 250,
      maxPerson: 4,
      image: "url",
      beds: 2,
    },
    {
      id: 3,
      name: "Suite",
      type: "suite",
      price: 400,
      maxPerson: 3,
      image: "url",
      beds: 1,
    },
  ],

  sampleUser: {
    id: "user_123",
    name: "John Doe",
    email: "john@example.com",
    phone: "+84912345678",
  },
};

// ============================================
// USAGE IN BROWSER CONSOLE
// ============================================

export const CONSOLE_COMMANDS = `
// Copy-paste vào browser console để test:

// 1. Xem chat history
console.table(JSON.parse(localStorage.getItem('hotel_chat_history_guest')))

// 2. Xem analytics
console.table(JSON.parse(localStorage.getItem('hotel_chat_analytics')))

// 3. Xóa history
localStorage.removeItem('hotel_chat_history_guest')

// 4. Kiểm tra performance
performance.measure('chatbox')

// 5. Xem state (cần add console.log trong component)
// ... định nghĩa trong React Component
`;

export default {
  TEST_SCENARIOS,
  MANUAL_TEST_CHECKLIST,
  PERFORMANCE_TESTS,
  DEBUG_HELPERS,
  SAMPLE_DATA,
  unitTestExamples,
  CONSOLE_COMMANDS,
};

--- END FILE: src\utils\chatboxTesting.js ---

--- START FILE: src\utils\chatboxValidation.js ---
/**
 * Validation & Error Handling for ChatBox
 */

export const BookingErrors = {
  INVALID_NAME: {
    code: "INVALID_NAME",
    message: "❌ Vui lòng nhập tên đầy đủ",
    vietnamese: "Tên không được để trống",
  },
  INVALID_EMAIL: {
    code: "INVALID_EMAIL",
    message: "❌ Email không hợp lệ",
    vietnamese: "Email phải chứa @ và có định dạng đúng",
  },
  INVALID_DATES: {
    code: "INVALID_DATES",
    message: "❌ Ngày trả phòng phải sau ngày nhận phòng",
    vietnamese: "Vui lòng kiểm tra lại ngày",
  },
  NO_ROOM: {
    code: "NO_ROOM",
    message: "❌ Không tìm thấy phòng trùng khớp",
    vietnamese: "Thử từ khóa khác hoặc xem tất cả phòng",
  },
  ROOM_FULL: {
    code: "ROOM_FULL",
    message: "❌ Phòng này đã đầy cho ngày được chọn",
    vietnamese: "Vui lòng chọn ngày khác hoặc phòng khác",
  },
  DATABASE_ERROR: {
    code: "DATABASE_ERROR",
    message: "❌ Lỗi khi tạo đặt phòng",
    vietnamese: "Vui lòng thử lại sau",
  },
};

/**
 * Validate booking form data
 */
export const validateBookingForm = (formData) => {
  const errors = [];

  // Validate name
  if (!formData.name || !formData.name.trim()) {
    errors.push(BookingErrors.INVALID_NAME);
  }

  // Validate email
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!formData.email || !emailRegex.test(formData.email)) {
    errors.push(BookingErrors.INVALID_EMAIL);
  }

  // Validate dates
  if (new Date(formData.checkIn) >= new Date(formData.checkOut)) {
    errors.push(BookingErrors.INVALID_DATES);
  }

  // Validate room name
  if (!formData.roomName || !formData.roomName.trim()) {
    errors.push(BookingErrors.NO_ROOM);
  }

  // Validate adults
  if (formData.adults < 1 || formData.adults > 10) {
    errors.push({
      code: "INVALID_ADULTS",
      message: "❌ Số người lớn phải từ 1-10",
      vietnamese: "Vui lòng nhập lại số người",
    });
  }

  return {
    isValid: errors.length === 0,
    errors,
  };
};

/**
 * Validate filter form data
 */
export const validateFilterForm = (formData) => {
  const errors = [];

  if (new Date(formData.checkIn) >= new Date(formData.checkOut)) {
    errors.push(BookingErrors.INVALID_DATES);
  }

  if (formData.adults < 1) {
    errors.push({
      code: "INVALID_FILTER",
      message: "❌ Cần ít nhất 1 người lớn",
      vietnamese: "Vui lòng nhập lại thông tin",
    });
  }

  return {
    isValid: errors.length === 0,
    errors,
  };
};

/**
 * Sanitize user input to prevent XSS
 */
export const sanitizeInput = (input) => {
  if (typeof input !== "string") return "";

  return input
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#x27;")
    .trim()
    .substring(0, 500); // Limit to 500 chars
};

/**
 * Format error message for display
 */
export const formatErrorMessage = (error) => {
  if (typeof error === "string") {
    return error;
  }

  if (error.message) {
    return error.message;
  }

  return "❌ Có lỗi xảy ra. Vui lòng thử lại!";
};

/**
 * Check if email is valid
 */
export const isValidEmail = (email) => {
  const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return regex.test(email);
};

/**
 * Check if phone is valid (Vietnamese format)
 */
export const isValidPhone = (phone) => {
  if (!phone) return true; // Optional field
  const regex = /^(\+84|0)[0-9]{9,10}$/;
  return regex.test(phone.replace(/\s/g, ""));
};

/**
 * Format date for display
 */
export const formatDateDisplay = (dateString) => {
  try {
    const date = new Date(dateString);
    return date.toLocaleDateString("vi-VN", {
      weekday: "short",
      year: "numeric",
      month: "short",
      day: "numeric",
    });
  } catch {
    return dateString;
  }
};

/**
 * Calculate number of nights
 */
export const calculateNights = (checkIn, checkOut) => {
  try {
    const start = new Date(checkIn);
    const end = new Date(checkOut);
    const nights = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
    return Math.max(1, nights);
  } catch {
    return 1;
  }
};

/**
 * Calculate total price
 */
export const calculateTotalPrice = (pricePerNight, nights, extras = []) => {
  let total = pricePerNight * nights;

  // Add extra fees
  extras.forEach((extra) => {
    if (extra.percentage) {
      total += total * (extra.amount / 100);
    } else {
      total += extra.amount;
    }
  });

  return Math.round(total * 100) / 100;
};

/**
 * Check room availability
 */
export const checkRoomAvailability = (
  room,
  checkIn,
  checkOut,
  existingBookings = []
) => {
  if (!room) return { available: false, reason: "Phòng không tồn tại" };

  // Check if room has capacity
  if (room.currentGuests >= room.capacity) {
    return { available: false, reason: "Phòng đã đầy" };
  }

  // Check for conflicting bookings
  const checkInDate = new Date(checkIn);
  const checkOutDate = new Date(checkOut);

  const hasConflict = existingBookings.some((booking) => {
    const bookingStart = new Date(booking.checkIn);
    const bookingEnd = new Date(booking.checkOut);

    return (
      (checkInDate >= bookingStart && checkInDate < bookingEnd) ||
      (checkOutDate > bookingStart && checkOutDate <= bookingEnd) ||
      (checkInDate < bookingStart && checkOutDate > bookingEnd)
    );
  });

  if (hasConflict) {
    return { available: false, reason: "Phòng đã được đặt cho ngày này" };
  }

  return { available: true };
};

/**
 * Log chat interaction for analytics
 */
export const logChatInteraction = (event, data = {}) => {
  const timestamp = new Date().toISOString();
  const interaction = {
    event,
    timestamp,
    userAgent: navigator.userAgent,
    ...data,
  };

  // Hiện tại chỉ log ra console, không lưu localStorage
  // (có thể thay bằng gửi lên Supabase/API analytics trong tương lai)
  // eslint-disable-next-line no-console
  console.debug("Chat interaction:", interaction);
};

/**
 * Generate booking confirmation details
 */
export const generateBookingConfirmation = (booking, room) => {
  const nights = calculateNights(booking.checkIn, booking.checkOut);
  const totalPrice = calculateTotalPrice(room.price, nights);

  return {
    confirmationCode: booking.confirmationCode || `${Date.now()}`,
    room: {
      name: room.name,
      type: room.type,
      price: room.price,
      amenities: room.amenities || [],
    },
    guest: {
      name: booking.name,
      email: booking.email,
      phone: booking.phone,
    },
    dates: {
      checkIn: formatDateDisplay(booking.checkIn),
      checkOut: formatDateDisplay(booking.checkOut),
      nights,
    },
    guests: {
      adults: booking.adults,
      kids: booking.kids,
      total: booking.adults + booking.kids,
    },
    pricing: {
      pricePerNight: room.price,
      nights,
      subtotal: room.price * nights,
      tax: Math.round(room.price * nights * 0.1 * 100) / 100,
      total: totalPrice,
    },
    specialRequests: booking.specialRequests,
    created: new Date().toISOString(),
  };
};

export default {
  validateBookingForm,
  validateFilterForm,
  sanitizeInput,
  formatErrorMessage,
  isValidEmail,
  isValidPhone,
  formatDateDisplay,
  calculateNights,
  calculateTotalPrice,
  checkRoomAvailability,
  logChatInteraction,
  generateBookingConfirmation,
  BookingErrors,
};

--- END FILE: src\utils\chatboxValidation.js ---

--- START FILE: src\utils\clearTestData.js ---
// Legacy helper file previously used to clear localStorage-based test data.
// Booking/review data is now stored exclusively in Supabase, so these helpers
// are left as no-ops for backward compatibility and should not be used.

export const clearAllTestData = () => {
  console.warn("clearAllTestData(): localStorage-based test data has been removed.");
};

export const clearBookings = () => {
  console.warn("clearBookings(): localStorage-based bookings have been removed.");
};

export const clearReviews = () => {
  console.warn("clearReviews(): localStorage-based reviews have been removed.");
};

--- END FILE: src\utils\clearTestData.js ---

--- START FILE: src\utils\emailService.js ---
import emailjs from '@emailjs/browser';

// ============================================
// EMAILJS CONFIGURATION
// ============================================
// Để gửi email thật, bạn cần:
// 1. Đăng ký tài khoản tại https://www.emailjs.com/ (miễn phí)
// 2. Tạo Email Service (Gmail) và lấy Service ID
// 3. Tạo Email Template và lấy Template ID  
// 4. Lấy Public Key từ Account Settings
// 5. Thay thế các giá trị bên dưới

const PUBLIC_KEY = 'YOUR_PUBLIC_KEY'; // Thay bằng Public Key của bạn
const SERVICE_ID = 'YOUR_SERVICE_ID'; // Thay bằng Service ID của bạn
const RESET_TEMPLATE_ID = 'YOUR_TEMPLATE_ID'; // Thay bằng Template ID cho reset mật khẩu
const BOOKING_TEMPLATE_ID = 'YOUR_BOOKING_TEMPLATE_ID'; // Thay bằng Template ID cho booking

// Initialize EmailJS (chỉ khi đã config)
if (PUBLIC_KEY !== 'YOUR_PUBLIC_KEY') {
  emailjs.init(PUBLIC_KEY);
}

/**
 * Send password reset code email
 * @param {string} toEmail - Recipient email address
 * @param {string} resetCode - 6-digit reset code
 * @param {string} userName - User's name (optional)
 * @returns {Promise} - Promise that resolves when email is sent
 */
export const sendResetCodeEmail = async (toEmail, resetCode, userName = 'User') => {
  try {
    const templateParams = {
      to_email: toEmail,
      to_name: userName,
      reset_code: resetCode,
      from_name: 'Hotel Booking',
      message: `Your password reset code is: ${resetCode}. This code will expire in 10 minutes.`,
    };

    const response = await emailjs.send(
      SERVICE_ID,
      RESET_TEMPLATE_ID,
      templateParams
    );

    return {
      success: true,
      message: 'Reset code sent successfully!',
      response
    };
  } catch (error) {
    console.error('EmailJS Error:', error);
    return {
      success: false,
      error: error.text || 'Failed to send email. Please try again.',
      details: error
    };
  }
};

/**
 * Check if EmailJS is configured
 */
export const isEmailConfigured = () => {
  return PUBLIC_KEY !== 'YOUR_PUBLIC_KEY' && 
         SERVICE_ID !== 'YOUR_SERVICE_ID' && 
         RESET_TEMPLATE_ID !== 'YOUR_TEMPLATE_ID';
};

export const isBookingEmailConfigured = () => {
  return PUBLIC_KEY !== 'YOUR_PUBLIC_KEY' && 
         SERVICE_ID !== 'YOUR_SERVICE_ID' && 
         BOOKING_TEMPLATE_ID !== 'YOUR_BOOKING_TEMPLATE_ID';
};

export const isContactEmailConfigured = () => {
  return PUBLIC_KEY !== 'YOUR_PUBLIC_KEY' && 
         SERVICE_ID !== 'YOUR_SERVICE_ID';
};

export const sendContactEmail = async ({ fromName, fromEmail, phone, subject, message }) => {
  if (!isContactEmailConfigured()) {
    console.log('Contact email would be sent from:', fromEmail, 'subject:', subject);
    return {
      success: true,
      message: 'Contact email sent (demo mode)',
    };
  }

  try {
    const templateParams = {
      from_name: fromName,
      from_email: fromEmail,
      phone: phone || 'N/A',
      subject: subject,
      message: message,
      to_email: 'booking@adinahotel.com', // Hotel contact email
      to_name: 'Adina Hotel Concierge',
    };

    // Use a contact template ID (you can reuse RESET_TEMPLATE_ID or create a new one)
    const CONTACT_TEMPLATE_ID = RESET_TEMPLATE_ID; // Or create a separate template
    
    const response = await emailjs.send(
      SERVICE_ID,
      CONTACT_TEMPLATE_ID,
      templateParams
    );

    return {
      success: true,
      message: 'Contact email sent successfully!',
      response
    };
  } catch (error) {
    console.error('EmailJS Contact Error:', error);
    return {
      success: true, // Still return success in demo mode
      message: 'Contact email sent (demo mode)',
      error: error.text || 'Failed to send email (demo mode)',
    };
  }
};

export const sendBookingConfirmationEmail = async ({ toEmail, toName = 'Guest', booking }) => {
  if (!isBookingEmailConfigured()) {
    // In demo mode, just log that email would be sent
    console.log('Email would be sent to:', toEmail, 'for booking:', booking?.confirmationCode);
    return {
      success: true,
      message: 'Booking confirmation email sent (demo mode)',
    };
  }

  try {
    const bookingType = booking?.type || 'room';
    let bookingDetails = '';
    
    if (bookingType === 'room') {
      bookingDetails = `
Room: ${booking?.roomName || 'N/A'}
Check-in: ${booking?.checkIn || 'N/A'}
Check-out: ${booking?.checkOut || 'N/A'}
Nights: ${booking?.totalNights || 1}
Guests: ${booking?.adults || 1} Adult(s)${booking?.kids ? `, ${booking.kids} Kid(s)` : ''}
      `;
    } else if (bookingType === 'restaurant') {
      bookingDetails = `
Date & Time: ${booking?.date || 'N/A'}
Number of Guests: ${booking?.guests || 1}
Service: ${booking?.serviceName || 'Restaurant Reservation'}
      `;
    } else if (bookingType === 'spa') {
      bookingDetails = `
Date & Time: ${booking?.date || 'N/A'}
Service: ${booking?.serviceName || booking?.service || 'N/A'}
Duration: ${booking?.duration || 'N/A'}
${booking?.therapist ? `Therapist: ${booking.therapist}` : ''}
      `;
    }

    const totalWithTax = ((booking?.totalPrice || booking?.price || 0) * 1.1).toFixed(2);

    const templateParams = {
      to_email: toEmail,
      to_name: toName,
      booking_type: bookingType === 'room' ? 'Room Booking' : bookingType === 'restaurant' ? 'Restaurant Reservation' : 'Spa Appointment',
      confirmation_code: booking?.confirmationCode,
      payment_code: booking?.paymentCode || 'N/A',
      booking_details: bookingDetails,
      total_amount: `$${booking?.totalPrice || booking?.price || 0}`,
      tax_amount: `$${((booking?.totalPrice || booking?.price || 0) * 0.1).toFixed(2)}`,
      total_with_tax: `$${totalWithTax}`,
      payment_method: booking?.paymentMethod || 'QR Code',
      invoice_date: new Date(booking?.paidAt || booking?.createdAt).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      }),
    };

    const response = await emailjs.send(
      SERVICE_ID,
      BOOKING_TEMPLATE_ID,
      templateParams
    );

    return {
      success: true,
      message: 'Invoice email sent successfully!',
      response
    };
  } catch (error) {
    console.error('EmailJS Booking Error:', error);
    // Still return success in demo mode to not block the flow
    return {
      success: true,
      message: 'Invoice email sent (demo mode)',
      error: error.text || 'Failed to send email (demo mode)',
    };
  }
};


--- END FILE: src\utils\emailService.js ---

--- START FILE: src\utils\notifications.js ---
/**
 * Notification/Toast System
 * Centralized notification handling for the application
 */

// Store active notifications
let notifications = [];
let notificationId = 0;
let listeners = [];

/**
 * Subscribe to notification changes
 */
export const subscribeToNotifications = (callback) => {
  listeners.push(callback);
  return () => {
    listeners = listeners.filter(l => l !== callback);
  };
};

/**
 * Notify all listeners
 */
const notifyListeners = () => {
  listeners.forEach(listener => listener([...notifications]));
};

/**
 * Show notification
 */
export const showNotification = (message, type = 'info', duration = 3000) => {
  const id = notificationId++;
  const notification = {
    id,
    message,
    type, // 'success', 'error', 'warning', 'info'
    duration
  };

  notifications.push(notification);
  notifyListeners();

  // Auto-remove after duration
  if (duration > 0) {
    setTimeout(() => {
      removeNotification(id);
    }, duration);
  }

  return id;
};

/**
 * Remove notification
 */
export const removeNotification = (id) => {
  notifications = notifications.filter(n => n.id !== id);
  notifyListeners();
};

/**
 * Success notification
 */
export const notifySuccess = (message, duration = 3000) => {
  return showNotification(message, 'success', duration);
};

/**
 * Error notification
 */
export const notifyError = (message, duration = 5000) => {
  return showNotification(message, 'error', duration);
};

/**
 * Warning notification
 */
export const notifyWarning = (message, duration = 4000) => {
  return showNotification(message, 'warning', duration);
};

/**
 * Info notification
 */
export const notifyInfo = (message, duration = 3000) => {
  return showNotification(message, 'info', duration);
};

/**
 * Get all notifications
 */
export const getNotifications = () => {
  return [...notifications];
};

/**
 * Clear all notifications
 */
export const clearNotifications = () => {
  notifications = [];
  notifyListeners();
};

--- END FILE: src\utils\notifications.js ---

--- START FILE: src\utils\ScrollToTop.js ---
import { useLocation } from 'react-router-dom';
import { useEffect } from 'react';

const ScrollToTop = () => {

  const { pathname } = useLocation();

  useEffect(() => {
    window.scrollTo(0, 0);
  }, [pathname]);

};

export default ScrollToTop;

--- END FILE: src\utils\ScrollToTop.js ---

--- START FILE: src\utils\supabaseClient.js ---
import { createClient } from '@supabase/supabase-js';

// Initialize Supabase client
// For Vite, use import.meta.env instead of process.env
const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || 'https://sxteddkozzqniebfstag.supabase.co';
const SUPABASE_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4dGVkZGtvenpxbmllYmZzdGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NjQwMDgsImV4cCI6MjA3NzQ0MDAwOH0.FYblHTFrNTthvpcdGy6DFefjnApCe4qwcKZaHdkTiac';

// Debug log
console.log('🔐 Supabase URL:', SUPABASE_URL.substring(0, 30) + '...');

export const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);


--- END FILE: src\utils\supabaseClient.js ---

--- START FILE: src\utils\supabaseStorageUrls.js ---
/**
 * Supabase Storage URLs Configuration
 * Bucket: hotel-rooms
 * Base URL: https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms
 */

const SUPABASE_PROJECT_ID = 'sxteddkozzqniebfstag';
const STORAGE_BUCKET = 'hotel-rooms';
const STORAGE_BASE_URL = `https://${SUPABASE_PROJECT_ID}.supabase.co/storage/v1/object/public/${STORAGE_BUCKET}`;

/**
 * Generate room image URL
 * @param {string} imagePath - Path to image (e.g., 'img/rooms/1.png')
 * @returns {string} Full Supabase Storage URL
 */
export const getRoomImageUrl = (imagePath) => {
  if (!imagePath) return null;
  
  // If already a full URL, return as is
  if (imagePath.startsWith('http')) {
    return imagePath;
  }
  
  // Build URL from path
  return `${STORAGE_BASE_URL}/${imagePath}`;
};

/**
 * Get room thumbnail image URL
 * @param {number} roomNumber - Room number (1-8)
 * @returns {string} Full Supabase Storage URL for thumbnail
 */
export const getRoomThumbnailUrl = (roomNumber) => {
  return getRoomImageUrl(`img/rooms/${roomNumber}.png`);
};

/**
 * Get room large image URL
 * @param {number} roomNumber - Room number (1-8)
 * @returns {string} Full Supabase Storage URL for large image
 */
export const getRoomLargeImageUrl = (roomNumber) => {
  return getRoomImageUrl(`img/rooms/${roomNumber}-lg.png`);
};

/**
 * Get logo URL
 * @param {string} type - 'dark' or 'white'
 * @returns {string} Full Supabase Storage URL for logo
 */
export const getLogoUrl = (type = 'dark') => {
  // logos are stored under img/ in the bucket
  return getRoomImageUrl(`img/logo-${type}.svg`);
};

/**
 * Build image URLs for room type
 * @param {number} roomNumber - Room number (1-8)
 * @returns {object} Object with image_url and image_lg_url
 */
export const buildRoomImageUrls = (roomNumber) => {
  return {
    image_url: getRoomThumbnailUrl(roomNumber),
    image_lg_url: getRoomLargeImageUrl(roomNumber),
  };
};

/**
 * Room type to image number mapping
 * Standard (STD) → 1
 * Deluxe (DLX) → 2
 * Suite (SUI) → 3
 * Penthouse (PEN) → 4
 * Combo (CMB) → 5
 */
export const ROOM_TYPE_IMAGE_MAP = {
  'STD': 1,
  'DLX': 2,
  'SUI': 3,
  'PEN': 4,
  'CMB': 5,
};

/**
 * Get image URLs for room type code
 * @param {string} roomTypeCode - Room type code (STD, DLX, SUI, PEN, CMB)
 * @returns {object} Object with image_url and image_lg_url
 */
export const getImageUrlsByRoomType = (roomTypeCode) => {
  const imageNumber = ROOM_TYPE_IMAGE_MAP[roomTypeCode?.toUpperCase()];
  if (!imageNumber) {
    console.warn(`⚠️ Unknown room type code: ${roomTypeCode}`);
    return { image_url: null, image_lg_url: null };
  }
  return buildRoomImageUrls(imageNumber);
};

/**
 * Example usage:
 * 
 * // Get URL for room 1 thumbnail
 * const url = getRoomThumbnailUrl(1);
 * // Result: https://sxteddkozzqniebfstag.supabase.co/storage/v1/object/public/hotel-rooms/img/rooms/1.png
 * 
 * // Get URLs for Standard room type
 * const urls = getImageUrlsByRoomType('STD');
 * // Result: {
 * //   image_url: 'https://...hotel-rooms/img/rooms/1.png',
 * //   image_lg_url: 'https://...hotel-rooms/img/rooms/1-lg.png'
 * // }
 * 
 * // Get logo
 * const logo = getLogoUrl('dark');
 * // Result: https://...hotel-rooms/logo-dark.svg
 */

export default {
  STORAGE_BASE_URL,
  getRoomImageUrl,
  getRoomThumbnailUrl,
  getRoomLargeImageUrl,
  getLogoUrl,
  buildRoomImageUrls,
  getImageUrlsByRoomType,
  ROOM_TYPE_IMAGE_MAP,
};

--- END FILE: src\utils\supabaseStorageUrls.js ---

--- START FILE: vite.config.js ---
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import svgr from 'vite-plugin-svgr'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react(),  svgr()],
})

--- END FILE: vite.config.js ---

